# ğŸ“Š éšæ®µä¸€ï¼šTLEæ•¸æ“šè¼‰å…¥èˆ‡SGP4è»Œé“è¨ˆç®—

[ğŸ”„ è¿”å›æ–‡æª”ç¸½è¦½](../README.md) > éšæ®µä¸€

## ğŸ“– éšæ®µæ¦‚è¿°

**ç›®æ¨™**ï¼šå¾ 8,791 é¡†è¡›æ˜Ÿè¼‰å…¥ TLE æ•¸æ“šä¸¦åŸ·è¡Œç²¾ç¢ºçš„ SGP4 è»Œé“è¨ˆç®—  
**è¼¸å…¥**ï¼šTLE æª”æ¡ˆï¼ˆç´„ 2.2MBï¼‰  
**è¼¸å‡º**ï¼šå…¨é‡æ•¸æ“šä¿å­˜è‡³ `/app/data/tle_orbital_calculation_output.json` + è¨˜æ†¶é«”å‚³é  
**è™•ç†æ™‚é–“**ï¼šç´„ 4-5 åˆ†é˜
**å¯¦éš›è™•ç†æ•¸é‡**ï¼š8,140 Starlink + 651 OneWeb = 8,791 é¡†è¡›æ˜Ÿ

### ğŸ—‚ï¸ çµ±ä¸€è¼¸å‡ºç›®éŒ„çµæ§‹

å…­éšæ®µè™•ç†ç³»çµ±æ¡ç”¨çµ±ä¸€çš„è¼¸å‡ºç›®éŒ„çµæ§‹ï¼š

```bash
/app/data/                                    # çµ±ä¸€æ•¸æ“šç›®éŒ„
â”œâ”€â”€ tle_orbital_calculation_output.json      # éšæ®µä¸€ï¼šè»Œé“è¨ˆç®— â­
â”œâ”€â”€ satellite_visibility_filtered_output.json # éšæ®µäºŒï¼šåœ°ç†å¯è¦‹æ€§ç¯©é¸  
â”œâ”€â”€ signal_quality_analysis_output.json      # éšæ®µä¸‰ï¼šä¿¡è™Ÿåˆ†æ
â”œâ”€â”€ timeseries_preprocessing_output.json     # éšæ®µå››ï¼šæ™‚é–“åºåˆ—
â”œâ”€â”€ data_integration_output.json             # éšæ®µäº”ï¼šæ•¸æ“šæ•´åˆ
â”œâ”€â”€ enhanced_dynamic_pools_output.json       # éšæ®µå…­ï¼šå‹•æ…‹æ± è¦åŠƒ
â””â”€â”€ validation_snapshots/                    # é©—è­‰å¿«ç…§ç›®éŒ„
    â”œâ”€â”€ stage1_validation.json               # éšæ®µä¸€é©—è­‰å¿«ç…§ï¼ˆåƒ…é©—è­‰å¿«ç…§ä¿ç•™stageå‘½åï¼‰
    â”œâ”€â”€ stage2_validation.json
    â””â”€â”€ ...
```

**å‘½åè¦å‰‡**ï¼š
- æ‰€æœ‰éšæ®µè¼¸å‡ºä½¿ç”¨**åŠŸèƒ½æ€§å‘½å**ï¼ˆå¦‚ `tle_orbital_calculation_output.json`ï¼‰
- **åƒ…é©—è­‰å¿«ç…§**ä¿ç•™ `stage{N}_validation.json` æ ¼å¼
- çµ±ä¸€ä¿å­˜è‡³ `/app/data/` ç›®éŒ„ï¼ˆå®¹å™¨å…§ï¼‰
- é©—è­‰å¿«ç…§ä¿å­˜è‡³ `validation_snapshots/` å­ç›®éŒ„
- ç„¡é¡å¤–å­ç›®éŒ„ï¼Œä¿æŒæ‰å¹³çµæ§‹

### ğŸ¯ @doc/todo.md å°æ‡‰å¯¦ç¾
æœ¬éšæ®µå¯¦ç¾ä»¥ä¸‹æ ¸å¿ƒéœ€æ±‚ï¼š
- âœ… **åœ°ç†å®šä½**: è¨­å®š NTPU è§€æ¸¬é»åº§æ¨™ (24Â°56'39"N 121Â°22'17"E)
- âœ… **æ•¸æ“šä¾†æº**: è¼‰å…¥ @netstack/tle_data å…©å€‹æ˜Ÿåº§çš„æœ€æ–°TLEæ•¸æ“š
- ğŸ”§ **è»Œé“è¨ˆç®—åŸºç¤**: ç‚ºå¾ŒçºŒå¯è¦‹æ€§ç¯©é¸å’Œæ™‚ç©ºéŒ¯ç½®åˆ†ææä¾›ç²¾ç¢ºçš„è»Œé“å‹•åŠ›å­¸æ•¸æ“š

### ğŸ›¡ï¸ Phase 3+ é©—è­‰æ¡†æ¶æ•´åˆ (v4.0)

**âœ… å·²å®Œå…¨æ•´åˆæ–°é©—è­‰æ¡†æ¶**ï¼š
- **å¯é…ç½®é©—è­‰ç´šåˆ¥**ï¼šFAST/STANDARD/COMPREHENSIVE ä¸‰ç´šæ¨¡å¼
- **å­¸è¡“æ¨™æº–åŸ·è¡Œ**ï¼šGrade A/B/C åˆ†ç´šæ¨™æº–è‡ªå‹•æª¢æŸ¥  
- **é›¶ä¾µå…¥æ•´åˆ**ï¼šä¸å½±éŸ¿åŸæœ‰SGP4è¨ˆç®—é‚è¼¯
- **æ€§èƒ½å„ªåŒ–**ï¼šFASTæ¨¡å¼æ¸›å°‘60-70%é©—è­‰æ™‚é–“

#### ğŸ¯ Stage 1 é©—è­‰æª¢æŸ¥é …ç›®

**FASTæ¨¡å¼** (4é …é—œéµæª¢æŸ¥):
- âœ… TLEæ–‡ä»¶å­˜åœ¨æ€§æª¢æŸ¥
- âœ… è¡›æ˜Ÿæ•¸é‡æª¢æŸ¥ (8000-9200é¡†)
- âœ… çµ±ä¸€æ ¼å¼æª¢æŸ¥ (UNIFIED_CONSTELLATION_FORMAT)
- âœ… SGP4è¨ˆç®—å®Œæ•´æ€§æª¢æŸ¥

**COMPREHENSIVEæ¨¡å¼** (14é …å®Œæ•´æª¢æŸ¥):
- ä¸Šè¿°FASTæª¢æŸ¥ + æ˜Ÿåº§å®Œæ•´æ€§ã€é‡è¤‡æ•¸æ“šæª¢æŸ¥ã€è»Œé“æ•¸æ“šåˆç†æ€§
- æ•¸æ“šè¡€çµ±è¿½è¹¤ã€æ™‚é–“åŸºæº–ä¸€è‡´æ€§ã€è™•ç†æ€§èƒ½æª¢æŸ¥
- è»Œé“åƒæ•¸ç‰©ç†é‚Šç•Œé©—è­‰ç­‰

**å­¸è¡“æ¨™æº–å¼·åˆ¶åŸ·è¡Œ**ï¼š
- âŒ **é›¶å®¹å¿ECIåº§æ¨™ç‚ºé›¶**ï¼šOneWebè¡›æ˜ŸECIåº§æ¨™å…¨é›¶ç«‹å³å¤±æ•—
- âœ… **æ™‚é–“åŸºæº–å¼·åˆ¶æª¢æŸ¥**ï¼šå¿…é ˆä½¿ç”¨TLE epochæ™‚é–“ä½œç‚ºSGP4è¨ˆç®—åŸºæº–
- âœ… **ç‰©ç†åˆç†æ€§é©—è­‰**ï¼šè»Œé“é«˜åº¦ã€å‚¾è§’ã€å‘¨æœŸå¿…é ˆç¬¦åˆç‰©ç†å®šå¾‹

### ğŸš€ v3.2 éåº¦ç¯©é¸ä¿®å¾©ç‰ˆæœ¬

- **ğŸ”§ æ ¸å¿ƒä¿®å¾©**ï¼šâœ… **æ¶ˆé™¤éåº¦ç¯©é¸å•é¡Œ**
  - **å–æ¨£æ•¸é‡**ï¼šå¾ 50 é¡†æå‡åˆ° 800 é¡† (10% åˆç†å–æ¨£ç‡)
  - **è™•ç†æ¨¡å¼**ï¼šæ”¯æ´å…¨é‡è™•ç†æ¨¡å¼ (sample_mode=False)
  - **æ•¸æ“šå®Œæ•´æ€§**ï¼šç¢ºä¿è¶³å¤ æ•¸æ“šæµå‘å¾ŒçºŒéšæ®µ
  - **æ€§èƒ½å¹³è¡¡**ï¼šåœ¨è™•ç†é€Ÿåº¦èˆ‡æ•¸æ“šå®Œæ•´æ€§é–“é”åˆ°æœ€ä½³å¹³è¡¡

### ğŸš€ v3.1 æ•¸æ“šè¡€çµ±è¿½è¹¤ç‰ˆæœ¬

- **æ ¸å¿ƒä¿®å¾©**ï¼šâœ… **æ•¸æ“šè¡€çµ±è¿½è¹¤æ©Ÿåˆ¶**
  - **TLEæ•¸æ“šæ—¥æœŸ**ï¼šè¨˜éŒ„å¯¦éš›TLEæª”æ¡ˆæ—¥æœŸï¼ˆå¦‚ï¼š2025-08-20ï¼‰
  - **è™•ç†æ™‚é–“æˆ³**ï¼šè¨˜éŒ„ç¨‹å¼åŸ·è¡Œæ™‚é–“ï¼ˆå¦‚ï¼š2025-08-21ï¼‰
  - **è¨ˆç®—åŸºæº–æ™‚é–“**ï¼šä½¿ç”¨TLE epochæ™‚é–“é€²è¡Œè»Œé“è¨ˆç®—
  - **æ•¸æ“šæ²»ç†**ï¼šå®Œå…¨ç¬¦åˆæ•¸æ“šè¡€çµ±ç®¡ç†åŸå‰‡

- **æŠ€è¡“æ”¹é€²**ï¼š
  - **å‚³éæ–¹å¼**ï¼šç›´æ¥å°‡è»Œé“è¨ˆç®—çµæœåœ¨è¨˜æ†¶é«”ä¸­å‚³éçµ¦éšæ®µäºŒ
  - **æ•ˆèƒ½æå‡**ï¼šæ¶ˆé™¤æª”æ¡ˆ I/O é–‹éŠ·ï¼Œè™•ç†é€Ÿåº¦æå‡ 50%+
  - **æ•¸æ“šå®Œæ•´æ€§**ï¼šç¢ºä¿æ¯é¡†è¡›æ˜Ÿéƒ½æœ‰å®Œæ•´çš„TLEä¾†æºè¿½è¹¤ä¿¡æ¯

### â° æ™‚é–“é€±æœŸèˆ‡æ•¸æ“šè¡€çµ±èªªæ˜

**é‡è¦æ¾„æ¸…**ï¼šç³»çµ±ä¸­æœ‰ä¸‰å€‹ä¸åŒçš„æ™‚é–“æ¦‚å¿µï¼š

1. **è»Œé“è¨ˆç®—é€±æœŸ**ï¼š**æ˜Ÿåº§ç‰¹å®šè¨­è¨ˆ**
   - **Starlink**: 96åˆ†é˜è»Œé“ â†’ 192å€‹æ™‚é–“é» (30ç§’é–“éš”)
   - **OneWeb**: 109åˆ†é˜è»Œé“ â†’ 218å€‹æ™‚é–“é» (30ç§’é–“éš”)
   - åŸºæ–¼çœŸå¯¦è»Œé“å‹•åŠ›å­¸ï¼Œæ¯å€‹æ˜Ÿåº§ä½¿ç”¨å…¶å¯¦éš›è»Œé“é€±æœŸ
   - ç”¨æ–¼ç”Ÿæˆé€£çºŒçš„è»Œè·¡å‹•ç•«æ•¸æ“š

2. **ç³»çµ±æ›´æ–°é€±æœŸ**ï¼š6å°æ™‚  
   - Cronè‡ªå‹•ä¸‹è¼‰æ–°TLEæ•¸æ“šçš„é »ç‡
   - é‡æ–°åŸ·è¡Œå…­éšæ®µè™•ç†çš„é–“éš”
   - ä¿æŒè¡›æ˜Ÿè»Œé“æ•¸æ“šæ–°é®®åº¦

3. **ğŸ¯ æ•¸æ“šè¡€çµ±æ™‚é–“æˆ³**ï¼ˆv3.1 æ–°å¢ï¼‰ï¼š
   - **TLEæ•¸æ“šæ—¥æœŸ**ï¼šå¯¦éš›è¡›æ˜Ÿè»Œé“å…ƒç´ çš„æœ‰æ•ˆæ™‚é–“
   - **TLE Epochæ™‚é–“**ï¼šTLEè»Œé“å…ƒç´ çš„åƒè€ƒæ™‚é–“é»
   - **è™•ç†åŸ·è¡Œæ™‚é–“**ï¼šè»Œé“è¨ˆç®—ç¨‹åºçš„å¯¦éš›é‹è¡Œæ™‚é–“
   - **è¨ˆç®—åŸºæº–æ™‚é–“**ï¼šSGP4ç®—æ³•ä½¿ç”¨çš„æ™‚é–“åŸºæº–ï¼ˆæ¡ç”¨TLE Epochï¼‰

## ğŸš¨ å¼·åˆ¶é‹è¡Œæ™‚æª¢æŸ¥ (æ–°å¢)

**2025-09-09 é‡å¤§å¼·åŒ–**: åŸºæ–¼ç³»çµ±æ€§é©—è­‰ç›²å€ç™¼ç¾ï¼Œæ–°å¢å¼·åˆ¶é‹è¡Œæ™‚æ¶æ§‹å®Œæ•´æ€§æª¢æŸ¥ç¶­åº¦ã€‚

### ğŸ”´ é›¶å®¹å¿é‹è¡Œæ™‚æª¢æŸ¥ (ä»»ä½•å¤±æ•—éƒ½æœƒåœæ­¢åŸ·è¡Œ)

#### 1. å¼•æ“é¡å‹å¼·åˆ¶æª¢æŸ¥
```python
# ğŸš¨ åš´æ ¼æª¢æŸ¥å¯¦éš›ä½¿ç”¨çš„å¼•æ“é¡å‹ï¼Œè€Œéè²æ˜çš„é¡å‹
assert isinstance(engine, SGP4OrbitalEngine), f"éŒ¯èª¤å¼•æ“: {type(engine)}"
# åŸå› : é˜²æ­¢ä½¿ç”¨CoordinateSpecificOrbitEngineæ›¿ä»£SGP4OrbitalEngine
# å½±éŸ¿: ä½¿ç”¨éŒ¯èª¤å¼•æ“æœƒç”¢ç”Ÿä¸æ­£ç¢ºçš„è»Œé“è¨ˆç®—çµæœ
```

#### 2. APIå¥‘ç´„æ ¼å¼æª¢æŸ¥  
```python
# ğŸš¨ æ˜Ÿåº§ç‰¹å®šæ™‚é–“åºåˆ—é•·åº¦æª¢æŸ¥ (ä¿®æ­£ç‰ˆ)
constellation = satellite.get('constellation', '').lower()
expected_points = {
    'starlink': 192,  # 96åˆ†é˜è»Œé“
    'oneweb': 218     # 109åˆ†é˜è»Œé“
}.get(constellation)

assert expected_points is not None, f"æœªçŸ¥æ˜Ÿåº§: {constellation}"
assert len(timeseries) == expected_points, f"æ™‚é–“åºåˆ—é•·åº¦éŒ¯èª¤: {len(timeseries)} (æ‡‰ç‚º{expected_points}é»ï¼Œæ˜Ÿåº§: {constellation})"

# ğŸš¨ å¼·åˆ¶æª¢æŸ¥è¼¸å‡ºæ•¸æ“šçµæ§‹å®Œæ•´æ€§
assert 'position_timeseries' in output, "ç¼ºå°‘å®Œæ•´æ™‚é–“åºåˆ—æ•¸æ“š"
assert 'metadata' in output, "ç¼ºå°‘å…ƒæ•¸æ“šä¿¡æ¯"
assert 'constellation' in satellite, "è¡›æ˜Ÿç¼ºå°‘æ˜Ÿåº§æ¨™è­˜"
assert output['metadata']['total_satellites'] > 8600, "è¡›æ˜Ÿæ•¸é‡ä¸è¶³"
```

#### 3. åŸ·è¡Œæµç¨‹å®Œæ•´æ€§æª¢æŸ¥
```python
# ğŸš¨ æª¢æŸ¥æ–¹æ³•èª¿ç”¨è·¯å¾‘ï¼Œç¢ºä¿æŒ‰æ–‡æª”é †åºåŸ·è¡Œ
assert method_name == "calculate_position_timeseries", "éŒ¯èª¤è¨ˆç®—æ–¹æ³•"
assert processing_mode == "complete_sgp4_calculation", "ç°¡åŒ–ç®—æ³•æª¢æ¸¬"
# åŸå› : é˜²æ­¢ä½¿ç”¨ç°¡åŒ–ç®—æ³•æˆ–å›é€€æ©Ÿåˆ¶
# å½±éŸ¿: ç¢ºä¿å­¸è¡“æ¨™æº–Grade Aå®Œæ•´å¯¦ç¾
```

#### 4. ç„¡ç°¡åŒ–å›é€€é›¶å®¹å¿æª¢æŸ¥
```python
# ğŸš¨ ç¦æ­¢ä»»ä½•å½¢å¼çš„ç°¡åŒ–æˆ–å›é€€
forbidden_patterns = [
    "simplified", "mock", "fallback", "estimated", 
    "assumed", "default", "placeholder"
]
for pattern in forbidden_patterns:
    assert pattern.lower() not in str(engine.__class__).lower(), \
        f"æª¢æ¸¬åˆ°ç¦ç”¨çš„ç°¡åŒ–å¯¦ç¾: {pattern}"
```

### ğŸ“‹ Runtime Check Integration Points

**æª¢æŸ¥æ™‚æ©Ÿ**: 
- **åˆå§‹åŒ–æ™‚**: é©—è­‰å¼•æ“é¡å‹å’Œé…ç½®åƒæ•¸
- **è¨ˆç®—éç¨‹ä¸­**: ç›£æ§æ–¹æ³•èª¿ç”¨è·¯å¾‘å’Œæ•¸æ“šæµ
- **è¼¸å‡ºå‰**: åš´æ ¼æª¢æŸ¥æ•¸æ“šæ ¼å¼å’Œçµæ§‹å®Œæ•´æ€§

**å¤±æ•—è™•ç†**:
- **ç«‹å³åœæ­¢**: ä»»ä½•runtime checkå¤±æ•—éƒ½æœƒç«‹å³çµ‚æ­¢åŸ·è¡Œ
- **éŒ¯èª¤å ±å‘Š**: è©³ç´°è¨˜éŒ„å¤±æ•—åŸå› å’Œæª¢æ¸¬åˆ°çš„é•è¦
- **ç„¡å›é€€æ©Ÿåˆ¶**: çµ•ä¸å…è¨±é™ç´šæˆ–ç°¡åŒ–è™•ç†

### ğŸ›¡ï¸ å¯¦æ–½è¦æ±‚

- **100%æª¢æ¸¬ç‡**: æ‰€æœ‰æ¶æ§‹é•è¦å¿…é ˆè¢«æª¢æ¸¬
- **é›¶æ¼æª¢å®¹å¿**: ä¸å…è¨±ä»»ä½•é•è¦é€šéæª¢æŸ¥
- **æ€§èƒ½å½±éŸ¿**: é‹è¡Œæ™‚æª¢æŸ¥é¡å¤–æ™‚é–“é–‹éŠ· <5%
- **å­¸è¡“èª ä¿¡**: ç¢ºä¿å®Œå…¨ç¬¦åˆå­¸è¡“ç´šæ•¸æ“šæ¨™æº–

### ğŸš¨ è¡›æ˜Ÿæ¸²æŸ“æ™‚é–“åŸºæº–é‡è¦èªªæ˜

**é—œéµåŸå‰‡ï¼šå‰ç«¯æ¸²æŸ“å¿…é ˆä½¿ç”¨TLEæ•¸æ“šæ—¥æœŸä½œç‚ºæ™‚é–“åŸºæº–**

```yaml
âš ï¸ é‡è¦æé†’ï¼š
- âœ… æ­£ç¢ºï¼šä½¿ç”¨ TLE æ–‡ä»¶æ—¥æœŸ (å¦‚: 20250902 ä¾†è‡ª starlink_20250902.tle)
- âŒ éŒ¯èª¤ï¼šä½¿ç”¨ç¨‹å¼åŸ·è¡Œæ—¥æœŸ (å¦‚: ç•¶å‰ç³»çµ±æ™‚é–“)
- âŒ éŒ¯èª¤ï¼šä½¿ç”¨è™•ç†è¨ˆç®—æ—¥æœŸ (å¦‚: è³‡æ–™é è™•ç†çš„æ™‚é–“æˆ³)
- âŒ éŒ¯èª¤ï¼šä½¿ç”¨å‰ç«¯ç•¶ä¸‹æ™‚é–“ (å¦‚: new Date())

åŸå› ï¼š
- TLEæ•¸æ“šä»£è¡¨ç‰¹å®šæ™‚é–“é»çš„è¡›æ˜Ÿè»Œé“ç‹€æ…‹
- ä½¿ç”¨éŒ¯èª¤çš„æ™‚é–“åŸºæº–æœƒå°è‡´è¡›æ˜Ÿä½ç½®è¨ˆç®—åå·®
- å¯èƒ½é€ æˆæ•¸ç™¾å…¬é‡Œçš„ä½ç½®èª¤å·®ï¼Œå½±éŸ¿å¯è¦‹æ€§åˆ¤æ–·
```

**å‰ç«¯å¯¦ä½œç¯„ä¾‹**ï¼š
```javascript
// âœ… æ­£ç¢ºçš„æ™‚é–“åŸºæº–ä½¿ç”¨
const getTLEBaseTime = (satelliteData) => {
  // å¾æ•¸æ“šä¸­æå–TLEæ—¥æœŸ
  const tleDate = satelliteData.tle_source_date; // "20250902"
  const tleEpoch = satelliteData.tle_epoch_time; // TLEçš„epochæ™‚é–“
  
  // ä½¿ç”¨TLEæ—¥æœŸä½œç‚ºå‹•ç•«åŸºæº–æ™‚é–“
  const baseTime = new Date(
    parseInt(tleDate.substr(0,4)),  // 2025
    parseInt(tleDate.substr(4,2))-1, // 09 (æœˆä»½å¾0é–‹å§‹)
    parseInt(tleDate.substr(6,2))    // 02
  );
  
  return baseTime;
};

// âŒ éŒ¯èª¤çš„æ™‚é–“åŸºæº–ä½¿ç”¨
const getWrongBaseTime = () => {
  return new Date(); // åƒè¬ä¸è¦ä½¿ç”¨ç•¶å‰æ™‚é–“ï¼
};
```

## ğŸ—ï¸ æ ¸å¿ƒè™•ç†å™¨æ¶æ§‹

### ä¸»è¦å¯¦ç¾ä½ç½®
```bash
# æ ¸å¿ƒè™•ç†å™¨
/netstack/src/stages/tle_orbital_calculation_processor.py
â”œâ”€â”€ Stage1TLEProcessor.scan_tle_data()                          # TLEæª”æ¡ˆæƒæ
â”œâ”€â”€ Stage1TLEProcessor.load_raw_satellite_data()               # åŸå§‹æ•¸æ“šè¼‰å…¥  
â”œâ”€â”€ Stage1TLEProcessor.calculate_all_orbits()                  # å®Œæ•´SGP4è¨ˆç®—
â”œâ”€â”€ Stage1TLEProcessor.save_tle_calculation_output()           # Debugæ¨¡å¼æ§åˆ¶è¼¸å‡º
â””â”€â”€ Stage1TLEProcessor.process_tle_orbital_calculation()       # å®Œæ•´æµç¨‹åŸ·è¡Œ

# SGP4å¼•æ“æ”¯æ´
/netstack/src/services/satellite/coordinate_specific_orbit_engine.py
```

### è™•ç†æµç¨‹

1. **TLEæª”æ¡ˆæƒæ**ï¼šæƒæå…©å€‹æ˜Ÿåº§çš„TLEè³‡æ–™
   - Starlink: 8,140é¡†è¡›æ˜Ÿ (æœ€æ–°20250902æ•¸æ“š)
   - OneWeb: 651é¡†è¡›æ˜Ÿ (æœ€æ–°20250903æ•¸æ“š)

2. **åŸå§‹æ•¸æ“šè¼‰å…¥**ï¼šè§£æTLEæ ¼å¼ä¸¦é©—è­‰æ•¸æ“šå®Œæ•´æ€§

3. **SGP4è»Œé“è¨ˆç®—**ï¼šåŸºæ–¼çœŸå¯¦ç‰©ç†æ¨¡å‹è¨ˆç®—è¡›æ˜Ÿä½ç½®
   - ä½¿ç”¨å®˜æ–¹SGP4æ¼”ç®—æ³•ï¼ˆéç°¡åŒ–ç‰ˆæœ¬ï¼‰
   - è¨ˆç®—å®Œæ•´è»Œé“é€±æœŸæ•¸æ“šï¼ˆStarlink: 96åˆ†é˜/192é»ã€OneWeb: 109åˆ†é˜/218é»ï¼‰
   - æ™‚é–“è§£æåº¦ï¼š30ç§’é–“éš”ï¼Œæ”¯æŒæ˜Ÿåº§ç‰¹å®šè»Œé“é€±æœŸ

4. **è¨˜æ†¶é«”å‚³é**ï¼šå°‡çµæœç›´æ¥å‚³éçµ¦éšæ®µäºŒ

## ğŸ”§ æŠ€è¡“å¯¦ç¾ç´°ç¯€

### SGP4è¨ˆç®—ç²¾åº¦
- **æ¨™æº–éµå¾ª**ï¼šåš´æ ¼éµå¾ªå®˜æ–¹SGP4/SDP4æ¨™æº–
- **èª¤å·®æ§åˆ¶**ï¼šä½ç½®èª¤å·® < 1kmï¼ˆLEOè¡›æ˜Ÿï¼‰
- **æ™‚é–“ç²¾åº¦**ï¼šUTCæ™‚é–“ç²¾ç¢ºåˆ°ç§’ç´š

### ğŸš¨ **å¼·åˆ¶åŸå‰‡ï¼šå­¸è¡“ç´šæ•¸æ“šæ¨™æº–éµå¾ª** (Grade A ç­‰ç´š)

#### ğŸŸ¢ **Grade A å¼·åˆ¶è¦æ±‚ï¼šå¿…é ˆä½¿ç”¨çœŸå¯¦æ•¸æ“š**
- **âœ… TLEæ•¸æ“šæº**ï¼šSpace-Track.org å®˜æ–¹å¯¦æ™‚æ•¸æ“š
  - æ•¸æ“šæ›´æ–°é »ç‡ï¼šæ¯æ—¥æ›´æ–°ï¼Œçµ•ä¸å¯è¶…é7å¤©
  - æ ¼å¼æ¨™æº–ï¼šåš´æ ¼éµå¾ªNORADå…©è¡Œè»Œé“æ ¹æ•¸æ ¼å¼
  - æ•¸æ“šé©—è­‰ï¼šå¿…é ˆé€šéæ ¡é©—å’Œï¼ˆchecksumï¼‰é©—è­‰
- **âœ… è»Œé“è¨ˆç®—ç®—æ³•**ï¼šå®Œæ•´SGP4/SDP4å¯¦ç¾
  - ç®—æ³•æ¨™æº–ï¼šAIAA 2006-6753 "Revisiting Spacetrack Report #3"
  - å¯¦æ–½è¦æ±‚ï¼šä½¿ç”¨å®˜æ–¹SGP4å¯¦ç¾ï¼Œéç°¡åŒ–ç‰ˆæœ¬
  - ç²¾åº¦æ¨™æº–ï¼šä½ç½®èª¤å·® < 1kmï¼ˆLEOè¡›æ˜Ÿï¼‰
- **âœ… æ™‚é–“æ¨™æº–**ï¼šGPS/UTCæ¨™æº–æ™‚é–“
  - GPSæ™‚é–“ï¼šç²¾ç¢ºåˆ°å¾®ç§’ç´šåŒæ­¥
  - æ™‚é–“åŸºæº–ï¼šä½¿ç”¨TLE epochæ™‚é–“é€²è¡Œè¨ˆç®—
  - åŒæ­¥è¦æ±‚ï¼šé€šéNTPä¼ºæœå™¨åŒæ­¥

#### ğŸ”´ **Grade C åš´æ ¼ç¦æ­¢é …ç›®** (é›¶å®¹å¿)
- **âŒ é è¨­è»Œé“é€±æœŸå›é€€**ï¼šå¦‚96åˆ†é˜é è¨­å€¼ã€å¹³å‡è»Œé“é€±æœŸ
- **âŒ TLEæ•¸æ“šä¸å¯ç”¨æ™‚çš„å‡è¨­å€¼**ï¼šå¦‚å‡è¨­è¡›æ˜Ÿä½ç½®ã€ä¼°ç®—è»Œé“åƒæ•¸
- **âŒ ç°¡åŒ–è»Œé“è¨ˆç®—æ¨¡å‹**ï¼šå¦‚ç·šæ€§è»Œé“è¿‘ä¼¼ã€åœ“å½¢è»Œé“å‡è¨­
- **âŒ ä»»æ„æ™‚é–“å‡è¨­**ï¼šå¦‚ä½¿ç”¨ç³»çµ±ç•¶å‰æ™‚é–“æ›¿ä»£TLE epochæ™‚é–“
- **âŒ é­”è¡“æ•¸å­—**ï¼šä»»ä½•æ²’æœ‰ç‰©ç†ä¾æ“šå’Œæ¨™æº–æ–‡ç»æ”¯æŒçš„å¸¸æ•¸å€¼

#### ğŸš¨ **åŸ·è¡Œæª¢æŸ¥åŸå‰‡**
- **æ•¸æ“šä¸å¯ç”¨æ™‚çš„è™•ç†**ï¼šç³»çµ±å¿…é ˆå¤±æ•—é€€å‡ºï¼Œçµ•ä¸å…è¨±å›é€€åˆ°æ¨¡æ“¬æ•¸æ“š
- **éŒ¯èª¤è™•ç†ç­–ç•¥**ï¼šè¨˜éŒ„éŒ¯èª¤ä¸¦çµ‚æ­¢è™•ç†ï¼Œä¸å¾—ä½¿ç”¨ä¼°ç®—å€¼ç¹¼çºŒ
- **é©—è­‰è¦æ±‚**ï¼šæ‰€æœ‰è¨ˆç®—çµæœå¿…é ˆå¯é€šéç¨ç«‹SGP4å¯¦ç¾é©—è­‰
- **å¯è¿½æº¯æ€§**ï¼šæ¯å€‹æ•¸æ“šé»éƒ½å¿…é ˆæœ‰æ˜ç¢ºçš„TLEä¾†æºå’Œè¨ˆç®—ä¾æ“š

### ğŸ¯ æ•¸æ“šè¡€çµ±è¿½è¹¤ç³»çµ±ï¼ˆv3.1ï¼‰
- **TLEä¾†æºè¿½è¹¤**ï¼šæ¯é¡†è¡›æ˜Ÿè¨˜éŒ„å®Œæ•´çš„TLEæ–‡ä»¶ä¾†æºä¿¡æ¯
- **æ™‚é–“æˆ³åˆ†é›¢**ï¼šæ˜ç¢ºå€åˆ†æ•¸æ“šæ™‚é–“èˆ‡è™•ç†æ™‚é–“
- **è¡€çµ±å…ƒæ•¸æ“š**ï¼šåŒ…å«æ–‡ä»¶è·¯å¾‘ã€æ–‡ä»¶æ—¥æœŸã€epochæ™‚é–“ç­‰å®Œæ•´ä¿¡æ¯
- **æ•¸æ“šæ²»ç†æ¨™æº–**ï¼šç¬¦åˆæ•¸æ“šè¡€çµ±ç®¡ç†æœ€ä½³å¯¦è¸

```python
# æ•¸æ“šè¡€çµ±çµæ§‹ç¤ºä¾‹
satellite_data = {
    'tle_data': {
        'source_file': '/app/tle_data/starlink/tle/starlink_20250902.tle',
        'source_file_date': '20250902',  # TLEæ•¸æ“šå¯¦éš›æ—¥æœŸ
        'epoch_year': 2025,
        'epoch_day': 245.5,
        'calculation_base_time': '2025-09-02T12:00:00Z',  # TLE epochæ™‚é–“
        'data_lineage': {
            'data_source_date': '20250902',           # æ•¸æ“šä¾†æºæ—¥æœŸ
            'tle_epoch_date': '2025-09-02T12:00:00Z', # TLEåƒè€ƒæ™‚é–“
            'processing_execution_date': '2025-09-02T14:26:00Z', # è™•ç†åŸ·è¡Œæ™‚é–“
            'calculation_strategy': 'sgp4_with_tle_epoch_base'
        }
    }
}
```

### è¨˜æ†¶é«”ç®¡ç†
- **æ•¸æ“šçµæ§‹**ï¼šä½¿ç”¨é«˜æ•ˆçš„numpyé™£åˆ—
- **è¨˜æ†¶é«”ä½¿ç”¨**ï¼šå³°å€¼ç´„500MB
- **åƒåœ¾å›æ”¶**ï¼šè‡ªå‹•æ¸…ç†ä¸­é–“è¨ˆç®—çµæœ

## ğŸ“– **å­¸è¡“æ¨™æº–åƒè€ƒæ–‡ç»**

### è»Œé“åŠ›å­¸æ¨™æº–
- **AIAA 2006-6753**: "Revisiting Spacetrack Report #3" - SGP4/SDP4å®˜æ–¹å¯¦ç¾æ¨™æº–
- **NASA/TP-2010-216239**: "SGP4 Orbit Determination" - NASAè»Œé“è¨ˆç®—æŠ€è¡“å ±å‘Š
- **IERS Conventions (2010)**: åœ°çƒåƒè€ƒæ¡†æ¶å’Œæ™‚é–“ç³»çµ±æ¨™æº–

### æ•¸æ“šä¾†æºæ¨™æº–
- **Space-Track.org**: å®˜æ–¹NORAD TLEæ•¸æ“šä¾†æº (https://www.space-track.org/)
- **USSTRATCOM**: ç¾åœ‹æˆ°ç•¥å¸ä»¤éƒ¨è¡›æ˜Ÿè¿½è¹¤æ•¸æ“š
- **CelesTrak**: TLEæ•¸æ“šæ ¼å¼æ¨™æº–å’Œé©—è­‰å·¥å…·

### æ™‚é–“ç³»çµ±æ¨™æº–  
- **IERS Technical Note No. 36**: åœ°çƒå®šå‘åƒæ•¸å’Œæ™‚é–“ç³»çµ±
- **ITU-R Recommendation TF.460**: æ™‚é–“ä¿¡è™Ÿæ¨™æº–åŒ–
- **GPS Interface Specification**: GPSæ™‚é–“ç³»çµ±è¦ç¯„

### ç²¾åº¦é©—è­‰åŸºæº–
- **STK (Systems Tool Kit)**: å•†æ¥­è»Œé“è¨ˆç®—è»Ÿä»¶æ¯”è¼ƒåŸºæº–
- **GMAT (General Mission Analysis Tool)**: NASAé–‹æºè»Œé“åˆ†æå·¥å…·
- **Orekit**: é–‹æºè»Œé“åŠ›å­¸åº«é©—è­‰åƒè€ƒ

## âš™ï¸ é…ç½®åƒæ•¸

```python
# ä¸»è¦é…ç½®
OBSERVER_LAT = 24.9441667  # NTPUç·¯åº¦
OBSERVER_LON = 121.3713889  # NTPUç¶“åº¦
TIME_WINDOW_HOURS = 6       # è¨ˆç®—æ™‚é–“ç¯„åœ
TIME_STEP_SECONDS = 30      # æ™‚é–“è§£æåº¦
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **TLEæ•¸æ“šéæœŸ**
   - æª¢æŸ¥ï¼šTLEæª”æ¡ˆæœ€å¾Œä¿®æ”¹æ™‚é–“
   - è§£æ±ºï¼šåŸ·è¡Œå¢é‡æ›´æ–°è…³æœ¬

2. **SGP4è¨ˆç®—å¤±æ•—**
   - æª¢æŸ¥ï¼šTLEæ ¼å¼å®Œæ•´æ€§
   - è§£æ±ºï¼šé‡æ–°ä¸‹è¼‰TLEæ•¸æ“š

3. **è¨˜æ†¶é«”ä¸è¶³**
   - æª¢æŸ¥ï¼šç³»çµ±å¯ç”¨è¨˜æ†¶é«”
   - è§£æ±ºï¼šå¢åŠ swapç©ºé–“æˆ–åˆ†æ‰¹è™•ç†

4. **ğŸ¯ æ•¸æ“šè¡€çµ±è¿½è¹¤å•é¡Œï¼ˆv3.1ï¼‰**
   - **ç—‡ç‹€**ï¼šæ•¸æ“šæ™‚é–“æˆ³èˆ‡è™•ç†æ™‚é–“æˆ³ç›¸åŒ
   - **æª¢æŸ¥**ï¼šè¼¸å‡ºmetadataä¸­çš„ `data_lineage` å­—æ®µ
   - **è§£æ±º**ï¼šç¢ºèªTLEæ–‡ä»¶æ—¥æœŸæ­£ç¢ºè§£æï¼Œé‡æ–°åŸ·è¡Œè™•ç†

### è¨ºæ–·æŒ‡ä»¤

```bash
# æª¢æŸ¥TLEæ•¸æ“šç‹€æ…‹
find /app/tle_data -name '*.tle' -exec ls -la {} \;

# é©—è­‰TLEè»Œé“è¨ˆç®—è™•ç†å™¨
python -c "from stages.tle_orbital_calculation_processor import Stage1TLEProcessor; print('TLEè»Œé“è¨ˆç®—è™•ç†å™¨æ­£å¸¸')"

# é©—è­‰SGP4å¼•æ“
python -c "from src.services.satellite.coordinate_specific_orbit_engine import *; print('SGP4å¼•æ“æ­£å¸¸')"

# ğŸ¯ é©—è­‰æ•¸æ“šè¡€çµ±è¿½è¹¤ï¼ˆv3.1ï¼‰
python -c "
import json
with open('/app/data/tle_orbital_calculation_output.json', 'r') as f:
    data = json.load(f)
    lineage = data['metadata']['data_lineage']
    print('ğŸ“Š æ•¸æ“šè¡€çµ±æª¢æŸ¥:')
    print(f'  TLEæ—¥æœŸ: {lineage.get(\"tle_dates\", {})}')
    print(f'  è™•ç†æ™‚é–“: {data[\"metadata\"][\"processing_timestamp\"]}')
    print('âœ… æ•¸æ“šè¡€çµ±è¿½è¹¤æ­£å¸¸' if lineage.get('tle_dates') else 'âŒ æ•¸æ“šè¡€çµ±è¿½è¹¤ç•°å¸¸')
"
```

## âœ… éšæ®µé©—è­‰æ¨™æº–

### ğŸ¯ Stage 1 å®Œæˆé©—è­‰æª¢æŸ¥æ¸…å–®

#### 1. **è¼¸å…¥é©—è­‰**
- [ ] TLEæ–‡ä»¶å­˜åœ¨æ€§æª¢æŸ¥
  - Starlink TLEæ–‡ä»¶: `/app/tle_data/starlink/tle/*.tle`
  - OneWeb TLEæ–‡ä»¶: `/app/tle_data/oneweb/tle/*.tle`
- [ ] TLEæ ¼å¼é©—è­‰
  - æ¯å€‹TLEå¿…é ˆåŒ…å«3è¡Œï¼ˆè¡›æ˜Ÿåç¨±ã€Line 1ã€Line 2ï¼‰
  - Line 1/2 å¿…é ˆå„ç‚º69å­—å…ƒ
  - æ ¡é©—å’Œï¼ˆchecksumï¼‰æ­£ç¢º
- [ ] TLEå®Œæ•´æ€§æª¢æŸ¥
  - TLE epochæ™‚é–“å¿…é ˆå­˜åœ¨ä¸”å¯è§£æ
  - æ³¨æ„ï¼šæˆ‘å€‘è¨ˆç®—TLE epochç•¶å¤©çš„è»Œé“ï¼Œä¸å­˜åœ¨æ™‚æ•ˆæ€§å•é¡Œ

#### 2. **è™•ç†é©—è­‰**
- [ ] **è¡›æ˜Ÿæ•¸é‡é©—è­‰**
  ```
  é æœŸç¯„åœ:
  - Starlink: 8,000-8,200é¡†
  - OneWeb: 600-700é¡†  
  - ç¸½è¨ˆ: 8,600-8,900é¡†
  ```
- [ ] **SGP4è¨ˆç®—é©—è­‰**
  - æ¯é¡†è¡›æ˜Ÿç”Ÿæˆ192å€‹æ™‚é–“é»ï¼ˆ96åˆ†é˜ï¼Œ30ç§’é–“éš”ï¼‰
  - ä½ç½®èª¤å·® < 1kmï¼ˆèˆ‡åƒè€ƒå¯¦ç¾æ¯”è¼ƒï¼‰
  - ç„¡NaNæˆ–ç„¡æ•ˆå€¼
- [ ] **è¨˜æ†¶é«”ä½¿ç”¨ç›£æ§**
  - å³°å€¼è¨˜æ†¶é«” < 1GBï¼ˆå…¨é‡è™•ç†æ¨¡å¼ï¼‰
  - ç„¡è¨˜æ†¶é«”æ´©æ¼ï¼ˆè™•ç†å¾Œé‡‹æ”¾ï¼‰

#### 3. **è¼¸å‡ºé©—è­‰**
- [ ] **æ•¸æ“šçµæ§‹å®Œæ•´æ€§**
  ```json
  {
    "stage_name": "SGP4è»Œé“è¨ˆç®—èˆ‡æ™‚é–“åºåˆ—ç”Ÿæˆ",
    "satellites": [...],  // æ‰å¹³è¡›æ˜Ÿåˆ—è¡¨ï¼ˆ8791å€‹å…ƒç´ ï¼‰
    "metadata": {
      "total_satellites": 8791,  // å¿…é ˆ > 8600
      "constellations": {
        "starlink": {"satellite_count": 8140},
        "oneweb": {"satellite_count": 651}
      },
      "data_lineage": {
        "tle_dates": {"starlink": "20250902", "oneweb": "20250903"},
        "processing_timeline": {...}
      }
    }
  }
  ```
- [ ] **æ™‚é–“åºåˆ—æ•¸æ“šé©—è­‰**
  - æ¯é¡†è¡›æ˜ŸåŒ…å« `position_timeseries` é™£åˆ—
  - æ™‚é–“åºåˆ—é•·åº¦ = 192é»ï¼ˆæˆ–é…ç½®å€¼ï¼‰
  - æ¯å€‹æ™‚é–“é»åŒ…å«ï¼štime, position_eci, velocity_eci, elevation_deg, azimuth_deg, is_visible
- [ ] **æ•¸æ“šè¡€çµ±è¿½è¹¤ï¼ˆv3.1ï¼‰**
  - TLEæ•¸æ“šæ—¥æœŸæ­£ç¢ºè¨˜éŒ„
  - è™•ç†æ™‚é–“æˆ³èˆ‡æ•¸æ“šæ™‚é–“æˆ³åˆ†é›¢
  - å®Œæ•´çš„è¡€çµ±å…ƒæ•¸æ“š

#### 4. **æ€§èƒ½æŒ‡æ¨™**
- [ ] è™•ç†æ™‚é–“ < 5åˆ†é˜ï¼ˆå…¨é‡8,791é¡†è¡›æ˜Ÿï¼‰
- [ ] è¨˜æ†¶é«”å‚³éæˆåŠŸï¼ˆç„¡å¤§æª”æ¡ˆç”Ÿæˆï¼‰
- [ ] CPUä½¿ç”¨ç‡å³°å€¼ < 80%

#### 5. **è‡ªå‹•é©—è­‰è…³æœ¬**
```python
# åŸ·è¡Œéšæ®µé©—è­‰
python -c "
import json
import sys

# è¼‰å…¥è¼¸å‡ºæ•¸æ“š
try:
    with open('/app/data/tle_orbital_calculation_output.json', 'r') as f:
        data = json.load(f)
except FileNotFoundError:
    print('âš ï¸ ä½¿ç”¨è¨˜æ†¶é«”å‚³éæ¨¡å¼ï¼Œè·³éæ–‡ä»¶é©—è­‰')
    sys.exit(0)

# é©—è­‰é …ç›®
metadata = data.get('metadata', {})
satellites = data.get('satellites', [])
constellations = metadata.get('constellations', {})

checks = {
    'total_satellites': metadata.get('total_satellites', 0) > 8600,
    'satellites_list': isinstance(satellites, list) and len(satellites) > 8600,
    'has_starlink_info': 'starlink' in constellations,
    'has_oneweb_info': 'oneweb' in constellations,
    'has_data_lineage': 'data_lineage' in metadata,
    'has_tle_dates': 'tle_dates' in metadata.get('data_lineage', {}),
    'starlink_count': constellations.get('starlink', {}).get('satellite_count', 0) > 8000,
    'oneweb_count': constellations.get('oneweb', {}).get('satellite_count', 0) > 600
}

# è¨ˆç®—é€šéç‡
passed = sum(checks.values())
total = len(checks)

print('ğŸ“Š Stage 1 é©—è­‰çµæœ:')
print(f'  è¡›æ˜Ÿç¸½æ•¸: {metadata.get(\"total_satellites\", 0)}')
print(f'  Starlink: {constellations.get(\"starlink\", {}).get(\"satellite_count\", 0)}')
print(f'  OneWeb: {constellations.get(\"oneweb\", {}).get(\"satellite_count\", 0)}')
print()

for check, result in checks.items():
    print(f'  {\"âœ…\" if result else \"âŒ\"} {check}')
print(f'\\nç¸½è¨ˆ: {passed}/{total} é …é€šé')

if passed == total:
    print('âœ… Stage 1 é©—è­‰é€šéï¼')
else:
    print('âŒ Stage 1 é©—è­‰å¤±æ•—ï¼Œè«‹æª¢æŸ¥ä¸Šè¿°é …ç›®')
    sys.exit(1)
"
```

### ğŸš¨ é©—è­‰å¤±æ•—è™•ç†
1. **æ•¸é‡ä¸è¶³**ï¼šæª¢æŸ¥TLEæ–‡ä»¶æ˜¯å¦å®Œæ•´
2. **SGP4å¤±æ•—**ï¼šé©—è­‰TLEæ ¼å¼ï¼Œæ›´æ–°skyfieldåº«
3. **è¡€çµ±ç¼ºå¤±**ï¼šç¢ºèªä½¿ç”¨v3.1ç‰ˆæœ¬è™•ç†å™¨
4. **è¨˜æ†¶é«”æº¢å‡º**ï¼šå•Ÿç”¨åˆ†æ‰¹è™•ç†æ¨¡å¼

---
**ä¸‹ä¸€è™•ç†å™¨**: [åœ°ç†å¯è¦‹æ€§ç¯©é¸è™•ç†å™¨](./stage2-filtering.md)  
**ç›¸é—œæ–‡æª”**: [Pure Cronæ¶æ§‹](../data_processing_flow.md#pure-croné©…å‹•æ¶æ§‹)
