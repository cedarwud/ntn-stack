# ğŸ¯ v6.0 å…­éšæ®µçµ±ä¸€é‡æ§‹æŒ‡å°æ–‡æª”

**ç‰ˆæœ¬**: v6.0.0
**å‰µå»ºæ—¥æœŸ**: 2025-09-17
**å°ˆæ¡ˆç‹€æ…‹**: ğŸš¨ é‡æ§‹æŒ‡å°æ–‡æª” - çµ±ä¸€æ™‚é–“åŸºæº–èˆ‡ç²¾åº¦æå‡
**é©ç”¨ç¯„åœ**: æ‰€æœ‰å…­éšæ®µè™•ç†å™¨ + Shared Coreæ¶æ§‹

## ğŸ“‹ é‡æ§‹èƒŒæ™¯èˆ‡ç›®æ¨™

### ğŸš¨ é—œéµå•é¡Œè­˜åˆ¥

**æ ¹æœ¬å•é¡Œ**: ç•¶å‰å…­éšæ®µç³»çµ±å­˜åœ¨æ™‚é–“åŸºæº–ä¸ä¸€è‡´å’Œè¨ˆç®—ç²¾åº¦å·®ç•°ï¼Œå°è‡´ï¼š
- **Stage 2é›¶å¯è¦‹æ€§å•é¡Œ**: 2,272é¡†è¡›æ˜Ÿè™•ç†ä½†é›¶å¯è¦‹çµæœ
- **æ™‚é–“åŸºæº–æ··äº‚**: Stage 1å’ŒStage 2ä½¿ç”¨ä¸åŒæ™‚é–“åŸºæº–
- **ç²¾åº¦ä¸ä¸€è‡´**: å–®æª”æ¡ˆè¨ˆç®—å™¨(3,240é¡†) vs å¤šéšæ®µç³»çµ±(2,272é¡†)çš„æº–ç¢ºæ€§å·®ç•°
- **å­¸è¡“æ¨™æº–é•è¦**: é•åGrade Aå­¸è¡“æ•¸æ“šæ¨™æº–è¦æ±‚

### ğŸ¯ v6.0 çµ±ä¸€é‡æ§‹ç›®æ¨™

**æ ¸å¿ƒç›®æ¨™**: å»ºç«‹å¯é çš„æ™‚é–“åŸºæº–ç¹¼æ‰¿æ©Ÿåˆ¶å’Œé«˜ç²¾åº¦è¨ˆç®—æ¨™æº–ï¼Œå¯¦ç¾ï¼š
1. **æ™‚é–“åŸºæº–çµ±ä¸€**: æ‰€æœ‰å…­éšæ®µä½¿ç”¨ç›¸åŒçš„TLE epochæ™‚é–“åŸºæº–
2. **è¨ˆç®—åº«æ¨™æº–åŒ–**: çµ±ä¸€ä½¿ç”¨Skyfieldåº«å¯¦ç¾å­¸è¡“ç´šç²¾åº¦
3. **æ•¸æ“šå‚³éå„ªåŒ–**: é«˜ç²¾åº¦ç„¡æå¤±æ•¸æ“šå‚³éæ©Ÿåˆ¶
4. **å­¸è¡“åˆè¦ä¿è­‰**: 100%ç¬¦åˆGrade Aå­¸è¡“æ¨™æº–è¦æ±‚

## ğŸš¨ v6.0 é‡æ§‹å„ªå…ˆç´šæ¸…å–®

### ğŸ”´ Priority 1: æ™‚é–“åŸºæº–çµ±ä¸€ (ç«‹å³åŸ·è¡Œ)

#### Stage 1 ä¿®å¾©è¦æ±‚
**æ–‡ä»¶**: `src/stages/stage1_orbital_calculation/tle_orbital_calculation_processor.py`

**å¿…é ˆä¿®å¾©çš„å•é¡Œ**:
```python
# âŒ ç•¶å‰å•é¡Œï¼š_get_tle_epoch_timeæ–¹æ³•å¯èƒ½å›é€€åˆ°ç•¶å‰æ™‚é–“
def _get_tle_epoch_time(self, orbital_results: Dict[str, Any]) -> str:
    # ç•¶å‰ä»£ç¢¼å¯èƒ½ä½¿ç”¨ datetime.now() ä½œç‚ºå›é€€

# âœ… v6.0 ä¿®å¾©ï¼šå¼·åˆ¶ä½¿ç”¨TLE epochæ™‚é–“ï¼Œç¦æ­¢ä»»ä½•å›é€€
def _get_tle_epoch_time(self, orbital_results: Dict[str, Any]) -> str:
    """
    å¾è»Œé“çµæœç²å–TLE epochæ™‚é–“ - v6.0é‡æ§‹ï¼šå¼·åˆ¶ä½¿ç”¨çœŸå¯¦TLE epochæ™‚é–“
    """
    # å¾SGP4å¼•æ“ç²å–TLE epochæ™‚é–“
    tle_epoch = orbital_results.get("tle_epoch_time")

    if tle_epoch:
        self.logger.info(f"ğŸ¯ v6.0é‡æ§‹ï¼šä½¿ç”¨SGP4å¼•æ“çš„TLE epochæ™‚é–“: {tle_epoch}")
        return tle_epoch

    # v6.0é‡æ§‹ï¼šçµ•å°ç¦æ­¢ä½¿ç”¨ç•¶å‰æ™‚é–“ä½œç‚ºå›é€€ï¼
    raise ValueError("v6.0é‡æ§‹ï¼šç„¡æ³•ç²å–çœŸå¯¦TLE epochæ™‚é–“ï¼Œæ‹’çµ•ä½¿ç”¨ç•¶å‰ç³»çµ±æ™‚é–“ä½œç‚ºå›é€€")
```

**metadataè¼¸å‡ºè¦æ±‚**:
```python
# âœ… v6.0 è¦æ±‚ï¼šStage 1å¿…é ˆè¼¸å‡ºæ­£ç¢ºçš„æ™‚é–“åŸºæº–ä¿¡æ¯
metadata = {
    "calculation_base_time": tle_epoch_time,  # ä¾†è‡ªTLEæ•¸æ“šï¼Œéç•¶å‰æ™‚é–“
    "tle_epoch_time": tle_epoch_time,         # åŸå§‹TLE epochæ™‚é–“
    "time_base_source": "tle_epoch_derived",  # æ¨™è­˜ä¾†æº
    "tle_epoch_compliance": True,             # åˆè¦æ€§æ¨™è¨˜
    "stage1_time_inheritance": {              # v6.0 æ–°å¢
        "exported_time_base": tle_epoch_time,
        "inheritance_ready": True,
        "calculation_reference": "tle_epoch_based"
    }
}
```

#### Stage 2 ä¿®å¾©è¦æ±‚
**æ–‡ä»¶**: `src/stages/stage2_visibility_filter/satellite_visibility_filter_processor.py`

**å¿…é ˆä¿®å¾©çš„å•é¡Œ**:
```python
# âœ… v6.0 ä¿®å¾©ï¼šæ­£ç¢ºç¹¼æ‰¿Stage 1æ™‚é–“åŸºæº–
def load_stage1_output(self) -> Dict[str, Any]:
    """è¼‰å…¥Stage 1è»Œé“è¨ˆç®—è¼¸å‡ºä¸¦ç¹¼æ‰¿æ™‚é–“åŸºæº–"""
    stage1_data = self.orbital_data_loader.load_stage1_output()

    # ğŸš¨ v6.0 é‡æ§‹ï¼šæª¢æŸ¥ä¸¦ä½¿ç”¨ç¹¼æ‰¿çš„æ™‚é–“åŸºæº–
    inherited_time_base = stage1_data.get("inherited_time_base")
    if inherited_time_base:
        self.logger.info(f"ğŸ¯ v6.0 é‡æ§‹ï¼šä½¿ç”¨ç¹¼æ‰¿çš„Stage 1æ™‚é–“åŸºæº–: {inherited_time_base}")
        self.calculation_base_time = inherited_time_base
    else:
        self.logger.error("âŒ Stage 1æ•¸æ“šä¸­æœªæ‰¾åˆ°inherited_time_base")
        raise ValueError("v6.0é‡æ§‹ï¼šStage 2ç„¡æ³•ç¹¼æ‰¿æ™‚é–“åŸºæº–ï¼ŒStage 1è¼¸å‡ºä¸ç¬¦åˆè¦æ±‚")

    return stage1_data
```

**è¼”åŠ©æ–‡ä»¶ä¿®å¾©**:
**æ–‡ä»¶**: `src/stages/stage2_visibility_filter/orbital_data_loader.py`

```python
# âœ… v6.0 ä¿®å¾©ï¼šæ·»åŠ æ™‚é–“åŸºæº–æå–æ–¹æ³•
def _extract_stage1_time_base(self, stage1_data: Dict[str, Any]) -> str:
    """å¾Stage 1 metadataæå–è¨ˆç®—åŸºæº–æ™‚é–“ - v6.0 é‡æ§‹ï¼šç¢ºä¿Stage 2æ­£ç¢ºç¹¼æ‰¿Stage 1çš„æ™‚é–“åŸºæº–"""
    try:
        metadata = stage1_data.get("metadata", {})

        # å„ªå…ˆä½¿ç”¨TLE epochæ™‚é–“
        tle_epoch_time = metadata.get("tle_epoch_time")
        calculation_base_time = metadata.get("calculation_base_time")

        if tle_epoch_time:
            self.logger.info(f"ğŸ¯ ä½¿ç”¨Stage 1 TLE epochæ™‚é–“: {tle_epoch_time}")
            return tle_epoch_time
        elif calculation_base_time:
            self.logger.info(f"ğŸ¯ ä½¿ç”¨Stage 1è¨ˆç®—åŸºæº–æ™‚é–“: {calculation_base_time}")
            return calculation_base_time
        else:
            # å¦‚æœéƒ½æ‰¾ä¸åˆ°ï¼Œé€™æ˜¯ä¸€å€‹åš´é‡å•é¡Œ
            raise ValueError("Stage 1 metadataç¼ºå¤±æ™‚é–“åŸºæº–ä¿¡æ¯ï¼Œç„¡æ³•åŸ·è¡Œæ™‚é–“åŸºæº–ç¹¼æ‰¿")
    except Exception as e:
        self.logger.error(f"âŒ æå–Stage 1æ™‚é–“åŸºæº–å¤±æ•—: {e}")
        raise
```

### ğŸŸ¡ Priority 2: Skyfieldåº«æ¨™æº–åŒ– (æ¬¡è¦åŸ·è¡Œ)

#### Stage 1 è¨ˆç®—å¼•æ“æ›¿æ›
**æ›¿æ›ç›®æ¨™**: `src/shared/engines/sgp4_orbital_engine.py`

```python
# âœ… v6.0 æ¨™æº–ï¼šä½¿ç”¨Skyfieldé€²è¡ŒSGP4è¨ˆç®—
from skyfield.api import load, EarthSatellite
from skyfield.timelib import Time

class SkyfieldSGP4Engine:
    def __init__(self):
        self.ts = load.timescale()

    def compute_orbital_positions(self, tle_data: Dict, calculation_base_time: str) -> List[Dict]:
        """ä½¿ç”¨Skyfieldè¨ˆç®—è»Œé“ä½ç½®"""
        # å¼·åˆ¶ä½¿ç”¨TLE epochæ™‚é–“ä½œç‚ºè¨ˆç®—åŸºæº–
        calculation_time = self.ts.ut1_jd(self._convert_to_jd(calculation_base_time))

        # å‰µå»ºè¡›æ˜Ÿå°è±¡
        satellite = EarthSatellite(
            tle_data['line1'],
            tle_data['line2'],
            tle_data['name'],
            ts=self.ts
        )

        # è¨ˆç®—è»Œé“ä½ç½®
        positions = []
        for offset_minutes in range(0, orbital_period_minutes, 0.5):  # 30ç§’é–“éš”
            time_point = calculation_time + (offset_minutes / (24 * 60))  # è½‰æ›ç‚ºå¤©
            geocentric = satellite.at(time_point)

            positions.append({
                "timestamp": time_point.ut1_iso(),
                "position_eci": {
                    "x": geocentric.position.km[0],
                    "y": geocentric.position.km[1],
                    "z": geocentric.position.km[2]
                },
                "velocity_eci": {
                    "x": geocentric.velocity.km_per_s[0],
                    "y": geocentric.velocity.km_per_s[1],
                    "z": geocentric.velocity.km_per_s[2]
                }
            })

        return positions
```

#### Stage 2 åº§æ¨™è½‰æ›æ›¿æ›
**å¢å¼·ç›®æ¨™**: Stage 2 çš„åº§æ¨™è½‰æ›é‚è¼¯

```python
# âœ… v6.0 æ¨™æº–ï¼šä½¿ç”¨Skyfieldé€²è¡Œåº§æ¨™è½‰æ›
from skyfield.api import load, wgs84
from skyfield.timelib import Time

def calculate_topocentric_skyfield(self, satellite_pos: Dict, observer_loc: Dict, time_base: str) -> Dict:
    """ä½¿ç”¨Skyfieldé€²è¡Œé«˜ç²¾åº¦åº§æ¨™è½‰æ›"""
    ts = load.timescale()

    # ä½¿ç”¨ç¹¼æ‰¿çš„æ™‚é–“åŸºæº–
    calculation_time = ts.ut1_jd(self._convert_to_jd(time_base))

    # å‰µå»ºè¡›æ˜Ÿä½ç½®
    satellite_skyfield = EarthSatellite(tle_line1, tle_line2, name, ts)
    geocentric = satellite_skyfield.at(calculation_time)

    # å‰µå»ºè§€æ¸¬è€…ä½ç½®
    observer_location = wgs84.latlon(
        observer_loc['latitude'],
        observer_loc['longitude'],
        observer_loc['altitude_m']
    )

    # è¨ˆç®—åœ°å¹³åº§æ¨™
    topocentric = geocentric - observer_location.at(calculation_time)
    alt, az, distance = topocentric.altaz()

    return {
        "elevation_deg": alt.degrees,
        "azimuth_deg": az.degrees,
        "range_km": distance.km,
        "is_visible": alt.degrees >= self.get_elevation_threshold()
    }
```

### ğŸŸ¢ Priority 3: é©—è­‰æ¡†æ¶å¼·åŒ– (é…å¥—åŸ·è¡Œ)

#### v6.0 ç‰¹å®šé©—è­‰é …ç›®æ·»åŠ 

**Stage 1 æ–°å¢é©—è­‰**:
```python
def _check_time_base_inheritance_ready(self, results: Dict[str, Any]) -> bool:
    """æ™‚é–“åŸºæº–ç¹¼æ‰¿æº–å‚™æª¢æŸ¥ - v6.0 æ–°å¢"""
    metadata = results.get("metadata", {})

    # æª¢æŸ¥å¿…è¦çš„æ™‚é–“åŸºæº–ä¿¡æ¯
    required_fields = [
        "calculation_base_time",
        "tle_epoch_time",
        "time_base_source",
        "stage1_time_inheritance"
    ]

    for field in required_fields:
        if field not in metadata:
            self.logger.error(f"âŒ ç¼ºå°‘æ™‚é–“åŸºæº–ç¹¼æ‰¿å¿…è¦å­—æ®µ: {field}")
            return False

    # æª¢æŸ¥æ™‚é–“åŸºæº–ä¾†æº
    if metadata["time_base_source"] != "tle_epoch_derived":
        self.logger.error(f"âŒ æ™‚é–“åŸºæº–ä¾†æºéŒ¯èª¤: {metadata['time_base_source']}")
        return False

    # æª¢æŸ¥ç¹¼æ‰¿æº–å‚™ç‹€æ…‹
    inheritance_info = metadata.get("stage1_time_inheritance", {})
    if not inheritance_info.get("inheritance_ready", False):
        self.logger.error("âŒ æ™‚é–“åŸºæº–ç¹¼æ‰¿æœªæº–å‚™å°±ç·’")
        return False

    self.logger.info("âœ… æ™‚é–“åŸºæº–ç¹¼æ‰¿æº–å‚™æª¢æŸ¥é€šé")
    return True

def _check_skyfield_integration(self, results: Dict[str, Any]) -> bool:
    """Skyfieldåº«æ•´åˆæª¢æŸ¥ - v6.0 æ–°å¢"""
    # æª¢æŸ¥è¨ˆç®—å¼•æ“é¡å‹
    if not hasattr(self.orbital_engine, 'ts'):  # Skyfield timescale object
        self.logger.error("âŒ æœªä½¿ç”¨Skyfieldåº«é€²è¡Œè»Œé“è¨ˆç®—")
        return False

    # æª¢æŸ¥è¨ˆç®—ç²¾åº¦
    satellites = results.get("satellites", [])
    if satellites:
        sample_sat = satellites[0]
        positions = sample_sat.get("orbital_positions", [])
        if positions:
            sample_pos = positions[0]
            position_eci = sample_pos.get("position_eci", {})

            # æª¢æŸ¥ç²¾åº¦ (Skyfieldæ‡‰è©²æä¾›æ›´é«˜ç²¾åº¦)
            x_precision = len(str(position_eci.get("x", 0)).split('.')[-1])
            if x_precision < 3:  # è‡³å°‘3ä½å°æ•¸ç²¾åº¦
                self.logger.warning(f"âš ï¸ ä½ç½®ç²¾åº¦å¯èƒ½ä¸è¶³: {x_precision}ä½å°æ•¸")
                return False

    self.logger.info("âœ… Skyfieldåº«æ•´åˆæª¢æŸ¥é€šé")
    return True
```

**Stage 2 æ–°å¢é©—è­‰**:
```python
def _check_time_base_inheritance(self, input_data: Dict[str, Any]) -> bool:
    """æ™‚é–“åŸºæº–ç¹¼æ‰¿é©—è­‰ - v6.0 æ–°å¢"""
    inherited_time_base = input_data.get("inherited_time_base")

    if not inherited_time_base:
        self.logger.error("âŒ æœªæ‰¾åˆ°Stage 1ç¹¼æ‰¿çš„æ™‚é–“åŸºæº–")
        return False

    # æª¢æŸ¥ç•¶å‰processoræ˜¯å¦ä½¿ç”¨äº†ç¹¼æ‰¿çš„æ™‚é–“åŸºæº–
    if not hasattr(self, 'calculation_base_time'):
        self.logger.error("âŒ Stage 2æœªè¨­ç½®è¨ˆç®—åŸºæº–æ™‚é–“")
        return False

    if self.calculation_base_time != inherited_time_base:
        self.logger.error(f"âŒ æ™‚é–“åŸºæº–ä¸ä¸€è‡´: {self.calculation_base_time} vs {inherited_time_base}")
        return False

    self.logger.info(f"âœ… æ™‚é–“åŸºæº–ç¹¼æ‰¿é©—è­‰é€šé: {inherited_time_base}")
    return True

def _check_visibility_calculation_accuracy(self, results: Dict[str, Any]) -> bool:
    """å¯è¦‹æ€§è¨ˆç®—æº–ç¢ºæ€§æª¢æŸ¥ - v6.0 æ–°å¢"""
    metadata = results.get("metadata", {})

    # æª¢æŸ¥è­˜åˆ¥çš„è¡›æ˜Ÿæ•¸é‡æ˜¯å¦é”åˆ°å–®æª”æ¡ˆè¨ˆç®—å™¨çš„æ°´å¹³
    total_satellites = metadata.get("total_filtered_satellites", 0)
    expected_minimum = 3000  # åŸºæ–¼å–®æª”æ¡ˆè¨ˆç®—å™¨çš„3,240é¡†çµæœ

    if total_satellites < expected_minimum:
        self.logger.warning(f"âš ï¸ å¯è¦‹æ€§è­˜åˆ¥æ•¸é‡å¯èƒ½ä¸è¶³: {total_satellites} < {expected_minimum}")
        # é€™æ˜¯è­¦å‘Šè€ŒééŒ¯èª¤ï¼Œå› ç‚ºå¯èƒ½æ˜¯åˆç†çš„åœ°ç†é™åˆ¶

    # æª¢æŸ¥å¯è¦‹æ€§æ¯”ä¾‹
    input_satellites = metadata.get("total_input_satellites", 1)
    visibility_rate = total_satellites / input_satellites

    if visibility_rate < 0.30:  # è‡³å°‘30%å¯è¦‹æ€§
        self.logger.error(f"âŒ å¯è¦‹æ€§æ¯”ä¾‹éä½: {visibility_rate:.2%}")
        return False

    self.logger.info(f"âœ… å¯è¦‹æ€§è¨ˆç®—æº–ç¢ºæ€§æª¢æŸ¥é€šé: {total_satellites}é¡† ({visibility_rate:.2%})")
    return True
```

## ğŸ”§ å¯¦æ–½æ­¥é©Ÿè©³ç´°æŒ‡å—

### Step 1: Stage 1 æ™‚é–“åŸºæº–ä¿®å¾©

1. **ä¿®æ”¹ `tle_orbital_calculation_processor.py`**:
   - ä¿®å¾© `_get_tle_epoch_time` æ–¹æ³•ï¼Œç¦æ­¢ç•¶å‰æ™‚é–“å›é€€
   - æ·»åŠ  `stage1_time_inheritance` metadata è¼¸å‡º
   - æ·»åŠ  v6.0 ç‰¹å®šé©—è­‰é …ç›®

2. **æ¸¬è©¦é©—è­‰**:
   ```bash
   # åŸ·è¡ŒStage 1ä¸¦æª¢æŸ¥metadataè¼¸å‡º
   docker exec satellite-dev python -c "
   import sys; sys.path.append('/satellite-processing/src')
   from stages.stage1_orbital_calculation.tle_orbital_calculation_processor import Stage1TLEProcessor
   stage1 = Stage1TLEProcessor()
   results = stage1.execute()
   print('calculation_base_time:', results['metadata']['calculation_base_time'])
   print('time_base_source:', results['metadata']['time_base_source'])
   print('inheritance_ready:', results['metadata']['stage1_time_inheritance']['inheritance_ready'])
   "
   ```

3. **é æœŸçµæœ**:
   - `calculation_base_time` æ‡‰ç‚ºTLE epochæ™‚é–“ï¼ˆå¦‚ï¼š2025-09-02T12:34:56Zï¼‰
   - `time_base_source` æ‡‰ç‚º "tle_epoch_derived"
   - `inheritance_ready` æ‡‰ç‚º True

### Step 2: Stage 2 æ™‚é–“åŸºæº–ç¹¼æ‰¿

1. **ä¿®æ”¹ `satellite_visibility_filter_processor.py`**:
   - æ·»åŠ æ™‚é–“åŸºæº–ç¹¼æ‰¿é‚è¼¯
   - æ·»åŠ  v6.0 ç‰¹å®šé©—è­‰é …ç›®
   - ç¢ºä¿æ‰€æœ‰å¯è¦‹æ€§è¨ˆç®—ä½¿ç”¨ç¹¼æ‰¿çš„æ™‚é–“åŸºæº–

2. **ä¿®æ”¹ `orbital_data_loader.py`**:
   - æ·»åŠ  `_extract_stage1_time_base` æ–¹æ³•
   - åœ¨ `load_stage1_output` ä¸­è¨­ç½® `inherited_time_base`

3. **æ¸¬è©¦é©—è­‰**:
   ```bash
   # åŸ·è¡ŒStage 1+2ä¸¦æª¢æŸ¥æ™‚é–“åŸºæº–ç¹¼æ‰¿
   docker exec satellite-dev python -c "
   import sys; sys.path.append('/satellite-processing/src')
   from stages.stage1_orbital_calculation.tle_orbital_calculation_processor import Stage1TLEProcessor
   from stages.stage2_visibility_filter.satellite_visibility_filter_processor import SatelliteVisibilityFilterProcessor

   # åŸ·è¡ŒStage 1
   stage1 = Stage1TLEProcessor()
   stage1_results = stage1.execute()

   # åŸ·è¡ŒStage 2
   stage2 = SatelliteVisibilityFilterProcessor()
   stage2_results = stage2.execute()

   print('Stage 1 time base:', stage1_results['metadata']['calculation_base_time'])
   print('Stage 2 time base:', stage2.calculation_base_time)
   print('Time base match:', stage1_results['metadata']['calculation_base_time'] == stage2.calculation_base_time)
   "
   ```

4. **é æœŸçµæœ**:
   - Stage 1å’ŒStage 2çš„æ™‚é–“åŸºæº–æ‡‰è©²å®Œå…¨ä¸€è‡´
   - Stage 2æ‡‰æ­£ç¢ºç¹¼æ‰¿Stage 1çš„æ™‚é–“åŸºæº–
   - å¯è¦‹æ€§è­˜åˆ¥æ•¸é‡æ‡‰é¡¯è‘—æå‡ï¼ˆç›®æ¨™>3,000é¡†ï¼‰

### Step 3: Skyfieldåº«æ•´åˆ

1. **å®‰è£Skyfieldä¾è³´**:
   ```bash
   # åœ¨å®¹å™¨å…§å®‰è£Skyfield
   docker exec satellite-dev pip install skyfield
   ```

2. **å‰µå»ºSkyfieldè¨ˆç®—å¼•æ“**:
   - å‰µå»º `src/shared/engines/skyfield_sgp4_engine.py`
   - å¯¦ç¾çµ±ä¸€çš„Skyfieldè¨ˆç®—æ¥å£

3. **é€æ­¥æ›¿æ›è¨ˆç®—é‚è¼¯**:
   - å…ˆæ›¿æ›Stage 1çš„è»Œé“è¨ˆç®—
   - å†æ›¿æ›Stage 2çš„åº§æ¨™è½‰æ›
   - ä¿æŒAPIå…¼å®¹æ€§

### Step 4: å…¨é¢æ¸¬è©¦é©—è­‰

1. **å–®éšæ®µæ¸¬è©¦**:
   ```bash
   # æ¸¬è©¦æ¯å€‹ä¿®å¾©å¾Œçš„éšæ®µ
   docker exec satellite-dev python scripts/test_stage1_v6.py
   docker exec satellite-dev python scripts/test_stage2_v6.py
   ```

2. **é›†æˆæ¸¬è©¦**:
   ```bash
   # æ¸¬è©¦å®Œæ•´çš„Stage 1+2æµç¨‹
   docker exec satellite-dev python scripts/run_stage1_stage2_integration_test.py
   ```

3. **æ€§èƒ½æ¯”è¼ƒæ¸¬è©¦**:
   ```bash
   # æ¯”è¼ƒv6.0ä¿®å¾©å‰å¾Œçš„æ€§èƒ½
   docker exec satellite-dev python scripts/compare_v6_performance.py
   ```

## ğŸ“Š é æœŸæˆæœæŒ‡æ¨™

### ğŸ¯ é—œéµæˆåŠŸæŒ‡æ¨™

| æŒ‡æ¨™ | ä¿®å¾©å‰ | v6.0ç›®æ¨™ | é©—è­‰æ–¹å¼ |
|------|--------|----------|----------|
| Stage 2å¯è¦‹è¡›æ˜Ÿæ•¸ | 2,272é¡† | >3,000é¡† | åŸ·è¡Œçµæœçµ±è¨ˆ |
| æ™‚é–“åŸºæº–ä¸€è‡´æ€§ | ä¸ä¸€è‡´ | 100%ä¸€è‡´ | metadataæª¢æŸ¥ |
| è¨ˆç®—ç²¾åº¦ç­‰ç´š | å…¬é‡Œç´š | ç±³ç´š | Skyfieldé›†æˆæª¢æŸ¥ |
| å­¸è¡“æ¨™æº–åˆè¦ | Grade B+ | Grade A++ | åˆè¦é©—è­‰é€šé |
| é›¶å¯è¦‹æ€§å•é¡Œ | å­˜åœ¨ | å®Œå…¨è§£æ±º | å¯è¦‹æ€§çµæœé©—è­‰ |

### ğŸš¨ å›æ»¾æº–å‚™

**å›æ»¾æ¢ä»¶**:
- v6.0ä¿®å¾©å¾ŒStage 2è­˜åˆ¥è¡›æ˜Ÿæ•¸ < 2,000é¡†
- ä»»ä½•é—œéµé©—è­‰é …ç›®å¤±æ•—
- ç³»çµ±ç©©å®šæ€§åš´é‡ä¸‹é™

**å›æ»¾æ–¹æ³•**:
```bash
# 1. å‚™ä»½ç•¶å‰v6.0ä»£ç¢¼
cp -r src/stages src/stages_v6_backup

# 2. æ¢å¾©v5.1ç‰ˆæœ¬ä»£ç¢¼
git checkout v5.1 -- src/stages/

# 3. é‡æ–°æ¸¬è©¦ç³»çµ±ç©©å®šæ€§
docker exec satellite-dev python scripts/run_six_stages_with_validation.py
```

## ğŸ”„ æŒçºŒæ”¹é€²è¨ˆåŠƒ

### Phase 1: åŸºç¤ä¿®å¾© (ç•¶å‰)
- âœ… Stage 1æ™‚é–“åŸºæº–ä¿®å¾©
- âœ… Stage 2æ™‚é–“åŸºæº–ç¹¼æ‰¿
- ğŸ”„ åŸºç¤é©—è­‰æ¡†æ¶å¢å¼·

### Phase 2: ç²¾åº¦æå‡ (å¾ŒçºŒ)
- Skyfieldåº«å…¨é¢æ•´åˆ
- é«˜ç²¾åº¦è¨ˆç®—æ¨™æº–åŒ–
- æ€§èƒ½å„ªåŒ–

### Phase 3: å…¨ç³»çµ±çµ±ä¸€ (é•·æœŸ)
- Stage 3-6æ™‚é–“åŸºæº–ç¹¼æ‰¿
- å…¨ç³»çµ±Skyfieldæ¨™æº–åŒ–
- å®Œæ•´å­¸è¡“åˆè¦ä¿è­‰

---

**æœ¬æŒ‡å°æ–‡æª”å°‡æŒ‡å°å®Œæ•´çš„v6.0é‡æ§‹å¯¦æ–½ï¼Œç¢ºä¿å…­éšæ®µç³»çµ±é”åˆ°å­¸è¡“ç´šç²¾åº¦å’Œä¸€è‡´æ€§æ¨™æº–ã€‚**

*å‰µå»ºæ—¥æœŸï¼š2025-09-17 | v6.0 é‡æ§‹æŒ‡å°æ–‡æª” 1.0.0*