# ğŸ›°ï¸ LEOè¡›æ˜ŸTLEæ•¸æ“šè¨ˆç®—å®Œæ•´æ•™å­¸æŒ‡å—

## ğŸ“š æ•™å­¸ç›®æ¨™

æœ¬æ•™å­¸å°‡å¸¶é ˜æ‚¨å¾é›¶é–‹å§‹ç†è§£ä¸¦å¯¦ä½œLEOè¡›æ˜Ÿçš„TLEæ•¸æ“šè¨ˆç®—ï¼Œå³ä½¿æ‚¨å®Œå…¨æ²’æœ‰è¡›æ˜Ÿé€šè¨Šæˆ–ç¨‹å¼é–‹ç™¼ç¶“é©—ï¼Œä¹Ÿèƒ½é€éæœ¬æŒ‡å—æŒæ¡æ ¸å¿ƒæ¦‚å¿µèˆ‡å¯¦éš›æ“ä½œã€‚

**å­¸ç¿’æˆæœ**ï¼š
- ç†è§£ä»€éº¼æ˜¯TLEæ•¸æ“šä»¥åŠç‚ºä½•é‡è¦
- æŒæ¡SGP4è»Œé“è¨ˆç®—çš„åŸºæœ¬åŸç†
- å­¸æœƒå¯¦ä½œå®Œæ•´çš„è¡›æ˜Ÿè»Œé“è¨ˆç®—ç³»çµ±
- å…·å‚™å­¸è¡“ç´šæ•¸æ“šè™•ç†æ¨™æº–çš„èªçŸ¥

---

## ğŸ¯ Chapter 1: åŸºç¤æ¦‚å¿µå…¥é–€

### 1.1 ä»€éº¼æ˜¯è¡›æ˜Ÿï¼Ÿ

**ğŸ’¡ ç°¡å–®ç†è§£**ï¼šè¡›æ˜Ÿå°±åƒæ˜¯åœ¨å¤ªç©ºä¸­ç¹è‘—åœ°çƒé£›è¡Œçš„äººé€ ç‰©é«”ï¼Œé¡ä¼¼æœˆäº®ç¹åœ°çƒè½‰ï¼Œä½†é€Ÿåº¦æ›´å¿«ã€é«˜åº¦æ›´ä½ã€‚

**LEOè¡›æ˜Ÿç‰¹é»**ï¼š
- **é«˜åº¦**ï¼šè·é›¢åœ°é¢ 300-2000 å…¬é‡Œ
- **é€Ÿåº¦**ï¼šæ¯ç§’ç´„ 7.5 å…¬é‡Œï¼ˆæ¯”é«˜éµå¿«100å€ï¼ï¼‰
- **è»Œé“é€±æœŸ**ï¼šç¹åœ°çƒä¸€åœˆéœ€è¦ 90-120 åˆ†é˜
- **ç”¨é€”**ï¼šæä¾›ç¶²è·¯æœå‹™ã€GPSå®šä½ã€é€šè¨Šç­‰

> ğŸ“Š **æŠ•å½±ç‰‡å»ºè­°**ï¼šéœ€è¦ä¸€å¼µåœ°çƒèˆ‡LEOè¡›æ˜Ÿé«˜åº¦æ¯”è¼ƒåœ–ï¼Œé¡¯ç¤º300-2000kmçš„ç¯„åœ

### 1.2 ä»€éº¼æ˜¯TLEæ•¸æ“šï¼Ÿ

**TLE = Two-Line Element Setï¼ˆå…©è¡Œè»Œé“æ ¹æ•¸ï¼‰**

**ğŸ” é€šä¿—è§£é‡‹**ï¼š
TLEå°±åƒæ˜¯è¡›æ˜Ÿçš„ã€Œèº«åˆ†è­‰ã€ï¼Œè¨˜éŒ„äº†è¡›æ˜Ÿåœ¨å¤ªç©ºä¸­çš„ä½ç½®ã€é€Ÿåº¦ã€è»Œé“å½¢ç‹€ç­‰é‡è¦è³‡è¨Šã€‚å°±åƒGPSéœ€è¦çŸ¥é“æ‚¨çš„ä½ç½®ä¸€æ¨£ï¼Œæˆ‘å€‘éœ€è¦TLEä¾†çŸ¥é“è¡›æ˜Ÿåœ¨å“ªè£¡ã€‚

**TLEæ•¸æ“šæ ¼å¼ç¯„ä¾‹**ï¼š
```
STARLINK-1007
1 44713U 19074A   25245.50000000  .00002182  00000-0  40864-4 0  9990
2 44713  53.0000 340.0000 0001234  90.0000 270.0000 15.50000000260532
```

**ğŸ” æ ¼å¼è§£æ**ï¼š
- **ç¬¬ä¸€è¡Œ**ï¼šè¡›æ˜Ÿåç¨±ï¼ˆSTARLINK-1007ï¼‰
- **ç¬¬äºŒè¡Œ**ï¼šåŒ…å«è¡›æ˜Ÿç·¨è™Ÿã€ç™¼å°„å¹´ä»½ã€è»Œé“å‚¾è§’ç­‰9å€‹é—œéµåƒæ•¸
- **ç¬¬ä¸‰è¡Œ**ï¼šåŒ…å«è»Œé“é€±æœŸã€è¿‘åœ°é»ã€é åœ°é»ç­‰6å€‹è»Œé“åƒæ•¸

> ğŸ“Š **æŠ•å½±ç‰‡å»ºè­°**ï¼šéœ€è¦ä¸€å¼µTLEæ ¼å¼è©³ç´°è§£æåœ–ï¼Œæ¨™è¨»æ¯å€‹æ•¸å­—çš„å«ç¾©

### 1.3 ç‚ºä»€éº¼éœ€è¦è¨ˆç®—è¡›æ˜Ÿè»Œé“ï¼Ÿ

**å¯¦éš›æ‡‰ç”¨å ´æ™¯**ï¼š

1. **ğŸŒ ç¶²è·¯æœå‹™**ï¼š
   - è¡›æ˜Ÿç¶²è·¯ï¼ˆå¦‚Starlinkï¼‰éœ€è¦çŸ¥é“å“ªé¡†è¡›æ˜Ÿèƒ½ç‚ºæ‚¨æä¾›æœå‹™
   - è¨ˆç®—æœ€ä½³é€£ç·šæ™‚æ©Ÿ

2. **ğŸ“¡ å¤©ç·šè¿½è¹¤**ï¼š
   - åœ°é¢ç«™éœ€è¦èª¿æ•´å¤©ç·šæ–¹å‘è¿½è¹¤è¡›æ˜Ÿ
   - ç¢ºä¿é€šè¨Šä¸ä¸­æ–·

3. **ğŸ¯ æ›æ‰‹æ±ºç­–**ï¼š
   - ç•¶å‰è¡›æ˜Ÿå³å°‡æ¶ˆå¤±æ™‚ï¼Œé¸æ“‡ä¸‹ä¸€é¡†æœ€ä½³è¡›æ˜Ÿ
   - é¿å…é€šè¨Šä¸­æ–·

**ğŸ”§ æŠ€è¡“æŒ‘æˆ°**ï¼š
- è¡›æ˜Ÿç§»å‹•é€Ÿåº¦æ¥µå¿«ï¼ˆ7.5 km/sï¼‰
- è»Œé“å—å¤šç¨®å› ç´ å½±éŸ¿ï¼ˆå¤§æ°£é˜»åŠ›ã€åœ°çƒé‡åŠ›å ´ï¼‰
- éœ€è¦é«˜ç²¾åº¦è¨ˆç®—ï¼ˆèª¤å·®<1å…¬é‡Œï¼‰

> ğŸ“Š **æŠ•å½±ç‰‡å»ºè­°**ï¼šéœ€è¦å‹•ç•«å±•ç¤ºè¡›æ˜Ÿå¿«é€Ÿç§»å‹•å’Œåœ°é¢è¦†è“‹ç¯„åœè®ŠåŒ–

---

## ğŸ§® Chapter 2: SGP4è¨ˆç®—åŸç†

### 2.1 ä»€éº¼æ˜¯SGP4ï¼Ÿ

**SGP4 = Simplified General Perturbations 4ï¼ˆç°¡åŒ–é€šç”¨æ”å‹•æ¨¡å‹ç¬¬4ç‰ˆï¼‰**

**ğŸ” é€šä¿—ç†è§£**ï¼š
SGP4å°±åƒæ˜¯ä¸€å€‹ã€Œè¡›æ˜Ÿä½ç½®è¨ˆç®—å™¨ã€ï¼Œè¼¸å…¥TLEæ•¸æ“šå’Œç›®æ¨™æ™‚é–“ï¼Œå°±èƒ½ç®—å‡ºè¡›æ˜Ÿåœ¨é‚£å€‹æ™‚åˆ»çš„ç²¾ç¢ºä½ç½®ã€‚

**æ­·å²èƒŒæ™¯**ï¼š
- 1970å¹´ä»£ç”±ç¾åœ‹ç©ºè»é–‹ç™¼
- å°ˆé–€ç”¨æ–¼ä½è»Œè¡›æ˜Ÿè»Œé“è¨ˆç®—
- æ˜¯åœ‹éš›æ¨™æº–ï¼Œå…¨ä¸–ç•Œéƒ½åœ¨ä½¿ç”¨

### 2.2 SGP4è¨ˆç®—æµç¨‹

```mermaid
graph TD
    A[è¼¸å…¥TLEæ•¸æ“š] --> B[è§£æè»Œé“åƒæ•¸]
    B --> C[è¨­å®šè¨ˆç®—æ™‚é–“]
    C --> D[åˆå§‹åŒ–SGP4æ¨¡å‹]
    D --> E[è€ƒæ…®æ”å‹•å› å­]
    E --> F[è¨ˆç®—è¡›æ˜Ÿä½ç½®]
    F --> G[è½‰æ›åº§æ¨™ç³»çµ±]
    G --> H[è¼¸å‡ºä½ç½®èˆ‡é€Ÿåº¦]
```

> ğŸ“Š **æŠ•å½±ç‰‡å»ºè­°**ï¼šéœ€è¦ä¸Šè¿°æµç¨‹åœ–çš„ç²¾ç¾ç‰ˆæœ¬

**è©³ç´°æ­¥é©Ÿèªªæ˜**ï¼š

#### Step 1: TLEæ•¸æ“šè§£æ
```python
# ç¯„ä¾‹ï¼šè§£æè»Œé“å‚¾è§’
inclination = float(tle_line2[8:16])  # 53.0000åº¦
# ç¯„ä¾‹ï¼šè§£æè»Œé“é€±æœŸ
mean_motion = float(tle_line2[52:63])  # 15.50000000æ¬¡/å¤©
```

#### Step 2: æ™‚é–“è¨ˆç®—
```python
# è¨ˆç®—å¾TLE epochåˆ°ç›®æ¨™æ™‚é–“çš„åˆ†é˜æ•¸
time_since_epoch_minutes = (target_time - tle_epoch_time).total_seconds() / 60
```

#### Step 3: æ”å‹•ä¿®æ­£
- **å¤§æ°£é˜»åŠ›**ï¼šè¡›æ˜Ÿåœ¨ç¨€è–„å¤§æ°£ä¸­æœƒæ¸›é€Ÿ
- **åœ°çƒæ‰ç‡**ï¼šåœ°çƒä¸æ˜¯å®Œç¾çƒé«”
- **ç¬¬ä¸‰é«”å¼•åŠ›**ï¼šæœˆäº®å’Œå¤ªé™½çš„å½±éŸ¿

#### Step 4: ä½ç½®è¨ˆç®—
```python
# ç°¡åŒ–çš„ä½ç½®è¨ˆç®—æ¦‚å¿µ
satellite_position = sgp4_model.propagate(time_since_epoch_minutes)
# çµæœï¼š[x, y, z] åº§æ¨™ï¼ˆå–®ä½ï¼šå…¬é‡Œï¼‰
```

### 2.3 åº§æ¨™ç³»çµ±è½‰æ›

**ğŸŒ é‡è¦æ¦‚å¿µï¼šæˆ‘å€‘éœ€è¦3ç¨®åº§æ¨™ç³»çµ±**

1. **ECIåº§æ¨™ç³»ï¼ˆEarth-Centered Inertialï¼‰**ï¼š
   - ä»¥åœ°çƒä¸­å¿ƒç‚ºåŸé»
   - ä¸éš¨åœ°çƒè‡ªè½‰
   - SGP4ç›´æ¥è¼¸å‡ºçš„åº§æ¨™

2. **ECEFåº§æ¨™ç³»ï¼ˆEarth-Centered Earth-Fixedï¼‰**ï¼š
   - ä»¥åœ°çƒä¸­å¿ƒç‚ºåŸé»
   - éš¨åœ°çƒè‡ªè½‰
   - GPSç³»çµ±ä½¿ç”¨çš„åº§æ¨™

3. **åœ°ç†åº§æ¨™ç³»ï¼ˆç¶“ç·¯åº¦+é«˜åº¦ï¼‰**ï¼š
   - æˆ‘å€‘æ—¥å¸¸ä½¿ç”¨çš„åº§æ¨™
   - ç·¯åº¦ï¼šå—åŒ—æ–¹å‘ï¼ˆ-90Â° åˆ° +90Â°ï¼‰
   - ç¶“åº¦ï¼šæ±è¥¿æ–¹å‘ï¼ˆ-180Â° åˆ° +180Â°ï¼‰

> ğŸ“Š **æŠ•å½±ç‰‡å»ºè­°**ï¼šéœ€è¦3Dåœ–å±•ç¤ºä¸‰ç¨®åº§æ¨™ç³»çµ±çš„é—œä¿‚

**è½‰æ›å…¬å¼ç¤ºæ„**ï¼š
```
ECIåº§æ¨™ â†’ è€ƒæ…®åœ°çƒè‡ªè½‰ â†’ ECEFåº§æ¨™ â†’ åœ°çƒæ©¢çƒæ¨¡å‹ â†’ ç¶“ç·¯åº¦åº§æ¨™
```

---

## ğŸ’» Chapter 3: ç¨‹å¼å¯¦ä½œæ¶æ§‹

### 3.1 ç³»çµ±æ•´é«”æ¶æ§‹

```
ğŸ—‚ï¸ è¡›æ˜Ÿè»Œé“è¨ˆç®—ç³»çµ±
â”œâ”€â”€ ğŸ“ æ•¸æ“šè¼¸å…¥å±¤
â”‚   â”œâ”€â”€ TLEæ–‡ä»¶æƒæå™¨
â”‚   â”œâ”€â”€ æ•¸æ“šæ ¼å¼é©—è­‰å™¨
â”‚   â””â”€â”€ æ™‚é–“åŸºæº–ç®¡ç†å™¨
â”œâ”€â”€ ğŸ“ è¨ˆç®—å¼•æ“å±¤  
â”‚   â”œâ”€â”€ SGP4è»Œé“è¨ˆç®—å™¨
â”‚   â”œâ”€â”€ åº§æ¨™è½‰æ›å™¨
â”‚   â””â”€â”€ æ™‚é–“åºåˆ—ç”Ÿæˆå™¨
â”œâ”€â”€ ğŸ“ æ•¸æ“šè¼¸å‡ºå±¤
â”‚   â”œâ”€â”€ çµæœæ ¼å¼åŒ–å™¨
â”‚   â”œâ”€â”€ é©—è­‰æª¢æŸ¥å™¨
â”‚   â””â”€â”€ è¨˜æ†¶é«”å‚³éå™¨
â””â”€â”€ ğŸ“ å“è³ªä¿è­‰å±¤
    â”œâ”€â”€ å­¸è¡“æ¨™æº–æª¢æŸ¥
    â”œâ”€â”€ æ•¸æ“šè¡€çµ±è¿½è¹¤
    â””â”€â”€ éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
```

> ğŸ“Š **æŠ•å½±ç‰‡å»ºè­°**ï¼šéœ€è¦å°‡ä¸Šè¿°æ¶æ§‹è£½ä½œæˆå°ˆæ¥­çš„ç³»çµ±æ¶æ§‹åœ–

### 3.2 æ ¸å¿ƒé¡åˆ¥è¨­è¨ˆ

#### 3.2.1 TLEè™•ç†å™¨é¡åˆ¥

```python
class Stage1TLEProcessor:
    """éšæ®µä¸€ï¼šTLEæ•¸æ“šè¼‰å…¥èˆ‡SGP4è»Œé“è¨ˆç®—è™•ç†å™¨"""
    
    def __init__(self):
        self.observer_location = (24.9441667, 121.3713889)  # NTPUåº§æ¨™
        self.calculation_time_window = 6  # è¨ˆç®—6å°æ™‚çš„è»Œé“
        self.time_resolution = 30  # æ¯30ç§’è¨ˆç®—ä¸€æ¬¡ä½ç½®
    
    def scan_tle_data(self):
        """æƒæä¸¦è¼‰å…¥TLEæ–‡ä»¶"""
        # åŠŸèƒ½ï¼šæƒæ /app/tle_data/ ç›®éŒ„ä¸‹çš„æ‰€æœ‰TLEæ–‡ä»¶
        # è¿”å›ï¼šTLEæ–‡ä»¶æ¸…å–®å’Œè¡›æ˜Ÿæ•¸é‡çµ±è¨ˆ
    
    def load_raw_satellite_data(self):
        """è§£æTLEæ ¼å¼ä¸¦å»ºç«‹è¡›æ˜Ÿè³‡æ–™åº«"""
        # åŠŸèƒ½ï¼šå°‡TLEæ–‡æœ¬è½‰æ›ç‚ºçµæ§‹åŒ–æ•¸æ“š
        # è¿”å›ï¼šåŒ…å«æ‰€æœ‰è¡›æ˜ŸTLEåƒæ•¸çš„å­—å…¸åˆ—è¡¨
    
    def calculate_all_orbits(self):
        """åŸ·è¡Œå®Œæ•´çš„SGP4è»Œé“è¨ˆç®—"""
        # åŠŸèƒ½ï¼šç‚ºæ¯é¡†è¡›æ˜Ÿè¨ˆç®—å®Œæ•´è»Œé“é€±æœŸ
        # è¿”å›ï¼šåŒ…å«ä½ç½®æ™‚é–“åºåˆ—çš„è¡›æ˜Ÿæ•¸æ“š
```

#### 3.2.2 SGP4è¨ˆç®—å¼•æ“

```python
class SGP4OrbitalEngine:
    """SGP4è»Œé“è¨ˆç®—å¼•æ“"""
    
    def calculate_position_timeseries(self, satellite_tle, time_points):
        """è¨ˆç®—è¡›æ˜Ÿåœ¨æŒ‡å®šæ™‚é–“é»çš„ä½ç½®åºåˆ—"""
        # è¼¸å…¥ï¼šè¡›æ˜ŸTLEæ•¸æ“š + æ™‚é–“é»åˆ—è¡¨
        # è™•ç†ï¼šSGP4è»Œé“è¨ˆç®— + åº§æ¨™è½‰æ›
        # è¼¸å‡ºï¼šä½ç½®ã€é€Ÿåº¦ã€å¯è¦‹æ€§æ•¸æ“šçš„æ™‚é–“åºåˆ—
    
    def convert_coordinates(self, eci_position, timestamp):
        """åº§æ¨™ç³»çµ±è½‰æ›"""
        # ECI â†’ ç¶“ç·¯åº¦ + ä»°è§’/æ–¹ä½è§’è¨ˆç®—
        # è¿”å›ï¼šåœ°ç†åº§æ¨™å’Œè§€æ¸¬è§’åº¦
```

### 3.3 æ•¸æ“šæµè™•ç†æµç¨‹

```mermaid
graph LR
    A[TLEæ–‡ä»¶] --> B[æƒæè¼‰å…¥]
    B --> C[æ ¼å¼é©—è­‰]
    C --> D[SGP4è¨ˆç®—]
    D --> E[åº§æ¨™è½‰æ›]
    E --> F[æ™‚é–“åºåˆ—ç”Ÿæˆ]
    F --> G[å“è³ªæª¢æŸ¥]
    G --> H[è¨˜æ†¶é«”å‚³é]
    
    style A fill:#e1f5fe
    style H fill:#e8f5e8
```

> ğŸ“Š **æŠ•å½±ç‰‡å»ºè­°**ï¼šéœ€è¦å°‡ä¸Šè¿°æµç¨‹åœ–ç¾åŒ–ï¼Œä¸¦åŠ ä¸Šæ¯å€‹æ­¥é©Ÿçš„è™•ç†æ™‚é–“

**å„æ­¥é©Ÿè©³ç´°èªªæ˜**ï¼š

1. **TLEæ–‡ä»¶æƒæï¼ˆ~5ç§’ï¼‰**ï¼š
   - æƒæ Starlink å’Œ OneWeb çš„TLEæ–‡ä»¶
   - çµ±è¨ˆè¡›æ˜Ÿæ•¸é‡ï¼ˆé æœŸ8,000+é¡†ï¼‰

2. **æ ¼å¼é©—è­‰ï¼ˆ~10ç§’ï¼‰**ï¼š
   - æª¢æŸ¥TLEæ ¼å¼æ­£ç¢ºæ€§
   - é©—è­‰æ ¡é©—å’Œï¼ˆchecksumï¼‰
   - éæ¿¾ç„¡æ•ˆæˆ–éæœŸæ•¸æ“š

3. **SGP4è¨ˆç®—ï¼ˆ~200ç§’ï¼‰**ï¼š
   - ç‚ºæ¯é¡†è¡›æ˜Ÿè¨ˆç®—192å€‹æ™‚é–“é»
   - ç¸½è¨ˆç®—é‡ï¼š8,791è¡›æ˜Ÿ Ã— 192é» = 1,687,872æ¬¡è¨ˆç®—

4. **åº§æ¨™è½‰æ›ï¼ˆ~30ç§’ï¼‰**ï¼š
   - ECI â†’ åœ°ç†åº§æ¨™è½‰æ›
   - è¨ˆç®—ä»°è§’ã€æ–¹ä½è§’ã€å¯è¦‹æ€§

5. **æ™‚é–“åºåˆ—ç”Ÿæˆï¼ˆ~15ç§’ï¼‰**ï¼š
   - çµ„ç¹”æ•¸æ“šç‚ºæ™‚é–“åºåˆ—æ ¼å¼
   - ç”Ÿæˆå…ƒæ•¸æ“šå’Œçµ±è¨ˆä¿¡æ¯

---

## ğŸ“Š Chapter 4: å¯¦éš›æ“ä½œæ­¥é©Ÿ

### 4.1 ç’°å¢ƒæº–å‚™

#### 4.1.1 ç³»çµ±éœ€æ±‚

**ç¡¬é«”éœ€æ±‚**ï¼š
- CPUï¼š4æ ¸å¿ƒä»¥ä¸Šï¼ˆå»ºè­°8æ ¸å¿ƒï¼‰
- è¨˜æ†¶é«”ï¼š8GBä»¥ä¸Šï¼ˆå»ºè­°16GBï¼‰
- å„²å­˜ç©ºé–“ï¼š10GBå¯ç”¨ç©ºé–“
- ç¶²è·¯ï¼šç©©å®šçš„ç¶²éš›ç¶²è·¯é€£ç·š

**è»Ÿé«”éœ€æ±‚**ï¼š
```bash
# å¿…è¦å¥—ä»¶æ¸…å–®
Python 3.8+
Docker 20.10+
skyfield==1.46  # SGP4è¨ˆç®—åº«
numpy>=1.21.0   # æ•¸å€¼è¨ˆç®—
astropy>=5.0    # å¤©æ–‡è¨ˆç®—
pytz>=2021.1    # æ™‚å€è™•ç†
```

#### 4.1.2 Dockerç’°å¢ƒè¨­ç½®

```bash
# 1. å•Ÿå‹•Dockerå®¹å™¨
cd /home/sat/ntn-stack
make up

# 2. é€²å…¥è¨ˆç®—å®¹å™¨
docker exec -it netstack-api bash

# 3. é©—è­‰ç’°å¢ƒ
python -c "import skyfield; print('SGP4ç’°å¢ƒæ­£å¸¸')"
```

### 4.2 TLEæ•¸æ“šæº–å‚™

#### 4.2.1 TLEæ•¸æ“šä¾†æº

**ä¸»è¦æ•¸æ“šä¾†æºï¼šSpace-Track.org**
- å®˜æ–¹ç¶²ç«™ï¼šhttps://www.space-track.org/
- æ•¸æ“šæ›´æ–°é »ç‡ï¼šæ¯æ—¥æ›´æ–°
- æ•¸æ“šæ ¼å¼ï¼šNORADå…©è¡Œè»Œé“æ ¹æ•¸

**æœ¬ç³»çµ±TLEæ•¸æ“šä½ç½®**ï¼š
```bash
/app/tle_data/
â”œâ”€â”€ starlink/tle/
â”‚   â””â”€â”€ starlink_20250902.tle    # Starlinkè¡›æ˜ŸTLEï¼ˆ8,140é¡†ï¼‰
â””â”€â”€ oneweb/tle/
    â””â”€â”€ oneweb_20250903.tle      # OneWebè¡›æ˜ŸTLEï¼ˆ651é¡†ï¼‰
```

#### 4.2.2 TLEæ•¸æ“šæª¢æŸ¥

```bash
# æª¢æŸ¥TLEæ–‡ä»¶æ˜¯å¦å­˜åœ¨
find /app/tle_data -name "*.tle" -exec ls -la {} \;

# çµ±è¨ˆè¡›æ˜Ÿæ•¸é‡
echo "Starlinkè¡›æ˜Ÿæ•¸é‡ï¼š"
grep -c "STARLINK" /app/tle_data/starlink/tle/starlink_*.tle

echo "OneWebè¡›æ˜Ÿæ•¸é‡ï¼š"
grep -c "ONEWEB" /app/tle_data/oneweb/tle/oneweb_*.tle
```

**é æœŸè¼¸å‡º**ï¼š
```
Starlinkè¡›æ˜Ÿæ•¸é‡ï¼š8140
OneWebè¡›æ˜Ÿæ•¸é‡ï¼š651
```

### 4.3 åŸ·è¡Œè»Œé“è¨ˆç®—

#### 4.3.1 å–®æ­¥é©ŸåŸ·è¡Œ

```bash
# é€²å…¥è™•ç†å™¨ç›®éŒ„
cd /app/src/stages

# åŸ·è¡Œéšæ®µä¸€TLEè»Œé“è¨ˆç®—
python tle_orbital_calculation_processor.py
```

**åŸ·è¡Œéç¨‹è¼¸å‡ºç¯„ä¾‹**ï¼š
```
ğŸš€ é–‹å§‹éšæ®µä¸€ï¼šTLEæ•¸æ“šè¼‰å…¥èˆ‡SGP4è»Œé“è¨ˆç®—
ğŸ“Š æƒæTLEæ•¸æ“š...
  - ç™¼ç¾ Starlink TLEæ–‡ä»¶ï¼š8,140é¡†è¡›æ˜Ÿ
  - ç™¼ç¾ OneWeb TLEæ–‡ä»¶ï¼š651é¡†è¡›æ˜Ÿ
  - ç¸½è¨ˆï¼š8,791é¡†è¡›æ˜Ÿ

ğŸ§® åŸ·è¡ŒSGP4è»Œé“è¨ˆç®—...
  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 100% 
  - è¨ˆç®—å®Œæˆï¼š1,687,872å€‹è»Œé“é»
  - è™•ç†æ™‚é–“ï¼š4åˆ†23ç§’

âœ… éšæ®µä¸€è¨ˆç®—å®Œæˆï¼
  - è¼¸å‡ºæ–‡ä»¶ï¼š/app/data/tle_orbital_calculation_output.json
  - è¨˜æ†¶é«”å‚³éï¼šæº–å‚™å°±ç·’
```

#### 4.3.2 å®Œæ•´å…­éšæ®µåŸ·è¡Œ

```bash
# åŸ·è¡Œå®Œæ•´çš„å…­éšæ®µè™•ç†æµç¨‹
python /app/scripts/run_six_stages_with_validation.py --stage=1
```

### 4.4 çµæœé©—è­‰

#### 4.4.1 åŸºæœ¬æ•¸æ“šæª¢æŸ¥

```python
# è¼‰å…¥è¨ˆç®—çµæœé€²è¡Œé©—è­‰
import json

# è®€å–è¼¸å‡ºæ–‡ä»¶
with open('/app/data/tle_orbital_calculation_output.json', 'r') as f:
    result = json.load(f)

# åŸºæœ¬çµ±è¨ˆ
print(f"ç¸½è¡›æ˜Ÿæ•¸é‡ï¼š{result['metadata']['total_satellites']}")
print(f"Starlinkï¼š{result['metadata']['constellations']['starlink']['satellite_count']}")
print(f"OneWebï¼š{result['metadata']['constellations']['oneweb']['satellite_count']}")

# æª¢æŸ¥ç¬¬ä¸€é¡†è¡›æ˜Ÿçš„æ•¸æ“šçµæ§‹
first_satellite = result['satellites'][0]
print(f"è¡›æ˜Ÿåç¨±ï¼š{first_satellite['satellite_name']}")
print(f"æ™‚é–“åºåˆ—é•·åº¦ï¼š{len(first_satellite['position_timeseries'])}")
```

**é æœŸè¼¸å‡º**ï¼š
```
ç¸½è¡›æ˜Ÿæ•¸é‡ï¼š8791
Starlinkï¼š8140
OneWebï¼š651
è¡›æ˜Ÿåç¨±ï¼šSTARLINK-1007
æ™‚é–“åºåˆ—é•·åº¦ï¼š192
```

#### 4.4.2 è»Œé“è¨ˆç®—ç²¾åº¦é©—è­‰

```python
# æª¢æŸ¥è¨ˆç®—ç²¾åº¦
import math

def verify_orbital_physics(satellite_data):
    """é©—è­‰è»Œé“è¨ˆç®—æ˜¯å¦ç¬¦åˆç‰©ç†å®šå¾‹"""
    timeseries = satellite_data['position_timeseries']
    
    for point in timeseries:
        # æª¢æŸ¥ä½ç½®å‘é‡é•·åº¦ï¼ˆåœ°å¿ƒè·é›¢ï¼‰
        position = point['position_eci']
        distance = math.sqrt(sum(x**2 for x in position))
        
        # LEOè¡›æ˜Ÿé«˜åº¦æ‡‰åœ¨300-2000kmç¯„åœ
        altitude = distance - 6371  # åœ°çƒåŠå¾‘
        assert 300 <= altitude <= 2000, f"é«˜åº¦ç•°å¸¸ï¼š{altitude}km"
        
        # æª¢æŸ¥é€Ÿåº¦åˆç†æ€§
        velocity = point['velocity_eci']
        speed = math.sqrt(sum(v**2 for v in velocity))
        assert 6 <= speed <= 8, f"é€Ÿåº¦ç•°å¸¸ï¼š{speed}km/s"
    
    return True

# é©—è­‰å‰10é¡†è¡›æ˜Ÿ
for i in range(10):
    satellite = result['satellites'][i]
    try:
        verify_orbital_physics(satellite)
        print(f"âœ… {satellite['satellite_name']} è»Œé“è¨ˆç®—æ­£ç¢º")
    except AssertionError as e:
        print(f"âŒ {satellite['satellite_name']} è»Œé“è¨ˆç®—ç•°å¸¸ï¼š{e}")
```

---

## ğŸ¯ Chapter 5: å­¸è¡“æ¨™æº–èˆ‡å“è³ªä¿è­‰

### 5.1 å­¸è¡“ç´šæ•¸æ“šæ¨™æº–

æˆ‘å€‘çš„ç³»çµ±éµå¾ªä¸‰ç´šæ•¸æ“šå“è³ªæ¨™æº–ï¼š

#### 5.1.1 Grade Aï¼šå¿…é ˆä½¿ç”¨çœŸå¯¦æ•¸æ“šï¼ˆçµ•ä¸å¦¥å”ï¼‰

**â­ å¼·åˆ¶è¦æ±‚**ï¼š

1. **TLEæ•¸æ“šæº**ï¼šSpace-Track.orgå®˜æ–¹å¯¦æ™‚æ•¸æ“š
   - âœ… æ•¸æ“šæ›´æ–°é »ç‡ï¼šæ¯æ—¥æ›´æ–°
   - âœ… æ ¼å¼æ¨™æº–ï¼šåš´æ ¼NORADå…©è¡Œè»Œé“æ ¹æ•¸
   - âœ… æ•¸æ“šé©—è­‰ï¼šé€šéæ ¡é©—å’Œé©—è­‰

2. **è»Œé“è¨ˆç®—ç®—æ³•**ï¼šå®Œæ•´SGP4/SDP4å¯¦ç¾
   - âœ… æ¨™æº–ï¼šAIAA 2006-6753 "Revisiting Spacetrack Report #3"
   - âœ… å¯¦æ–½ï¼šå®˜æ–¹SGP4å¯¦ç¾ï¼Œéç°¡åŒ–ç‰ˆæœ¬
   - âœ… ç²¾åº¦ï¼šä½ç½®èª¤å·® < 1km

3. **æ™‚é–“æ¨™æº–**ï¼šGPS/UTCæ¨™æº–æ™‚é–“
   - âœ… GPSæ™‚é–“ï¼šå¾®ç§’ç´šç²¾ç¢ºåŒæ­¥
   - âœ… æ™‚é–“åŸºæº–ï¼šä½¿ç”¨TLE epochæ™‚é–“è¨ˆç®—
   - âœ… åŒæ­¥ï¼šé€éNTPä¼ºæœå™¨åŒæ­¥

#### 5.1.2 Grade Cï¼šåš´æ ¼ç¦æ­¢é …ç›®ï¼ˆé›¶å®¹å¿ï¼‰

**âŒ çµ•å°ç¦æ­¢**ï¼š

1. **é è¨­è»Œé“é€±æœŸå›é€€**ï¼šå¦‚96åˆ†é˜é è¨­å€¼
2. **TLEæ•¸æ“šä¸å¯ç”¨æ™‚çš„å‡è¨­å€¼**ï¼šå¦‚å‡è¨­è¡›æ˜Ÿä½ç½®
3. **ç°¡åŒ–è»Œé“è¨ˆç®—æ¨¡å‹**ï¼šå¦‚ç·šæ€§è»Œé“è¿‘ä¼¼
4. **ä»»æ„æ™‚é–“å‡è¨­**ï¼šå¦‚ä½¿ç”¨ç³»çµ±ç•¶å‰æ™‚é–“æ›¿ä»£TLE epoch
5. **é­”è¡“æ•¸å­—**ï¼šæ²’æœ‰ç‰©ç†ä¾æ“šçš„å¸¸æ•¸å€¼

> ğŸ“Š **æŠ•å½±ç‰‡å»ºè­°**ï¼šéœ€è¦è£½ä½œGrade A vs Grade Cçš„å°æ¯”è¡¨æ ¼

### 5.2 æ™‚é–“åŸºæº–åš´æ ¼è¦æ±‚

**ğŸš¨ æ¥µå…¶é‡è¦ï¼šæ™‚é–“åŸºæº–éŒ¯èª¤æœƒå°è‡´è»Œé“è¨ˆç®—å®Œå…¨å¤±æ•—**

#### 5.2.1 æ­£ç¢ºçš„æ™‚é–“åŸºæº–ä½¿ç”¨

```python
# âœ… æ­£ç¢ºæ–¹å¼ï¼šä½¿ç”¨TLE epochæ™‚é–“
tle_epoch_date = datetime(tle_epoch_year, 1, 1, tzinfo=timezone.utc) + \
                timedelta(days=tle_epoch_day - 1)
calculation_base_time = tle_epoch_date

# ä½¿ç”¨TLE epochæ™‚é–“é€²è¡Œè»Œé“è¨ˆç®—
orbit_result = sgp4_engine.calculate_position_timeseries(
    satellite_tle, 
    calculation_base_time  # ä½¿ç”¨TLE epochæ™‚é–“
)
```

#### 5.2.2 éŒ¯èª¤çš„æ™‚é–“åŸºæº–ä½¿ç”¨

```python
# âŒ éŒ¯èª¤æ–¹å¼ï¼šä½¿ç”¨ç•¶å‰ç³»çµ±æ™‚é–“
calculation_base_time = datetime.now(timezone.utc)  # æœƒå°è‡´è»Œé“è¨ˆç®—éŒ¯èª¤ï¼

# é€™æœƒé€ æˆåš´é‡å¾Œæœï¼š
# - 8000+é¡†è¡›æ˜Ÿè¨ˆç®—çµæœé¡¯ç¤º0é¡†å¯è¦‹
# - è»Œé“é æ¸¬å®Œå…¨åé›¢å¯¦éš›ä½ç½®
# - æ™‚é–“å·®>3å¤©æ™‚è»Œé“é æ¸¬åš´é‡å¤±æº–
```

#### 5.2.3 å¯¦ä¾‹æ•™è¨“åˆ†æ

**å•é¡Œæ¡ˆä¾‹**ï¼š
- **ç¾è±¡**ï¼š8000+é¡†è¡›æ˜Ÿè¨ˆç®—çµæœé¡¯ç¤º0é¡†å¯è¦‹
- **åŸå› **ï¼šä½¿ç”¨ç•¶å‰æ™‚é–“(2025-09-08)è¨ˆç®—ï¼Œä½†TLEæ•¸æ“šæ˜¯(2025-09-02/03)
- **å½±éŸ¿**ï¼š5-6å¤©æ™‚é–“å·®å°è‡´è»Œé“é æ¸¬å®Œå…¨åé›¢
- **è§£æ±º**ï¼šä¿®æ”¹ç‚ºä½¿ç”¨TLE epochæ™‚é–“ä½œç‚ºè¨ˆç®—åŸºæº–

> ğŸ“Š **æŠ•å½±ç‰‡å»ºè­°**ï¼šéœ€è¦æ™‚é–“è»¸åœ–è¡¨ï¼Œå±•ç¤ºTLE epochæ™‚é–“vsç•¶å‰æ™‚é–“çš„å·®ç•°å½±éŸ¿

### 5.3 æ•¸æ“šè¡€çµ±è¿½è¹¤ç³»çµ±

#### 5.3.1 ä»€éº¼æ˜¯æ•¸æ“šè¡€çµ±ï¼Ÿ

**æ•¸æ“šè¡€çµ±**ï¼šè¨˜éŒ„æ•¸æ“šçš„ä¾†æºã€è™•ç†éç¨‹ã€æ™‚é–“æˆ³ç­‰å®Œæ•´è³‡è¨Šï¼Œç¢ºä¿æ•¸æ“šå¯è¿½æº¯æ€§å’Œå­¸è¡“èª ä¿¡ã€‚

**é‡è¦æ€§**ï¼š
- å­¸è¡“ç ”ç©¶å¿…é ˆèƒ½å¤ é‡ç¾çµæœ
- åŒè¡Œè©•å¯©éœ€è¦é©—è­‰æ•¸æ“šä¾†æº
- éŒ¯èª¤æ’æŸ¥éœ€è¦å®Œæ•´çš„è™•ç†è»Œè·¡

#### 5.3.2 è¡€çµ±è¿½è¹¤å¯¦ç¾

```python
# æ•¸æ“šè¡€çµ±çµæ§‹ç¯„ä¾‹
satellite_data = {
    'tle_data': {
        'source_file': '/app/tle_data/starlink/tle/starlink_20250902.tle',
        'source_file_date': '20250902',  # TLEæ•¸æ“šå¯¦éš›æ—¥æœŸ
        'epoch_year': 2025,
        'epoch_day': 245.5,
        'calculation_base_time': '2025-09-02T12:00:00Z',  # TLE epochæ™‚é–“
        'data_lineage': {
            'data_source_date': '20250902',           # æ•¸æ“šä¾†æºæ—¥æœŸ
            'tle_epoch_date': '2025-09-02T12:00:00Z', # TLEåƒè€ƒæ™‚é–“
            'processing_execution_date': '2025-09-02T14:26:00Z', # è™•ç†åŸ·è¡Œæ™‚é–“
            'calculation_strategy': 'sgp4_with_tle_epoch_base'
        }
    }
}
```

---

## ğŸ” Chapter 6: æ•…éšœæ’é™¤èˆ‡æœ€ä½³å¯¦è¸

### 6.1 å¸¸è¦‹å•é¡Œè¨ºæ–·

#### 6.1.1 TLEæ•¸æ“šå•é¡Œ

**å•é¡Œ1ï¼šTLEæ–‡ä»¶ä¸å­˜åœ¨**
```bash
# ç—‡ç‹€
FileNotFoundError: [Errno 2] No such file or directory: '/app/tle_data/starlink/tle/starlink_*.tle'

# è¨ºæ–·
find /app/tle_data -name "*.tle" -exec ls -la {} \;

# è§£æ±ºæ–¹æ¡ˆ
# 1. æª¢æŸ¥Docker volumeæ›è¼‰
docker inspect netstack-api | grep -A 10 "Mounts"
# 2. é‡æ–°ä¸‹è¼‰TLEæ•¸æ“š
./scripts/tle_management/tle_downloader.sh
```

**å•é¡Œ2ï¼šTLEæ•¸æ“šéæœŸ**
```bash
# ç—‡ç‹€
Warning: TLE data is 7 days old, calculation may be inaccurate

# è¨ºæ–·
stat /app/tle_data/starlink/tle/starlink_*.tle

# è§£æ±ºæ–¹æ¡ˆ
# åŸ·è¡ŒTLEæ›´æ–°è…³æœ¬
crontab -l  # æŸ¥çœ‹å®šæœŸæ›´æ–°è¨­å®š
./scripts/tle_management/tle_cron_scheduler.sh
```

#### 6.1.2 SGP4è¨ˆç®—å•é¡Œ

**å•é¡Œ3ï¼šè¨ˆç®—çµæœå…¨ç‚ºé›¶**
```python
# ç—‡ç‹€
satellite_position = [0.0, 0.0, 0.0]  # æ‰€æœ‰ä½ç½®éƒ½æ˜¯é›¶

# è¨ºæ–·ç¨‹å¼ç¢¼
def diagnose_sgp4_calculation(satellite_tle):
    """è¨ºæ–·SGP4è¨ˆç®—å•é¡Œ"""
    # æª¢æŸ¥TLEæ ¼å¼
    if len(satellite_tle['tle_line1']) != 69:
        return "TLE Line 1æ ¼å¼éŒ¯èª¤"
    if len(satellite_tle['tle_line2']) != 69:
        return "TLE Line 2æ ¼å¼éŒ¯èª¤"
    
    # æª¢æŸ¥æ™‚é–“åŸºæº–
    current_time = datetime.now(timezone.utc)
    tle_epoch = satellite_tle['epoch_datetime']
    time_diff_days = (current_time - tle_epoch).days
    
    if time_diff_days > 7:
        return f"TLEæ•¸æ“šéæœŸï¼š{time_diff_days}å¤©"
    
    return "TLEæ•¸æ“šæ­£å¸¸"

# è§£æ±ºæ–¹æ¡ˆ
# 1. é‡æ–°è¼‰å…¥TLEæ•¸æ“š
# 2. æª¢æŸ¥æ™‚é–“åŸºæº–è¨­å®š
# 3. é©—è­‰SGP4å¼•æ“ç‰ˆæœ¬
```

#### 6.1.3 è¨˜æ†¶é«”å•é¡Œ

**å•é¡Œ4ï¼šè¨˜æ†¶é«”ä¸è¶³**
```bash
# ç—‡ç‹€
MemoryError: Unable to allocate array with shape (8791, 192, 3)

# è¨ºæ–·
free -h  # æª¢æŸ¥å¯ç”¨è¨˜æ†¶é«”
docker stats netstack-api  # æª¢æŸ¥å®¹å™¨è¨˜æ†¶é«”ä½¿ç”¨

# è§£æ±ºæ–¹æ¡ˆ
# 1. å¢åŠ Dockerè¨˜æ†¶é«”é™åˆ¶
docker run --memory=8g ...
# 2. å•Ÿç”¨åˆ†æ‰¹è™•ç†æ¨¡å¼
export BATCH_PROCESSING=true
# 3. æ¸›å°‘æ™‚é–“åºåˆ—è§£æåº¦
export TIME_STEP_SECONDS=60  # å¾30ç§’æ”¹ç‚º60ç§’
```

### 6.2 æ•ˆèƒ½å„ªåŒ–å»ºè­°

#### 6.2.1 è¨ˆç®—æ•ˆèƒ½å„ªåŒ–

**å¤šæ ¸å¿ƒä¸¦è¡Œè™•ç†**ï¼š
```python
import multiprocessing

def optimize_sgp4_calculation():
    """å„ªåŒ–SGP4è¨ˆç®—æ•ˆèƒ½"""
    # 1. ä½¿ç”¨å¤šç¨‹åºä¸¦è¡Œè¨ˆç®—
    cpu_cores = multiprocessing.cpu_count()
    pool_size = min(cpu_cores - 1, 8)  # ä¿ç•™ä¸€æ ¸å¿ƒçµ¦ç³»çµ±
    
    # 2. åˆ†æ‰¹è™•ç†è¡›æ˜Ÿæ•¸æ“š
    batch_size = 1000  # æ¯æ‰¹è™•ç†1000é¡†è¡›æ˜Ÿ
    
    # 3. ä½¿ç”¨è¨˜æ†¶é«”æ˜ å°„æ¸›å°‘I/O
    # 4. é å…ˆåˆ†é…numpyé™£åˆ—ç©ºé–“
    
    return optimized_results
```

**è¨˜æ†¶é«”å„ªåŒ–**ï¼š
```python
def optimize_memory_usage():
    """å„ªåŒ–è¨˜æ†¶é«”ä½¿ç”¨"""
    # 1. ä½¿ç”¨numpy float32è€Œéfloat64
    position_array = numpy.zeros((satellite_count, time_points, 3), dtype=numpy.float32)
    
    # 2. åŠæ™‚é‡‹æ”¾ä¸éœ€è¦çš„è®Šé‡
    del intermediate_calculations
    
    # 3. ä½¿ç”¨ç”Ÿæˆå™¨è€Œéåˆ—è¡¨
    def satellite_generator():
        for satellite in satellite_list:
            yield process_satellite(satellite)
    
    # 4. åˆ†å¡Šè™•ç†å¤§å‹æ•¸æ“š
    for chunk in chunked_data(satellite_list, chunk_size=500):
        process_chunk(chunk)
```

#### 6.2.2 I/Oæ•ˆèƒ½å„ªåŒ–

```python
def optimize_io_performance():
    """å„ªåŒ–æª”æ¡ˆI/Oæ•ˆèƒ½"""
    # 1. ä½¿ç”¨è¨˜æ†¶é«”å‚³éä»£æ›¿æª”æ¡ˆI/O
    result = process_in_memory(satellite_data)
    
    # 2. å£“ç¸®è¼¸å‡ºæª”æ¡ˆ
    import gzip
    with gzip.open('output.json.gz', 'wt') as f:
        json.dump(result, f)
    
    # 3. ä¸¦è¡Œæª”æ¡ˆè®€å–
    import concurrent.futures
    with concurrent.futures.ThreadPoolExecutor() as executor:
        tle_files = executor.map(read_tle_file, file_list)
```

### 6.3 æœ€ä½³å¯¦è¸å»ºè­°

#### 6.3.1 é–‹ç™¼æœ€ä½³å¯¦è¸

1. **ç‰ˆæœ¬æ§åˆ¶**ï¼š
   - ä½¿ç”¨Gitè¿½è¹¤ç¨‹å¼ç¢¼è®Šæ›´
   - æ¨™è¨˜é‡è¦ç‰ˆæœ¬å’Œç™¼å¸ƒé»
   - è¨˜éŒ„æ¯æ¬¡ä¿®æ”¹çš„åŸå› å’Œå½±éŸ¿

2. **æ¸¬è©¦é©—è­‰**ï¼š
   - å–®å…ƒæ¸¬è©¦ï¼šæ¸¬è©¦å€‹åˆ¥å‡½æ•¸åŠŸèƒ½
   - æ•´åˆæ¸¬è©¦ï¼šæ¸¬è©¦å®Œæ•´è™•ç†æµç¨‹
   - æ•ˆèƒ½æ¸¬è©¦ï¼šç›£æ§è¨ˆç®—æ™‚é–“å’Œè¨˜æ†¶é«”ä½¿ç”¨

3. **æ–‡æª”ç¶­è­·**ï¼š
   - ä¿æŒç¨‹å¼ç¢¼è¨»è§£æ›´æ–°
   - è¨˜éŒ„é…ç½®åƒæ•¸è®Šæ›´
   - ç¶­è­·æ•…éšœæ’é™¤æŒ‡å—

#### 6.3.2 é‹ç‡Ÿæœ€ä½³å¯¦è¸

1. **ç›£æ§å‘Šè­¦**ï¼š
```bash
# è¨­å®šè‡ªå‹•ç›£æ§è…³æœ¬
#!/bin/bash
# monitor_tle_processing.sh

# æª¢æŸ¥TLEæ•¸æ“šæ–°é®®åº¦
LATEST_TLE=$(find /app/tle_data -name "*.tle" -printf '%T@ %p\n' | sort -n | tail -1)
AGE_DAYS=$(( ($(date +%s) - ${LATEST_TLE%% *}) / 86400 ))

if [ $AGE_DAYS -gt 3 ]; then
    echo "è­¦å‘Šï¼šTLEæ•¸æ“šå·²éæœŸ $AGE_DAYS å¤©"
    # ç™¼é€å‘Šè­¦é€šçŸ¥
    curl -X POST "your-alert-webhook" -d "TLE data is $AGE_DAYS days old"
fi

# æª¢æŸ¥è™•ç†å™¨ç‹€æ…‹
if ! python -c "from stages.tle_orbital_calculation_processor import Stage1TLEProcessor"; then
    echo "éŒ¯èª¤ï¼šTLEè™•ç†å™¨ç„¡æ³•è¼‰å…¥"
fi
```

2. **å‚™ä»½ç­–ç•¥**ï¼š
```bash
# å‚™ä»½é—œéµæ•¸æ“š
#!/bin/bash
# backup_tle_system.sh

# å‚™ä»½TLEæ•¸æ“š
tar -czf "tle_backup_$(date +%Y%m%d).tar.gz" /app/tle_data/

# å‚™ä»½è™•ç†çµæœ
cp /app/data/tle_orbital_calculation_output.json \
   /backup/tle_output_$(date +%Y%m%d_%H%M%S).json

# å‚™ä»½ç³»çµ±é…ç½®
docker inspect netstack-api > /backup/container_config_$(date +%Y%m%d).json
```

3. **å®šæœŸç¶­è­·**ï¼š
   - æ¯é€±æª¢æŸ¥TLEæ•¸æ“šæ›´æ–°ç‹€æ…‹
   - æ¯æœˆæª¢æŸ¥ç³»çµ±æ•ˆèƒ½æŒ‡æ¨™
   - æ¯å­£åº¦æ›´æ–°ä¾è³´åº«ç‰ˆæœ¬
   - æ¯å¹´æª¢è¦–å­¸è¡“æ¨™æº–æ›´æ–°

---

## ğŸ“ Chapter 7: é€²éšä¸»é¡Œèˆ‡æœªä¾†ç™¼å±•

### 7.1 é«˜ç²¾åº¦è»Œé“è¨ˆç®—

#### 7.1.1 SGP4é™åˆ¶èˆ‡æ”¹é€²

**SGP4çš„é™åˆ¶**ï¼š
- ç²¾åº¦éš¨æ™‚é–“è¡°æ¸›ï¼ˆ24å°æ™‚å¾Œèª¤å·®>1kmï¼‰
- ç„¡æ³•è™•ç†æ©Ÿå‹•è»Œé“ä¿®æ­£
- å¤§æ°£å¯†åº¦æ¨¡å‹ç°¡åŒ–

**æ”¹é€²æ–¹æ¡ˆ**ï¼š
```python
class EnhancedOrbitCalculator:
    """å¢å¼·ç‰ˆè»Œé“è¨ˆç®—å™¨"""
    
    def __init__(self):
        self.use_high_precision_gravity = True  # ä½¿ç”¨é«˜ç²¾åº¦é‡åŠ›æ¨¡å‹
        self.atmospheric_density_model = "NRLMSISE-00"  # å…ˆé€²å¤§æ°£æ¨¡å‹
        self.solar_pressure_correction = True  # å¤ªé™½è¼»å°„å£“ä¿®æ­£
    
    def calculate_precise_orbit(self, satellite_data, time_span):
        """é«˜ç²¾åº¦è»Œé“è¨ˆç®—"""
        # 1. ä½¿ç”¨æ•¸å€¼ç©åˆ†ä»£æ›¿è§£æè§£
        # 2. è€ƒæ…®å¤šç¨®æ”å‹•å› å­
        # 3. å¯¦æ™‚å¤§æ°£å¯†åº¦ä¿®æ­£
        
        return precise_orbit_data
```

#### 7.1.2 æ©Ÿå™¨å­¸ç¿’è¼”åŠ©è»Œé“é æ¸¬

```python
import tensorflow as tf

class MLOrbitPredictor:
    """æ©Ÿå™¨å­¸ç¿’è»Œé“é æ¸¬å™¨"""
    
    def __init__(self):
        self.model = self.build_lstm_model()
        self.feature_scaler = StandardScaler()
    
    def build_lstm_model(self):
        """å»ºç«‹LSTMè»Œé“é æ¸¬æ¨¡å‹"""
        model = tf.keras.Sequential([
            tf.keras.layers.LSTM(128, return_sequences=True),
            tf.keras.layers.LSTM(64),
            tf.keras.layers.Dense(32, activation='relu'),
            tf.keras.layers.Dense(3)  # x, y, z ä½ç½®è¼¸å‡º
        ])
        
        model.compile(optimizer='adam', loss='mse')
        return model
    
    def predict_orbit_correction(self, historical_positions, atmospheric_data):
        """é æ¸¬è»Œé“ä¿®æ­£"""
        # ä½¿ç”¨æ­·å²è»Œé“æ•¸æ“šå’Œå¤§æ°£åƒæ•¸é æ¸¬æœªä¾†ä½ç½®
        return corrected_positions
```

### 7.2 å³æ™‚è»Œé“æ›´æ–°ç³»çµ±

#### 7.2.1 ä¸²æµè™•ç†æ¶æ§‹

```python
import asyncio
import websockets

class RealTimeOrbitUpdater:
    """å³æ™‚è»Œé“æ›´æ–°ç³»çµ±"""
    
    def __init__(self):
        self.update_interval = 30  # 30ç§’æ›´æ–°ä¸€æ¬¡
        self.websocket_clients = set()
    
    async def stream_orbit_updates(self):
        """ä¸²æµè»Œé“æ›´æ–°"""
        while True:
            # 1. æª¢æŸ¥TLEæ•¸æ“šæ›´æ–°
            new_tle_data = await self.check_tle_updates()
            
            if new_tle_data:
                # 2. å³æ™‚é‡æ–°è¨ˆç®—è»Œé“
                updated_orbits = await self.recalculate_orbits(new_tle_data)
                
                # 3. æ¨é€æ›´æ–°çµ¦æ‰€æœ‰å®¢æˆ¶ç«¯
                await self.broadcast_updates(updated_orbits)
            
            await asyncio.sleep(self.update_interval)
    
    async def broadcast_updates(self, orbit_data):
        """å»£æ’­è»Œé“æ›´æ–°"""
        message = json.dumps({
            'type': 'orbit_update',
            'timestamp': datetime.now().isoformat(),
            'data': orbit_data
        })
        
        # ç™¼é€çµ¦æ‰€æœ‰é€£æ¥çš„å®¢æˆ¶ç«¯
        if self.websocket_clients:
            await asyncio.gather(
                *[client.send(message) for client in self.websocket_clients],
                return_exceptions=True
            )
```

### 7.3 å¤šæ˜Ÿåº§æ•´åˆç®¡ç†

#### 7.3.1 çµ±ä¸€æ˜Ÿåº§ç®¡ç†ä»‹é¢

```python
class ConstellationManager:
    """å¤šæ˜Ÿåº§çµ±ä¸€ç®¡ç†å™¨"""
    
    def __init__(self):
        self.constellations = {
            'starlink': StarlinkConstellation(),
            'oneweb': OneWebConstellation(), 
            'kuiper': KuiperConstellation(),
            'galileo': GalileoConstellation()
        }
    
    def unified_orbit_calculation(self, target_time):
        """çµ±ä¸€è»Œé“è¨ˆç®—ä»‹é¢"""
        all_satellites = []
        
        for name, constellation in self.constellations.items():
            # æ¯å€‹æ˜Ÿåº§å¯èƒ½æœ‰ä¸åŒçš„TLEæ ¼å¼å’Œè¨ˆç®—åƒæ•¸
            satellites = constellation.calculate_orbits(target_time)
            
            # æ¨™æº–åŒ–è¼¸å‡ºæ ¼å¼
            standardized = self.standardize_format(satellites, name)
            all_satellites.extend(standardized)
        
        return self.merge_constellation_data(all_satellites)
    
    def optimize_global_coverage(self):
        """å„ªåŒ–å…¨çƒè¦†è“‹ç¯„åœ"""
        # åˆ†æå¤šæ˜Ÿåº§å”åŒè¦†è“‹æ•ˆæœ
        # è­˜åˆ¥è¦†è“‹ç›²å€
        # å»ºè­°æœ€ä½³æ˜Ÿåº§é…ç½®
        
        return coverage_optimization_report
```

### 7.4 å­¸è¡“ç ”ç©¶æ‡‰ç”¨

#### 7.4.1 ç ”ç©¶æ•¸æ“šæ¨™æº–åŒ–

```python
class AcademicDataExporter:
    """å­¸è¡“ç ”ç©¶æ•¸æ“šåŒ¯å‡ºå™¨"""
    
    def export_for_publication(self, orbit_data, metadata):
        """åŒ¯å‡ºç¬¦åˆå­¸è¡“ç™¼è¡¨æ¨™æº–çš„æ•¸æ“š"""
        
        academic_dataset = {
            'title': 'LEO Satellite Orbital Calculation Dataset',
            'version': '1.0.0',
            'doi': '10.xxxx/dataset.2025.001',
            'authors': ['NTN Stack Research Team'],
            'institution': 'National Taipei University',
            'license': 'CC BY 4.0',
            
            'methodology': {
                'orbital_model': 'SGP4/SDP4',
                'reference_standard': 'AIAA 2006-6753',
                'coordinate_system': 'ECI J2000.0',
                'time_standard': 'UTC',
                'data_sources': {
                    'tle_provider': 'Space-Track.org',
                    'update_frequency': 'Daily',
                    'constellations': ['Starlink', 'OneWeb']
                }
            },
            
            'quality_metrics': {
                'position_accuracy': '<1km LEO satellites',
                'time_resolution': '30 seconds',
                'validation_method': 'Cross-reference with STK',
                'data_completeness': '99.9%'
            },
            
            'data': orbit_data,
            'metadata': metadata
        }
        
        return academic_dataset
    
    def generate_citation(self):
        """ç”Ÿæˆæ¨™æº–å¼•ç”¨æ ¼å¼"""
        return """
        NTN Stack Research Team. (2025). LEO Satellite Orbital Calculation Dataset. 
        National Taipei University. https://doi.org/10.xxxx/dataset.2025.001
        """
```

#### 7.4.2 åŒè¡Œè©•å¯©æº–å‚™

**ç™¼è¡¨æº–å‚™æ¸…å–®**ï¼š

1. **æ•¸æ“šå¯é‡ç¾æ€§**ï¼š
   - [ ] æä¾›å®Œæ•´çš„TLEæ•¸æ“šé›†
   - [ ] è¨˜éŒ„æ‰€æœ‰è¨ˆç®—åƒæ•¸
   - [ ] é–‹æºSGP4å¯¦ç¾ç¨‹å¼ç¢¼
   - [ ] æä¾›é©—è­‰æ¸¬è©¦æ¡ˆä¾‹

2. **æ–¹æ³•è«–æ–‡æª”**ï¼š
   - [ ] è©³ç´°çš„è»Œé“è¨ˆç®—æµç¨‹
   - [ ] åº§æ¨™ç³»çµ±è½‰æ›èªªæ˜
   - [ ] èª¤å·®åˆ†æå’Œç²¾åº¦è©•ä¼°
   - [ ] èˆ‡å•†æ¥­è»Ÿé«”æ¯”è¼ƒé©—è­‰

3. **çµ±è¨ˆåˆ†æ**ï¼š
   - [ ] è»Œé“ç²¾åº¦çµ±è¨ˆåˆ†å¸ƒ
   - [ ] è¨ˆç®—æ•ˆèƒ½åŸºæº–æ¸¬è©¦
   - [ ] ä¸åŒæ˜Ÿåº§ç‰¹æ€§æ¯”è¼ƒ
   - [ ] é•·æœŸè»Œé“æ¼”åŒ–åˆ†æ

---

## ğŸ“ˆ Chapter 8: çµè«–èˆ‡ç¸½çµ

### 8.1 å­¸ç¿’æˆæœå›é¡§

é€šéæœ¬æ•™å­¸ï¼Œæ‚¨å·²ç¶“æŒæ¡äº†ï¼š

#### 8.1.1 ç†è«–çŸ¥è­˜
- âœ… **è¡›æ˜Ÿè»Œé“åŠ›å­¸åŸºç¤**ï¼šç†è§£LEOè¡›æ˜Ÿé‹å‹•åŸç†
- âœ… **TLEæ•¸æ“šæ ¼å¼**ï¼šæŒæ¡å…©è¡Œè»Œé“æ ¹æ•¸çš„çµæ§‹å’Œå«ç¾©
- âœ… **SGP4è¨ˆç®—åŸç†**ï¼šäº†è§£è»Œé“è¨ˆç®—çš„æ•¸å­¸æ¨¡å‹
- âœ… **åº§æ¨™ç³»çµ±è½‰æ›**ï¼šæŒæ¡ECIã€ECEFã€åœ°ç†åº§æ¨™çš„é—œä¿‚

#### 8.1.2 å¯¦å‹™æŠ€èƒ½
- âœ… **ç³»çµ±æ¶æ§‹è¨­è¨ˆ**ï¼šç†è§£å¤§è¦æ¨¡è¡›æ˜Ÿè¨ˆç®—ç³»çµ±çš„æ¶æ§‹
- âœ… **ç¨‹å¼å¯¦ä½œèƒ½åŠ›**ï¼šèƒ½å¤ å¯¦ç¾å®Œæ•´çš„è»Œé“è¨ˆç®—æµç¨‹
- âœ… **å“è³ªä¿è­‰æ–¹æ³•**ï¼šæŒæ¡å­¸è¡“ç´šæ•¸æ“šæ¨™æº–å’Œé©—è­‰æ–¹æ³•
- âœ… **æ•…éšœæ’é™¤æŠ€å·§**ï¼šå…·å‚™è¨ºæ–·å’Œè§£æ±ºå¸¸è¦‹å•é¡Œçš„èƒ½åŠ›

#### 8.1.3 å­¸è¡“ç´ é¤Š
- âœ… **æ•¸æ“šèª ä¿¡æ„è­˜**ï¼šç†è§£Grade A/B/Cæ•¸æ“šæ¨™æº–çš„é‡è¦æ€§
- âœ… **æ™‚é–“åŸºæº–åŸå‰‡**ï¼šæŒæ¡æ­£ç¢ºçš„è»Œé“è¨ˆç®—æ™‚é–“åŸºæº–
- âœ… **å¯é‡ç¾æ€§è¦æ±‚**ï¼šäº†è§£å­¸è¡“ç ”ç©¶çš„å¯é‡ç¾æ€§æ¨™æº–
- âœ… **åŒè¡Œè©•å¯©æº–å‚™**ï¼šå…·å‚™ç™¼è¡¨å­¸è¡“è«–æ–‡çš„åŸºæœ¬ç´ é¤Š

### 8.2 é—œéµæŠ€è¡“è¦é»

#### 8.2.1 å¿…é ˆè¨˜ä½çš„é‡è¦åŸå‰‡

1. **ğŸš¨ æ™‚é–“åŸºæº–åŸå‰‡**ï¼š
   ```
   è»Œé“è¨ˆç®—å¿…é ˆä½¿ç”¨TLE epochæ™‚é–“ï¼Œçµ•ä¸èƒ½ä½¿ç”¨ç•¶å‰ç³»çµ±æ™‚é–“
   ```

2. **ğŸ“Š å­¸è¡“æ¨™æº–åŸå‰‡**ï¼š
   ```
   Grade Aæ•¸æ“šè¦æ±‚ï¼šçœŸå¯¦TLEæ•¸æ“š + å®˜æ–¹SGP4ç®—æ³• + æ¨™æº–æ™‚é–“ç³»çµ±
   ```

3. **ğŸ” ç²¾åº¦é©—è­‰åŸå‰‡**ï¼š
   ```
   è¨ˆç®—çµæœå¿…é ˆèˆ‡ç¨ç«‹å¯¦ç¾é€²è¡Œäº¤å‰é©—è­‰ï¼Œä½ç½®èª¤å·® < 1km
   ```

4. **ğŸ“ˆ æ•ˆèƒ½å„ªåŒ–åŸå‰‡**ï¼š
   ```
   8,791é¡†è¡›æ˜Ÿçš„å®Œæ•´è»Œé“è¨ˆç®—æ‡‰åœ¨5åˆ†é˜å…§å®Œæˆ
   ```

#### 8.2.2 å¸¸è¦‹é™·é˜±èˆ‡é¿å…æ–¹æ³•

| é™·é˜± | ç—‡ç‹€ | é¿å…æ–¹æ³• |
|------|------|----------|
| æ™‚é–“åŸºæº–éŒ¯èª¤ | 0é¡†è¡›æ˜Ÿå¯è¦‹ | æª¢æŸ¥calculation_base_timeè¨­å®š |
| TLEæ•¸æ“šéæœŸ | è»Œé“é æ¸¬åå·® | å®šæœŸæ›´æ–°TLEæ•¸æ“šï¼ˆ<7å¤©ï¼‰ |
| è¨˜æ†¶é«”ä¸è¶³ | è¨ˆç®—ä¸­æ–· | ä½¿ç”¨åˆ†æ‰¹è™•ç†æˆ–å¢åŠ è¨˜æ†¶é«” |
| åº§æ¨™è½‰æ›éŒ¯èª¤ | ä½ç½®è¨ˆç®—ç•°å¸¸ | é©—è­‰åº§æ¨™ç³»çµ±ä¸€è‡´æ€§ |
| SGP4å¼•æ“éŒ¯èª¤ | è¨ˆç®—çµæœç‚ºé›¶ | æª¢æŸ¥TLEæ ¼å¼å’Œå¼•æ“ç‰ˆæœ¬ |

> ğŸ“Š **æŠ•å½±ç‰‡å»ºè­°**ï¼šä¸Šè¿°è¡¨æ ¼éœ€è¦è£½ä½œæˆè¦–è¦ºåŒ–çš„å°æ¯”åœ–è¡¨

### 8.3 å¯¦éš›æ‡‰ç”¨åƒ¹å€¼

#### 8.3.1 å•†æ¥­æ‡‰ç”¨æ½›åŠ›

1. **è¡›æ˜Ÿé€šè¨Šæœå‹™**ï¼š
   - Starlinkã€OneWebç­‰æ˜Ÿåº§ç¶²è·¯å„ªåŒ–
   - ç”¨æˆ¶çµ‚ç«¯å¤©ç·šè‡ªå‹•è¿½è¹¤
   - æœå‹™è¦†è“‹ç¯„åœé æ¸¬

2. **ç‰©è¯ç¶²æ‡‰ç”¨**ï¼š
   - åé åœ°å€è¨­å‚™é€£æ¥
   - æµ·ä¸Šèˆ¹èˆ¶é€šè¨Š
   - ç½å€æ‡‰æ€¥é€šè¨Š

3. **é‡‘èç§‘æŠ€**ï¼š
   - é«˜é »äº¤æ˜“ç¶²è·¯å»¶é²å„ªåŒ–
   - è·¨åœ‹æ”¯ä»˜è·¯å¾‘è¦åŠƒ
   - å€å¡Šéˆç¯€é»åˆ†ä½ˆå„ªåŒ–

#### 8.3.2 ç ”ç©¶æ‡‰ç”¨å‰æ™¯

1. **å­¸è¡“ç ”ç©¶**ï¼š
   - LEOè¡›æ˜Ÿæ›æ‰‹æ¼”ç®—æ³•å„ªåŒ–
   - æ˜Ÿåº§å”åŒè¦†è“‹ç ”ç©¶
   - è»Œé“å‹•åŠ›å­¸æ¨¡å‹æ”¹é€²

2. **æŠ€è¡“å‰µæ–°**ï¼š
   - æ©Ÿå™¨å­¸ç¿’è»Œé“é æ¸¬
   - å³æ™‚è»Œé“æ›´æ–°ç³»çµ±
   - å¤šæ˜Ÿåº§æ•´åˆç®¡ç†

3. **æ”¿ç­–åˆ¶å®š**ï¼š
   - å¤ªç©ºäº¤é€šç®¡ç†
   - è»Œé“ç¢ç‰‡è¿½è¹¤
   - åœ‹éš›é »è­œå”èª¿

### 8.4 å¾ŒçºŒå­¸ç¿’å»ºè­°

#### 8.4.1 é€²éšæŠ€è¡“é ˜åŸŸ

1. **è»Œé“åŠ›å­¸æ·±å…¥**ï¼š
   - å­¸ç¿’GMATã€STKç­‰å°ˆæ¥­è»Ÿé«”
   - ç ”è®€NASAè»Œé“åŠ›å­¸æ•™ç§‘æ›¸
   - åƒèˆ‡AIAAè»Œé“åŠ›å­¸æœƒè­°

2. **è¡›æ˜Ÿé€šè¨ŠæŠ€è¡“**ï¼š
   - 3GPP NTNæ¨™æº–æ·±å…¥ç ”ç©¶
   - å°„é »éˆè·¯é ç®—è¨ˆç®—
   - ä¿¡è™Ÿè™•ç†èˆ‡èª¿è®ŠæŠ€è¡“

3. **ç³»çµ±å·¥ç¨‹æ–¹æ³•**ï¼š
   - å¤§è¦æ¨¡åˆ†æ•£å¼ç³»çµ±è¨­è¨ˆ
   - å³æ™‚ç³»çµ±é–‹ç™¼
   - é›²ç«¯è¨ˆç®—æ¶æ§‹

#### 8.4.2 å­¸è¡“ç™¼å±•è·¯å¾‘

1. **è«–æ–‡ç™¼è¡¨æº–å‚™**ï¼š
   - å­¸ç¿’LaTeXå­¸è¡“å¯«ä½œ
   - åƒèˆ‡åœ‹éš›æœƒè­°æŠ•ç¨¿
   - å»ºç«‹ç ”ç©¶åˆä½œç¶²è·¯

2. **ç ”ç©¶è³‡æºå»ºç«‹**ï¼š
   - ç”³è«‹NASAæ•¸æ“šå­˜å–æ¬Šé™
   - å»ºç«‹å¯¦é©—å®¤æ¸¬è©¦ç’°å¢ƒ
   - è³¼è²·å•†æ¥­è»Ÿé«”æˆæ¬Š

3. **ç”¢å­¸åˆä½œæ©Ÿæœƒ**ï¼š
   - åƒèˆ‡å¤ªç©ºç”¢æ¥­å°ˆæ¡ˆ
   - èˆ‡åœ‹éš›ç ”ç©¶æ©Ÿæ§‹åˆä½œ
   - æŠ€è¡“è½‰ç§»å•†æ¥­åŒ–

### 8.5 æœ€çµ‚å»ºè­°

#### 8.5.1 æŒçºŒå­¸ç¿’çš„é‡è¦æ€§

å¤ªç©ºæŠ€è¡“æ˜¯å¿«é€Ÿç™¼å±•çš„é ˜åŸŸï¼š
- **æ–°æ˜Ÿåº§ä¸æ–·ç™¼å°„**ï¼šAmazon Kuiperã€ä¸­åœ‹æ˜Ÿåº§ç­‰
- **æŠ€è¡“æ¨™æº–æŒçºŒæ›´æ–°**ï¼š3GPP Release-18/19
- **è¨ˆç®—æ–¹æ³•ä¸æ–·æ”¹é€²**ï¼šé«˜ç²¾åº¦æ•¸å€¼æ¨¡å‹ã€AIè¼”åŠ©é æ¸¬

#### 8.5.2 å¯¦è¸çš„é‡è¦æ€§

**ç†è«–å¿…é ˆçµåˆå¯¦è¸**ï¼š
- å‹•æ‰‹å¯¦ä½œå¯ä»¥ç™¼ç¾æ›¸æœ¬ä¸Šæ²’æœ‰çš„å•é¡Œ
- çœŸå¯¦æ•¸æ“šè™•ç†æœƒé‡åˆ°æ„æƒ³ä¸åˆ°çš„æŒ‘æˆ°
- ç³»çµ±æ•´åˆéœ€è¦å¤§é‡çš„èª¿è©¦å’Œå„ªåŒ–ç¶“é©—

#### 8.5.3 å­¸è¡“èª ä¿¡çš„é‡è¦æ€§

**æ•¸æ“šå“è³ªæ±ºå®šç ”ç©¶åƒ¹å€¼**ï¼š
- Grade Aæ¨™æº–ä¸æ˜¯éåº¦è¦æ±‚ï¼Œè€Œæ˜¯å­¸è¡“åŸºæœ¬è¦æ±‚
- ä»»ä½•ç°¡åŒ–æˆ–å‡è¨­éƒ½å¯èƒ½å½±éŸ¿çµè«–çš„å¯ä¿¡åº¦
- åŒè¡Œè©•å¯©æœƒåš´æ ¼æª¢æŸ¥æ•¸æ“šä¾†æºå’Œæ–¹æ³•è«–

---

## ğŸ“š é™„éŒ„

### é™„éŒ„Aï¼šåƒè€ƒæ–‡ç»

#### A.1 è»Œé“åŠ›å­¸æ¨™æº–æ–‡ç»
1. **AIAA 2006-6753**: "Revisiting Spacetrack Report #3" - SGP4/SDP4å®˜æ–¹å¯¦ç¾æ¨™æº–
2. **NASA/TP-2010-216239**: "SGP4 Orbit Determination" - NASAè»Œé“è¨ˆç®—æŠ€è¡“å ±å‘Š
3. **IERS Conventions (2010)**: åœ°çƒåƒè€ƒæ¡†æ¶å’Œæ™‚é–“ç³»çµ±æ¨™æº–

#### A.2 è¡›æ˜Ÿé€šè¨Šæ¨™æº–
1. **3GPP TS 38.821**: "Solutions for NR to support non-terrestrial networks"
2. **ITU-R P.618-13**: "Earth-space path attenuation"
3. **ITU-R P.676-12**: "Attenuation by atmospheric gases"

#### A.3 æ•¸æ“šä¾†æº
1. **Space-Track.org**: å®˜æ–¹NORAD TLEæ•¸æ“šä¾†æº
2. **CelesTrak**: TLEæ•¸æ“šæ ¼å¼æ¨™æº–å’Œé©—è­‰å·¥å…·
3. **NASA JPL**: é«˜ç²¾åº¦æ˜Ÿæ›†æ•¸æ“š

### é™„éŒ„Bï¼šç¨‹å¼ç¢¼ç¯„ä¾‹

#### B.1 å®Œæ•´TLEè™•ç†ç¯„ä¾‹
```python
#!/usr/bin/env python3
"""
å®Œæ•´çš„TLEè»Œé“è¨ˆç®—ç¯„ä¾‹
é©åˆåˆå­¸è€…å­¸ç¿’ä½¿ç”¨
"""

import json
from datetime import datetime, timezone, timedelta
from skyfield.api import load, EarthSatellite

class SimpleTLECalculator:
    """ç°¡åŒ–ç‰ˆTLEè¨ˆç®—å™¨ï¼Œé©åˆæ•™å­¸ä½¿ç”¨"""
    
    def __init__(self, observer_lat=24.9441667, observer_lon=121.3713889):
        """åˆå§‹åŒ–è¨ˆç®—å™¨"""
        self.observer_lat = observer_lat  # NTPUç·¯åº¦
        self.observer_lon = observer_lon  # NTPUç¶“åº¦
        self.earth = load('de421.bsp')['earth']
        self.observer = self.earth + load('de421.bsp')['sun']
    
    def parse_tle_file(self, tle_file_path):
        """è§£æTLEæ–‡ä»¶"""
        satellites = []
        
        with open(tle_file_path, 'r') as f:
            lines = f.readlines()
        
        # æ¯3è¡Œçµ„æˆä¸€å€‹TLEè¨˜éŒ„
        for i in range(0, len(lines), 3):
            if i + 2 < len(lines):
                name = lines[i].strip()
                line1 = lines[i + 1].strip()
                line2 = lines[i + 2].strip()
                
                satellite = {
                    'name': name,
                    'tle_line1': line1,
                    'tle_line2': line2
                }
                satellites.append(satellite)
        
        return satellites
    
    def calculate_satellite_position(self, satellite_tle, target_time):
        """è¨ˆç®—å–®é¡†è¡›æ˜Ÿä½ç½®"""
        # å»ºç«‹Skyfieldè¡›æ˜Ÿç‰©ä»¶
        satellite = EarthSatellite(
            satellite_tle['tle_line1'], 
            satellite_tle['tle_line2'],
            satellite_tle['name']
        )
        
        # è¨ˆç®—ä½ç½®
        time_obj = load.timescale().from_datetime(target_time)
        position = satellite.at(time_obj)
        
        # è¨ˆç®—åœ°ç†åº§æ¨™
        subpoint = position.subpoint()
        
        # è¨ˆç®—è§€æ¸¬è§’åº¦
        observer_location = self.earth + load('de421.bsp')['399']
        difference = satellite - observer_location
        topocentric = difference.at(time_obj)
        altitude_deg, azimuth_deg, distance_km = topocentric.altaz()
        
        return {
            'timestamp': target_time.isoformat(),
            'latitude_deg': subpoint.latitude.degrees,
            'longitude_deg': subpoint.longitude.degrees,
            'altitude_km': subpoint.elevation.km,
            'elevation_deg': altitude_deg.degrees,
            'azimuth_deg': azimuth_deg.degrees,
            'distance_km': distance_km.km,
            'is_visible': altitude_deg.degrees > 10  # ä»°è§’>10åº¦è¦–ç‚ºå¯è¦‹
        }

# ä½¿ç”¨ç¯„ä¾‹
if __name__ == "__main__":
    # åˆå§‹åŒ–è¨ˆç®—å™¨
    calculator = SimpleTLECalculator()
    
    # è§£æTLEæ–‡ä»¶
    satellites = calculator.parse_tle_file('/app/tle_data/starlink/tle/starlink_20250902.tle')
    
    # è¨ˆç®—ç•¶å‰æ™‚é–“çš„è¡›æ˜Ÿä½ç½®
    current_time = datetime.now(timezone.utc)
    
    # è™•ç†å‰10é¡†è¡›æ˜Ÿä½œç‚ºç¤ºç¯„
    results = []
    for satellite in satellites[:10]:
        try:
            position = calculator.calculate_satellite_position(satellite, current_time)
            results.append({
                'satellite_name': satellite['name'],
                'position': position
            })
            print(f"âœ… {satellite['name']}: ä»°è§’ {position['elevation_deg']:.1f}Â°")
        except Exception as e:
            print(f"âŒ {satellite['name']}: è¨ˆç®—å¤±æ•— - {e}")
    
    # å„²å­˜çµæœ
    with open('simple_tle_results.json', 'w') as f:
        json.dump(results, f, indent=2)
    
    print(f"\nè¨ˆç®—å®Œæˆï¼è™•ç†äº† {len(results)} é¡†è¡›æ˜Ÿ")
```

### é™„éŒ„Cï¼šé™¤éŒ¯å·¥å…·

#### C.1 TLEæ•¸æ“šé©—è­‰å·¥å…·
```bash
#!/bin/bash
# tle_validator.sh - TLEæ•¸æ“šé©—è­‰å·¥å…·

echo "ğŸ” TLEæ•¸æ“šé©—è­‰å·¥å…·"
echo "===================="

# æª¢æŸ¥TLEæ–‡ä»¶å­˜åœ¨æ€§
echo "1. æª¢æŸ¥TLEæ–‡ä»¶..."
for constellation in starlink oneweb; do
    tle_dir="/app/tle_data/$constellation/tle"
    if [ -d "$tle_dir" ]; then
        tle_count=$(find "$tle_dir" -name "*.tle" | wc -l)
        echo "  âœ… $constellation: ç™¼ç¾ $tle_count å€‹TLEæ–‡ä»¶"
        
        # æª¢æŸ¥æ–‡ä»¶å¤§å°
        for tle_file in "$tle_dir"/*.tle; do
            if [ -f "$tle_file" ]; then
                size=$(stat -f%z "$tle_file" 2>/dev/null || stat -c%s "$tle_file")
                echo "    ğŸ“Š $(basename "$tle_file"): $size bytes"
            fi
        done
    else
        echo "  âŒ $constellation: ç›®éŒ„ä¸å­˜åœ¨"
    fi
done

# æª¢æŸ¥TLEæ ¼å¼
echo -e "\n2. æª¢æŸ¥TLEæ ¼å¼..."
python3 << 'EOF'
import os
import glob

def validate_tle_format(tle_file):
    """é©—è­‰TLEæ ¼å¼"""
    errors = []
    
    with open(tle_file, 'r') as f:
        lines = f.readlines()
    
    if len(lines) % 3 != 0:
        errors.append(f"è¡Œæ•¸ä¸æ˜¯3çš„å€æ•¸: {len(lines)}")
    
    for i in range(1, len(lines), 3):  # æª¢æŸ¥Line 1
        if i < len(lines):
            line = lines[i].strip()
            if len(line) != 69:
                errors.append(f"Line {i+1} é•·åº¦éŒ¯èª¤: {len(line)} (æ‡‰ç‚º69)")
            if not line.startswith('1 '):
                errors.append(f"Line {i+1} æ ¼å¼éŒ¯èª¤: ä¸ä»¥'1 'é–‹é ­")
    
    for i in range(2, len(lines), 3):  # æª¢æŸ¥Line 2
        if i < len(lines):
            line = lines[i].strip()
            if len(line) != 69:
                errors.append(f"Line {i+1} é•·åº¦éŒ¯èª¤: {len(line)} (æ‡‰ç‚º69)")
            if not line.startswith('2 '):
                errors.append(f"Line {i+1} æ ¼å¼éŒ¯èª¤: ä¸ä»¥'2 'é–‹é ­")
    
    return errors

# æª¢æŸ¥æ‰€æœ‰TLEæ–‡ä»¶
tle_files = glob.glob('/app/tle_data/**/tle/*.tle', recursive=True)

for tle_file in tle_files:
    filename = os.path.basename(tle_file)
    errors = validate_tle_format(tle_file)
    
    if errors:
        print(f"  âŒ {filename}:")
        for error in errors:
            print(f"     {error}")
    else:
        # è¨ˆç®—è¡›æ˜Ÿæ•¸é‡
        with open(tle_file, 'r') as f:
            satellite_count = len(f.readlines()) // 3
        print(f"  âœ… {filename}: {satellite_count} é¡†è¡›æ˜Ÿï¼Œæ ¼å¼æ­£ç¢º")

EOF

echo -e "\n3. æª¢æŸ¥TLEæ™‚é–“æ–°é®®åº¦..."
find /app/tle_data -name "*.tle" -exec stat -c '%n: %y' {} \;

echo -e "\nğŸ¯ é©—è­‰å®Œæˆï¼"
```

#### C.2 SGP4è¨ˆç®—é©—è­‰å·¥å…·
```python
#!/usr/bin/env python3
"""
SGP4è¨ˆç®—é©—è­‰å·¥å…·
ç”¨æ–¼æª¢æŸ¥è»Œé“è¨ˆç®—çš„æº–ç¢ºæ€§
"""

import numpy as np
from datetime import datetime, timezone
from skyfield.api import load, EarthSatellite

class SGP4Validator:
    """SGP4è¨ˆç®—é©—è­‰å™¨"""
    
    def __init__(self):
        self.tolerance_km = 1.0  # ä½ç½®å®¹å·®ï¼š1å…¬é‡Œ
        self.tolerance_deg = 0.1  # è§’åº¦å®¹å·®ï¼š0.1åº¦
    
    def validate_single_satellite(self, tle_line1, tle_line2, test_time):
        """é©—è­‰å–®é¡†è¡›æ˜Ÿè¨ˆç®—"""
        try:
            # ä½¿ç”¨Skyfieldè¨ˆç®—ï¼ˆåƒè€ƒå¯¦ç¾ï¼‰
            satellite = EarthSatellite(tle_line1, tle_line2, 'TEST_SAT')
            time_obj = load.timescale().from_datetime(test_time)
            position = satellite.at(time_obj)
            
            # å–å¾—ECIåº§æ¨™
            eci_position = position.position.km
            eci_velocity = position.velocity.km_per_s
            
            return {
                'success': True,
                'eci_position': eci_position,
                'eci_velocity': eci_velocity,
                'distance_km': np.linalg.norm(eci_position),
                'speed_km_s': np.linalg.norm(eci_velocity)
            }
            
        except Exception as e:
            return {
                'success': False,
                'error': str(e)
            }
    
    def physics_validation(self, result):
        """ç‰©ç†åˆç†æ€§é©—è­‰"""
        checks = []
        
        if result['success']:
            distance = result['distance_km']
            speed = result['speed_km_s']
            
            # æª¢æŸ¥è»Œé“é«˜åº¦ï¼ˆLEOç¯„åœï¼‰
            altitude = distance - 6371  # åœ°çƒåŠå¾‘
            if 200 <= altitude <= 2000:
                checks.append(('altitude', True, f'{altitude:.1f} km'))
            else:
                checks.append(('altitude', False, f'{altitude:.1f} km (è¶…å‡ºLEOç¯„åœ)'))
            
            # æª¢æŸ¥è»Œé“é€Ÿåº¦
            if 6.5 <= speed <= 8.0:
                checks.append(('speed', True, f'{speed:.2f} km/s'))
            else:
                checks.append(('speed', False, f'{speed:.2f} km/s (é€Ÿåº¦ç•°å¸¸)'))
            
            # æª¢æŸ¥ä½ç½®å‘é‡é•·åº¦
            if distance > 6571:  # åœ°çƒåŠå¾‘ + 200km
                checks.append(('position', True, f'{distance:.1f} km'))
            else:
                checks.append(('position', False, f'{distance:.1f} km (ä½æ–¼åœ°è¡¨)'))
        
        return checks
    
    def run_comprehensive_test(self, tle_file_path, sample_size=100):
        """åŸ·è¡Œç¶œåˆæ¸¬è©¦"""
        print(f"ğŸ§ª é–‹å§‹SGP4è¨ˆç®—é©—è­‰æ¸¬è©¦")
        print(f"ğŸ“ TLEæ–‡ä»¶: {tle_file_path}")
        print(f"ğŸ“Š æ¸¬è©¦æ¨£æœ¬: {sample_size} é¡†è¡›æ˜Ÿ")
        print("=" * 50)
        
        # è®€å–TLEæ•¸æ“š
        satellites = []
        with open(tle_file_path, 'r') as f:
            lines = f.readlines()
        
        for i in range(0, len(lines), 3):
            if i + 2 < len(lines):
                satellites.append({
                    'name': lines[i].strip(),
                    'line1': lines[i + 1].strip(),
                    'line2': lines[i + 2].strip()
                })
        
        # éš¨æ©Ÿå–æ¨£
        import random
        test_satellites = random.sample(satellites, min(sample_size, len(satellites)))
        
        # æ¸¬è©¦æ™‚é–“
        test_time = datetime.now(timezone.utc)
        
        # åŸ·è¡Œæ¸¬è©¦
        results = []
        for i, sat in enumerate(test_satellites):
            print(f"\ré€²åº¦: {i+1}/{len(test_satellites)}", end='', flush=True)
            
            result = self.validate_single_satellite(
                sat['line1'], sat['line2'], test_time
            )
            
            if result['success']:
                physics_checks = self.physics_validation(result)
                result['physics_checks'] = physics_checks
                result['all_checks_passed'] = all(check[1] for check in physics_checks)
            
            result['satellite_name'] = sat['name']
            results.append(result)
        
        print()  # æ›è¡Œ
        
        # çµ±è¨ˆçµæœ
        successful = [r for r in results if r['success']]
        physics_passed = [r for r in successful if r.get('all_checks_passed', False)]
        
        print("\nğŸ“Š æ¸¬è©¦çµæœçµ±è¨ˆ:")
        print(f"  ç¸½æ¸¬è©¦æ•¸é‡: {len(results)}")
        print(f"  SGP4è¨ˆç®—æˆåŠŸ: {len(successful)} ({len(successful)/len(results)*100:.1f}%)")
        print(f"  ç‰©ç†é©—è­‰é€šé: {len(physics_passed)} ({len(physics_passed)/len(results)*100:.1f}%)")
        
        # è©³ç´°å¤±æ•—å ±å‘Š
        failed = [r for r in results if not r['success']]
        if failed:
            print(f"\nâŒ SGP4è¨ˆç®—å¤±æ•— ({len(failed)} é¡†):")
            for r in failed[:5]:  # åªé¡¯ç¤ºå‰5å€‹
                print(f"  - {r['satellite_name']}: {r['error']}")
        
        physics_failed = [r for r in successful if not r.get('all_checks_passed', False)]
        if physics_failed:
            print(f"\nâš ï¸  ç‰©ç†é©—è­‰å¤±æ•— ({len(physics_failed)} é¡†):")
            for r in physics_failed[:5]:
                print(f"  - {r['satellite_name']}:")
                for check_name, passed, value in r['physics_checks']:
                    if not passed:
                        print(f"    {check_name}: {value}")
        
        return {
            'total_tested': len(results),
            'sgp4_success_rate': len(successful) / len(results),
            'physics_pass_rate': len(physics_passed) / len(results),
            'detailed_results': results
        }

# ä½¿ç”¨ç¯„ä¾‹
if __name__ == "__main__":
    validator = SGP4Validator()
    
    # æ¸¬è©¦Starlinkè¡›æ˜Ÿ
    results = validator.run_comprehensive_test(
        '/app/tle_data/starlink/tle/starlink_20250902.tle', 
        sample_size=50
    )
    
    print(f"\nğŸ¯ æœ€çµ‚è©•ä¼°:")
    if results['sgp4_success_rate'] > 0.95 and results['physics_pass_rate'] > 0.90:
        print("âœ… SGP4è¨ˆç®—ç³»çµ±é‹è¡Œæ­£å¸¸")
    else:
        print("âŒ SGP4è¨ˆç®—ç³»çµ±å­˜åœ¨å•é¡Œï¼Œéœ€è¦æª¢æŸ¥")
```

> ğŸ“Š **æŠ•å½±ç‰‡å»ºè­°**ï¼šæœ¬æ•™å­¸æ–‡ä»¶éœ€è¦è½‰æ›ç‚ºç´„30-40å¼µæŠ•å½±ç‰‡ï¼Œé‡é»ç« ç¯€éœ€è¦é…åœ–å’Œå‹•ç•«æ•ˆæœã€‚

---

**ğŸ“ æ–‡ä»¶è³‡è¨Š**
- **ç‰ˆæœ¬**: v1.0
- **æœ€å¾Œæ›´æ–°**: 2025-09-11
- **ä½œè€…**: NTN Stack Research Team
- **ç›®æ¨™è®€è€…**: è¡›æ˜Ÿé€šè¨Šåˆå­¸è€…ã€ç¨‹å¼é–‹ç™¼æ–°æ‰‹
- **é è¨ˆæŠ•å½±ç‰‡æ•¸é‡**: 35-40å¼µ
- **å»ºè­°æˆèª²æ™‚é–“**: 3-4å°æ™‚ï¼ˆåŒ…å«å¯¦ä½œç·´ç¿’ï¼‰