### SIB19 是什麼？  
SystemInformationBlockType19（簡稱 SIB19）是 3GPP TS 38.331 為非地面網路（NTN）新增的系統資訊區塊。gNB 透過 BCCH-BCH 以週期性廣播方式下發，任何在該小區內的 UE 都能被動接收。其內容可概略分為四大類：  

- **衛星軌道資訊**：衛星星曆（satelliteEphemeris）、軌道參考時間（epochTime）、軌道模型類型等。  
- **移動參考位置參數**：movingReferenceLocation 的計算常數、位置基準座標系統、時區與時間同步偏移。  
- **時頻校正資訊**：GNSS 時間偏移、頻率校準用的 Doppler 參數。  
- **輔助配置**：可選的 SIB 版本號、存活時間、廣播週期與有效期等元資料。  

D2 事件之所以反覆提到 SIB19，是因為 D2 需要「**隨時間更新的衛星位置**」來建立 `movingReferenceLocation`，而該位置正是靠 UE 解析 SIB19 中的星曆與時間戳自行推算得出。  

### 為什麼模擬 D2 必須先「獲取並解析 SIB19」  
1. **觸發邏輯依賴動態位置**：D2 的條件是「距離服務衛星的移動參考位置 > 閾值１」且「距離目標衛星的移動參考位置  Thresh1」且「目標衛星距離 < Thresh2」同時滿足，則在模擬流程中產生「MeasurementReport(D2)」。  
   - 後續可模擬網路側接收報告後配置 CHO 或下發 RRCReconfiguration 等訊息，完成整個切換流程的閉環。  

7. **有效期與更新策略**  
   - SIB19 會標示 `validityTime`；模擬時應在該時間到期前重新索取最新星曆，否則 propagate 會因軌道演化而逐漸失準。  
   - 真實網路通常每數分鐘到數十秒即重新廣播一次 SIB19；在離線重播或純軟體模擬中，可自行設定刷新週期以貼近實際行為。  

### 注意事項  

- **同步精度**：D2 觸發閾值往往只有數十至數百米，時鐘誤差幾十毫秒就可能造成觸發提前或錯失，需要在模擬中加入 GNSS 時鐘同步或誤差模型。  
- **星曆品質**：若使用公網 TLE 替代真實 SIB19 星曆，需評估誤差是否可接受，否則模擬結果會過度樂觀或悲觀。  
- **軌道擾動**：高擾動 LEO（特別是傾角高、低高度軌道）可能需要引入大氣阻力與 J2/J4 項等高階攝動，才能在長時間窗口內保持觸發精度。  
- **多衛星並行**：真正的 NTN 會同時追蹤多顆可見衛星；模擬時也應建立一個衛星星座管理器，將各衛星的星曆分別 propagate，才能觀察到「服務衛星落下→目標衛星升起」的連續切換鏈。  

透過上述步驟，即可在不揭露任何專屬程式碼的前提下，完整理解並實作「從 SIB19 取得星曆→生成 movingReferenceLocation→應用 D2 雙閾值觸發」的整個模擬流程。