# NTN Stack - 非地面網路通訊系統

## 專案概述

NTN Stack 是一個基於 5G 標準的非地面網路（Non-Terrestrial Networks, NTN）通訊系統，專為無人機群體通訊與衛星基地台整合而設計。系統結合了現代 5G 核心網技術、衛星軌道計算、無線通訊模擬與視覺化展示，提供完整的端到端通訊解決方案。

### 核心功能特色

* **動態 5G 非地面網路模擬**：基於 Open5GS 和 UERANSIM 構建的完整 5G 核心網與無線接取網
* **即時衛星軌道計算**：整合 Skyfield 天文計算引擎，支援 OneWeb 等 LEO 衛星星座追蹤
* **UAV 群體通訊管理**：支援多架無人機的動態位置更新、軌跡規劃與通訊品質評估
* **干擾控制與抗干擾**：內建 AI-RAN 決策引擎，支援動態頻率切換與干擾避讓
* **三維視覺化模擬**：基於 React Three Fiber 和 Sionna RT 的 3D 場景渲染與射線追蹤
* **即時系統監控**：整合 Prometheus 與 Grafana 的系統效能監控與告警機制

## 系統架構

### 主要組件

**NetStack API**
- 基於 FastAPI 的核心 API 服務
- 實現 Hexagonal Architecture 設計模式
- 提供 UE 管理、網路切片、衛星映射等核心功能
- 支援 Redis 快取與 MongoDB 資料持久化

**SimWorld**
- 前端：React + TypeScript + Three.js 視覺化界面
- 後端：FastAPI + SQLModel + PostgreSQL 資料管理
- 支援 3D 場景渲染、設備管理與即時數據展示
- 整合 Sionna RT 進行電磁波傳播模擬

**監控與部署**
- Prometheus + Grafana 系統監控
- Docker Compose 容器化部署
- 自動化部署腳本與配置管理
- 完整的系統健康檢查機制

### 技術棧

**後端技術**
- Python 3.11+
- FastAPI - 高效能 API 框架
- SQLModel/SQLAlchemy - 資料庫 ORM
- Redis - 記憶體快取
- MongoDB - 文件型資料庫
- PostgreSQL - 關聯式資料庫

**前端技術**
- React 19
- TypeScript
- Three.js / React Three Fiber - 3D 渲染
- Vite - 建置工具
- Socket.IO - 即時通訊

**5G 網路核心**
- Open5GS - 5G 核心網實作
- UERANSIM - 5G RAN 模擬器
- Sionna RT - 射線追蹤模擬

**衛星與科學計算**
- Skyfield - 天文計算與衛星軌道
- NumPy/SciPy - 數值計算
- Matplotlib - 資料視覺化

## 核心功能模組

### 1. 5G 核心網管理

**UE (用戶設備) 管理**
- 動態 UE 註冊與去註冊
- 即時連線狀態監控
- UE 統計資料收集與分析
- 支援 IMSI 查詢與管理

**網路切片控制**
- 動態網路切片切換
- QoS 策略管理
- 切片類型配置 (eMBB、URLLC、mMTC)
- 切片效能監控與最佳化

**UERANSIM 配置生成**
- 動態 gNodeB 配置生成
- UE 配置範本管理
- 多場景配置支援
- 配置檔案自動部署

### 2. 衛星系統整合

**衛星軌道計算**
- OneWeb 星座即時追蹤
- TLE 資料自動更新
- ECEF/ENU 座標系轉換
- 衛星可見性計算

**衛星 gNodeB 映射**
- 衛星位置到 gNodeB 參數轉換
- 動態傳播延遲補償
- 多普勒效應計算
- 波束覆蓋範圍模擬

**星座管理**
- OneWeb 648 顆衛星完整模擬
- 18 個軌道面配置
- 87.4° 軌道傾角精確模擬
- 1200km 軌道高度設定

### 3. UAV 群體通訊

**軌跡管理**
- UAV 軌跡規劃與建立
- 多點航路規劃
- 軌跡更新與修改
- 軌跡執行狀態監控

**UAV 狀態管理**
- 即時位置更新
- 飛行任務管理
- 通訊連線品質評估
- UAV 群體協調控制

**連線品質評估**
- SINR (信噪干擾比) 計算
- 連線品質歷史分析
- 異常檢測與告警
- 效能閾值管理

### 4. 干擾控制與 AI-RAN

**干擾場景模擬**
- 干擾源配置與管理
- 多類型干擾模型
- 干擾影響評估
- 干擾事件記錄

**AI-RAN 決策引擎**
- 智慧頻率選擇
- 動態功率控制
- 抗干擾策略生成
- 決策結果應用

**策略執行**
- UERANSIM 配置動態更新
- gNodeB 參數調整
- 干擾避讓策略實作
- 效果評估與反饋

### 5. Mesh 網路橋接

**Mesh 節點管理**
- Mesh 節點建立與配置
- 節點狀態監控
- 拓撲結構管理
- 路由最佳化

**5G-Mesh 閘道**
- 雙模通訊閘道管理
- 流量橋接處理
- 效能監控與分析
- 故障檢測與復原

**UAV Mesh 備援機制**
- 自動故障切換
- 網路模式動態轉換
- 備援狀態監控
- 手動干預支援

### 6. 3D 視覺化模擬

**場景渲染**
- 多種預設場景支援
- 即時 3D 環境渲染
- 設備位置視覺化
- 互動式操作界面

**射線追蹤模擬**
- Sionna RT 整合
- 電磁波傳播模擬
- 路徑損失計算
- 多徑效應分析

**裝置管理**
- 發射器與接收器配置
- 干擾源模擬
- 設備參數調整
- 即時位置更新

### 7. 衛星視覺化

**軌道展示**
- OneWeb 衛星即時位置
- 軌道軌跡可視化
- 地球表面投影
- 衛星可見性指示

**資料整合**
- Skyfield 軌道資料
- TLE 檔案處理
- 座標系統轉換
- 時間同步機制

## 系統監控與維運

### 效能監控

**Prometheus 指標收集**
- API 請求統計
- 系統資源使用率
- 5G 網路 KPI
- 應用程式效能指標

**Grafana 儀表板**
- 即時系統狀態展示
- 歷史趨勢分析
- 自訂告警規則
- 多維度資料視覺化

### 日誌管理

**結構化日誌**
- JSON 格式日誌輸出
- 分層級日誌記錄
- 請求追蹤機制
- 錯誤堆疊追蹤

**日誌聚合**
- 集中式日誌收集
- 日誌搜尋與過濾
- 關鍵事件告警
- 日誌保存策略

### 健康檢查

**服務健康監控**
- 各組件狀態檢查
- 相依服務連線檢測
- 資源可用性監控
- 自動恢復機制

**告警機制**
- 即時狀態通知
- 多通道告警發送
- 告警優先級分級
- 告警歷史記錄

## 資料管理

### 資料庫設計

**MongoDB 集合**
- UE 資訊與狀態
- 網路切片配置
- 衛星軌道資料
- 系統日誌記錄

**PostgreSQL 資料表**
- 場景配置資料
- 設備管理資訊
- 使用者偏好設定
- 系統配置參數

**Redis 快取策略**
- 頻繁查詢資料快取
- 會話狀態管理
- 即時資料緩存
- 分散式鎖機制

### 資料同步

**即時同步機制**
- WebSocket 連線管理
- 事件驅動更新
- 資料一致性保證
- 衝突解決策略

**批次處理**
- 大量資料匯入
- 定期資料清理
- 統計資料產生
- 備份與復原

## 安全性與可靠性

### 安全機制

**API 安全**
- CORS 跨域存取控制
- 請求速率限制
- 輸入資料驗證
- 錯誤資訊過濾

**資料保護**
- 敏感資料加密
- 存取權限控制
- 資料完整性檢查
- 稽核軌跡記錄

### 系統可靠性

**容錯設計**
- 服務隔離機制
- 優雅降級處理
- 電路斷路器模式
- 重試策略實作

**備份與恢復**
- 自動資料備份
- 災難恢復計畫
- 服務快速重啟
- 資料遷移支援

## 開發與測試

### 測試框架

**單元測試**
- pytest 測試框架
- Mock 物件模擬
- 測試覆蓋率追蹤
- 自動化測試執行

**整合測試**
- API 端點測試
- 資料庫整合測試
- 外部服務模擬
- 端對端測試場景

### 程式碼品質

**靜態分析**
- 程式碼風格檢查
- 類型註解驗證
- 安全性掃描
- 相依性漏洞檢查

**持續整合**
- 自動化建置流程
- 測試結果報告
- 部署流水線
- 版本控制整合

## 專案結構

```
ntn-stack/
├── netstack/              # 核心 API 服務
│   ├── netstack_api/      # FastAPI 應用程式
│   ├── compose/           # Docker Compose 設定
│   └── config/            # 系統配置檔案
├── simworld/              # 視覺化模擬平台
│   ├── frontend/          # React 前端應用
│   └── backend/           # FastAPI 後端服務
├── monitoring/            # 監控與觀測系統
│   ├── configs/           # Prometheus/Grafana 配置
│   └── tools/             # 監控工具腳本
├── deployment/            # 部署自動化工具
│   ├── scripts/           # 部署腳本
│   └── templates/         # 配置範本
├── tests/                 # 測試程式碼
└── docs/                  # 技術文件
```

## 現有功能完成度

本專案已完成核心通訊系統的主要功能模組，包括：

- ✅ 完整的 5G 核心網 API 服務
- ✅ 衛星軌道計算與 gNodeB 映射
- ✅ UAV 群體通訊管理機制
- ✅ 干擾控制與 AI-RAN 決策引擎
- ✅ 3D 視覺化模擬平台
- ✅ Mesh 網路橋接功能
- ✅ 即時系統監控與告警
- ✅ 自動化部署與配置管理
- ✅ 完整的測試框架與程式碼品質保證

系統具備了從底層 5G 網路模擬到上層應用服務的完整技術棧，能夠支援複雜的非地面網路通訊場景模擬與驗證。