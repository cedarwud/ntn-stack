# SimWorld Backend å…¨é¢å¥æª¢å ±å‘Š

## ğŸ“Š åŸ·è¡Œæ—¥æœŸ
**2024å¹´12æœˆ25æ—¥** - å®Œæ•´æ¶æ§‹åˆ†æèˆ‡é‡æ§‹å»ºè­°

---

## ğŸ¯ å¥æª¢ç›®æ¨™
å° `simworld/backend` é€²è¡Œå…¨é¢æª¢æŸ¥ï¼Œè­˜åˆ¥ç„¡ç”¨æˆ–é‡è¤‡çš„éƒ¨åˆ†ï¼Œåˆ¶å®šæ•´åˆå’Œåˆªé™¤ç­–ç•¥ã€‚

---

## ğŸ“‹ ç›®éŒ„çµæ§‹åˆ†æç¸½çµ

### ç¾æœ‰æ¶æ§‹å•é¡Œè­˜åˆ¥

1. **é‡è¤‡çš„ API è·¯ç”±å±¤ç´š**: å­˜åœ¨ `app/api/` å’Œ `app/domains/*/api/` å…©å¥— API ç³»çµ±
2. **é‡è¤‡çš„æœå‹™å±¤**: `app/services/` å’Œ `app/domains/*/services/` åŠŸèƒ½é‡ç–Š
3. **æ¨¡å‹å®šç¾©åˆ†æ•£**: æ¨¡å‹å®šç¾©åœ¨å¤šå€‹ä½ç½®ï¼Œç¼ºä¹ä¸€è‡´æ€§
4. **é‡è¤‡çš„ç”Ÿå‘½é€±æœŸç®¡ç†**: `main.py` å’Œ `lifespan.py` éƒ½æœ‰ lifespan å‡½æ•¸
5. **ä¸è¦ç¯„çš„æª”æ¡ˆ**: å­˜åœ¨ä¸å±¬æ–¼ Python é …ç›®çš„æª”æ¡ˆï¼ˆå¦‚ `gp.php`ï¼‰
6. **æ¸¬è©¦æª”æ¡ˆå†—é¤˜**: å¤šå€‹ç›¸ä¼¼çš„æ•´åˆæ¸¬è©¦æª”æ¡ˆ

---

## ğŸ” å…·é«”é‡è¤‡æ€§åˆ†æ

### 1. API è·¯ç”±é‡è¤‡

#### é‡è¤‡çš„è·¯ç”±å±¤ç´šï¼š
- **å…¨åŸŸ API**: `app/api/v1/router.py` - 855è¡Œçš„å·¨å¤§è·¯ç”±æª”æ¡ˆ
- **åŸŸ API**: å„ `app/domains/*/api/*.py` æª”æ¡ˆ
- **å–®ç¨è·¯ç”±**: `app/api/routes/algorithm_performance.py`
- **Router ç›®éŒ„**: `app/routers/performance_router.py`

#### å•é¡Œåˆ†æï¼š
- `app/api/v1/router.py` åŒ…å«å¤§é‡æ¥­å‹™é‚è¼¯ï¼ˆè¡›æ˜Ÿè¨ˆç®—ã€UAVè¿½è¹¤ç­‰ï¼‰
- åŸŸAPIå’Œå…¨åŸŸAPIåŠŸèƒ½é‡ç–Š
- è·¯ç”±è¨»å†Šåˆ†æ•£åœ¨å¤šå€‹åœ°æ–¹

### 2. æœå‹™å±¤é‡è¤‡

#### é‡è¤‡çš„æœå‹™ï¼š
- **æ•ˆèƒ½æœ€ä½³åŒ–æœå‹™**:
  - `app/services/performance_optimizer.py` - SimWorldæ•ˆèƒ½æœ€ä½³åŒ–
  - `app/domains/interference/services/algorithm_performance_service.py` - æ¼”ç®—æ³•æ•ˆèƒ½è¨ˆç®—
- **è¡›æ˜Ÿç›¸é—œæœå‹™**:
  - `app/services/satellite_scheduler.py` - è¡›æ˜Ÿæ’ç¨‹
  - `app/domains/satellite/services/` ä¸‹å¤šå€‹è¡›æ˜Ÿæœå‹™ï¼ˆ7å€‹æª”æ¡ˆï¼‰

### 3. æ¨¡å‹å’Œæ¶æ§‹æ··äº‚

#### å•é¡Œæ¨¡å¼ï¼š
- æŸäº›åŸŸæœ‰å®Œæ•´çš„ DDD çµæ§‹ï¼ˆå¦‚ satelliteï¼‰
- æŸäº›åŸŸç¼ºå°‘é—œéµçµ„ä»¶ï¼ˆå¦‚ system ç¼ºå°‘ modelsï¼‰
- æ¨¡å‹å®šç¾©åˆ†æ•£ä¸”ä¸ä¸€è‡´

---

## ğŸ—‘ï¸ éœ€è¦åˆªé™¤çš„æª”æ¡ˆæ¸…å–®

### 1. ä¸è¦ç¯„æª”æ¡ˆ
```bash
âŒ /simworld/backend/gp.php
   åŸå› : TLEæ•¸æ“šæª”æ¡ˆï¼Œå‰¯æª”åéŒ¯èª¤ï¼ˆæ‡‰ç‚º.txtï¼‰ï¼Œä¸”å…§å®¹èˆ‡æª”åä¸ç¬¦
```

### 2. é‡è¤‡çš„æ¸¬è©¦æª”æ¡ˆ
```bash
âŒ /simworld/backend/simple_integration_test.py
âŒ /simworld/backend/simple_integration_test_fixed.py
   åŸå› : åŠŸèƒ½é‡è¤‡ï¼Œä¿ç•™æœ€å®Œæ•´çš„ test_honest_complete_integration.py
```

### 3. é‡è¤‡çš„ç”Ÿæˆæª”æ¡ˆ
```bash
âŒ /simworld/backend/honest_integration_test_results_container.json
   åŸå› : æ¸¬è©¦çµæœæª”æ¡ˆï¼Œæ‡‰ç”±æ¸¬è©¦è‡ªå‹•ç”Ÿæˆï¼Œä¸æ‡‰ç‰ˆæ§
```

---

## ğŸ”„ éœ€è¦åˆä½µçš„é‡è¤‡åŠŸèƒ½

### 1. API è·¯ç”±é‡æ§‹

#### ç•¶å‰ç‹€æ…‹ï¼š
- `app/api/v1/router.py` (855è¡Œ) - åŒ…å«æ¥­å‹™é‚è¼¯
- `app/api/routes/algorithm_performance.py` - æ¼”ç®—æ³•æ•ˆèƒ½ API
- `app/routers/performance_router.py` - SimWorld æ•ˆèƒ½ API

#### é‡æ§‹å»ºè­°ï¼š
```python
# æ–°çµæ§‹
app/api/
â”œâ”€â”€ v1/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ router.py          # åªåšè·¯ç”±èšåˆï¼Œç„¡æ¥­å‹™é‚è¼¯
â”‚   â””â”€â”€ dependencies.py    # å…¨åŸŸç›¸ä¾æ€§
â””â”€â”€ routes/
    â”œâ”€â”€ core.py           # æ ¸å¿ƒåŠŸèƒ½è·¯ç”±ï¼ˆæ¨¡å‹ã€å ´æ™¯ï¼‰
    â”œâ”€â”€ performance.py    # åˆä½µæ‰€æœ‰æ•ˆèƒ½ç›¸é—œAPI
    â””â”€â”€ integration.py    # è·¨åŸŸæ•´åˆAPI
```

### 2. æœå‹™å±¤é‡æ§‹

#### åˆä½µæ•ˆèƒ½ç›¸é—œæœå‹™ï¼š
```python
# ç•¶å‰
app/services/performance_optimizer.py              # SimWorldæ•ˆèƒ½
app/domains/interference/services/algorithm_performance_service.py  # æ¼”ç®—æ³•æ•ˆèƒ½

# é‡æ§‹å¾Œ
app/domains/performance/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ simworld_optimizer.py     # SimWorldç‰¹å®šæœ€ä½³åŒ–
â”‚   â”œâ”€â”€ algorithm_calculator.py   # æ¼”ç®—æ³•æ•ˆèƒ½è¨ˆç®—
â”‚   â””â”€â”€ performance_aggregator.py # æ•ˆèƒ½æ•¸æ“šèšåˆ
â”œâ”€â”€ models/
â”‚   â””â”€â”€ performance_models.py     # çµ±ä¸€æ•ˆèƒ½æ¨¡å‹
â””â”€â”€ api/
    â””â”€â”€ performance_api.py         # çµ±ä¸€æ•ˆèƒ½API
```

---

## ğŸ—ï¸ å»ºè­°çš„é‡æ–°çµ„ç¹”çµæ§‹

### 1. è¦ç¯„åŒ–åŸŸçµæ§‹

```python
app/domains/
â”œâ”€â”€ common/                    # ä¿æŒç¾æœ‰
â”œâ”€â”€ coordinates/              # ä¿æŒç¾æœ‰ï¼ˆçµæ§‹è‰¯å¥½ï¼‰
â”œâ”€â”€ device/                   # ä¿æŒç¾æœ‰ï¼ˆçµæ§‹è‰¯å¥½ï¼‰
â”œâ”€â”€ satellite/                # ä¿æŒç¾æœ‰ï¼ˆçµæ§‹è‰¯å¥½ï¼‰
â”œâ”€â”€ simulation/               # ä¿æŒç¾æœ‰
â”œâ”€â”€ wireless/                 # ä¿æŒç¾æœ‰
â”œâ”€â”€ interference/             # éœ€è¦è£œå…… interfaces/
â”œâ”€â”€ handover/                 # éœ€è¦è£œå…… interfaces/
â”œâ”€â”€ performance/              # âœ¨ æ–°å»ºï¼ˆåˆä½µæ•ˆèƒ½ç›¸é—œåŠŸèƒ½ï¼‰
â”‚   â”œâ”€â”€ interfaces/
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ api/
â”‚   â””â”€â”€ adapters/
â””â”€â”€ system/                   # éœ€è¦è£œå…… models/, interfaces/
```

### 2. ç°¡åŒ– API å±¤

```python
app/api/
â”œâ”€â”€ v1/
â”‚   â”œâ”€â”€ router.py             # åƒ…è·¯ç”±èšåˆï¼Œ<100è¡Œ
â”‚   â””â”€â”€ dependencies.py       # å…¨åŸŸç›¸ä¾æ€§
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ core.py              # åŸºç¤åŠŸèƒ½ï¼ˆæ¨¡å‹ã€å ´æ™¯ã€å¥åº·æª¢æŸ¥ï¼‰
â”‚   â”œâ”€â”€ satellite.py         # æ‰€æœ‰è¡›æ˜Ÿç›¸é—œAPI
â”‚   â”œâ”€â”€ performance.py       # æ‰€æœ‰æ•ˆèƒ½ç›¸é—œAPI
â”‚   â”œâ”€â”€ simulation.py        # æ¨¡æ“¬ç›¸é—œAPI
â”‚   â””â”€â”€ integration.py       # è·¨ç³»çµ±æ•´åˆAPI
â””â”€â”€ middleware/               # APIä¸­ä»‹è»Ÿé«”
```

### 3. çµ±ä¸€æœå‹™å±¤

```python
app/services/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ lifecycle.py              # æ‡‰ç”¨ç¨‹å¼ç”Ÿå‘½é€±æœŸç®¡ç†ï¼ˆå¾main.pyç§»å‡ºï¼‰
â”œâ”€â”€ scheduler.py              # é‡æ–°å‘½åsatellite_scheduler.py
â””â”€â”€ core.py                   # æ ¸å¿ƒæœå‹™å”èª¿
```

---

## ğŸ”§ ç›¸ä¾æ€§é—œä¿‚æœ€ä½³åŒ–å»ºè­°

### 1. æ¶ˆé™¤å¾ªç’°ç›¸ä¾

**ç•¶å‰æ½›åœ¨å•é¡Œ**ï¼š
- `main.py` ç›´æ¥å°å…¥å¤šå€‹åŸŸæœå‹™
- åŸŸä¹‹é–“å¯èƒ½å­˜åœ¨ç›´æ¥ç›¸ä¾

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- é€é `app.state` ç®¡ç†æœå‹™å¯¦ä¾‹
- ä½¿ç”¨ç›¸ä¾æ€§æ³¨å…¥æ¨¡å¼
- æ–°å¢æœå‹™è¨»å†Šæ©Ÿåˆ¶

### 2. ä»‹é¢å±¤å®Œå–„

**éœ€è¦æ–°å¢ä»‹é¢çš„åŸŸ**ï¼š
- `interference` ç¼ºå°‘ `interfaces/`
- `handover` ç¼ºå°‘ `interfaces/`  
- `system` ç¼ºå°‘ `interfaces/`

---

## ğŸ“‹ é‡æ§‹åŸ·è¡Œè¨ˆç•«

### Phase 1: æ¸…ç†å’Œæ¨™æº–åŒ–ï¼ˆ1-2å¤©ï¼‰
1. âœ… åˆªé™¤ä¸è¦ç¯„æª”æ¡ˆå’Œé‡è¤‡æ¸¬è©¦æª”æ¡ˆ
2. âœ… é‡æ–°å‘½å `gp.php` ç‚º `satellite_tle_data.txt`
3. âœ… è£œå…¨ç¼ºå¤±çš„ä»‹é¢å®šç¾©
4. âœ… æ¨™æº–åŒ–æ‰€æœ‰åŸŸçš„ç›®éŒ„çµæ§‹

### Phase 2: APIå±¤é‡æ§‹ï¼ˆ2-3å¤©ï¼‰
1. ğŸ”„ å°‡ `app/api/v1/router.py` çš„æ¥­å‹™é‚è¼¯é·ç§»åˆ°å°æ‡‰åŸŸ
2. ğŸ”„ å»ºç«‹æ–°çš„è·¯ç”±çµæ§‹
3. ğŸ”„ åˆä½µé‡è¤‡çš„APIç«¯é»
4. ğŸ”„ æ›´æ–°è·¯ç”±è¨»å†Š

### Phase 3: æœå‹™å±¤é‡æ§‹ï¼ˆ2-3å¤©ï¼‰
1. ğŸ”„ å»ºç«‹ `performance` åŸŸ
2. ğŸ”„ åˆä½µæ•ˆèƒ½ç›¸é—œæœå‹™
3. ğŸ”„ é‡æ§‹ç”Ÿå‘½é€±æœŸç®¡ç†
4. ğŸ”„ æœ€ä½³åŒ–ç›¸ä¾æ€§æ³¨å…¥

### Phase 4: æ¸¬è©¦å’Œé©—è­‰ï¼ˆ1-2å¤©ï¼‰
1. ğŸ”„ æ›´æ–°æ¸¬è©¦æª”æ¡ˆ
2. ğŸ”„ é©—è­‰APIåŠŸèƒ½å®Œæ•´æ€§
3. ğŸ”„ æ•ˆèƒ½æ¸¬è©¦
4. ğŸ”„ æ–‡ä»¶æ›´æ–°

---

## ğŸ¯ é æœŸæ”¶ç›Š

### ç¨‹å¼ç¢¼å“è³ªæå‡
- **è¡Œæ•¸æ¸›å°‘**: é è¨ˆæ¸›å°‘ 20-30% é‡è¤‡ç¨‹å¼ç¢¼
- **ç¶­è­·æ€§**: æ¸…æ™°çš„æ¨¡çµ„é‚Šç•Œå’Œè·è²¬åˆ†é›¢
- **å¯æ¸¬è©¦æ€§**: æ›´å¥½çš„ç›¸ä¾æ€§æ³¨å…¥å’Œä»‹é¢æŠ½è±¡

### æ•ˆèƒ½æœ€ä½³åŒ–
- **å•Ÿå‹•æ™‚é–“**: æ¸›å°‘é‡è¤‡çš„æœå‹™åˆå§‹åŒ–
- **è¨˜æ†¶é«”ä½¿ç”¨**: é¿å…é‡è¤‡çš„æœå‹™å¯¦ä¾‹
- **é–‹ç™¼æ•ˆç‡**: æ›´å¿«çš„ç†±é‡è¼‰å’Œé™¤éŒ¯

### æ¶æ§‹å„ªå‹¢
- **æ“´å±•æ€§**: è¦ç¯„åŒ–çš„åŸŸçµæ§‹ä¾¿æ–¼æ–°å¢æ–°åŠŸèƒ½
- **ç¶­è­·æ€§**: æ¸…æ™°çš„ç›¸ä¾æ€§é—œä¿‚
- **åœ˜éšŠå”ä½œ**: æ¨™æº–åŒ–çš„ç¨‹å¼ç¢¼çµ„ç¹”

---

## ğŸ“Š æª”æ¡ˆçµ±è¨ˆæ‘˜è¦

### éœ€è¦åˆªé™¤çš„æª”æ¡ˆæ•¸é‡
- **ä¸è¦ç¯„æª”æ¡ˆ**: 1å€‹ (`gp.php`)
- **é‡è¤‡æ¸¬è©¦æª”æ¡ˆ**: 2å€‹
- **é‡è¤‡é…ç½®æª”æ¡ˆ**: 1å€‹
- **ç¸½è¨ˆ**: 4å€‹æª”æ¡ˆ

### éœ€è¦é‡æ§‹çš„ä¸»è¦æ¨¡çµ„
- **APIå±¤**: 4å€‹ä¸»è¦æª”æ¡ˆéœ€è¦é‡æ§‹
- **æœå‹™å±¤**: 3å€‹é‡è¤‡æœå‹™éœ€è¦åˆä½µ
- **åŸŸçµæ§‹**: 3å€‹åŸŸéœ€è¦è£œå……ä»‹é¢

### ç¨‹å¼ç¢¼è¡Œæ•¸é è¨ˆè®ŠåŒ–
- **åˆªé™¤é‡è¤‡ç¨‹å¼ç¢¼**: ~500-800è¡Œ
- **æ–°å¢ä»‹é¢å®šç¾©**: ~200-300è¡Œ
- **æ·¨æ¸›å°‘**: ~300-500è¡Œ

---

## âš ï¸ é¢¨éšªè©•ä¼°èˆ‡æ³¨æ„äº‹é …

### é«˜é¢¨éšªæ“ä½œ
1. **åˆªé™¤ `app/api/v1/router.py` ä¸­çš„æ¥­å‹™é‚è¼¯** - éœ€è¦ç¢ºä¿é·ç§»å®Œæ•´
2. **åˆä½µæ•ˆèƒ½æœå‹™** - å¯èƒ½å½±éŸ¿ç¾æœ‰APIå›æ‡‰æ ¼å¼
3. **ä¿®æ”¹ä¸»è¦è·¯ç”±çµæ§‹** - å¯èƒ½å½±éŸ¿å‰ç«¯æ•´åˆ

### é™ä½é¢¨éšªç­–ç•¥
1. **éšæ®µæ€§åŸ·è¡Œ**: åˆ†éšæ®µé€²è¡Œï¼Œæ¯éšæ®µé©—è­‰åŠŸèƒ½å®Œæ•´æ€§
2. **ä¿æŒå‚™ä»½**: é‡æ§‹å‰å»ºç«‹å®Œæ•´å‚™ä»½
3. **æ¸¬è©¦é©…å‹•**: å…ˆå®Œå–„æ¸¬è©¦è¦†è“‹ï¼Œå†é€²è¡Œé‡æ§‹
4. **å›æ»¾è¨ˆç•«**: æº–å‚™å¿«é€Ÿå›æ»¾æ©Ÿåˆ¶

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡Œå‹•

### ç«‹å³åŸ·è¡Œï¼ˆä»Šæ—¥ï¼‰
1. åˆªé™¤æ˜ç¢ºç„¡ç”¨çš„æª”æ¡ˆï¼ˆ`gp.php` ç­‰ï¼‰
2. å»ºç«‹é‡æ§‹åˆ†æ”¯
3. æº–å‚™å®Œæ•´çš„æ¸¬è©¦ç’°å¢ƒ

### çŸ­æœŸåŸ·è¡Œï¼ˆæœ¬é€±ï¼‰
1. APIå±¤é‡æ§‹
2. æœå‹™å±¤åˆä½µ
3. ä»‹é¢è£œå……

### ä¸­æœŸåŸ·è¡Œï¼ˆä¸‹é€±ï¼‰
1. æ•ˆèƒ½æ¸¬è©¦å’Œé©—è­‰
2. æ–‡ä»¶æ›´æ–°
3. éƒ¨ç½²é©—è­‰

---

*æœ¬å ±å‘Šç‚º SimWorld Backend æ¶æ§‹æœ€ä½³åŒ–çš„å®Œæ•´æŒ‡å—ï¼Œå»ºè­°æŒ‰ç…§éšæ®µæ€§è¨ˆç•«åŸ·è¡Œï¼Œç¢ºä¿ç³»çµ±ç©©å®šæ€§å’ŒåŠŸèƒ½å®Œæ•´æ€§ã€‚*