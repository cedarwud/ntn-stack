# çœŸå¯¦è¡›æ˜Ÿæ­·å²æ•¸æ“šé è¨ˆç®—æ–¹æ¡ˆ

## ğŸš¨ **ç·Šæ€¥å•é¡Œä¿®å¾©**

**ç•¶å‰å•é¡Œ**ï¼š`make restart-v` æŒ‡ä»¤å›  NetStack API å•Ÿå‹•æ™‚é€²è¡Œå¤§é‡å³æ™‚è»Œé“è¨ˆç®—è€Œå¤±æ•—
**æ ¹æœ¬åŸå› **ï¼šé›–å·²å¯¦ç¾é è¼‰æ©Ÿåˆ¶ï¼Œä½†APIä»ä½¿ç”¨å³æ™‚è¨ˆç®—é‚è¼¯ï¼Œå°è‡´å•Ÿå‹•ç·©æ…¢å’Œè·¨æœå‹™é€£æ¥å¤±æ•—
**è§£æ±ºç›®æ¨™**ï¼šç¢ºä¿ API ä½¿ç”¨é è¼‰æ•¸æ“šï¼Œå¯¦ç¾ç§’ç´šå•Ÿå‹•

## ğŸ“‹ é–‹ç™¼è¨ˆç•«æ¦‚è¿°

**æ ¸å¿ƒç†å¿µ**ï¼šä½¿ç”¨çœŸå¯¦ TLE æ­·å²æ•¸æ“š + é è¨ˆç®—å­˜å„² + æ™‚é–“è»¸æ’­æ”¾ï¼Œè§£æ±ºå³æ™‚è¨ˆç®—æ€§èƒ½å•é¡Œï¼ŒåŒæ™‚ä¿æŒæ•¸æ“šçœŸå¯¦æ€§ã€‚

### âœ… æ–¹æ¡ˆå„ªå‹¢
- **çœŸå¯¦æ€§ä¿è­‰**ï¼šä½¿ç”¨çœŸå¯¦ Starlink TLE æ•¸æ“šï¼Œéæ¨¡æ“¬æ•¸æ“š
- **æ€§èƒ½å„ªåŒ–**ï¼šé è¨ˆç®—é¿å…å³æ™‚ SGP4 é‹ç®—ç“¶é ¸
- **å±•ç¤ºå‹å¥½**ï¼šæ”¯æ´æ™‚é–“è»¸æ§åˆ¶ã€åŠ é€Ÿæ’­æ”¾ã€handover å‹•ç•«
- **ç ”ç©¶åƒ¹å€¼**ï¼šå¯ç”¨æ–¼ 3GPP events è¨ˆç®—å’Œè«–æ–‡åˆ†æ
- **ç©©å®šæ€§**ï¼šä¸ä¾è³´ç¶²è·¯å³æ™‚é€£æ¥

## ğŸ“š æª”æ¡ˆçµæ§‹èˆ‡é–‹ç™¼é †åº

### ğŸ¯ é–‹ç™¼éšæ®µæ–‡æª”ï¼ˆæŒ‰é †åºåŸ·è¡Œï¼‰

| éšæ®µ | ç‹€æ…‹ | æª”æ¡ˆåç¨± | èªªæ˜ | é ä¼°æ™‚é–“ |
|------|------|----------|------|----------|
| **æ–¹æ¡ˆç¸½è¦½** | ğŸ“‹ å®Œæˆ | [`01-project-overview.md`](./01-project-overview.md) | æŠ€è¡“åƒæ•¸å»ºè­°ã€å¤šæ˜Ÿåº§æ”¯æ´è¨­è¨ˆ | åƒè€ƒ |
| **Phase 1** | ğŸŸ¡ 80% å®Œæˆ | [`02-phase1-database-setup.md`](./02-phase1-database-setup.md) | PostgreSQL æ­·å²æ•¸æ“šè¡¨è¨­è¨ˆã€å®¹å™¨å…§é è¼‰æ•¸æ“šæ©Ÿåˆ¶ | 1-2 å¤© |
| **Phase 2** | â³ å¾…é–‹å§‹ | [`03-phase2-precompute-engine.md`](./03-phase2-precompute-engine.md) | æ­·å²æ•¸æ“šé è¨ˆç®—å™¨ã€æ‰¹æ¬¡è™•ç†å’Œå­˜å„² | 2-3 å¤© |  
| **Phase 3** | â³ å¾…é–‹å§‹ | [`04-phase3-api-endpoints.md`](./04-phase3-api-endpoints.md) | æ™‚é–“è»¸æŸ¥è©¢ APIã€æ™‚é–“æ§åˆ¶ API | 1-2 å¤© |
| **Phase 4** | â³ å¾…é–‹å§‹ | [`05-phase4-frontend-timeline.md`](./05-phase4-frontend-timeline.md) | æ˜Ÿåº§åˆ‡æ›æ§åˆ¶å™¨ã€æ™‚é–“è»¸æ§åˆ¶å™¨çµ„ä»¶ | 2-3 å¤© |
| **Phase 5** | â³ å¾…é–‹å§‹ | [`06-phase5-container-startup.md`](./06-phase5-container-startup.md) | Docker Compose å•Ÿå‹•é †åºã€æ™ºèƒ½å•Ÿå‹•è…³æœ¬ | 1 å¤© |

### ğŸ“Š æ”¯æ´èˆ‡è¦ç¯„æ–‡æª”

| åˆ†é¡ | æª”æ¡ˆåç¨± | èªªæ˜ |
|------|----------|------|
| **é©—æ”¶æ¨™æº–** | [`00-verification-standards.md`](./00-verification-standards.md) | å„éšæ®µé©—è­‰æ©Ÿåˆ¶èˆ‡å®Œæˆç¢ºèª |
| **æ€§èƒ½æŒ‡æ¨™** | [`00-performance-metrics.md`](./00-performance-metrics.md) | æ•ˆèƒ½æŒ‡æ¨™ã€è³‡æºä½¿ç”¨é ä¼°ã€æœªä¾†æ“´å±• |

## ğŸ› ï¸ Phase 1 ç¾ç‹€åˆ†æèˆ‡ Makefile æ•´åˆ

### âœ… å·²å®Œæˆçµ„ä»¶ (80%)

#### **1. é è¨ˆç®—æ•¸æ“šç”Ÿæˆæ©Ÿåˆ¶**
```bash
# ä½ç½®ï¼š/netstack/generate_precomputed_satellite_data.py
# åŠŸèƒ½ï¼šç”Ÿæˆ 6 å°æ™‚ã€30 ç§’é–“éš”çš„é è¨ˆç®—è¡›æ˜Ÿæ•¸æ“š
# ç‹€æ…‹ï¼šâœ… å®Œå…¨å¯¦ç¾
```

#### **2. Docker å»ºç½®éšæ®µæ•´åˆ**  
```dockerfile
# ä½ç½®ï¼š/netstack/docker/Dockerfile ç¬¬ 69-75 è¡Œ
# åŠŸèƒ½ï¼šå»ºç½®æ™‚è‡ªå‹•ç”Ÿæˆé è¼‰æ•¸æ“šåˆ°å®¹å™¨æ˜ åƒæª”
RUN python3 generate_precomputed_satellite_data.py \
    --output /app/data/satellite_history_embedded.sql \
    --observer_lat 24.94417 --observer_lon 121.37139 \
    --duration_hours 6 --time_step_seconds 30
# ç‹€æ…‹ï¼šâœ… å®Œå…¨å¯¦ç¾
```

#### **3. å®¹å™¨å•Ÿå‹•æ™‚æ•¸æ“šè¼‰å…¥**
```bash
# ä½ç½®ï¼š/netstack/docker/docker-entrypoint.sh ç¬¬ 45-84 è¡Œ
# åŠŸèƒ½ï¼šå®¹å™¨å•Ÿå‹•æ™‚ç«‹å³è¼‰å…¥é è¼‰æ•¸æ“š
# ç‹€æ…‹ï¼šâœ… å®Œå…¨å¯¦ç¾ï¼ŒåŒ…å«ä¸‰å±¤ fallback æ©Ÿåˆ¶
```

#### **4. å³æ™‚è¼‰å…¥å™¨æœå‹™**
```python
# ä½ç½®ï¼š/netstack/netstack_api/services/instant_satellite_loader.py
# åŠŸèƒ½ï¼šInstantSatelliteLoader é¡åˆ¥ï¼Œç¢ºä¿æ•¸æ“šç«‹å³å¯ç”¨
# fallback é †åºï¼šç¾æœ‰æ•¸æ“š â†’ å…§å»ºæ•¸æ“š â†’ ç·Šæ€¥ç”Ÿæˆ
# ç‹€æ…‹ï¼šâœ… å®Œå…¨å¯¦ç¾
```

#### **5. ç·Šæ€¥ Fallback æ©Ÿåˆ¶**
```python
# ä½ç½®ï¼š/netstack/netstack_api/services/emergency_satellite_generator.py
# åŠŸèƒ½ï¼šEmergencySatelliteGenerator é¡åˆ¥ï¼Œç”Ÿæˆæœ€å°å¯ç”¨æ•¸æ“šé›†
# ç‹€æ…‹ï¼šâœ… å®Œå…¨å¯¦ç¾ï¼Œ1 å°æ™‚ç·Šæ€¥æ•¸æ“š
```

### âš ï¸ å¾…ä¿®å¾©å•é¡Œ (20%)

#### **æ ¹æœ¬å•é¡Œï¼šAPI é‚è¼¯æœªä½¿ç”¨é è¼‰æ•¸æ“š**
**ç—‡ç‹€**ï¼š`make restart-v` å¤±æ•—ï¼ŒNetStack API å•Ÿå‹•ç·©æ…¢
**åŸå› **ï¼šé›–ç„¶é è¼‰æ©Ÿåˆ¶å®Œæ•´ï¼Œä½† API ç«¯é»å¯èƒ½ä»ä½¿ç”¨å³æ™‚è¨ˆç®—é‚è¼¯
**è§£æ±ºæ–¹æ¡ˆ**ï¼šä¿®æ”¹ API é‚è¼¯ç¢ºä¿ä½¿ç”¨ `satellite_orbital_cache` è¡¨çš„é è¼‰æ•¸æ“š

#### **Makefile ä¾è³´é—œä¿‚å„ªåŒ–éœ€æ±‚**
```makefile
# ç•¶å‰å•é¡Œï¼šè·¨æœå‹™é€£æ¥æª¢æŸ¥é‚è¼¯éœ€å„ªåŒ–
# å½±éŸ¿æŒ‡ä»¤ï¼šmake restart-v, make all-restart-v, make status
# æ”¹é€²æ–¹å‘ï¼šæ™ºèƒ½ç­‰å¾… NetStack API å¥åº·æª¢æŸ¥é€šé
```

### ğŸ”§ å®Œæˆ Phase 1 çš„å‰©é¤˜å·¥ä½œ

#### **Step 1: API é‚è¼¯ä¿®å¾©** (ç·Šæ€¥å„ªå…ˆ)
1. æª¢æŸ¥ NetStack API ä¸­ä½¿ç”¨å³æ™‚è¨ˆç®—çš„ç«¯é»
2. ä¿®æ”¹ç‚ºæŸ¥è©¢ `satellite_orbital_cache` è¡¨
3. ç¢ºä¿ API éŸ¿æ‡‰æ™‚é–“ < 100ms

#### **Step 2: Makefile æ™ºèƒ½ç­‰å¾…** (é«˜å„ªå…ˆ)
1. å„ªåŒ– `netstack-start` ä¸­çš„å¥åº·æª¢æŸ¥å¾ªç’°
2. æ”¹é€² `all-start` ä¸­çš„è·¨æœå‹™é€£æ¥é‚è¼¯
3. ä¿®å¾© `restart-v` å’Œç›¸é—œæŒ‡ä»¤çš„å¯é æ€§

#### **Step 3: é©—è­‰èˆ‡æ¸¬è©¦**
1. åŸ·è¡Œ `make restart-v` ç¢ºä¿ < 60 ç§’å®Œæˆ
2. é©—è­‰ API éŸ¿æ‡‰æ™‚é–“ç¬¦åˆè¦æ±‚
3. ç¢ºèªé è¼‰æ•¸æ“šè¦†è“‹ç¯„åœæ»¿è¶³éœ€æ±‚

## ğŸ³ å®¹å™¨æ˜ åƒæª”èˆ‡ Makefile ä¾è³´é—œä¿‚åˆ†æ

### ğŸ”„ ç•¶å‰å®¹å™¨å•Ÿå‹•ä¾è³´éˆ

```mermaid
graph TD
    A[make restart-v] --> B[make down]
    B --> C[make up]
    C --> D[netstack-start]
    C --> E[simworld-start]
    
    D --> F[rl-postgres å•Ÿå‹•]
    F --> G[netstack-api å•Ÿå‹•]
    G --> H[æ•¸æ“šåº«è¡¨åˆå§‹åŒ–]
    H --> I[è¡›æ˜Ÿæ•¸æ“šè¼‰å…¥]
    I --> J[NetStack API å°±ç·’]
    
    E --> K[simworld-backend å•Ÿå‹•]
    K --> L[simworld-frontend å•Ÿå‹•]
    
    J --> M[è·¨æœå‹™é€£æ¥æª¢æŸ¥]
    L --> M
    M --> N[ç³»çµ±å®Œå…¨å°±ç·’]
```

### ğŸ“Š å•Ÿå‹•æ™‚åºå•é¡Œåˆ†æ

#### **ç•¶å‰å•é¡Œé»**
1. **NetStack API å•Ÿå‹•ç·©æ…¢** (60-180 ç§’)
   - åŸå› ï¼š`docker-entrypoint.sh` ä¸­æ•¸æ“šè¼‰å…¥æµç¨‹
   - å½±éŸ¿ï¼š`make restart-v` åœ¨ç­‰å¾… NetStack API æ™‚è¶…æ™‚

2. **è·¨æœå‹™é€£æ¥æª¢æŸ¥éæ–¼åš´æ ¼**
   - ä½ç½®ï¼šä¸» `Makefile` çš„ `all-start` ç›®æ¨™
   - å•é¡Œï¼šé€£æ¥æª¢æŸ¥å¤±æ•—æ™‚æ•´å€‹å•Ÿå‹•æµç¨‹ä¸­æ–·

3. **å¥åº·æª¢æŸ¥é€±æœŸä¸åŒ¹é…**
   - Docker Healthcheck: 30s é–“éš”
   - Makefile æª¢æŸ¥: å¯èƒ½æ›´é »ç¹æˆ–æ›´å°‘

### ğŸ› ï¸ Makefile ä¿®æ”¹å»ºè­°

#### **1. å„ªåŒ– netstack-start ç›®æ¨™**
```makefile
# å»ºè­°ä¿®æ”¹ï¼š/netstack/Makefile
netstack-start:
	@echo "ğŸš€ å•Ÿå‹• NetStack æœå‹™..."
	cd docker && docker compose up -d
	
	# æ™ºèƒ½ç­‰å¾…å¥åº·æª¢æŸ¥é€šé
	@echo "â³ ç­‰å¾… NetStack API æº–å‚™å°±ç·’..."
	@timeout=300; \
	while [ $$timeout -gt 0 ]; do \
		if docker exec netstack-api curl -f http://localhost:8080/health >/dev/null 2>&1; then \
			echo "âœ… NetStack API å¥åº·æª¢æŸ¥é€šé"; \
			break; \
		fi; \
		echo "  ç­‰å¾…ä¸­... (å‰©é¤˜ $$timeout ç§’)"; \
		sleep 10; \
		timeout=$$((timeout-10)); \
	done
	@if [ $$timeout -le 0 ]; then \
		echo "âŒ NetStack API å•Ÿå‹•è¶…æ™‚"; \
		exit 1; \
	fi
```

#### **2. æ”¹é€²è·¨æœå‹™é€£æ¥æª¢æŸ¥**
```makefile
# å»ºè­°ä¿®æ”¹ï¼šä¸» Makefile çš„ all-start
all-start: netstack-start simworld-start
	@echo "ğŸ”— é©—è­‰è·¨æœå‹™é€£æ¥..."
	
	# å¯¬é¬†çš„é€£æ¥æª¢æŸ¥ - å…è¨±æš«æ™‚å¤±æ•—
	@retries=3; \
	while [ $$retries -gt 0 ]; do \
		if docker exec simworld_backend curl -f http://netstack-api:8080/health >/dev/null 2>&1; then \
			echo "âœ… SimWorld â†’ NetStack é€£æ¥æ­£å¸¸"; \
			break; \
		fi; \
		echo "âš ï¸ è·¨æœå‹™é€£æ¥æª¢æŸ¥å¤±æ•—ï¼Œé‡è©¦... (å‰©é¤˜ $$retries æ¬¡)"; \
		sleep 5; \
		retries=$$((retries-1)); \
	done
	
	# å³ä½¿é€£æ¥æš«æ™‚å¤±æ•—ä¹Ÿç¹¼çºŒï¼Œå› ç‚ºæœå‹™å¯èƒ½éœ€è¦æ›´å¤šæ™‚é–“ç©©å®š
	@echo "ğŸŒŸ æ‰€æœ‰æœå‹™å·²å•Ÿå‹•ï¼Œç³»çµ±æ­£åœ¨ç©©å®šä¸­..."
```

#### **3. å„ªåŒ– restart-v æŒ‡ä»¤**
```makefile
# å»ºè­°ä¿®æ”¹ï¼šä¸» Makefile
restart-v: down
	@echo "ğŸ”„ åŸ·è¡Œå¿«é€Ÿé‡å•Ÿ..."
	@make all-start
	@echo "â±ï¸ ç­‰å¾…ç³»çµ±ç©©å®š (30ç§’)..."
	@sleep 30
	@make status
	@echo "âœ… å¿«é€Ÿé‡å•Ÿå®Œæˆ"
```

### ğŸ“‹ Phase 1 å®Œæˆæª¢æŸ¥æ¸…å–®

- [x] **é è¨ˆç®—æ•¸æ“šç”Ÿæˆå™¨** - `generate_precomputed_satellite_data.py`
- [x] **Docker å»ºç½®æ•´åˆ** - `Dockerfile` ç¬¬ 69-75 è¡Œ
- [x] **å®¹å™¨å•Ÿå‹•è¼‰å…¥** - `docker-entrypoint.sh`
- [x] **å³æ™‚è¼‰å…¥å™¨æœå‹™** - `instant_satellite_loader.py`
- [x] **ç·Šæ€¥ fallback æ©Ÿåˆ¶** - `emergency_satellite_generator.py`
- [ ] **API é‚è¼¯ä¿®å¾©** - ç¢ºä¿ä½¿ç”¨é è¼‰æ•¸æ“šè€Œéå³æ™‚è¨ˆç®—
- [ ] **Makefile æ™ºèƒ½ç­‰å¾…** - å„ªåŒ–å•Ÿå‹•æ™‚åºå’Œå¥åº·æª¢æŸ¥
- [ ] **ç³»çµ±æ•´åˆæ¸¬è©¦** - `make restart-v` åœ¨ 60 ç§’å…§å®Œæˆ

## ğŸš€ å¿«é€Ÿé–‹å§‹

### ğŸ“‹ é–‹ç™¼å‰ç½®æª¢æŸ¥

```bash
# 1. ç¢ºèª Docker ç’°å¢ƒé‹è¡Œæ­£å¸¸
make status

# 2. ç¢ºèª PostgreSQL RL æ•¸æ“šåº«å¯ç”¨
docker exec -it netstack-rl-postgres psql -U rl_user -d rl_research -c "\dt"

# 3. æª¢æŸ¥ç•¶å‰ Git ç‹€æ…‹
git status
```

### ğŸ¯ é–‹ç™¼åŸ·è¡Œæµç¨‹

```bash
# 1. å¾ Phase 1 é–‹å§‹é–‹ç™¼
cd satellite-precompute-plan
less 02-phase1-database-setup.md

# 2. æŒ‰é †åºå®Œæˆå„éšæ®µ
# Phase 1 â†’ Phase 2 â†’ Phase 3 â†’ Phase 4 â†’ Phase 5

# 3. æ¯å€‹éšæ®µå®Œæˆå¾ŒåŸ·è¡Œé©—è­‰
# åƒè€ƒå°æ‡‰çš„é©—è­‰æ¨™æº–æ–‡æª”
```

### âš ï¸ é‡è¦æ³¨æ„äº‹é …

1. **ç·¨ç¢¼è¦ç¯„**ï¼šå‰µå»ºä¸­æ–‡æª”æ¡ˆæ™‚ä½¿ç”¨ `echo` å‘½ä»¤ï¼Œé¿å…äº‚ç¢¼
2. **éŒ¯èª¤è™•ç†**ï¼šç™¼ç¾éŒ¯èª¤ç«‹å³ä¿®å¾©ï¼Œçµ•ä¸æ¥å—éŒ¯èª¤ç‹€æ…‹
3. **API é…ç½®**ï¼šç¦æ­¢ç¡¬ç·¨ç¢¼ URLï¼Œä½¿ç”¨çµ±ä¸€é…ç½®ç³»çµ±
4. **çœŸå¯¦æ•¸æ“š**ï¼šå°è«–æ–‡ç ”ç©¶å½±éŸ¿çš„æ•¸æ“šå¿…é ˆä½¿ç”¨çœŸå¯¦æ•¸æ“š
5. **é‡æ§‹é©—è­‰**ï¼šæ¯æ¬¡é‡æ§‹å¾Œå¿…é ˆåŸ·è¡Œå®Œæ•´ç³»çµ±é©—è­‰

## ğŸ¯ æ ¸å¿ƒæŠ€è¡“è¦æ±‚

### ğŸ’¾ æ•¸æ“šçœŸå¯¦æ€§åˆ†ç´š
- **CRITICAL**ï¼šè»Œé“å‹•åŠ›å­¸ã€è¡›æ˜Ÿä½ç½®ã€åˆ‡æ›æ±ºç­–é‚è¼¯
- **HIGH**ï¼šä¿¡è™Ÿå¼·åº¦æ¨¡å‹ã€éƒ½åœå‹’é »ç§»ã€è·¯å¾‘æè€—
- **MEDIUM**ï¼šå¤§æ°£è¡°æ¸›ã€å¹²æ“¾å ´æ™¯ã€ç¶²è·¯è² è¼‰
- **LOW**ï¼šç”¨æˆ¶è¡Œç‚ºã€èƒŒæ™¯æµé‡ã€éé—œéµåƒæ•¸

### ğŸ“Š æŠ€è¡“è¦æ ¼
- **æ™‚é–“è§£æåº¦**ï¼š30 ç§’é–“éš”
- **å¯è¦‹è¡›æ˜Ÿæ•¸**ï¼š6-8 é¡†ï¼ˆç¬¦åˆ 3GPP NTN æ¨™æº–ï¼‰
- **è§€æ¸¬ä½ç½®**ï¼šå°ç£ï¼ˆ24.94Â°N, 121.37Â°Eï¼‰
- **æ”¯æ´æ˜Ÿåº§**ï¼šStarlink (ä¸»è¦) + OneWeb (å°æ¯”)
- **æ•¸æ“šå­˜å„²**ï¼šNetStack RL PostgreSQL (172.20.0.51:5432/rl_research)

## ğŸ“– ç›¸é—œè³‡æº

### ğŸ”— å¤–éƒ¨åƒè€ƒ
- [Celestrak TLE æ•¸æ“š](https://celestrak.org/NORAD/elements/gp.php?GROUP=starlink&FORMAT=tle)
- [3GPP TS 38.331 NTN æ¨™æº–](https://www.3gpp.org/specifications)
- [Skyfield å¤©é«”è¨ˆç®—åº«](https://rhodesmill.org/skyfield/)

### ğŸ“‚ å°ˆæ¡ˆçµæ§‹
```
ntn-stack/
â”œâ”€â”€ satellite-precompute-plan/    # æœ¬é–‹ç™¼è¨ˆç•«ç›®éŒ„
â”œâ”€â”€ netstack/                     # 5G æ ¸å¿ƒç¶²å¾Œç«¯
â”œâ”€â”€ simworld/                     # 3D ä»¿çœŸå¼•æ“
â””â”€â”€ CLAUDE.md                     # å°ˆæ¡ˆé–‹ç™¼è¦ç¯„
```

---

**ğŸ¯ ä¸‹ä¸€æ­¥å‹•ä½œ**ï¼šé–‹å§‹ [`02-phase1-database-setup.md`](./02-phase1-database-setup.md) çš„é–‹ç™¼å·¥ä½œï¼

