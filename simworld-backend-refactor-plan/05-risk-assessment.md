# SimWorld Backend é‡æ§‹é¢¨éšªè©•ä¼°

## ğŸ¯ é¢¨éšªè©•ä¼°æ¡†æ¶

### é¢¨éšªç­‰ç´šå®šç¾©
- **ğŸ”´ é«˜é¢¨éšª**: å¯èƒ½å½±éŸ¿æ ¸å¿ƒç ”ç©¶åŠŸèƒ½æˆ–å°è‡´ç³»çµ±ä¸å¯ç”¨
- **ğŸŸ¡ ä¸­é¢¨éšª**: å¯èƒ½å½±éŸ¿è¼”åŠ©åŠŸèƒ½æˆ–é€ æˆæš«æ™‚æ€§å•é¡Œ  
- **ğŸŸ¢ ä½é¢¨éšª**: å½±éŸ¿ç¯„åœæœ‰é™ï¼Œå®¹æ˜“ä¿®å¾©

### å½±éŸ¿ç¨‹åº¦åˆ†é¡
- **åš´é‡**: æ ¸å¿ƒç ”ç©¶åŠŸèƒ½å—æï¼Œç³»çµ±ä¸å¯ç”¨
- **ä¸­ç­‰**: éƒ¨åˆ†åŠŸèƒ½å—æï¼Œå½±éŸ¿ä½¿ç”¨é«”é©—
- **è¼•å¾®**: è¼”åŠ©åŠŸèƒ½å—æï¼Œä¸å½±éŸ¿ä¸»è¦å·¥ä½œæµç¨‹

### ç™¼ç”Ÿæ©Ÿç‡è©•ä¼°
- **é«˜æ©Ÿç‡** (>50%): æ ¹æ“šåˆ†æå¾ˆå¯èƒ½ç™¼ç”Ÿ
- **ä¸­æ©Ÿç‡** (10-50%): æœ‰ä¸€å®šå¯èƒ½ç™¼ç”Ÿ
- **ä½æ©Ÿç‡** (<10%): ç™¼ç”Ÿå¯èƒ½æ€§è¼ƒå°

## ğŸ“Š é¢¨éšªçŸ©é™£åˆ†æ

### ğŸ”´ é«˜é¢¨éšªé …ç›®

#### R1: éš±è—ä¾è³´å°è‡´æ ¸å¿ƒåŠŸèƒ½æå£
**é¢¨éšªæè¿°**: ç§»é™¤çµ„ä»¶å¾Œç™¼ç¾æœ‰æœªè­˜åˆ¥çš„ä¾è³´é—œä¿‚ï¼Œå°è‡´è¡›æ˜Ÿè»Œé“è¨ˆç®—æˆ–å¯è¦‹æ€§åˆ†æåŠŸèƒ½ç•°å¸¸

**å½±éŸ¿ç¨‹åº¦**: åš´é‡
**ç™¼ç”Ÿæ©Ÿç‡**: ä¸­æ©Ÿç‡ (30%)
**é¢¨éšªç­‰ç´š**: ğŸ”´ é«˜é¢¨éšª

**æ½›åœ¨å½±éŸ¿**:
- è¡›æ˜Ÿä½ç½®è¨ˆç®—éŒ¯èª¤
- å¯è¦‹æ€§åˆ†æçµæœä¸æº–ç¢º
- Handover æ±ºç­–é‚è¼¯å¤±æ•ˆ
- ç ”ç©¶æ•¸æ“šå¯ä¿¡åº¦å—æ

**ç·©è§£ç­–ç•¥**:
1. **é é˜²æªæ–½**:
   - ä½¿ç”¨ `pydeps`, `vulture` å·¥å…·é€²è¡Œæ·±åº¦ä¾è³´åˆ†æ
   - å»ºç«‹å®Œæ•´çš„æ¨¡çµ„ä¾è³´åœ–
   - åŸ·è¡Œéœæ…‹ç¨‹å¼ç¢¼åˆ†æ

2. **ç›£æ§æªæ–½**:
   - æ¯éšæ®µå¾ŒåŸ·è¡Œå®Œæ•´æ¸¬è©¦å¥—ä»¶
   - å»ºç«‹è‡ªå‹•åŒ–çš„å›æ­¸æ¸¬è©¦
   - ç›£æ§é—œéµ API çš„éŸ¿æ‡‰æ­£ç¢ºæ€§

3. **æ‡‰æ€¥æªæ–½**:
   - æº–å‚™å¿«é€Ÿå›æ»¾æ–¹æ¡ˆ (`git reset --hard v-before-refactor`)
   - å»ºç«‹æ ¸å¿ƒåŠŸèƒ½çš„ç¨ç«‹é©—è­‰è…³æœ¬
   - ç¶­è­·è©³ç´°çš„è®Šæ›´æ—¥èªŒä»¥ä¾¿å¿«é€Ÿå®šä½å•é¡Œ

**å…·é«”æª¢æŸ¥æ¸…å–®**:
```bash
# æª¢æŸ¥è¡›æ˜Ÿè»Œé“è¨ˆç®—åŠŸèƒ½
curl -s "http://localhost:8888/api/satellite/visible_satellites?lat=24.9&lon=121.4" | jq '.satellites | length'

# æª¢æŸ¥åº§æ¨™è½‰æ›åŠŸèƒ½  
curl -s "http://localhost:8888/api/coordinates/convert" -X POST -H "Content-Type: application/json" -d '{"lat": 24.9, "lon": 121.4, "alt": 0}'

# æª¢æŸ¥ 3D æ¨¡å‹æœå‹™
curl -s -I "http://localhost:8888/sionna/models/sat.glb" | grep "200 OK"
```

#### R2: è³‡æ–™åº«é·ç§»æˆ–çµæ§‹è®Šæ›´å•é¡Œ
**é¢¨éšªæè¿°**: é‡æ§‹éç¨‹ä¸­éœ€è¦ä¿®æ”¹è³‡æ–™åº«çµæ§‹ï¼Œå¯èƒ½å°è‡´è³‡æ–™æå¤±æˆ–ä¸ä¸€è‡´

**å½±éŸ¿ç¨‹åº¦**: åš´é‡  
**ç™¼ç”Ÿæ©Ÿç‡**: ä½æ©Ÿç‡ (15%)
**é¢¨éšªç­‰ç´š**: ğŸ”´ é«˜é¢¨éšª

**æ½›åœ¨å½±éŸ¿**:
- æ­·å²è»Œé“è³‡æ–™éºå¤±
- è¡›æ˜Ÿ TLE è³‡æ–™ä¸ä¸€è‡´
- è¨­å‚™é…ç½®è³‡æ–™æå£

**ç·©è§£ç­–ç•¥**:
1. **è³‡æ–™å‚™ä»½**: é‡æ§‹å‰å®Œæ•´å‚™ä»½ MongoDB å’Œ Redis è³‡æ–™
2. **æ¼¸é€²å¼è®Šæ›´**: é¿å…ä¸€æ¬¡æ€§å¤§å¹…ä¿®æ”¹è³‡æ–™åº«çµæ§‹
3. **ç‰ˆæœ¬æ§åˆ¶**: ä½¿ç”¨è³‡æ–™åº«é·ç§»è…³æœ¬ç®¡ç†çµæ§‹è®Šæ›´

### ğŸŸ¡ ä¸­é¢¨éšªé …ç›®

#### R3: API å‘å¾Œç›¸å®¹æ€§å•é¡Œ  
**é¢¨éšªæè¿°**: é‡æ§‹å¾Œçš„ API è®Šæ›´å¯èƒ½å½±éŸ¿å‰ç«¯åŠŸèƒ½

**å½±éŸ¿ç¨‹åº¦**: ä¸­ç­‰
**ç™¼ç”Ÿæ©Ÿç‡**: ä¸­æ©Ÿç‡ (40%)
**é¢¨éšªç­‰ç´š**: ğŸŸ¡ ä¸­é¢¨éšª

**æ½›åœ¨å½±éŸ¿**:
- å‰ç«¯ 3D æ¸²æŸ“åŠŸèƒ½ç•°å¸¸
- è¡›æ˜Ÿå‹•ç•«æ’­æ”¾å¤±æ•ˆ
- ä½¿ç”¨è€…ä»‹é¢éŸ¿æ‡‰éŒ¯èª¤

**ç·©è§£ç­–ç•¥**:
1. **API ç‰ˆæœ¬æ§åˆ¶**: ä¿æŒç¾æœ‰ API ç«¯é»çš„å‘å¾Œç›¸å®¹
2. **å‰ç«¯å”èª¿**: èˆ‡å‰ç«¯åœ˜éšŠå¯†åˆ‡æºé€šï¼Œé å…ˆå”èª¿è®Šæ›´
3. **æ¸¬è©¦é©—è­‰**: å»ºç«‹ç«¯åˆ°ç«¯æ¸¬è©¦é©—è­‰å‰å¾Œç«¯æ•´åˆ

**æª¢æŸ¥æ–¹æ³•**:
```bash
# æª¢æŸ¥é—œéµ API ç«¯é»
curl -s "http://localhost:8888/sionna/models/sat.glb" -I
curl -s "http://localhost:8888/scenes/NTPU_v2/model" -I
curl -s "http://localhost:8888/api/satellite/visible_satellites" -I

# æª¢æŸ¥å‰ç«¯è¼‰å…¥
curl -s "http://localhost:5173" -I
```

#### R4: æ•ˆèƒ½å›æ­¸é¢¨éšª
**é¢¨éšªæè¿°**: ç¨‹å¼ç¢¼é‡æ§‹å¯èƒ½å°è‡´è»Œé“è¨ˆç®—æˆ– API éŸ¿æ‡‰æ•ˆèƒ½ä¸‹é™

**å½±éŸ¿ç¨‹åº¦**: ä¸­ç­‰
**ç™¼ç”Ÿæ©Ÿç‡**: ä¸­æ©Ÿç‡ (25%)  
**é¢¨éšªç­‰ç´š**: ğŸŸ¡ ä¸­é¢¨éšª

**æ½›åœ¨å½±éŸ¿**:
- è»Œé“è¨ˆç®—æ™‚é–“å¢åŠ 
- API éŸ¿æ‡‰å»¶é²
- ä½¿ç”¨è€…é«”é©—ä¸‹é™

**ç·©è§£ç­–ç•¥**:
1. **æ•ˆèƒ½åŸºæº–**: å»ºç«‹è©³ç´°çš„æ•ˆèƒ½åŸºæº–æ¸¬è©¦
2. **æŒçºŒç›£æ§**: é‡æ§‹éç¨‹ä¸­æŒçºŒç›£æ§é—œéµæŒ‡æ¨™
3. **å„ªåŒ–æº–å‚™**: æº–å‚™æ•ˆèƒ½å„ªåŒ–æ–¹æ¡ˆ

**æ•ˆèƒ½åŸºæº–æ¸¬è©¦**:
```bash
# API éŸ¿æ‡‰æ™‚é–“æ¸¬è©¦
time curl -s "http://localhost:8888/api/satellite/visible_satellites?lat=24.9&lon=121.4" > /dev/null

# è»Œé“è¨ˆç®—æ•ˆèƒ½æ¸¬è©¦
python -m pytest tests/performance/test_orbit_calculation.py --benchmark-only
```

#### R5: æ¸¬è©¦è¦†è“‹ä¸è¶³é¢¨éšª
**é¢¨éšªæè¿°**: ç¾æœ‰æ¸¬è©¦å¯èƒ½ç„¡æ³•è¦†è“‹æ‰€æœ‰é‡æ§‹è®Šæ›´ï¼Œå°è‡´æ½›åœ¨å•é¡Œæœªè¢«ç™¼ç¾

**å½±éŸ¿ç¨‹åº¦**: ä¸­ç­‰
**ç™¼ç”Ÿæ©Ÿç‡**: ä¸­æ©Ÿç‡ (35%)
**é¢¨éšªç­‰ç´š**: ğŸŸ¡ ä¸­é¢¨éšª

**ç·©è§£ç­–ç•¥**:
1. **æ¸¬è©¦è£œå¼·**: é‡æ§‹å‰è£œå……é—œéµåŠŸèƒ½çš„å–®å…ƒæ¸¬è©¦
2. **æ•´åˆæ¸¬è©¦**: å»ºç«‹å®Œæ•´çš„ API æ•´åˆæ¸¬è©¦
3. **æ‰‹å‹•é©—è­‰**: å»ºç«‹æ‰‹å‹•æ¸¬è©¦æª¢æŸ¥æ¸…å–®

### ğŸŸ¢ ä½é¢¨éšªé …ç›®

#### R6: æ–‡æª”åŒæ­¥å»¶é²
**é¢¨éšªæè¿°**: ç¨‹å¼ç¢¼è®Šæ›´å¾Œæ–‡æª”æ›´æ–°ä¸åŠæ™‚

**å½±éŸ¿ç¨‹åº¦**: è¼•å¾®
**ç™¼ç”Ÿæ©Ÿç‡**: é«˜æ©Ÿç‡ (60%)
**é¢¨éšªç­‰ç´š**: ğŸŸ¢ ä½é¢¨éšª

**ç·©è§£ç­–ç•¥**: å»ºç«‹æ–‡æª”æ›´æ–°æª¢æŸ¥æ¸…å–®ï¼Œé‡æ§‹å®Œæˆå‰çµ±ä¸€æ›´æ–°

#### R7: é–‹ç™¼ç’°å¢ƒé…ç½®å·®ç•°
**é¢¨éšªæè¿°**: ä¸åŒé–‹ç™¼ç’°å¢ƒå¯èƒ½å°è‡´é‡æ§‹çµæœä¸ä¸€è‡´

**å½±éŸ¿ç¨‹åº¦**: è¼•å¾®
**ç™¼ç”Ÿæ©Ÿç‡**: ä½æ©Ÿç‡ (20%)
**é¢¨éšªç­‰ç´š**: ğŸŸ¢ ä½é¢¨éšª

**ç·©è§£ç­–ç•¥**: ä½¿ç”¨ Docker å®¹å™¨ç¢ºä¿ç’°å¢ƒä¸€è‡´æ€§

## ğŸ›¡ï¸ é¢¨éšªç·©è§£ç­–ç•¥ç¸½è¦½

### é é˜²æ€§æªæ–½

#### 1. å®Œæ•´å‚™ä»½ç­–ç•¥
```bash
# ç¨‹å¼ç¢¼å‚™ä»½
git tag v-before-refactor
cp -r simworld/backend backup/simworld-backend-$(date +%Y%m%d)

# è³‡æ–™åº«å‚™ä»½
docker exec netstack-mongodb mongodump --out /backup/mongodb-$(date +%Y%m%d)
docker exec netstack-redis redis-cli BGSAVE
```

#### 2. è‡ªå‹•åŒ–æ¸¬è©¦å¼·åŒ–
```python
# æ–°å¢æ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦
class TestCoreIntegration:
    def test_satellite_orbit_calculation_accuracy(self):
        """é©—è­‰è»Œé“è¨ˆç®—ç²¾åº¦"""
        pass
        
    def test_visibility_analysis_correctness(self):
        """é©—è­‰å¯è¦‹æ€§åˆ†ææ­£ç¢ºæ€§"""  
        pass
        
    def test_api_response_time(self):
        """é©—è­‰ API éŸ¿æ‡‰æ™‚é–“"""
        pass
```

#### 3. ä¾è³´åˆ†æå·¥å…·
```bash
# æ·±åº¦ä¾è³´åˆ†æ
pydeps simworld/backend/app --show-deps --max-bacon 5 --cluster

# æœªä½¿ç”¨ç¨‹å¼ç¢¼æª¢æ¸¬
vulture simworld/backend/app --min-confidence 80

# å¾ªç’°ä¾è³´æª¢æ¸¬
pydeps simworld/backend/app --show-cycles
```

### ç›£æ§æ©Ÿåˆ¶

#### 1. å³æ™‚å¥åº·æª¢æŸ¥
```bash
#\!/bin/bash
# scripts/health_monitor.sh

while true; do
    # API å¥åº·æª¢æŸ¥
    if curl -s http://localhost:8888/health | grep -q "healthy"; then
        echo "$(date): âœ… API æœå‹™æ­£å¸¸"
    else
        echo "$(date): âŒ API æœå‹™ç•°å¸¸"
        # è§¸ç™¼å‘Šè­¦
    fi
    
    # è¡›æ˜ŸåŠŸèƒ½æª¢æŸ¥
    satellite_count=$(curl -s "http://localhost:8888/api/satellite/visible_satellites?lat=24.9&lon=121.4" | jq '.satellites | length')
    if [ "$satellite_count" -gt 0 ]; then
        echo "$(date): âœ… è¡›æ˜ŸåŠŸèƒ½æ­£å¸¸ ($satellite_count é¡†è¡›æ˜Ÿ)"
    else
        echo "$(date): âŒ è¡›æ˜ŸåŠŸèƒ½ç•°å¸¸"
    fi
    
    sleep 30
done
```

#### 2. æ•ˆèƒ½ç›£æ§
```python
# tests/monitoring/performance_monitor.py
import time
import psutil
import requests

class PerformanceMonitor:
    def monitor_api_response_time(self):
        """ç›£æ§ API éŸ¿æ‡‰æ™‚é–“"""
        start_time = time.time()
        response = requests.get("http://localhost:8888/api/satellite/visible_satellites?lat=24.9&lon=121.4")
        response_time = time.time() - start_time
        
        if response_time > 0.5:  # 500ms é–¾å€¼
            print(f"âš ï¸ API éŸ¿æ‡‰æ™‚é–“éé•·: {response_time:.2f}s")
            
    def monitor_memory_usage(self):
        """ç›£æ§è¨˜æ†¶é«”ä½¿ç”¨"""
        memory_usage = psutil.virtual_memory().percent
        if memory_usage > 80:
            print(f"âš ï¸ è¨˜æ†¶é«”ä½¿ç”¨ç‡éé«˜: {memory_usage}%")
```

### æ‡‰æ€¥å›æ»¾æ©Ÿåˆ¶

#### 1. å¿«é€Ÿå›æ»¾ç¨‹åº
```bash
#\!/bin/bash
# scripts/emergency_rollback.sh

echo "ğŸš¨ åŸ·è¡Œç·Šæ€¥å›æ»¾ç¨‹åº..."

# åœæ­¢æœå‹™
make simworld-down

# å›æ»¾ç¨‹å¼ç¢¼
git reset --hard v-before-refactor
git clean -fd

# æ¢å¾©è³‡æ–™åº«ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰
# docker exec netstack-mongodb mongorestore /backup/mongodb-latest

# é‡å•Ÿæœå‹™
make simworld-up

# é©—è­‰å›æ»¾
sleep 30
curl -s http://localhost:8888/health | grep "healthy" && echo "âœ… å›æ»¾æˆåŠŸ" || echo "âŒ å›æ»¾å¤±æ•—"
```

#### 2. éƒ¨åˆ†å›æ»¾ç­–ç•¥
```bash
# é‡å°ç‰¹å®šåŠŸèƒ½çš„å›æ»¾
git log --oneline --grep="Phase 2" | head -5
git revert <commit-hash>  # å›æ»¾ç‰¹å®šè®Šæ›´

# é‡å°ç‰¹å®šæª”æ¡ˆçš„å›æ»¾
git checkout v-before-refactor -- simworld/backend/app/api/routes/satellite_redis.py
```

## ğŸ“ˆ é¢¨éšªç›£æ§å„€è¡¨æ¿

### é—œéµæŒ‡æ¨™è¿½è¹¤

#### åŠŸèƒ½æŒ‡æ¨™
- âœ… è¡›æ˜Ÿå¯è¦‹æ€§ API æ­£å¸¸å›æ‡‰
- âœ… è»Œé“è¨ˆç®—ç²¾åº¦åœ¨å¯æ¥å—ç¯„åœ  
- âœ… 3D æ¨¡å‹æœå‹™å¯æ­£å¸¸å­˜å–
- âœ… å‰ç«¯é é¢æ­£å¸¸è¼‰å…¥

#### æ•ˆèƒ½æŒ‡æ¨™  
- ğŸ“Š API éŸ¿æ‡‰æ™‚é–“ < 200ms (90th percentile)
- ğŸ“Š è»Œé“è¨ˆç®—æ™‚é–“ < 100ms
- ğŸ“Š è¨˜æ†¶é«”ä½¿ç”¨ç‡ < 70%
- ğŸ“Š CPU ä½¿ç”¨ç‡ < 50%

#### ç©©å®šæ€§æŒ‡æ¨™
- ğŸ”’ æœå‹™æ­£å¸¸é‹è¡Œæ™‚é–“ > 99%
- ğŸ”’ è³‡æ–™ä¸€è‡´æ€§æª¢æŸ¥é€šé
- ğŸ”’ ç„¡é—œéµéŒ¯èª¤æ—¥èªŒ
- ğŸ”’ è³‡æ–™åº«é€£æ¥ç©©å®š

### å‘Šè­¦æ©Ÿåˆ¶
```python
# monitoring/alerting.py
class AlertSystem:
    def check_and_alert(self):
        alerts = []
        
        # æª¢æŸ¥ API å¥åº·
        if not self.is_api_healthy():
            alerts.append("ğŸš¨ API æœå‹™ç•°å¸¸")
            
        # æª¢æŸ¥æ•ˆèƒ½
        if self.get_response_time() > 0.5:
            alerts.append("âš ï¸ API éŸ¿æ‡‰æ™‚é–“éé•·")
            
        # æª¢æŸ¥è¨˜æ†¶é«”
        if psutil.virtual_memory().percent > 80:
            alerts.append("âš ï¸ è¨˜æ†¶é«”ä½¿ç”¨ç‡éé«˜")
            
        return alerts
```

---

**é¢¨éšªç®¡ç†åŸå‰‡**: é é˜²ç‚ºä¸»ï¼Œç›£æ§ç‚ºè¼”ï¼Œå¿«é€ŸéŸ¿æ‡‰ï¼Œç¢ºä¿æ ¸å¿ƒç ”ç©¶åŠŸèƒ½åœ¨ä»»ä½•æƒ…æ³ä¸‹éƒ½èƒ½æ­£å¸¸é‹ä½œã€‚
EOF < /dev/null
