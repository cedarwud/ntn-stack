* 在場景上空 **同時可見的衛星數（目標）**：**建議把目標設定為 8–12 顆同時可見**。
  原因：這個量級在做 handover 決策、候選管理與 RL 學習（探索不同換手策略）時提供足夠選擇性與複雜度，能暴露真實網路競爭與失敗情況；同時又不會讓狀態空間過大、難以訓練。
* 為達到上述目標，在**單一星座內**最終要取的衛星數（工程/研究兩個層級）：

  * Starlink（低軌，週期 ≈ 96 分鐘）：

    * 研究-起始（可研究但偏保守）：**120 顆**
    * 研究-健壯（含 worst-case 與高冗餘）：**180–240 顆**（若資源允許取高端）
  * OneWeb（較高軌，週期 ≈ 109 分鐘）：

    * 研究-起始：**60–80 顆**
    * 研究-健壯：**90–100 顆**

以上數字是針對「要在大部分時間保證場景上空能看到 8–12 顆同星座衛星」的工程建議；實驗時仍應做敏感度分析（下文說明）。

---

## 為什麼選 8–12 顆同時可見（概念性原因）

1. **RL 需要豐富且穩定的 action/observation 空間**：若同時候選太少（例如只有 2–4 顆），策略學到的東西過於簡單且不能泛化到真實密集星座。8–12 顆能提供真實世界常見的決策競爭情形（多候選、短可見窗口、多次切換）。
2. **能同時呈現多種 handover 情境**：包含快速切換（低軌）、長期服務（高軌）、多候選出現/消失、重疊 rise/set 等，這對 reward 設計（切換代價、掉線懲罰、連續性獎勵）很重要。
3. **研究可觀察統計量收斂**：8–12 顆能使 handover rate、interruptions、候選大小等統計量在合理時間尺度內有足夠樣本來估計與比較演算法性能。

---

## 以軌道週期與可見時間做的推算（透明化計算思路）

概念先說：單顆衛星在某地點的**平均可見時間（t\_v）**除以軌道週期（T）就是該顆在任一時刻的**平均可見率（duty）**。若你想在任何時刻「同時可見 N\_goal 顆」，理論上需要的總衛星數約等於 N\_goal / duty。為了穩健，再乘上安全係數（冗餘）來對抗相位叢聚、TLE 誤差與局部幾何劣勢。

具體步驟與關鍵數值（簡潔）：

* Starlink：可見時間 conserv. 取 8–10 分鐘，週期 T ≈ 96 min，duty ≈ 8/96 = 0.083… 到 10/96 = 0.104…
* OneWeb：可見時間 conserv. 取 18–20 分鐘，T ≈ 109 min，duty ≈ 18/109 ≈ 0.165… 到 20/109 ≈ 0.183…

以目標同時可見 N\_goal = 8–12 計算（取範圍的端點，再乘安全係數）：

* Starlink：以較保守 duty=0.0833，N = N\_goal / 0.0833。當 N\_goal=8 → N≈96，N\_goal=12 → N≈144。為研究級要更保險，乘安全係數 1.25–2.5 得到約 120–360 的範圍；綜合考量效能與真實性，建議採 120（起始）到 180–240（健壯）之間。
* OneWeb：以保守 duty≈0.165，N = N\_goal / 0.165。當 N\_goal=8 → N≈48，N\_goal=12 → N≈72。加上安全係數 1.25–2 → 約 60–144；合理起始是 60–80，健壯取 90–100。

（上面數字是用 duty 作為「平均佔用率」的直觀推估，再加上實務上常用的安全係數以對抗相位/地域差異。）

---

## 取衛星的邏輯（篩選算法 — 概念與步驟，讓模擬既真實又達到同時可見目標）

整體流程分成預處理／候選建立／動態維護三大階段。

### 預處理（離線或一開始做）

1. **收集真實星歷（TLE）並按 epoch 過濾**：對於歷史回放，使用當時 epoch 的 TLE；對於實驗性長期模擬，選取近 epoch 並注意 TLE 更新頻率。
2. **對每顆原始 TLE 做軌道推演（SGP4）生成 visibility windows**：在你研究時間窗（例如每天、或多天）內，計算每顆相對 UE 的 rise/set 時刻、peak 仰角、可見總時長。把這些資訊存成 visibility table（每顆的 interval list）。
3. **計算每顆的 summary 指標**：peak elevation（最大仰角）、mean elevation、最大可見時長、最近一次過境時間、所屬 orbital plane、RAAN、mean anomaly。

### 候選建立（如何從整個星群中選出要模擬的子集）

目標是「在大多數時間能保證場景上空同時可見 N\_goal 顆」，因此需要兼顧**數量**與**相位/plane 分布**。

1. **先按 orbital-plane 與 shell 分群**：把星座切成若干群（例如 Starlink 的 53° shell、70° shell 等；OneWeb 各 plane）。在每個群內繼續抽樣，確保不同 plane 都有代表。這避免所有衛星在同一 plane 相位相近造成同時出現/消失。
2. **在每個 plane 內做 phase 分散抽樣**：用 mean anomaly / true anomaly 做排序，從中以固定間隔抽取（例如每隔 k 個位置取一顆），保證 phase 均勻，避免叢聚。
3. **優先挑選 peak elevation 較高、可見時長較長的衛星**：這些衛星在 UE 週期內更有機會進入候選集合，提高同時可見的可靠性。用 peak elevation 與可見時長組合成一個 score，作為次排序依據。
4. **如果單純真實 TLE 不夠密集，可以合成/複製代表性衛星**：在同一 plane 上按合理的相位偏移生成 synthetic clones（保留 plane & inclination），用來增加樣本密度，但仍保留真實特性（避免隨意合成造成不自然通過）。
5. **計算預期 simult.-visible 分佈並調整數量**：根據選出來的子集，用 visibility table 做模擬抽樣（例如一天每分鐘取樣）來統計同時可見分佈；如果不能達成 N\_goal，在不同 plane 增加樣本或提高複製密度直到滿足目標。

### 動態維護（線上或播放時）

1. **只渲染當前可見子集**：即便模擬總數很多，前端每幀只 load/transform 那些仰角≥ cutoff（例如 ≥10°）的衛星，其他僅維持在資料結構中以節省資源。
2. **平滑 spawn/despawn**：遇到大量衛星同時進出時，不要瞬間全部 render/unrender；用短時間淡入/淡出或小幅時移（例如 ±10–30 秒）平滑化，既有視覺效果又避免網路/渲染抖動，對 RL 訓練則應保留真實 timing 版本作為對照。
3. **候選池維護（serving + candidates）**：在每個時間步，為 UE 建立一個 top-K 候選池（K 建議取 5），依據仰角、預期剩餘可見時間、距離（或 SNR proxy）計分並排序；強化學習 agent 的 action 空間可以是選擇 top-1（or multi-connect subset）。
4. **注入隨機性與 TLE 噪聲（為了 RL 泛化）**：訓練時可在衛星位置、可見時間上加小幅隨機擾動（模擬 TLE 誤差、傳播延遲或遮蔽），避免 agent 過度擬合 deterministic schedule。

---

## 為 RL 設計的觀察（state）與動作（action）與 reward（概念）

### State（建議最小集合）

* UE 固定位置（地理座標、時間、環境參數）
* 對每個候選衛星的即時特徵（azimuth, elevation, distance, remaining\_visibility\_time, peak\_elevation, plane\_id, predicted\_SNR\_proxy）
* 當前 serving 衛星 ID 與其 QoS（例如 throughput proxy、latency proxy）
* 歷史切換記錄（上次handover 時間、切換次數在 window 內）

### Action（範例）

* 選擇一顆衛星作為下一個 serving（或選 multi-connect set）
* 選擇是否執行即時 handover 或延遲 handover（選擇 hold-on）

### Reward（設計重點）

* 正獎勵：保持連續服務（service duration）、高 SNR/高仰角連線時間
* 負獎勵：handover 中斷時間、切換過於頻繁的懲罰（切換成本）、掉線事件大懲罰
* 加速器：鼓勵選擇剩餘可見時間長的衛星（減少短期切換），但也要保留探索誘因（例如短期高 SNR 衛星也應被考量）

---

## 評估指標（你論文會用到）

* 同時可見分佈（CDF）與平均值、中位數（baseline vs. 模擬子集）
* Handover rate（次/分鐘）、平均中斷時間、最大中斷時間分佈
* RL 演算法的累積 reward、收斂速度、policy 穩定性（在不同模擬密度下）
* 敏感度分析：在不同模擬衛星總數（30、60、120、200）下比較結果收斂性

---

## 實驗設計建議（以你的論文為中心）

* 先做「收斂實驗」：以 N\_total = 30 / 60 / 120 / 200（單星座）分別跑同一隨機 seed 的多次模擬，觀察 handover rate 與中斷率是否在某個 N 上收斂；若在 120 左右收斂，則可把 120 當成你的「最小可接受模擬規模」。
* 主實驗組：採用 120 (Starlink) 或 60–80 (OneWeb) 作為 baseline；再與 180–240 (Starlink) 或 90–100 (OneWeb) 做健壯性對比。
* 時間尺度：做一天或多日的回放（使用 time-acceleration 因子 10x/60x 來加速訓練），並將隨機 TLE 噪聲納入訓練集與測試集以驗證 policy 的泛化能力。

---

## 注意事項（風險與實務限制）

* TLE/SGP4 的精度會影響個別衛星路徑的精確性，但對大量統計量（simult.-visible distribution）影響較小；若研究需要高精度定位或延遲估計，考慮更高精度星曆或合併測量雜訊模型。
* 前端渲染與後端模擬分離：大量衛星模擬沒問題，但應把 propagate 與 visibility 計算放到後端 batch 或 webworker，前端只做 subset rendering。
* 若你只關心「單星座 handover」，就照單星座計算；若跨星座（實際上很少做 cross-constellation handover）則另行建模。

---

## 最後總結（研究者的可行採用戰術）

* 把**研究目標**（要取到能學會 robust handover 策略的資料）置於首位：設定場景上空同時可見 8–12 顆為目標。
* 初始實驗採用 Starlink 120 / OneWeb 60–80（根據你要研究的星座擇一或分別做實驗），這可在多數情況下提供足夠複雜度讓 RL 學會有效策略，且在算力上可接受。
* 若要發表或驗證 worst-case 與高可靠性結論，再把 Starlink 增到 180–240、OneWeb 增到 90–100 做健壯性測試與收斂驗證。
* 衛星抽樣邏輯以「plane 分群 → phase 均勻抽樣 → peak-elevation 排序 → 必要時合成 clones → 預計算 visibility windows」的流程執行，並用預計算的 visibility table 驗證所選子集是否達到 simult.-visible 目標，必要時增減樣本並重測，直到達標。