<!DOCTYPE html>
<html>
<head>
    <title>è¡›æ˜Ÿæ•¸æ“šèª¿è©¦</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #00ff00; }
        .status { margin: 10px 0; padding: 10px; background: #2a2a2a; border-radius: 5px; }
        .success { border-left: 5px solid #00ff00; }
        .error { border-left: 5px solid #ff0000; }
        .warning { border-left: 5px solid #ffaa00; }
        .info { border-left: 5px solid #0088ff; }
        pre { overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ›°ï¸ è¡›æ˜Ÿæ•¸æ“šæµèª¿è©¦å·¥å…·</h1>
    <div id="status">è¼‰å…¥ä¸­...</div>
    
    <script>
        const statusDiv = document.getElementById('status');
        
        function addStatus(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> ${message}`;
            statusDiv.appendChild(div);
            console.log(message);
        }
        
        async function testSatelliteAPI() {
            addStatus('ğŸ” æ¸¬è©¦ NetStack è¡›æ˜Ÿ API...', 'info');
            
            try {
                const response = await fetch('http://localhost:8080/api/v1/satellite-simple/visible_satellites?count=3&min_elevation_deg=5&observer_lat=24.9441667&observer_lon=121.3713889&constellation=starlink&utc_timestamp=2025-08-18T10:00:00Z&global_view=false');
                const data = await response.json();
                
                addStatus(`âœ… API æˆåŠŸ: ${data.satellites.length} é¡†è¡›æ˜Ÿ`, 'success');
                addStatus(`<pre>${JSON.stringify(data.satellites[0], null, 2)}</pre>`, 'info');
                
                return data;
            } catch (error) {
                addStatus(`âŒ API éŒ¯èª¤: ${error.message}`, 'error');
                return null;
            }
        }
        
        async function testSatelliteModel() {
            addStatus('ğŸ” æ¸¬è©¦è¡›æ˜Ÿ 3D æ¨¡å‹...', 'info');
            
            try {
                const response = await fetch('http://localhost:8888/static/models/sat.glb', { method: 'HEAD' });
                if (response.ok) {
                    addStatus(`âœ… è¡›æ˜Ÿæ¨¡å‹æ­£å¸¸: ${response.headers.get('content-length')} bytes`, 'success');
                } else {
                    addStatus(`âŒ è¡›æ˜Ÿæ¨¡å‹éŒ¯èª¤: ${response.status}`, 'error');
                }
            } catch (error) {
                addStatus(`âŒ æ¨¡å‹è«‹æ±‚éŒ¯èª¤: ${error.message}`, 'error');
            }
        }
        
        async function testFrontendData() {
            addStatus('ğŸ” æª¢æŸ¥å‰ç«¯æ•¸æ“šæœå‹™...', 'info');
            
            // æ¨¡æ“¬å‰ç«¯æ•¸æ“šæœå‹™èª¿ç”¨é‚è¼¯
            try {
                // æ¨¡æ“¬ satelliteDataService çš„èª¿ç”¨
                const API_BASE = 'http://localhost:8080';
                const endpoint = `/api/v1/satellite-simple/visible_satellites?count=15&min_elevation_deg=5&observer_lat=24.9441667&observer_lon=121.3713889&constellation=starlink&utc_timestamp=2025-08-18T10:00:00Z&global_view=false`;
                
                const response = await fetch(API_BASE + endpoint);
                const data = await response.json();
                
                addStatus(`âœ… å‰ç«¯æ•¸æ“šæœå‹™æ¨¡æ“¬æˆåŠŸ`, 'success');
                addStatus(`è¡›æ˜Ÿæ•¸é‡: ${data.satellites.length}`, 'info');
                
                // æª¢æŸ¥æ•¸æ“šçµæ§‹
                const firstSat = data.satellites[0];
                if (firstSat) {
                    addStatus(`ç¬¬ä¸€é¡†è¡›æ˜Ÿ:`, 'info');
                    addStatus(`- ID: ${firstSat.norad_id || firstSat.id}`, 'info');
                    addStatus(`- åç¨±: ${firstSat.name}`, 'info');
                    addStatus(`- æ™‚é–“åºåˆ—é•·åº¦: ${firstSat.position_timeseries ? firstSat.position_timeseries.length : 0}`, 'info');
                    addStatus(`- å¯è¦‹æ€§: ${firstSat.is_visible}`, 'info');
                    addStatus(`- ä»°è§’: ${firstSat.elevation_deg}Â°`, 'info');
                    
                    if (firstSat.position_timeseries && firstSat.position_timeseries.length > 0) {
                        addStatus(`âœ… æ™‚é–“åºåˆ—æ•¸æ“šå­˜åœ¨ï¼Œå¯é€²è¡Œè»Œé“è¨ˆç®—`, 'success');
                        
                        // æª¢æŸ¥ç¬¬ä¸€å€‹æ™‚é–“åºåˆ—é»
                        const firstPoint = firstSat.position_timeseries[0];
                        addStatus(`ç¬¬ä¸€å€‹è»Œé“é»: ä»°è§’${firstPoint.elevation_deg}Â°, æ–¹ä½è§’${firstPoint.azimuth_deg}Â°`, 'info');
                    } else {
                        addStatus(`âŒ ç¼ºå°‘æ™‚é–“åºåˆ—æ•¸æ“šï¼Œç„¡æ³•è¨ˆç®—è»Œé“`, 'error');
                    }
                }
                
            } catch (error) {
                addStatus(`âŒ å‰ç«¯æ•¸æ“šæœå‹™éŒ¯èª¤: ${error.message}`, 'error');
            }
        }
        
        async function runAllTests() {
            addStatus('ğŸš€ é–‹å§‹å®Œæ•´è¡›æ˜Ÿç³»çµ±è¨ºæ–·...', 'info');
            
            await testSatelliteAPI();
            await testSatelliteModel();
            await testFrontendData();
            
            addStatus('ğŸ“Š è¨ºæ–·å®Œæˆï¼æª¢æŸ¥ä¸Šè¿°çµæœç¢ºå®šå•é¡Œæ‰€åœ¨ã€‚', 'success');
        }
        
        // è‡ªå‹•é–‹å§‹æ¸¬è©¦
        runAllTests();
        
        // æ¯30ç§’é‡æ–°æ¸¬è©¦API
        setInterval(async () => {
            addStatus('ğŸ”„ å®šæœŸæª¢æŸ¥è¡›æ˜ŸAPI...', 'info');
            await testSatelliteAPI();
        }, 30000);
    </script>
</body>
</html>