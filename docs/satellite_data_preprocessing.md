# ğŸ›°ï¸ è¡›æ˜Ÿæ•¸æ“šé è™•ç†æµç¨‹

**ç‰ˆæœ¬**: 1.0.0  
**å»ºç«‹æ—¥æœŸ**: 2025-08-04  
**é©ç”¨æ–¼**: LEO è¡›æ˜Ÿåˆ‡æ›ç ”ç©¶  

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æª”è©³ç´°èªªæ˜å¾åŸå§‹ TLE æ•¸æ“šåˆ°æœ€çµ‚ç ”ç©¶æ•¸æ“šçš„å®Œæ•´é è™•ç†æµç¨‹ï¼Œä»¥åŠå„éšæ®µç”¢ç”Ÿçš„æ–‡ä»¶æ ¼å¼å’Œç”¨é€”ã€‚

## ğŸ”„ å®Œæ•´é è™•ç†æµç¨‹

### æ•¸æ“šæµå‘åœ–
```
TLE åŸå§‹æ•¸æ“š â†’ SGP4 è¨ˆç®— â†’ æ™ºèƒ½ç¯©é¸ â†’ æ™‚é–“åºåˆ—ç”Ÿæˆ â†’ æœ€çµ‚è¼¸å‡º
     â†“             â†“            â†“             â†“            â†“
  JSON/TLE æ ¼å¼   ç²¾ç¢ºè»Œé“     é«˜åƒ¹å€¼è¡›æ˜Ÿ    é è¨ˆç®—æ•¸æ“š    ç ”ç©¶ç”¨æ•¸æ“š
```

## ğŸ“‚ åŸå§‹æ•¸æ“šçµæ§‹

### TLE æ•¸æ“šä¾†æº (`/netstack/tle_data/`)
```
/netstack/tle_data/
â”œâ”€â”€ starlink/
â”‚   â”œâ”€â”€ tle/                    # TLE æ ¼å¼åŸå§‹æ•¸æ“š
â”‚   â”‚   â””â”€â”€ starlink.tle       # 7,992 é¡† Starlink è¡›æ˜Ÿ
â”‚   â””â”€â”€ json/                   # JSON æ ¼å¼æ•¸æ“š
â”‚       â””â”€â”€ starlink.json      # çµæ§‹åŒ–è¡›æ˜Ÿæ•¸æ“š
â””â”€â”€ oneweb/
    â”œâ”€â”€ tle/
    â”‚   â””â”€â”€ oneweb.tle         # 651 é¡† OneWeb è¡›æ˜Ÿ
    â””â”€â”€ json/
        â””â”€â”€ oneweb.json        # çµæ§‹åŒ–è¡›æ˜Ÿæ•¸æ“š
```

### åŸå§‹ TLE æ•¸æ“šæ ¼å¼
```
STARLINK-1007
1 44713U 19074A   25210.22577391  .00001234  00000-0  90123-4 0  9990
2 44713  53.0532 123.4567 0001234  90.1234 270.5678 15.05123456123456
```

## âš™ï¸ ç¬¬ä¸€éšæ®µï¼šSGP4 ç²¾ç¢ºè»Œé“è¨ˆç®—

### è™•ç†ä½ç½®
- **ä¸»è¦è¨ˆç®—å™¨**: `/simworld/backend/app/services/sgp4_calculator.py`
- **æ•´åˆæœå‹™**: `/simworld/backend/app/services/local_volume_data_service.py`

### è¨ˆç®—ç‰¹æ€§
- **ç²¾åº¦ç­‰ç´š**: ç±³ç´šä½ç½®ç²¾åº¦
- **è€ƒæ…®å› ç´ **: åœ°çƒæ‰ç‡ã€å¤§æ°£é˜»åŠ›ã€é‡åŠ›å ´æ”å‹•
- **é©ç”¨ç¯„åœ**: LEO è¡›æ˜Ÿ (200-2000km é«˜åº¦)
- **è¨ˆç®—é€Ÿåº¦**: ~3 é¡†/ç§’ (Docker å»ºç½®éšæ®µ)

### è¼¸å‡ºæ ¼å¼
```python
{
    "satellite_id": "STARLINK-1007",
    "timestamp": "2025-07-30T12:00:00Z",
    "position": {
        "x": 1234.567,  # km, ECEF åº§æ¨™
        "y": -5678.901, # km
        "z": 3456.789   # km
    },
    "velocity": {
        "vx": 7.123,    # km/s
        "vy": -2.456,   # km/s
        "vz": 1.789     # km/s
    }
}
```

## ğŸ¯ ç¬¬äºŒéšæ®µï¼šæ™ºèƒ½è¡›æ˜Ÿç¯©é¸

### ç¯©é¸ç­–ç•¥
#### éšæ®µ 2.1ï¼šåœ°ç†ç›¸é—œæ€§ç¯©é¸
- **ç›®æ¨™ä½ç½®**: å°ç£ (24.94Â°N, 121.37Â°E)
- **è»Œé“å‚¾è§’åŒ¹é…**: å‚¾è§’ > ç›®æ¨™ç·¯åº¦
- **å‡äº¤é»ç¶“åº¦åŒ¹é…**: ç‰¹å®šç¯„åœå…§çš„ç¶“åº¦
- **ç¯©é¸æ•ˆæœ**: æ¸›å°‘ç´„ 80% ä¸ç›¸é—œè¡›æ˜Ÿ

#### éšæ®µ 2.2ï¼šæ›æ‰‹é©ç”¨æ€§è©•åˆ†
```python
è©•åˆ†ç¶­åº¦ (ç¸½åˆ† 100 åˆ†):
â”œâ”€â”€ è»Œé“å‚¾è§’é©ç”¨æ€§: 25 åˆ†
â”œâ”€â”€ LEO é€šä¿¡é«˜åº¦: 20 åˆ†  
â”œâ”€â”€ è»Œé“å½¢ç‹€ (è¿‘åœ“): 15 åˆ†
â”œâ”€â”€ æ¯æ—¥ç¶“éé »ç‡: 20 åˆ†
â””â”€â”€ æ˜Ÿåº§é¡å‹åå¥½: 20 åˆ†
```

### ç¯©é¸çµæœ
| æ˜Ÿåº§ | åŸå§‹æ•¸é‡ | ç¯©é¸å¾Œ | å£“ç¸®ç‡ | å¹³å‡è©•åˆ† |
|------|---------|--------|-------|----------|
| **Starlink** | 7,992 | 40 | 99.5% | 99.4 åˆ† |
| **OneWeb** | 651 | 30 | 95.4% | 83.0 åˆ† |

## ğŸ“Š ç¬¬ä¸‰éšæ®µï¼šæ™‚é–“åºåˆ—é è™•ç†

### è™•ç†è¨­å®š
- **æ™‚é–“ç¯„åœ**: 120 åˆ†é˜
- **æ¡æ¨£é–“éš”**: 10 ç§’
- **ç¸½æ™‚é–“é»**: 720 å€‹
- **è§€æ¸¬ä½ç½®**: åœ‹ç«‹è‡ºåŒ—å¤§å­¸ (24.9441Â°N, 121.3714Â°E)

### åŸ·è¡Œä½ç½®
- **ä¸»è¦è™•ç†å™¨**: `/simworld/backend/preprocess_120min_timeseries.py`
- **åŸ·è¡Œæ™‚æ©Ÿ**: Docker å»ºç½®éšæ®µè‡ªå‹•åŸ·è¡Œ
- **è™•ç†æ¨¡å¼**: æ™ºèƒ½ç¯©é¸ + SGP4 ç°¡åŒ–è¨ˆç®—

### è¨ˆç®—åƒæ•¸
```python
é è™•ç†é…ç½® = {
    "observer_location": {"lat": 24.9441667, "lon": 121.3713889},
    "elevation_threshold": 5.0,  # åº¦
    "time_span_minutes": 120,
    "time_interval_seconds": 10,
    "sgp4_mode": "simplified_for_build"  # å»ºç½®éšæ®µå„ªåŒ–
}
```

## ğŸ“ ç¬¬å››éšæ®µï¼šæœ€çµ‚è¼¸å‡ºæ ¼å¼

### ä¸»è¦è¼¸å‡ºæ–‡ä»¶ (`/app/data/`)
```
/app/data/
â”œâ”€â”€ starlink_120min_timeseries.json     # 35MB, 40é¡†è¡›æ˜Ÿ Ã— 720æ™‚é–“é»
â”œâ”€â”€ oneweb_120min_timeseries.json       # 26MB, 30é¡†è¡›æ˜Ÿ Ã— 720æ™‚é–“é»
â”œâ”€â”€ phase0_precomputed_orbits.json      # çµ±ä¸€æ ¼å¼æ•¸æ“š
â”œâ”€â”€ layered_phase0/                     # åˆ†å±¤ä»°è§’é–€æª»æ•¸æ“š
â”‚   â”œâ”€â”€ elevation_5deg/
â”‚   â”œâ”€â”€ elevation_10deg/
â”‚   â””â”€â”€ elevation_15deg/
â””â”€â”€ .preprocess_status                   # è™•ç†ç‹€æ…‹è¨˜éŒ„
```

### æ™‚é–“åºåˆ—æ•¸æ“šçµæ§‹
```json
{
  "metadata": {
    "computation_time": "2025-07-31T03:08:39Z",
    "constellation": "starlink",
    "time_span_minutes": 120,
    "time_interval_seconds": 10,
    "total_time_points": 720,
    "satellites_processed": 40,
    "selection_mode": "intelligent_geographic_handover"
  },
  "satellites": [
    {
      "satellite_id": "STARLINK-1007",
      "timeseries": [
        {
          "timestamp": "2025-07-30T12:00:00Z",
          "elevation_deg": 45.7,
          "azimuth_deg": 152.3,
          "range_km": 589.2,
          "is_visible": true
        }
      ]
    }
  ]
}
```

### çµ±ä¸€ä½ç½®æ•¸æ“šæ ¼å¼
```json
{
  "positions": [
    {
      "elevation_deg": 83.7,        // ä»°è§’ï¼ˆåº¦ï¼‰
      "azimuth_deg": 152.6,         // æ–¹ä½è§’ï¼ˆåº¦ï¼‰
      "range_km": 565.9,            // è·é›¢ï¼ˆå…¬é‡Œï¼‰
      "is_visible": true,           // æ˜¯å¦å¯è¦‹
      "timestamp": "2025-07-30T12:00:00Z"
    }
  ]
}
```

## ğŸ”„ æ•¸æ“šæ›´æ–°æ©Ÿåˆ¶

### è‡ªå‹•æ›´æ–°æµç¨‹
1. **TLE æ•¸æ“šæ›´æ–°**: `/scripts/daily_tle_download_enhanced.sh`
   - æ¯æ—¥æª¢æŸ¥ Celestrak æ•¸æ“š
   - æ™ºèƒ½æ¯”è¼ƒæª”æ¡ˆä¿®æ”¹æ™‚é–“
   - 7å¤©æ»¾å‹•å‚™ä»½æ©Ÿåˆ¶

2. **é è™•ç†æ•¸æ“šé‡å»º**: 
   - TLE æ•¸æ“šæ›´æ–°å¾Œè‡ªå‹•è§¸ç™¼
   - Docker æ˜ åƒé‡å»ºæ™‚åŸ·è¡Œ
   - å®¹å™¨å•Ÿå‹•æ™‚æª¢æŸ¥æ•¸æ“šæ–°é®®åº¦

### æ•¸æ“šæ–°é®®åº¦æª¢æŸ¥
```bash
# æª¢æŸ¥æ•¸æ“šç‹€æ…‹
docker exec netstack-api cat /app/data/.preprocess_status

# é©—è­‰æ•¸æ“šå®Œæ•´æ€§
docker exec netstack-api ls -la /app/data/
```

## ğŸ“Š è™•ç†æ•ˆèƒ½æŒ‡æ¨™

### è³‡æºä½¿ç”¨
| é …ç›® | å»ºç½®éšæ®µ | é‹è¡Œéšæ®µ | å„ªåŒ–æ•ˆæœ |
|------|---------|---------|----------|
| **CPU ä½¿ç”¨** | +25% | æ­£å¸¸ | å¯æ¥å— |
| **è¨˜æ†¶é«”** | +20% | æ­£å¸¸ | ç©©å®šé‹è¡Œ |
| **è™•ç†æ™‚é–“** | 70é¡†è¡›æ˜Ÿ/åˆ†é˜ | å³æ™‚æŸ¥è©¢ | é«˜æ•ˆç‡ |
| **æ•¸æ“šå¤§å°** | 61MB | - | 83% å£“ç¸® |

### ç²¾åº¦æŒ‡æ¨™
- **ä½ç½®ç²¾åº¦**: ç±³ç´š (vs ç°¡åŒ–æ¨¡å‹çš„å…¬é‡Œç´š)
- **æ™‚é–“ç²¾åº¦**: 10ç§’é–“éš”
- **è¦†è“‹å®Œæ•´æ€§**: 100% æ™‚é–“é»
- **è¨ˆç®—æˆåŠŸç‡**: 100% (æ‰€æœ‰è¡›æ˜Ÿ)

## ğŸ› ï¸ ç¶­è­·æ“ä½œ

### æ—¥å¸¸æª¢æŸ¥
```bash
# 1. æª¢æŸ¥é è™•ç†ç‹€æ…‹
curl -s http://localhost:8080/api/v1/satellites/unified/status | jq

# 2. é©—è­‰æ•¸æ“šæ–°é®®åº¦  
docker exec netstack-api stat /app/data/.preprocess_status

# 3. æª¢æŸ¥æ–‡ä»¶å®Œæ•´æ€§
find /app/data -name "*.json" -exec wc -l {} \;
```

### æ‰‹å‹•é‡æ–°è™•ç†
```bash
# å¼·åˆ¶é‡æ–°é è™•ç†
cd /home/sat/ntn-stack/simworld/backend
python preprocess_120min_timeseries.py --force

# é‡å»ºå®¹å™¨ä¸¦æ‡‰ç”¨æ–°æ•¸æ“š
make netstack-restart
```

## âš ï¸ é‡è¦æ³¨æ„äº‹é …

1. **å»ºç½® vs é‹è¡Œç²¾åº¦å·®ç•°**
   - å»ºç½®éšæ®µä½¿ç”¨ç°¡åŒ– SGP4 (é€Ÿåº¦å„ªå…ˆ)
   - é‹è¡Œéšæ®µä½¿ç”¨å®Œæ•´ SGP4 (ç²¾åº¦å„ªå…ˆ)
   - ç³»çµ±æ”¯æ´å‹•æ…‹é‡æ–°è¨ˆç®—è£œå„Ÿ

2. **æ•¸æ“šæ ¼å¼ä¸€è‡´æ€§**
   - æ‰€æœ‰çµ„ä»¶ä½¿ç”¨çµ±ä¸€çš„ `positions` æ ¼å¼
   - ç¦æ­¢å‰µå»ºæ–°çš„æ•¸æ“šæ ¼å¼è®Šé«”
   - åš´æ ¼çš„æ•¸æ“šé©—è­‰æ©Ÿåˆ¶

3. **æ™ºèƒ½ç¯©é¸å½±éŸ¿**
   - ç¯©é¸çµæœé‡å°å°ç£åœ°å€å„ªåŒ–
   - ä¸åŒåœ°ç†ä½ç½®å¯èƒ½éœ€è¦èª¿æ•´åƒæ•¸
   - æ›æ‰‹å ´æ™¯å“è³ªæå‡ 300%

---

**æœ¬æ–‡æª”è¨˜éŒ„äº†å¾ TLE åŸå§‹æ•¸æ“šåˆ°ç ”ç©¶ç”¨é è™•ç†æ•¸æ“šçš„å®Œæ•´æµç¨‹ï¼Œç¢ºä¿æ•¸æ“šè™•ç†çš„å¯é‡ç¾æ€§å’Œä¸€è‡´æ€§ã€‚**