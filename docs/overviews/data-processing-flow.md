# 🔄 衛星數據預處理流程 - 概述

**版本**: 1.0.0  
**更新日期**: 2025-08-11  
**適用於**: 理解系統數據流程和架構設計  

## 🎯 整體架構

### Pure Cron 驅動架構 (v3.0)
**核心理念**：容器 = 純數據載入，Cron = 自動數據更新，徹底分離關注點

```
🏗️ Docker 建構階段     🚀 容器啟動階段      🕒 Cron 調度階段
      ↓                     ↓                    ↓
   預計算基礎數據         純數據載入驗證         自動數據更新
      ↓                     ↓                    ↓
   映像檔包含數據         < 30秒快速啟動      智能增量處理
                                              (每6小時執行)
```

### 完整預處理數據流向
```
🏗️ 建構階段：
TLE 原始數據 → SGP4 計算 → 智能篩選 → 預計算數據 → 映像檔基礎數據
     ↓             ↓            ↓           ↓            ↓
  JSON/TLE 格式   完整算法     高價值衛星   即用數據     快速啟動

🚀 啟動階段（純載入）：
映像檔數據 → 數據完整性驗證 → API 服務啟動 → 立即可用
     ↓              ↓              ↓           ↓
  預計算數據      結構和格式檢查    < 30秒啟動   研究用數據
```

## 📋 處理階段概述

### 🔄 階段一：TLE數據載入與SGP4精確軌道計算
**核心目的**：完整的TLE數據載入、驗證、篩選與SGP4軌道計算，建立完整衛星軌道數據庫

#### 📋 詳細處理流程

**1.1 TLE數據掃描與載入**
- **目的**: 掃描和載入所有可用的TLE數據檔案
- **輸入**: `/netstack/tle_data/` 目錄結構
- **輸出**: TLE檔案清單和基礎統計

**1.2 原始衛星數據載入**
- **目的**: 從TLE檔案中解析出原始衛星軌道參數
- **功能**: 載入最新日期的TLE數據，解析三行格式
- **輸出**: 原始衛星數據列表

**1.3 衛星池建構（基礎篩選）**
- **目的**: 基礎數據驗證和初步篩選，移除無效數據
- **篩選條件**: TLE格式驗證、軌道參數合理性、基本覆蓋檢查
- **輸出**: 經過基礎篩選的衛星池

**1.4 完整SGP4軌道計算與時間序列生成**
- **目的**: 使用完整SGP4算法計算精確軌道和時間序列數據
- **算法**: 完整SGP4（非簡化版本）
- **輸出**: 包含完整軌道時間序列的衛星數據

#### 📊 實際處理數量 (2025-08-10 最新驗證)

```
全量 TLE 數據處理:
├── Starlink: 8,064 顆衛星 (來自 starlink_20250809.tle)
├── OneWeb: 651 顆衛星 (來自 oneweb_20250809.tle)  
└── 總計: 8,715 顆衛星

處理策略: 無篩選全量載入
├── ✅ 載入所有格式正確的 TLE 記錄
├── ✅ 包含活躍、測試、備用衛星
├── ✅ 僅跳過格式錯誤或損壞的記錄
└── ✅ 確保不遺漏任何潛在候選衛星
```

#### 🔍 為什麼需要全量處理？
1. **軌道不可預測性**：僅從 TLE 原始數據無法直接判斷衛星是否會出現在特定觀測點上空
2. **動態軌道特性**：衛星軌道隨時間變化，需要完整時間序列計算才能確定可見性
3. **避免遺漏候選**：預篩選可能錯過重要的換手候選衛星
4. **統一精度基準**：為後續地理篩選提供一致的高精度軌道數據

#### 計算特性
- **精度等級**: 米級位置精度（完整 SGP4 算法）
- **考慮因素**: 地球扁率、大氣阻力、重力場攝動
- **適用範圍**: LEO 衛星 (200-2000km 高度)
- **建構時計算**: 完整數據預計算（2-5 分鐘）
- **啟動時驗證**: 純數據完整性檢查（毫秒級）
- **Cron 更新**: 智能增量處理（每6小時，按需執行）

### 🔧 階段二：3GPP Events & 信號品質計算
**核心目的**：為所有衛星計算信號品質參數，支援 3GPP NTN 標準的 A4/A5/D2 換手事件

**處理範圍**：
- 星座分離處理（Starlink/OneWeb 獨立建模）
- RSRP/RSRQ/SINR 實時計算
- A4/A5/D2 事件參數預計算

### 🎯 階段三：智能衛星篩選
**核心目的**：基於實際可見性和換手需求進行動態篩選

**處理策略**：
- 星座完全分離處理
- 地理相關性篩選（NTPU 觀測點）
- 換手適用性動態評分

### 📊 階段四：時間序列預處理
**核心目的**：生成完整的時間序列數據供前端動畫使用

**處理設定**：
- 時間範圍：120 分鐘
- 採樣間隔：30 秒
- 總時間點：240 個

### 📁 階段五：最終輸出格式與存儲策略
**核心目的**：實現 PostgreSQL + Volume 混合存儲策略

**存儲分工**：
- PostgreSQL：結構化數據和快速查詢
- Docker Volume：大容量時間序列數據和緩存

## 🔍 核心設計原則

### 為什麼採用 Pure Cron 驅動？
1. **穩定性優先**：100% 場景實現 < 30秒穩定啟動
2. **真實數據保證**：完整 SGP4 算法，絕不使用簡化算法
3. **零維護運行**：Cron 全自動調度，完全無感更新
4. **開發友善**：純載入模式，極速開發測試迭代

### 完整軌道週期分析突破
- **動態平衡設計**：確保任何時刻都有足夠換手候選
- **三層衛星架構**：換手區 → 追蹤區 → 接近區
- **智能評分機制**：基於參與度、仰角品質、貢獻時間

## 📊 系統性能指標

### 處理規模
- **衛星總數**：8,715 顆（全量真實數據）
- **最終衛星池**：555 Starlink + 134 OneWeb
- **時間序列點**：240 個/衛星（30秒間隔）

### 性能表現
- **建構時間**：2-5 分鐘（首次完整計算）
- **啟動時間**：< 30秒（Pure Cron 穩定保證）
- **API 響應**：< 100ms（衛星位置查詢）
- **算法精度**：米級位置精度，預測準確率 > 94%

## 🔗 相關文檔

- **[技術實現詳細說明](../technical-details/data-processing-implementation.md)** - 程式位置、API參考、維護指令
- **[完整技術規格](../satellite_data_preprocessing.md)** - 原始完整文檔
- **[系統架構](../system_architecture.md)** - 容器配置和服務交互

---

**本概述提供數據預處理系統的整體理解，具體實現細節請參考技術文檔。**