# ğŸ”„ NTN Stack æ•¸æ“šè™•ç†æµç¨‹

**ç‰ˆæœ¬**: 4.0.0 (å¯¦ç¾èˆ‡æ–‡æª”åŒæ­¥ç‰ˆ)  
**æ›´æ–°æ—¥æœŸ**: 2025-08-28  
**å°ˆæ¡ˆç‹€æ…‹**: âœ… ç”Ÿç”¢å°±ç·’ + å®Œå…¨åæ˜ çœŸå¯¦æ¶æ§‹  
**é©ç”¨æ–¼**: LEO è¡›æ˜Ÿåˆ‡æ›ç ”ç©¶ - å…­éšæ®µå®Œæ•´ç‰ˆ + æœ¬åœ°æ•¸æ“šæ¶æ§‹

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æª”è©³ç´°èªªæ˜ **æœ¬åœ°æ•¸æ“šé©…å‹•æ¶æ§‹** çš„å®Œæ•´æ•¸æ“šé è™•ç†æµç¨‹ï¼šç³»çµ±ä½¿ç”¨æœ¬åœ°TLEæ•¸æ“šï¼Œé€šéæ··åˆåŸ·è¡Œæ¨¡å¼ï¼ˆå»ºæ§‹æ™‚é è™•ç† + é‹è¡Œæ™‚æŒ‰éœ€æ›´æ–°ï¼‰ï¼Œå¯¦ç¾é«˜æ€§èƒ½çš„ç ”ç©¶æ•¸æ“šæº–å‚™ã€‚

**é‡è¦æ¾„æ¸…**ï¼š
- âœ… **æœ¬åœ°TLEæ•¸æ“š** - ç³»çµ±ä½¿ç”¨é ä¸‹è¼‰çš„æœ¬åœ°TLEæ–‡ä»¶ï¼Œç„¡ä¾è³´å¤–éƒ¨API  
- âœ… **æ··åˆåŸ·è¡Œæ¨¡å¼** - æ˜ åƒæª”å»ºç«‹æ™‚é è™•ç† + TLEæ›´æ–°æ™‚å¢é‡è™•ç† + æ‰‹å‹•è§¸ç™¼æ”¯æ´
- âœ… **è¨˜æ†¶é«”å„ªå…ˆ** - éšæ®µé–“ä¸»è¦ä½¿ç”¨è¨˜æ†¶é«”å‚³éï¼Œæ–‡ä»¶å­˜å„²ä½œç‚ºå‚™ä»½
- âœ… **å®Œæ•´SGP4ç®—æ³•** - çµ•ä¸ä½¿ç”¨ç°¡åŒ–æˆ–æ¨¡æ“¬æ•¸æ“šï¼Œä¿è­‰å­¸è¡“ç ”ç©¶æº–ç¢ºæ€§

**é‡è¦æ¾„æ¸…**ï¼šç³»çµ±ä½¿ç”¨å®Œæ•´çš„ SGP4 ç®—æ³•ï¼Œçµ•ä¸ä½¿ç”¨ç°¡åŒ–æˆ–æ¨¡æ“¬æ•¸æ“šã€‚æ‰€æœ‰æ¨™è¨˜ç‚º "simplified_for_build" çš„æ–‡ä»¶åƒ…ç‚ºå»ºæ§‹æ™‚çš„å¿«é€Ÿå•Ÿå‹•æ•¸æ“šï¼Œé‹è¡Œæ™‚ä½¿ç”¨ "runtime_precision" æ¨¡å¼ã€‚

**ğŸ“‹ ç›¸é—œæ–‡æª”**ï¼š
- **ç³»çµ±æ¶æ§‹**ï¼š[ç³»çµ±æ¶æ§‹ç¸½è¦½](./system_architecture.md) - Docker é…ç½®å’Œçµ„ä»¶åˆ†å·¥
- **çµ±ä¸€æ¶æ§‹**ï¼š[Shared Core çµ±ä¸€æ¶æ§‹](./shared_core_architecture.md) - çµ±ä¸€ç®¡ç†å™¨å’Œæ€§èƒ½å„ªåŒ–
- **æŠ€è¡“å¯¦ç¾**ï¼š[æŠ€è¡“å¯¦æ–½æŒ‡å—](./technical_guide.md) - éƒ¨ç½²å’Œé–‹ç™¼æŒ‡å—
- **ç®—æ³•ç´°ç¯€**ï¼š[ç®—æ³•å¯¦ç¾æ‰‹å†Š](./algorithms_implementation.md) - SGP4 å’Œæ›æ‰‹ç®—æ³•
- **éšæ®µè©³è§£**ï¼š[stages/](./stages/) - å„éšæ®µæŠ€è¡“å¯¦ç¾ç´°ç¯€

## ğŸš€ æœ¬åœ°æ•¸æ“šé©…å‹•æ¶æ§‹ (v4.0)

### æ ¸å¿ƒç†å¿µ
**æœ¬åœ°TLEæ•¸æ“š + æŒ‰éœ€è™•ç† + è¨˜æ†¶é«”å‚³éï¼Œç¢ºä¿ç ”ç©¶æ•¸æ“šçš„æº–ç¢ºæ€§å’Œå¯é‡ç¾æ€§**

```
ğŸ—ï¸ æœ¬åœ°TLEæº–å‚™       ğŸš€ å…­éšæ®µè™•ç†          ğŸ’¾ æ•¸æ“šè¼¸å‡º           ğŸ§  APIæœå‹™
      â†“                     â†“                    â†“                   â†“
   æ­·å²TLEæ•¸æ“š          æ‰‹å‹•/æŒ‰éœ€åŸ·è¡Œ        çµæ§‹åŒ–è¼¸å‡º         å¿«é€ŸæŸ¥è©¢æœå‹™
      â†“                     â†“                    â†“                   â†“
  /app/tle_data       è¨˜æ†¶é«”+æ–‡ä»¶å„²å­˜       /app/data          PostgreSQLæ•´åˆ
```

### æ¶æ§‹å„ªå‹¢ (v4.0 çœŸå¯¦å¯¦ç¾)
- **ğŸ¯ å­¸è¡“ç ”ç©¶å°å‘** - ä½¿ç”¨çœŸå¯¦æ­·å²TLEæ•¸æ“šï¼Œç¢ºä¿è«–æ–‡æ•¸æ“šå¯ä¿¡åº¦
- **âš¡ é«˜æ€§èƒ½è™•ç†** - è¨˜æ†¶é«”å‚³éé¿å…å¤§æ–‡ä»¶I/Oï¼ŒStageé–“ç›´æ¥æ•¸æ“šæµ
- **ğŸ”„ æŒ‰éœ€åŸ·è¡Œ** - æ‰‹å‹•è§¸ç™¼è™•ç†ï¼Œå®Œå…¨æ§åˆ¶æ•¸æ“šç”Ÿæˆæ™‚æ©Ÿ  
- **ğŸ“ çµ±ä¸€æ•¸æ“šç®¡ç†** - æ‰€æœ‰è¼¸å‡ºé›†ä¸­æ–¼ `/app/data`ï¼Œä¾¿æ–¼ç®¡ç†
- **ğŸ§¹ æ™ºèƒ½æ¸…ç†** - å¯é…ç½®æ–‡ä»¶ä¿ç•™ç­–ç•¥ï¼Œé¿å…æ•¸æ“šç´¯ç©
- **ğŸ”§ çµ±ä¸€æœå‹™æ¶æ§‹** - shared_core ä¿è­‰è·¨éšæ®µä¸€è‡´æ€§

## ğŸ§¹ æ•¸æ“šæ¸…ç†æ©Ÿåˆ¶ (v4.1 æ–°å¢)

### æ¸…ç†æ™‚æ©Ÿèˆ‡ç­–ç•¥
ç³»çµ±åœ¨ä»¥ä¸‹æ™‚æ©Ÿæœƒè‡ªå‹•æ¸…ç†èˆŠçš„å…­éšæ®µé è™•ç†æª”æ¡ˆï¼š

1. **å»ºæ§‹æ™‚æ¸…ç†** (`build-time-entrypoint.sh`)
   - åœ¨ Docker æ˜ åƒæª”å»ºæ§‹æ™‚ï¼ŒåŸ·è¡Œå…­éšæ®µè™•ç†å‰å…ˆæ¸…ç†æ‰€æœ‰èˆŠæª”æ¡ˆ
   - ç¢ºä¿æ¯æ¬¡å»ºæ§‹éƒ½å¾ä¹¾æ·¨ç‹€æ…‹é–‹å§‹

2. **é‹è¡Œæ™‚ç·Šæ€¥æ¸…ç†** (`runtime-entrypoint.sh`)
   - ç•¶éœ€è¦ç·Šæ€¥é‡æ–°ç”Ÿæˆæ•¸æ“šæ™‚ï¼Œå…ˆæ¸…ç†æ‰€æœ‰èˆŠæª”æ¡ˆ
   - é¿å…æ–°èˆŠæ•¸æ“šæ··æ·†æˆ–è¡çª

3. **æ‰‹å‹•æ¸…ç†è…³æœ¬** (`clean_and_run_six_stages.sh`)
   - æä¾›æ‰‹å‹•æ¸…ç†ä¸¦é‡æ–°åŸ·è¡Œçš„é¸é …
   - ç”¨æ–¼é–‹ç™¼æ¸¬è©¦æˆ–å•é¡Œæ’æŸ¥

### æ¸…ç†ç›®æ¨™
ä»¥ä¸‹ç›®éŒ„å’Œæª”æ¡ˆæœƒè¢«æ¸…ç†ï¼š
- `/app/data/tle_calculation_outputs/`
- `/app/data/orbital_calculation_outputs/`
- `/app/data/intelligent_filtering_outputs/`
- `/app/data/signal_analysis_outputs/`
- `/app/data/timeseries_preprocessing_outputs/`
- `/app/data/data_integration_outputs/`
- `/app/data/dynamic_pool_planning_outputs/`
- `/app/data/signal_cache/`
- `/app/data/data_integration_output.json`
- `/app/data/leo_optimization_final_report.json`

### æ³¨æ„äº‹é …
- âš ï¸ **Volume æŒä¹…åŒ–**ï¼šä½¿ç”¨ bind mount çš„æ•¸æ“šæœƒåœ¨å®¹å™¨é‡å»ºå¾Œä¿ç•™
- âš ï¸ **æ™‚æ•ˆæ€§æª¢æŸ¥**ï¼šç³»çµ±æ‡‰æª¢æŸ¥æª”æ¡ˆæ™‚é–“æˆ³ï¼Œé¿å…ä½¿ç”¨éæ™‚æ•¸æ“š
- âœ… **å®Œæ•´æ¸…ç†**ï¼šç¢ºä¿æ‰€æœ‰éšæ®µçš„è¼¸å‡ºéƒ½è¢«æ¸…ç†ï¼Œé¿å…ç‰ˆæœ¬ä¸ä¸€è‡´

## ğŸ”„ å…­éšæ®µæ•¸æ“šè™•ç†æµç¨‹

### ğŸ¯ v3.1 æ•¸æ“šè¡€çµ±è¿½è¹¤æ›´æ–°

**é‡è¦ä¿®å¾©**ï¼šè§£æ±ºæ•¸æ“šè¡€çµ±è¿½è¹¤å•é¡Œï¼Œç¢ºä¿æ•¸æ“šæ™‚é–“æˆ³çš„æº–ç¢ºæ€§

- **å•é¡Œ**ï¼šä¹‹å‰ç³»çµ±è¨˜éŒ„è™•ç†åŸ·è¡Œæ™‚é–“è€Œéå¯¦éš›TLEæ•¸æ“šæ™‚é–“
- **ä¿®å¾©**ï¼šæ˜ç¢ºåˆ†é›¢TLEæ•¸æ“šæ—¥æœŸèˆ‡è™•ç†æ™‚é–“æˆ³  
- **å½±éŸ¿**ï¼šStage 1 è¼¸å‡ºç¾åœ¨åŒ…å«å®Œæ•´çš„æ•¸æ“šè¡€çµ±ä¿¡æ¯
- **æ¨™æº–**ï¼šç¬¦åˆæ•¸æ“šæ²»ç†å’Œè¡€çµ±ç®¡ç†æœ€ä½³å¯¦è¸

**ä¿®å¾©å…§å®¹**ï¼š
```python
# ä¿®å¾©å‰ï¼ˆå•é¡Œï¼‰
processing_timestamp: "2025-08-21T10:30:00Z"  # è™•ç†åŸ·è¡Œæ™‚é–“

# ä¿®å¾©å¾Œï¼ˆæ­£ç¢ºï¼‰
data_lineage: {
    "tle_dates": {"starlink": "20250820", "oneweb": "20250820"},    # å¯¦éš›æ•¸æ“šæ—¥æœŸ
    "processing_execution_time": "2025-08-21T10:30:00Z",           # è™•ç†åŸ·è¡Œæ™‚é–“
    "calculation_base_time": "2025-08-20T12:00:00Z"                # SGP4è¨ˆç®—åŸºæº–æ™‚é–“
}
```

### å¯¦éš›åŸ·è¡Œæ¨¡å¼
**æ‰‹å‹•åŸ·è¡Œ**ï¼š
```bash
# åœ¨å®¹å™¨å…§åŸ·è¡Œå®Œæ•´å…­éšæ®µ
docker exec netstack-api python /app/scripts/run_six_stages.py

# æˆ–ä½¿ç”¨Dockerå»ºæ§‹æ™‚åŸ·è¡Œ
RUN python /app/scripts/run_six_stages.py
```

### å®Œæ•´æ•¸æ“šæµå‘åœ–
```
ğŸ“ æœ¬åœ°TLEæ•¸æ“šæºï¼š
/app/tle_data/starlink/tle/*.tle â†’ Stage 1 TLEè¼‰å…¥èˆ‡SGP4è¨ˆç®—
/app/tle_data/oneweb/tle/*.tle   â†’ å®Œæ•´è»Œé“æ•¸æ“šç”Ÿæˆ

ğŸ“Š å…­éšæ®µè¨˜æ†¶é«”è™•ç†éˆï¼š
Stage 1 (TLE+SGP4) â†’ Stage 2 (æ™ºèƒ½ç¯©é¸) â†’ Stage 3 (ä¿¡è™Ÿåˆ†æ) 
     â†“                    â†“                     â†“
Stage 4 (æ™‚åºé è™•ç†) â†’ Stage 5 (æ•¸æ“šæ•´åˆ) â†’ Stage 6 (å‹•æ…‹æ± è¦åŠƒ)

ğŸ’¾ çµæ§‹åŒ–è¼¸å‡ºå­˜å„²ï¼š
/app/data/tle_calculation_outputs/     â† Stage 1 å‚™ä»½è¼¸å‡º
/app/data/intelligent_filtering_outputs/ â† Stage 2 ç¯©é¸çµæœ  
/app/data/signal_analysis_outputs/      â† Stage 3 ä¿¡è™Ÿåˆ†æ
/app/data/timeseries_preprocessing_outputs/ â† Stage 4 å‰ç«¯æ•¸æ“š
/app/data/data_integration_outputs/     â† Stage 5 æ•´åˆæ•¸æ“š
/app/data/dynamic_pool_planning_outputs/ â† Stage 6 æœ€çµ‚æ± è¦åŠƒ
```

### å…­éšæ®µè©³ç´°è™•ç†æµç¨‹

#### **Stage 1: TLE æ•¸æ“šè¼‰å…¥èˆ‡ SGP4 è»Œé“è¨ˆç®—**
**æ•¸æ“šæº**: æœ¬åœ°TLEæ–‡ä»¶ (`/app/tle_data/`)  
**è™•ç†å°è±¡**: 8,779 é¡†è¡›æ˜Ÿ (8,128 Starlink + 651 OneWeb)  
**è™•ç†æ™‚é–“**: ç´„ 2-3 åˆ†é˜  
**è¼¸å‡ºæ¨¡å¼**: è¨˜æ†¶é«”å‚³é + å¯é¸æ–‡ä»¶å‚™ä»½

**å¯¦éš›å¯¦ç¾ä½ç½®**: `/netstack/src/stages/tle_orbital_calculation_processor.py`
```python
class Stage1TLEProcessor:
    def __init__(self, tle_data_dir="/app/tle_data", output_dir="/app/data"):
        self.tle_data_dir = Path(tle_data_dir)    # æœ¬åœ°TLEæ•¸æ“šæº
        self.output_dir = Path(output_dir)        # çµ±ä¸€è¼¸å‡ºç›®éŒ„
```

**æ ¸å¿ƒè™•ç†æµç¨‹**:
```python
def process_tle_orbital_calculation(self):
    # 1. æƒææœ¬åœ°TLEæ–‡ä»¶
    scan_result = self.scan_tle_data() 
    
    # 2. è¼‰å…¥åŸå§‹è¡›æ˜Ÿæ•¸æ“š 
    raw_satellite_data = self.load_raw_satellite_data(scan_result)
    
    # 3. åŸ·è¡Œå®Œæ•´SGP4è»Œé“è¨ˆç®—
    tle_data = self.calculate_all_orbits(raw_satellite_data)
    
    # 4. è¿”å›è¨˜æ†¶é«”æ•¸æ“šçµ¦Stage 2
    return tle_data
```

**æŠ€è¡“ç‰¹è‰²**:
- **å®Œæ•´ SGP4 è»Œé“è¨ˆç®—** - ä½¿ç”¨å®˜æ–¹ SGP4 æ¼”ç®—æ³•ï¼Œéç°¡åŒ–ç‰ˆæœ¬
- **æ™‚é–“è§£æåº¦**: 30 ç§’é–“éš”ï¼Œè¨ˆç®— 6 å°æ™‚å®Œæ•´è»Œé“æ•¸æ“š
- **è¨˜æ†¶é«”å‚³éå„ªå…ˆ** - ç›´æ¥å°‡çµæœå‚³çµ¦Stage 2ï¼Œé¿å…2.2GBå¤§æª”æ¡ˆç”Ÿæˆ

#### **Stage 2: æ™ºèƒ½è¡›æ˜Ÿç¯©é¸**
**è™•ç†å°è±¡**: å¾ 8,779 é¡†ç¯©é¸è‡³ 1,113 é¡†å€™é¸  
**ç¯©é¸ç‡**: 87.3% å¤§å¹…æ¸›å°‘å¾ŒçºŒè¨ˆç®—è² è·  
**è™•ç†æ™‚é–“**: ç´„ 1-2 åˆ†é˜

**å¯¦éš›å¯¦ç¾ä½ç½®**: `/netstack/src/stages/intelligent_satellite_filter_processor.py`
```python
class IntelligentSatelliteFilterProcessor:
    def process_intelligent_filtering(self, stage1_data):
        # æ¥æ”¶Stage 1çš„è¨˜æ†¶é«”æ•¸æ“š
        # åŸ·è¡Œåœ°ç†ç›¸é—œæ€§ç¯©é¸
        # è¿”å›ç¯©é¸å¾Œçš„å€™é¸è¡›æ˜Ÿçµ¦Stage 3
```

**å…­éšæ®µç¯©é¸ç®¡ç·š**:
1. **æ˜Ÿåº§åˆ†é›¢ç¯©é¸** (8,779 â†’ 8,779) - åˆ†é›¢ Starlink å’Œ OneWeb
2. **åœ°ç†ç›¸é—œæ€§ç¯©é¸** (8,779 â†’ 1,113) - åŸºæ–¼ NTPU è§€æ¸¬é»ç¯©é¸
3. **æ›æ‰‹é©ç”¨æ€§è©•åˆ†** (1,113 â†’ 1,113) - è©•ä¼°æ¯é¡†è¡›æ˜Ÿçš„æ›æ‰‹æ½›åŠ›

**å¯¦éš›ç¯©é¸çµæœ**:
- Starlink: 946 é¡† (å¾ 8,128 é¡†ç¯©é¸)
- OneWeb: 167 é¡† (å¾ 651 é¡†ç¯©é¸)
- ç¸½è¨ˆ: 1,113 é¡†è¡›æ˜Ÿä¿ç•™

#### **Stage 3: ä¿¡è™Ÿå“è³ªåˆ†æ**
**è™•ç†å°è±¡**: 1,113 é¡†å€™é¸è¡›æ˜Ÿçš„ä¿¡è™Ÿåˆ†æ  
**è™•ç†æ™‚é–“**: ç´„ 1-2 åˆ†é˜  
**æ ¸å¿ƒæŠ€è¡“**: 3GPP NTN æ¨™æº– A4/A5/D2 äº‹ä»¶å¯¦ç¾

**3GPP äº‹ä»¶åˆ†æ**:
- **Event A4**: é„°è¿‘è¡›æ˜Ÿä¿¡è™Ÿå„ªæ–¼é–€æª» (RSRP > -100 dBm)
- **Event A5**: æœå‹™è¡›æ˜ŸåŠ£åŒ–ä¸”é„°è¿‘è¡›æ˜Ÿè‰¯å¥½
- **Event D2**: åŸºæ–¼è·é›¢çš„æ›æ‰‹è§¸ç™¼

**RSRP è¨ˆç®—å¯¦ç¾**:
```python
def calculate_rsrp_simple(sat):
    # è‡ªç”±ç©ºé–“è·¯å¾‘æè€— (Kué »æ®µ 12 GHz)
    fspl_db = 20 * math.log10(sat.distance_km) + 20 * math.log10(12.0) + 32.45
    elevation_gain = min(sat.elevation_deg / 90.0, 1.0) * 15  # æœ€å¤§15dBå¢ç›Š
    tx_power = 43.0  # 43dBmç™¼å°„åŠŸç‡
    return tx_power - fspl_db + elevation_gain
```

#### **Stage 4: æ™‚é–“åºåˆ—é è™•ç†**
**è™•ç†å°è±¡**: 1,113 é¡†è¡›æ˜Ÿçš„æ™‚é–“åºåˆ—æœ€ä½³åŒ–  
**è¼¸å…¥**: éšæ®µä¸‰ä¿¡è™Ÿå“è³ªæ•¸æ“š (~200MB)  
**è¼¸å‡º**: å‰ç«¯æ™‚é–“åºåˆ—æ•¸æ“š (~60-75MB)

**å‰ç«¯å‹•ç•«éœ€æ±‚**:
- **æ™‚é–“è»¸æ§åˆ¶**: æ”¯æ´ 1x-60x å€é€Ÿæ’­æ”¾
- **è¡›æ˜Ÿè»Œè·¡**: å¹³æ»‘çš„è»Œé“å‹•ç•«è·¯å¾‘
- **ä¿¡è™Ÿè®ŠåŒ–**: å³æ™‚ä¿¡è™Ÿå¼·åº¦è¦–è¦ºåŒ–
- **æ›æ‰‹äº‹ä»¶**: å‹•æ…‹æ›æ‰‹æ±ºç­–å±•ç¤º

**æœ€ä½³åŒ–ç­–ç•¥**:
- **æª”æ¡ˆå¤§å°**: å£“ç¸®è‡³å‰ç«¯å¯æ¥å—ç¯„åœ
- **è¼‰å…¥é€Ÿåº¦**: æ”¯æ´å¿«é€Ÿåˆå§‹åŒ–
- **å‹•ç•«æµæš¢**: 60 FPS æ¸²æŸ“éœ€æ±‚
- **è¨˜æ†¶é«”æ•ˆç‡**: ç€è¦½å™¨è¨˜æ†¶é«”å‹å–„

#### **Stage 5: æ•¸æ“šæ•´åˆè™•ç†** âœ… å·²ä¿®å¾©
**è™•ç†å°è±¡**: è·¨ç³»çµ±æ•¸æ“šæ ¼å¼çµ±ä¸€èˆ‡åˆ†å±¤å¢å¼·  
**è™•ç†æ™‚é–“**: ç´„ 30-60 ç§’  

**æ•´åˆåŠŸèƒ½**:
- **åˆ†å±¤ä»°è§’æ¿¾æ³¢**: 5Â°/10Â°/15Â° ä¸‰å±¤ä»°è§’é–€æª»æ•¸æ“šç”Ÿæˆ
  - elevation_5deg: 399é¡†è¡›æ˜Ÿ (100%ä¿ç•™)
  - elevation_10deg: 351é¡†è¡›æ˜Ÿ (87.9%ä¿ç•™) 
  - elevation_15deg: 277é¡†è¡›æ˜Ÿ (69.4%ä¿ç•™)
- **PostgreSQLæ•´åˆ**: è¡›æ˜Ÿå…ƒæ•¸æ“šã€ä¿¡è™Ÿçµ±è¨ˆã€æ›æ‰‹äº‹ä»¶
- **æ ¼å¼æ¨™æº–åŒ–**: çµ±ä¸€ `position_timeseries` æ•¸æ“šçµæ§‹
- **æ›æ‰‹å ´æ™¯ç”Ÿæˆ**: A4/A5/D2 äº‹ä»¶æ™‚é–“è»¸

#### **Stage 6: å‹•æ…‹æ± è¦åŠƒ (æ™‚é–“åºåˆ—ä¿ç•™ç‰ˆ)**
**è™•ç†å°è±¡**: å¾ 1,113 é¡†å€™é¸ä¸­é¸å‡º 156 é¡†è¡›æ˜Ÿæ±  (120 Starlink + 36 OneWeb)  
**è™•ç†æ™‚é–“**: ç´„ 0.5 ç§’ (å¿«é€Ÿé¸æ“‡ + æ™‚é–“åºåˆ—æ•¸æ“šä¿ç•™)

**æ ¸å¿ƒåŠŸèƒ½**:
- **æ™‚é–“åºåˆ—ä¿ç•™**: ç¢ºä¿æ¯é¡†è¡›æ˜ŸåŒ…å«å®Œæ•´çš„ 192 é»è»Œè·¡æ•¸æ“š
- **æ•¸æ“šå®Œæ•´æ€§**: 30 ç§’é–“éš”çš„é€£çºŒ SGP4 è¨ˆç®—çµæœ
- **å‰ç«¯æ”¯æŒ**: è§£æ±ºè»Œè·¡è·³èºå•é¡Œï¼Œæ”¯æŒå¹³æ»‘ 3D å‹•ç•«

**é—œéµå¯¦ç¾**:
```python
# å¯¦éš›å¯¦ç¾ä½ç½®: /netstack/src/stages/enhanced_dynamic_pool_planner.py
@dataclass 
class EnhancedSatelliteCandidate:
    position_timeseries: List[Dict[str, Any]] = None  # ğŸ¯ å®Œæ•´æ™‚é–“åºåˆ—

def convert_to_enhanced_candidates(satellite_data):
    # ä¿ç•™å®Œæ•´çš„æ™‚é–“åºåˆ—æ•¸æ“š
    position_timeseries = sat_data.get('position_timeseries', [])
    # ç¢ºä¿ 192 é»Ã—30 ç§’é–“éš”è»Œè·¡æ•¸æ“šå®Œæ•´æ€§
```

## ğŸ—ƒï¸ æ•¸æ“šå­˜å„²æ¶æ§‹

### æœ¬åœ°TLEæ•¸æ“šæº
**æ•¸æ“šä¾†æº**: é ä¸‹è¼‰çš„æ­·å²TLEæ•¸æ“š  
**æ›´æ–°æ–¹å¼**: æ‰‹å‹•æ›´æ–°æœ¬åœ°TLEæ–‡ä»¶  
**æ˜Ÿåº§è¦†è“‹**:

```
ğŸ“ /app/tle_data/ (å®¹å™¨å…§è·¯å¾‘)
â”œâ”€â”€ starlink/
â”‚   â”œâ”€â”€ tle/starlink_20250805.tle    # æ­·å²TLEæ•¸æ“š (8,128é¡†)
â”‚   â””â”€â”€ json/starlink.json           # çµæ§‹åŒ–æ•¸æ“š
â””â”€â”€ oneweb/
    â”œâ”€â”€ tle/oneweb_20250805.tle      # æ­·å²TLEæ•¸æ“š (651é¡†)  
    â””â”€â”€ json/oneweb.json
```

### å…­éšæ®µè¼¸å‡ºæ•¸æ“šçµæ§‹
```
ğŸ“ /app/data/ (çµ±ä¸€æ•¸æ“šè¼¸å‡ºç›®éŒ„)
â”œâ”€â”€ tle_calculation_outputs/         # Stage 1: SGP4è»Œé“è¨ˆç®—çµæœ
â”‚   â””â”€â”€ tle_orbital_calculation_output.json  # å®Œæ•´è»Œé“æ•¸æ“š (å¯é”2.3GB)
â”œâ”€â”€ intelligent_filtering_outputs/   # Stage 2: 1,113é¡†ç¯©é¸å€™é¸
â”‚   â””â”€â”€ intelligent_filtered_output.json
â”œâ”€â”€ signal_analysis_outputs/         # Stage 3: 3GPPäº‹ä»¶åˆ†æ
â”‚   â””â”€â”€ signal_event_analysis_output.json  
â”œâ”€â”€ timeseries_preprocessing_outputs/ # Stage 4: å‰ç«¯å‹•ç•«æ•¸æ“š (~60MB)
â”‚   â”œâ”€â”€ starlink_enhanced.json      # Starlinkæ™‚åºæ•¸æ“š
â”‚   â””â”€â”€ oneweb_enhanced.json         # OneWebæ™‚åºæ•¸æ“š
â”œâ”€â”€ data_integration_outputs/        # Stage 5: PostgreSQLæ•´åˆç‹€æ…‹
â”‚   â””â”€â”€ integrated_data_output.json
â””â”€â”€ dynamic_pool_planning_outputs/   # Stage 6: æœ€çµ‚å‹•æ…‹æ± 
    â””â”€â”€ enhanced_dynamic_pools_output.json
```

### Docker Volume æ˜ å°„
```yaml
# docker-compose.yml ä¸­çš„å¯¦éš›æ˜ å°„
volumes:
  - /home/sat/ntn-stack/data:/app/data              # ä¸»è¦è¼¸å‡ºç›®éŒ„
  - /home/sat/ntn-stack/netstack/tle_data:/app/tle_data  # TLEæ•¸æ“šæº
```

### PostgreSQL æ•¸æ“šåº«æ•´åˆ
```sql
-- RL ç ”ç©¶æ•¸æ“šåº« (172.20.0.51:5432/rl_research)
satellite_orbital_cache:    -- è»Œé“è¨ˆç®—ç·©å­˜ (~3MB/é€±)
â”œâ”€â”€ satellite_id           -- è¡›æ˜Ÿè­˜åˆ¥ç¢¼
â”œâ”€â”€ timestamp              -- æ™‚é–“æˆ³ (30ç§’é–“éš”)  
â”œâ”€â”€ latitude, longitude    -- åœ°ç†åº§æ¨™
â”œâ”€â”€ altitude, elevation    -- é«˜åº¦å’Œä»°è§’
â””â”€â”€ distance_km           -- 3Dè·é›¢

satellite_tle_data:        -- TLEåŸå§‹æ•¸æ“šå­˜å„²
â”œâ”€â”€ satellite_id          -- è¡›æ˜Ÿè­˜åˆ¥ç¢¼
â”œâ”€â”€ constellation         -- æ˜Ÿåº§åç¨±
â”œâ”€â”€ tle_line1, tle_line2  -- TLEæ•¸æ“šè¡Œ
â””â”€â”€ epoch_time           -- è»Œé“å…ƒç´ æ™‚é–“
```

## âš¡ æ€§èƒ½æŒ‡æ¨™èˆ‡å„ªåŒ–

### é æœŸæ€§èƒ½æå‡
- **API éŸ¿æ‡‰æ™‚é–“**: å¾ 500-2000ms â†’ 50-100ms
- **è¡›æ˜Ÿæ•¸æ“šé‡**: å¾ 6 é¡†æ¨¡æ“¬ â†’ 6-8 é¡†çœŸå¯¦å¯è¦‹è¡›æ˜Ÿ (ç¬¦åˆ 3GPP NTN æ¨™æº–)
- **æ›æ‰‹å€™é¸**: 3-5 é¡† (ç¬¦åˆçœŸå¯¦å ´æ™¯)
- **æ™‚é–“ç¯„åœ**: æ”¯æ´ 6 å°æ™‚å®Œæ•´æ­·å²æ•¸æ“š
- **å‹•ç•«æµæš¢åº¦**: æ”¯æ´ 1x-60x å€é€Ÿæ’­æ”¾

### è¨˜æ†¶é«”å‚³éå„ªå‹¢
- **é¿å…å¤§æ–‡ä»¶I/O**: Stageé–“ç›´æ¥è¨˜æ†¶é«”æ•¸æ“šæµï¼Œç„¡éœ€å¯«å…¥2.3GBä¸­é–“æ–‡ä»¶
- **è™•ç†é€Ÿåº¦æå‡**: å…­éšæ®µç¸½è™•ç†æ™‚é–“å¾10-15åˆ†é˜å„ªåŒ–è‡³5-8åˆ†é˜
- **å„²å­˜ç©ºé–“ç¯€çœ**: åƒ…åœ¨éœ€è¦æ™‚æ‰ç”Ÿæˆæ–‡ä»¶å‚™ä»½ï¼Œç¯€çœç£ç¢Ÿç©ºé–“

### è³‡æºä½¿ç”¨å„ªåŒ–  
- **è¨˜æ†¶é«”å³°å€¼**: ~4-6GB (è™•ç†8,779é¡†è¡›æ˜Ÿæ™‚)
- **CPU ä½¿ç”¨**: Stage 1 æœ€é«˜ (~80%)ï¼Œå…¶ä»–éšæ®µ <30%
- **ç£ç¢Ÿç©ºé–“**: å®Œæ•´è¼¸å‡ºç´„200-300MB (ä¸å«å¤§å‹å‚™ä»½æ–‡ä»¶)
- **è™•ç†æ™‚é–“**: å®Œæ•´å…­éšæ®µ 5-8åˆ†é˜

### æ€§èƒ½åŸºæº–
```
ğŸš€ æ•¸æ“šè¼‰å…¥æ™‚é–“: < 30 ç§’
âš¡ API æŸ¥è©¢éŸ¿æ‡‰: < 100ms
ğŸ¨ å‰ç«¯çµ„ä»¶è¼‰å…¥: < 2 ç§’
ğŸ¬ å‹•ç•«æµæš¢åº¦: 60 FPS
ğŸ’¾ è¨˜æ†¶é«”ä½¿ç”¨: < 200MB
ğŸ”§ CPU ä½¿ç”¨ç‡: < 50%
```

## ğŸ”§ åŸ·è¡Œå’Œç®¡ç†

### æ‰‹å‹•åŸ·è¡Œå…­éšæ®µ
```bash
# æ–¹æ³• 1: å®¹å™¨å…§ç›´æ¥åŸ·è¡Œ
docker exec netstack-api python /app/scripts/run_six_stages.py

# æ–¹æ³• 2: é€²å…¥å®¹å™¨åŸ·è¡Œ
docker exec -it netstack-api bash
python /app/scripts/run_six_stages.py

# æ–¹æ³• 3: å»ºæ§‹æ™‚åŸ·è¡Œ (åœ¨Dockerfileä¸­)  
RUN python /app/scripts/run_six_stages.py
```

### è¼¸å‡ºé©—è­‰
```bash
# æª¢æŸ¥è¼¸å‡ºæª”æ¡ˆå®Œæ•´æ€§
docker exec netstack-api python /app/scripts/run_six_stages.py --verify-only

# æŸ¥çœ‹è™•ç†çµ±è¨ˆ
ls -lah /home/sat/ntn-stack/data/*/
```

### æ¸…ç†ç­–ç•¥
```bash
# æ¸…ç†æ‰€æœ‰è¼¸å‡º (é‡æ–°é–‹å§‹)
rm -rf /home/sat/ntn-stack/data/*/

# æ¸…ç†å¤§å‹å‚™ä»½æª”æ¡ˆä½†ä¿ç•™å°æ–‡ä»¶  
find /home/sat/ntn-stack/data/ -name "*.json" -size +100M -delete
```

## ğŸ” æ•¸æ“šå“è³ªä¿è­‰

### TLE æ•¸æ“šæ ¼å¼é©—è­‰
```
STARLINK-1008           
1 44714U 19074B   25217.02554568  .00001428  00000+0  11473-3 0  9994
2 44714  53.0544  88.2424 0001286  82.9322 277.1813 15.06399309315962
```

**é©—è­‰é …ç›®**:
- **æ ¼å¼å®Œæ•´æ€§**: TLE æ¨™æº– 69 å­—å…ƒè¡Œæ ¼å¼
- **æ ¡é©—å’Œé©—è­‰**: modulo-10 æ ¡é©—å’Œæ­£ç¢ºæ€§
- **æ•¸å€¼ç¯„åœæª¢æŸ¥**: è»Œé“åƒæ•¸åˆç†æ€§é©—è­‰
- **æ™‚é–“ä¸€è‡´æ€§**: epoch æ™‚é–“èˆ‡ç•¶å‰æ™‚é–“å·®ç•°æª¢æŸ¥

### SGP4 è¨ˆç®—ç²¾åº¦é©—è­‰
- **ä½ç½®ç²¾åº¦**: èˆ‡å®˜æ–¹ SGP4 åƒè€ƒå¯¦ç¾æ¯”è¼ƒèª¤å·® < 1km
- **é€Ÿåº¦ç²¾åº¦**: è»Œé“é€Ÿåº¦è¨ˆç®—èª¤å·® < 0.1 m/s
- **æ™‚é–“ç²¾åº¦**: è»Œé“é æ¸¬æ™‚é–“ç²¾åº¦ < 1 ç§’

## ğŸš¨ ç•°å¸¸è™•ç†èˆ‡å®¹éŒ¯

### å¸¸è¦‹å•é¡Œæ’è§£
1. **TLEæ–‡ä»¶ç¼ºå¤±**: æª¢æŸ¥ `/app/tle_data/` ç›®éŒ„çµæ§‹
2. **è¨˜æ†¶é«”ä¸è¶³**: èª¿æ•´Dockerè¨˜æ†¶é«”é™åˆ¶æˆ–ä½¿ç”¨sample_mode
3. **ç£ç¢Ÿç©ºé–“ä¸è¶³**: æ¸…ç†èˆŠè¼¸å‡ºæ–‡ä»¶æˆ–èª¿æ•´ä¿ç•™ç­–ç•¥
4. **è™•ç†ä¸­æ–·**: å¾ä¸­æ–·çš„Stageç¹¼çºŒï¼Œåˆ©ç”¨å·²æœ‰çš„ä¸­é–“çµæœ

### æ•¸æ“šå®Œæ•´æ€§é©—è­‰
```python
# æ¯å€‹Stageéƒ½åŒ…å«å®Œæ•´æ€§æª¢æŸ¥
def verify_stage_output(stage_data):
    if not stage_data or 'metadata' not in stage_data:
        raise ValueError("Stageæ•¸æ“šä¸å®Œæ•´")
    
    total_satellites = stage_data['metadata']['total_satellites'] 
    if total_satellites == 0:
        raise ValueError("æœªè™•ç†ä»»ä½•è¡›æ˜Ÿæ•¸æ“š")
```

### å®¹éŒ¯è¨­è¨ˆåŸå‰‡
1. **graceful degradation** - éƒ¨åˆ†å¤±æ•—ä¸å½±éŸ¿æ•´é«”ç³»çµ±
2. **automatic retry** - è‡ªå‹•é‡è©¦æ©Ÿåˆ¶ (æŒ‡æ•¸é€€é¿)
3. **fallback mechanism** - å¤±æ•—æ™‚ä½¿ç”¨ç·©å­˜æ•¸æ“š
4. **health monitoring** - æŒçºŒå¥åº·ç‹€æ…‹ç›£æ§

## ğŸ”® æœªä¾†æ“´å±•è¦åŠƒ

### æ¶æ§‹å„ªåŒ–æ–¹å‘
1. **åˆ†æ•£å¼è™•ç†**: æ”¯æ´å¤šå®¹å™¨ä¸¦è¡Œè™•ç†ä¸åŒæ˜Ÿåº§  
2. **å¢é‡æ›´æ–°**: æ™ºèƒ½æª¢æ¸¬TLEè®Šæ›´ï¼Œåªé‡æ–°è¨ˆç®—è®Šæ›´éƒ¨åˆ†
3. **å¿«å–å„ªåŒ–**: æ™ºèƒ½å¿«å–ä¸­é–“çµæœï¼Œé¿å…é‡è¤‡è¨ˆç®—
4. **è‡ªå‹•åŒ–æµç¨‹**: å¯é¸çš„Cronèª¿åº¦æ”¯æ´ï¼Œä½†ä¿æŒæ‰‹å‹•å„ªå…ˆ

### ç ”ç©¶åƒ¹å€¼æå‡  
1. **å¤šæ™‚é–“é»æ”¯æ´**: æ”¯æ´ä¸åŒæ­·å²æ™‚é–“é»çš„è»Œé“æ•¸æ“š
2. **ç²¾åº¦æ¯”è¼ƒ**: èˆ‡å®˜æ–¹è»Œé“æ•¸æ“šé€²è¡Œç²¾åº¦é©—è­‰
3. **çµ±è¨ˆåˆ†æ**: å¤§é‡æ­·å²æ•¸æ“šæ”¯æ´çµ±è¨ˆç ”ç©¶
4. **ç®—æ³•é©—è­‰**: çœŸå¯¦å ´æ™¯ä¸‹çš„ handover ç®—æ³•æ¸¬è©¦

## ğŸ¯ æŠ€è¡“è¦æ ¼ç¸½çµ

### æ ¸å¿ƒæŠ€è¡“åƒæ•¸
- **æ•¸æ“šä¾†æº**: æœ¬åœ°æ­·å²TLEæ–‡ä»¶ (CelesTrakåŸå§‹æ•¸æ“š)
- **è™•ç†æ¨¡å¼**: æ‰‹å‹•/æŒ‰éœ€åŸ·è¡Œï¼Œè¨˜æ†¶é«”å„ªå…ˆå‚³é  
- **æ™‚é–“è§£æåº¦**: 30 ç§’é–“éš”
- **è§€æ¸¬ä½ç½®**: å°ç£ NTPU (24.94Â°N, 121.37Â°E)
- **æ”¯æ´æ˜Ÿåº§**: Starlink (8,128é¡†) + OneWeb (651é¡†)
- **æ•¸æ“šå­˜å„²**: çµ±ä¸€æ–¼ `/app/data`ï¼ŒPostgreSQL æ•´åˆ

### æ•¸æ“šè™•ç†çµ±è¨ˆ
```
åŸå§‹æ•¸æ“š:     8,779 é¡†è¡›æ˜Ÿ TLE (æœ¬åœ°æ–‡ä»¶)
Stage 1:      å®Œæ•´ SGP4 è»Œé“è¨ˆç®— (è¨˜æ†¶é«”å‚³é)
Stage 2:      æ™ºèƒ½ç¯©é¸è‡³ 1,113 é¡†å€™é¸ (87.3% æ¸›å°‘)
Stage 3:      3GPP A4/A5/D2 äº‹ä»¶åˆ†æ
Stage 4:      å‰ç«¯å‹•ç•«æ•¸æ“šæœ€ä½³åŒ– (60-75MB)
Stage 5:      è·¨ç³»çµ±æ ¼å¼çµ±ä¸€
Stage 6:      å‹•æ…‹æ± è¦åŠƒ (æœ€çµ‚è¡›æ˜Ÿæ± )
```

---

**é€™å€‹æœ¬åœ°æ•¸æ“šé©…å‹•æ¶æ§‹ç¢ºä¿äº†å­¸è¡“ç ”ç©¶çš„æ•¸æ“šæº–ç¢ºæ€§å’Œå¯é‡ç¾æ€§ï¼Œå®Œå…¨åŸºæ–¼çœŸå¯¦çš„æ­·å²TLEæ•¸æ“šå’Œå®Œæ•´çš„SGP4è¨ˆç®—ï¼**

*æœ€å¾Œæ›´æ–°ï¼š2025-08-28 | æ•¸æ“šè™•ç†æµç¨‹ç‰ˆæœ¬ 4.0.0 (å¯¦ç¾èˆ‡æ–‡æª”åŒæ­¥ç‰ˆ)*