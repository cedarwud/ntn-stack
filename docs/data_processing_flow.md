# ğŸ”„ NTN Stack æ•¸æ“šè™•ç†æµç¨‹

**ç‰ˆæœ¬**: 5.0.0 (çµ±ä¸€è³‡æ–™æ ¼å¼æ¶æ§‹ç‰ˆ)  
**æ›´æ–°æ—¥æœŸ**: 2025-09-09  
**å°ˆæ¡ˆç‹€æ…‹**: âœ… ç”Ÿç”¢å°±ç·’ + çµ±ä¸€è³‡æ–™æ ¼å¼ + å³æ™‚é©—è­‰æ¶æ§‹ + é«˜æ•ˆè™•ç†å„ªåŒ–  
**é©ç”¨æ–¼**: LEO è¡›æ˜Ÿåˆ‡æ›ç ”ç©¶ - çµ±ä¸€è³‡æ–™æ ¼å¼ + å…­éšæ®µå³æ™‚é©—è­‰ + æœ¬åœ°æ•¸æ“šæ¶æ§‹

## ğŸ¯ v5.0 é‡å¤§æ›´æ–°
- **çµ±ä¸€è³‡æ–™æ ¼å¼**: æ¶ˆé™¤é›™é‡å­˜å„²æ¶æ§‹ï¼Œæ–‡ä»¶å¤§å°æ¸›å°‘80% (6.2GBâ†’1.2GB)
- **SimplifiedVisibilityPreFilterä¿®å¾©**: è§£æ±º8837é¡†è¡›æ˜Ÿâ†’0é¡†å¯è¦‹çš„æ•¸æ“šæ ¼å¼é©é…å•é¡Œ  
- **é«˜æ•ˆè™•ç†**: ç§»é™¤æ‰¹æ¬¡è™•ç†éœ€æ±‚ï¼Œç›´æ¥è¨˜æ†¶é«”è™•ç†1.2GBæ•¸æ“š
- **æˆåŠŸçµæœ**: éšæ®µ2ç¾åœ¨æ­£å¸¸è¼¸å‡º3200é¡†å¯è¦‹è¡›æ˜Ÿ (Starlink 3033 + OneWeb 167)

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æª”è©³ç´°èªªæ˜ **æœ¬åœ°æ•¸æ“šé©…å‹•æ¶æ§‹** çš„å®Œæ•´æ•¸æ“šé è™•ç†æµç¨‹ï¼šç³»çµ±ä½¿ç”¨æœ¬åœ°TLEæ•¸æ“šï¼Œé€šéæ··åˆåŸ·è¡Œæ¨¡å¼ï¼ˆå»ºæ§‹æ™‚é è™•ç† + é‹è¡Œæ™‚æŒ‰éœ€æ›´æ–°ï¼‰ï¼Œå¯¦ç¾é«˜æ€§èƒ½çš„ç ”ç©¶æ•¸æ“šæº–å‚™ã€‚

**é‡è¦æ¾„æ¸…**ï¼š
- âœ… **æœ¬åœ°TLEæ•¸æ“š** - ç³»çµ±ä½¿ç”¨é ä¸‹è¼‰çš„æœ¬åœ°TLEæ–‡ä»¶ï¼Œç„¡ä¾è³´å¤–éƒ¨API  
- âœ… **æ··åˆåŸ·è¡Œæ¨¡å¼** - æ˜ åƒæª”å»ºç«‹æ™‚é è™•ç† + TLEæ›´æ–°æ™‚å¢é‡è™•ç† + æ‰‹å‹•è§¸ç™¼æ”¯æ´
- âœ… **è¨˜æ†¶é«”å„ªå…ˆ** - éšæ®µé–“ä¸»è¦ä½¿ç”¨è¨˜æ†¶é«”å‚³éï¼Œæ–‡ä»¶å­˜å„²ä½œç‚ºå‚™ä»½
- âœ… **å®Œæ•´SGP4ç®—æ³•** - çµ•ä¸ä½¿ç”¨ç°¡åŒ–æˆ–æ¨¡æ“¬æ•¸æ“šï¼Œä¿è­‰å­¸è¡“ç ”ç©¶æº–ç¢ºæ€§

**é‡è¦æ¾„æ¸…**ï¼šç³»çµ±ä½¿ç”¨å®Œæ•´çš„ SGP4 ç®—æ³•ï¼Œçµ•ä¸ä½¿ç”¨ç°¡åŒ–æˆ–æ¨¡æ“¬æ•¸æ“šã€‚æ‰€æœ‰æ¨™è¨˜ç‚º "simplified_for_build" çš„æ–‡ä»¶åƒ…ç‚ºå»ºæ§‹æ™‚çš„å¿«é€Ÿå•Ÿå‹•æ•¸æ“šï¼Œé‹è¡Œæ™‚ä½¿ç”¨ "runtime_precision" æ¨¡å¼ã€‚

**ğŸ“‹ ç›¸é—œæ–‡æª”**ï¼š
- **ç³»çµ±æ¶æ§‹**ï¼š[ç³»çµ±æ¶æ§‹ç¸½è¦½](./system_architecture.md) - Docker é…ç½®å’Œçµ„ä»¶åˆ†å·¥
- **çµ±ä¸€æ¶æ§‹**ï¼š[Shared Core çµ±ä¸€æ¶æ§‹](./shared_core_architecture.md) - çµ±ä¸€ç®¡ç†å™¨å’Œæ€§èƒ½å„ªåŒ–
- **æŠ€è¡“å¯¦ç¾**ï¼š[æŠ€è¡“å¯¦æ–½æŒ‡å—](./technical_guide.md) - éƒ¨ç½²å’Œé–‹ç™¼æŒ‡å—
- **ç®—æ³•ç´°ç¯€**ï¼š[ç®—æ³•å¯¦ç¾æ‰‹å†Š](./algorithms_implementation.md) - SGP4 å’Œæ›æ‰‹ç®—æ³•
- **éšæ®µè©³è§£**ï¼š[stages/](./stages/) - å„éšæ®µæŠ€è¡“å¯¦ç¾ç´°ç¯€

## ğŸš€ æœ¬åœ°æ•¸æ“šé©…å‹•æ¶æ§‹ (v4.0)

### æ ¸å¿ƒç†å¿µ
**æœ¬åœ°TLEæ•¸æ“š + æŒ‰éœ€è™•ç† + è¨˜æ†¶é«”å‚³éï¼Œç¢ºä¿ç ”ç©¶æ•¸æ“šçš„æº–ç¢ºæ€§å’Œå¯é‡ç¾æ€§**

```
ğŸ—ï¸ æœ¬åœ°TLEæº–å‚™       ğŸš€ å…­éšæ®µè™•ç†          ğŸ’¾ æ•¸æ“šè¼¸å‡º           ğŸ§  APIæœå‹™
      â†“                     â†“                    â†“                   â†“
   æ­·å²TLEæ•¸æ“š          æ‰‹å‹•/æŒ‰éœ€åŸ·è¡Œ        çµæ§‹åŒ–è¼¸å‡º         å¿«é€ŸæŸ¥è©¢æœå‹™
      â†“                     â†“                    â†“                   â†“
  /app/tle_data       è¨˜æ†¶é«”+æ–‡ä»¶å„²å­˜       /app/data          PostgreSQLæ•´åˆ
```

### æ¶æ§‹å„ªå‹¢ (v4.0 çœŸå¯¦å¯¦ç¾)
- **ğŸ¯ å­¸è¡“ç ”ç©¶å°å‘** - ä½¿ç”¨çœŸå¯¦æ­·å²TLEæ•¸æ“šï¼Œç¢ºä¿è«–æ–‡æ•¸æ“šå¯ä¿¡åº¦
- **âš¡ é«˜æ€§èƒ½è™•ç†** - è¨˜æ†¶é«”å‚³éé¿å…å¤§æ–‡ä»¶I/Oï¼ŒStageé–“ç›´æ¥æ•¸æ“šæµ
- **ğŸ”„ æŒ‰éœ€åŸ·è¡Œ** - æ‰‹å‹•è§¸ç™¼è™•ç†ï¼Œå®Œå…¨æ§åˆ¶æ•¸æ“šç”Ÿæˆæ™‚æ©Ÿ  
- **ğŸ“ çµ±ä¸€æ•¸æ“šç®¡ç†** - æ‰€æœ‰è¼¸å‡ºé›†ä¸­æ–¼ `/app/data`ï¼Œä¾¿æ–¼ç®¡ç†
- **ğŸ§¹ æ™ºèƒ½æ¸…ç†** - å¯é…ç½®æ–‡ä»¶ä¿ç•™ç­–ç•¥ï¼Œé¿å…æ•¸æ“šç´¯ç©
- **ğŸ”§ çµ±ä¸€æœå‹™æ¶æ§‹** - shared_core ä¿è­‰è·¨éšæ®µä¸€è‡´æ€§

## ğŸ§¹ æ•¸æ“šæ¸…ç†æ©Ÿåˆ¶ (v4.1 æ–°å¢)

### æ¸…ç†æ™‚æ©Ÿèˆ‡ç­–ç•¥
ç³»çµ±åœ¨ä»¥ä¸‹æ™‚æ©Ÿæœƒè‡ªå‹•æ¸…ç†èˆŠçš„å…­éšæ®µé è™•ç†æª”æ¡ˆï¼š

1. **å»ºæ§‹æ™‚æ¸…ç†** (`build-time-entrypoint.sh`)
   - åœ¨ Docker æ˜ åƒæª”å»ºæ§‹æ™‚ï¼ŒåŸ·è¡Œå…­éšæ®µè™•ç†å‰å…ˆæ¸…ç†æ‰€æœ‰èˆŠæª”æ¡ˆ
   - ç¢ºä¿æ¯æ¬¡å»ºæ§‹éƒ½å¾ä¹¾æ·¨ç‹€æ…‹é–‹å§‹

2. **é‹è¡Œæ™‚ç·Šæ€¥æ¸…ç†** (`runtime-entrypoint.sh`)
   - ç•¶éœ€è¦ç·Šæ€¥é‡æ–°ç”Ÿæˆæ•¸æ“šæ™‚ï¼Œå…ˆæ¸…ç†æ‰€æœ‰èˆŠæª”æ¡ˆ
   - é¿å…æ–°èˆŠæ•¸æ“šæ··æ·†æˆ–è¡çª

3. **çµ±ä¸€åŸ·è¡Œç¨‹å¼** (`run_six_stages_with_validation.py`)
   - æ”¯æ´å®Œæ•´å…­éšæ®µåŸ·è¡Œå’Œå–®ç¨éšæ®µåŸ·è¡Œ
   - å…§å»ºè‡ªå‹•æ¸…ç†åŠŸèƒ½ï¼Œç”¨æ–¼é–‹ç™¼æ¸¬è©¦æˆ–å•é¡Œæ’æŸ¥
   - ä½¿ç”¨æ–¹å¼: `python run_six_stages_with_validation.py [--stage N]`

### æ¸…ç†ç›®æ¨™
ä»¥ä¸‹ç›®éŒ„å’Œæª”æ¡ˆæœƒè¢«æ¸…ç†ï¼š
- `/app/data/tle_calculation_outputs/`
- `/app/data/orbital_calculation_outputs/`
- `/app/data/intelligent_filtering_outputs/`
- `/app/data/signal_analysis_outputs/`
- `/app/data/timeseries_preprocessing_outputs/`
- `/app/data/data_integration_outputs/`
- `/app/data/enhanced_dynamic_pools_output.json`
- `/app/data/signal_cache/`
- `/app/data/data_integration_output.json`
- `/app/data/leo_optimization_final_report.json`

### æ³¨æ„äº‹é …
- âš ï¸ **Volume æŒä¹…åŒ–**ï¼šä½¿ç”¨ bind mount çš„æ•¸æ“šæœƒåœ¨å®¹å™¨é‡å»ºå¾Œä¿ç•™
- âš ï¸ **æ™‚æ•ˆæ€§æª¢æŸ¥**ï¼šç³»çµ±æ‡‰æª¢æŸ¥æª”æ¡ˆæ™‚é–“æˆ³ï¼Œé¿å…ä½¿ç”¨éæ™‚æ•¸æ“š
- âœ… **å®Œæ•´æ¸…ç†**ï¼šç¢ºä¿æ‰€æœ‰éšæ®µçš„è¼¸å‡ºéƒ½è¢«æ¸…ç†ï¼Œé¿å…ç‰ˆæœ¬ä¸ä¸€è‡´

## ğŸš¨ æ™‚é–“åŸºæº–é—œéµæé†’

**è¡›æ˜Ÿæ¸²æŸ“èˆ‡ç§»å‹•è¨ˆç®—å¿…é ˆä½¿ç”¨TLEæ•¸æ“šæ—¥æœŸä½œç‚ºæ™‚é–“åŸºæº–**

```yaml
âš ï¸ æ¥µå…¶é‡è¦ - æ™‚é–“åŸºæº–åŸå‰‡ï¼š
æ­£ç¢ºåšæ³•ï¼š
  âœ… ä½¿ç”¨ TLE æ–‡ä»¶æ—¥æœŸ (å¦‚: starlink_20250816.tle â†’ åŸºæº–æ™‚é–“: 2025-08-16)
  âœ… ä½¿ç”¨ TLE Epoch æ™‚é–“ä½œç‚ºè»Œé“è¨ˆç®—èµ·é»
  âœ… å‰ç«¯å‹•ç•«åŸºæ–¼ TLE æ•¸æ“šçš„æ™‚é–“æˆ³

éŒ¯èª¤åšæ³•ï¼š
  âŒ ä½¿ç”¨åŸ·è¡Œç¨‹å¼çš„ç•¶ä¸‹æ™‚é–“ (new Date())
  âŒ ä½¿ç”¨é è¨ˆç®—è™•ç†çš„æ™‚é–“æˆ³ (processing_timestamp)
  âŒ ä½¿ç”¨å‰ç«¯ç³»çµ±çš„ç•¶å‰æ™‚é–“ (Date.now())

å½±éŸ¿ç¯„åœï¼š
  - è¡›æ˜Ÿä½ç½®è¨ˆç®— (å¯èƒ½åå·®æ•¸ç™¾å…¬é‡Œ)
  - å¯è¦‹æ€§åˆ¤æ–· (éŒ¯èª¤çš„è¦†è“‹è©•ä¼°)
  - è¦†è“‹ç‡åˆ†æ (ä¸æº–ç¢ºçš„çµ±è¨ˆ)
  - æ›æ‰‹æ±ºç­– (éŒ¯èª¤çš„åˆ‡æ›æ™‚æ©Ÿ)

å¯¦ä½œè¦é»ï¼š
  - å‰ç«¯å¿…é ˆå¾æ•¸æ“šä¸­è®€å– tle_source_date æ¬„ä½
  - å‹•ç•«æ™‚é–“è»¸ä»¥ TLE æ—¥æœŸç‚ºèµ·é»
  - SGP4 è¨ˆç®—ä½¿ç”¨ TLE Epoch ä½œç‚ºåƒè€ƒæ™‚é–“
```

### å‰ç«¯å¯¦ä½œæŒ‡å¼•
```javascript
// satellite_data ä¸­æ‡‰åŒ…å« TLE æ™‚é–“ä¿¡æ¯
const satelliteData = {
  tle_source_date: "20250816",     // TLEæ–‡ä»¶æ—¥æœŸ
  tle_epoch_time: "2025-08-16T12:00:00Z", // TLE Epochæ™‚é–“
  processing_time: "2025-08-21T10:30:00Z", // åƒ…ä¾›åƒè€ƒï¼Œå‹¿ç”¨æ–¼æ¸²æŸ“
  position_timeseries: [...]        // åŸºæ–¼TLEæ™‚é–“çš„è»Œé“æ•¸æ“š
};

// âœ… æ­£ç¢ºï¼šä½¿ç”¨ TLE æ•¸æ“šæ—¥æœŸ
const animationStartTime = new Date(satelliteData.tle_epoch_time);

// âŒ éŒ¯èª¤ï¼šä½¿ç”¨ç•¶å‰æ™‚é–“
const wrongTime = new Date(); // çµ•å°ä¸è¦é€™æ¨£åšï¼
```

## ğŸ”„ å…­éšæ®µæ•¸æ“šè™•ç†æµç¨‹ (v4.1 å³æ™‚é©—è­‰æ¶æ§‹)

### ğŸš¨ v5.0 çµ±ä¸€è³‡æ–™æ ¼å¼æ¶æ§‹é‡å¤§æ›´æ–°

**æ¶æ§‹é©å‘½æ€§æ”¹é€²**ï¼šçµ±ä¸€æ‰€æœ‰éšæ®µçš„è³‡æ–™æ ¼å¼ï¼Œæ¶ˆé™¤é›™é‡å­˜å„²å’Œå†—ä½™çµæ§‹

### ğŸ¯ v5.0 çµ±ä¸€è³‡æ–™æ ¼å¼é‡å¤§æ›´æ–°

**æ ¸å¿ƒå•é¡Œè§£æ±º**ï¼š
- **ç™¼ç¾å•é¡Œ**ï¼šéšæ®µ1è¼¸å‡ºé›™é‡å­˜å„²æ¶æ§‹ (`satellites[]` + `constellations.*`)ï¼Œå°è‡´æ–‡ä»¶å¤§å°å¾é æœŸ1-2GBæ¿€å¢è‡³6.2GB
- **æ ¹æœ¬åŸå› **ï¼šéšæ®µ2-6å¯¦éš›éƒ½éœ€è¦ `constellations` çµæ§‹ï¼Œä¸éœ€è¦ `satellites[]` é™£åˆ—æ ¼å¼
- **è§£æ±ºæ–¹æ¡ˆ**ï¼šçµ±ä¸€ä½¿ç”¨ `UNIFIED_CONSTELLATION_FORMAT`ï¼Œæ¶ˆé™¤é‡è¤‡å­˜å„²

**çµ±ä¸€æ ¼å¼æ¶æ§‹**ï¼š
```json
{
  "metadata": {...},
  "constellations": {
    "starlink": {
      "metadata": {...},
      "satellites": [...]  // çµ±ä¸€ä½¿ç”¨åˆ—è¡¨æ ¼å¼
    },
    "oneweb": {
      "metadata": {...}, 
      "satellites": [...]  // çµ±ä¸€ä½¿ç”¨åˆ—è¡¨æ ¼å¼
    }
  }
}
```

**é æœŸæ•ˆæœ**ï¼š
- **æ–‡ä»¶å¤§å°æ¸›å°‘**: 6.2GB â†’ é æœŸ1.8GB (70%æ¸›å°‘)
- **è™•ç†é€Ÿåº¦æå‡**: æ¶ˆé™¤æ ¼å¼è½‰æ›é–‹éŠ·
- **ç¶­è­·æ€§æ”¹å–„**: å–®ä¸€æ•¸æ“šæ ¼å¼ï¼Œç„¡æ–°èˆŠå…¼å®¹å•é¡Œ

### ğŸš¨ v4.1 å³æ™‚é©—è­‰æ¶æ§‹é‡å¤§æ›´æ–°

**æ¶æ§‹é©å‘½æ€§æ”¹é€²**ï¼šå¯¦ç¾æ¯éšæ®µåŸ·è¡Œå¾Œç«‹å³é©—è­‰ï¼Œé˜²æ­¢ç„¡æ„ç¾©è¨ˆç®—

- **å•é¡Œè­˜åˆ¥**ï¼šä¹‹å‰çš„æ¶æ§‹åœ¨æ‰€æœ‰éšæ®µå®Œæˆå¾Œæ‰é©—è­‰ï¼Œå°è‡´å¤±æ•—çš„ä¸­é–“éšæ®µæœƒç”¢ç”Ÿç„¡æ„ç¾©çš„å¾ŒçºŒè¨ˆç®—
- **è§£æ±ºæ–¹æ¡ˆ**ï¼šæ¯å€‹éšæ®µåŸ·è¡Œå®Œæˆå¾Œç«‹å³é©—è­‰ï¼Œé©—è­‰å¤±æ•—å‰‡åœæ­¢æ‰€æœ‰å¾ŒçºŒè™•ç†
- **æ ¸å¿ƒåƒ¹å€¼**ï¼šé˜²æ­¢åŸºæ–¼éŒ¯èª¤æ•¸æ“šçš„è¨ˆç®—è³‡æºæµªè²»ï¼Œæä¾›å¿«é€Ÿå¤±æ•—æª¢æ¸¬
- **å¯¦ç¾æ–‡ä»¶**ï¼š`/netstack/scripts/run_six_stages_with_validation.py` (å³æ™‚é©—è­‰ç®¡é“)

**å³æ™‚é©—è­‰æµç¨‹åœ–**ï¼š
```
Stage 1 åŸ·è¡Œ â†’ [å³æ™‚é©—è­‰1] â†’ âœ… ç¹¼çºŒ / âŒ åœæ­¢
                    â†“
Stage 2 åŸ·è¡Œ â†’ [å³æ™‚é©—è­‰2] â†’ âœ… ç¹¼çºŒ / âŒ åœæ­¢  
                    â†“
Stage 3 åŸ·è¡Œ â†’ [å³æ™‚é©—è­‰3] â†’ âœ… ç¹¼çºŒ / âŒ åœæ­¢
                    â†“
             ... (ä»¥æ­¤é¡æ¨)
                    â†“
ğŸ¯ é—œéµå„ªå‹¢ï¼šä»»ä½•éšæ®µå¤±æ•— = ç«‹å³åœæ­¢ = é˜²æ­¢ç„¡æ„ç¾©è¨ˆç®—
```

**å¯¦éš›é©—è­‰ç¯„ä¾‹**ï¼š
```bash
# å³æ™‚é©—è­‰ç¯„ä¾‹æ—¥èªŒ
ğŸ” éšæ®µ1ç«‹å³é©—è­‰æª¢æŸ¥...
âœ… éšæ®µ1é©—è­‰é€šé
âœ… éšæ®µ1å“è³ªé©—è­‰é€šé  
âœ… éšæ®µä¸€å®Œæˆä¸¦é©—è­‰é€šé: 8791 é¡†è¡›æ˜Ÿ

ğŸ¯ éšæ®µäºŒï¼šåœ°ç†å¯è¦‹æ€§ç¯©é¸
âŒ éšæ®µäºŒé©—è­‰å¤±æ•—: è·¯å¾‘é…ç½®éŒ¯èª¤
ğŸš« åœæ­¢å¾ŒçºŒéšæ®µè™•ç†ï¼Œé¿å…åŸºæ–¼éŒ¯èª¤æ•¸æ“šçš„ç„¡æ„ç¾©è¨ˆç®—
```

### ğŸ¯ v3.1 æ•¸æ“šè¡€çµ±è¿½è¹¤æ›´æ–°

**é‡è¦ä¿®å¾©**ï¼šè§£æ±ºæ•¸æ“šè¡€çµ±è¿½è¹¤å•é¡Œï¼Œç¢ºä¿æ•¸æ“šæ™‚é–“æˆ³çš„æº–ç¢ºæ€§

- **å•é¡Œ**ï¼šä¹‹å‰ç³»çµ±è¨˜éŒ„è™•ç†åŸ·è¡Œæ™‚é–“è€Œéå¯¦éš›TLEæ•¸æ“šæ™‚é–“
- **ä¿®å¾©**ï¼šæ˜ç¢ºåˆ†é›¢TLEæ•¸æ“šæ—¥æœŸèˆ‡è™•ç†æ™‚é–“æˆ³  
- **å½±éŸ¿**ï¼šStage 1 è¼¸å‡ºç¾åœ¨åŒ…å«å®Œæ•´çš„æ•¸æ“šè¡€çµ±ä¿¡æ¯
- **æ¨™æº–**ï¼šç¬¦åˆæ•¸æ“šæ²»ç†å’Œè¡€çµ±ç®¡ç†æœ€ä½³å¯¦è¸

**ä¿®å¾©å…§å®¹**ï¼š
```python
# ä¿®å¾©å‰ï¼ˆå•é¡Œï¼‰
processing_timestamp: "2025-08-21T10:30:00Z"  # è™•ç†åŸ·è¡Œæ™‚é–“

# ä¿®å¾©å¾Œï¼ˆæ­£ç¢ºï¼‰
data_lineage: {
    "tle_dates": {"starlink": "20250820", "oneweb": "20250820"},    # å¯¦éš›æ•¸æ“šæ—¥æœŸ
    "processing_execution_time": "2025-08-21T10:30:00Z",           # è™•ç†åŸ·è¡Œæ™‚é–“
    "calculation_base_time": "2025-08-20T12:00:00Z"                # SGP4è¨ˆç®—åŸºæº–æ™‚é–“
}
```

### å¯¦éš›åŸ·è¡Œæ¨¡å¼
**æ‰‹å‹•åŸ·è¡Œ**ï¼š
```bash
# åœ¨å®¹å™¨å…§åŸ·è¡Œå®Œæ•´å…­éšæ®µ
docker exec netstack-api python /app/scripts/run_six_stages.py

# æˆ–ä½¿ç”¨Dockerå»ºæ§‹æ™‚åŸ·è¡Œ
RUN python /app/scripts/run_six_stages.py
```

### å®Œæ•´æ•¸æ“šæµå‘åœ–
```
ğŸ“ æœ¬åœ°TLEæ•¸æ“šæºï¼š
/app/tle_data/starlink/tle/*.tle â†’ Stage 1 TLEè¼‰å…¥èˆ‡SGP4è¨ˆç®—
/app/tle_data/oneweb/tle/*.tle   â†’ å®Œæ•´è»Œé“æ•¸æ“šç”Ÿæˆ

ğŸ“Š å…­éšæ®µè¨˜æ†¶é«”è™•ç†éˆï¼š
Stage 1 (TLE+SGP4) â†’ Stage 2 (æ™ºèƒ½ç¯©é¸) â†’ Stage 3 (ä¿¡è™Ÿåˆ†æ) 
     â†“                    â†“                     â†“
Stage 4 (æ™‚åºé è™•ç†) â†’ Stage 5 (æ•¸æ“šæ•´åˆ) â†’ Stage 6 (å‹•æ…‹æ± è¦åŠƒ)

ğŸ’¾ çµ±ä¸€æ ¹ç›®éŒ„è¼¸å‡ºå­˜å„² (v4.1+ æ¶æ§‹)ï¼š
/app/data/tle_orbital_calculation_output.json     â† Stage 1 SGP4è»Œé“è¨ˆç®—
/app/data/satellite_visibility_filtered_output.json â† Stage 2 åœ°ç†å¯è¦‹æ€§ç¯©é¸çµæœ  
/app/data/signal_event_analysis_output.json       â† Stage 3 ä¿¡è™Ÿå“è³ªåˆ†æ
/app/data/enhanced_timeseries_output.json         â† Stage 4 æ™‚é–“åºåˆ—é è™•ç†
/app/data/data_integration_output.json            â† Stage 5 æ•¸æ“šæ•´åˆ
/app/data/enhanced_dynamic_pools_output.json      â† Stage 6 å‹•æ…‹æ± è¦åŠƒ

ğŸ”§ æ¶æ§‹æ›´æ–°: çµ±ä¸€ä½¿ç”¨ /app/data æ ¹ç›®éŒ„ï¼Œå–ä»£å­ç›®éŒ„çµæ§‹
```

### å…­éšæ®µè©³ç´°è™•ç†æµç¨‹

#### **Stage 1: TLE æ•¸æ“šè¼‰å…¥èˆ‡ SGP4 è»Œé“è¨ˆç®—** âœ… v5.0 çµ±ä¸€æ ¼å¼ç‰ˆ
**æ•¸æ“šæº**: æœ¬åœ°TLEæ–‡ä»¶ (`/app/tle_data/`)  
**è™•ç†å°è±¡**: 8,837 é¡†è¡›æ˜Ÿ (8,186 Starlink + 651 OneWeb)  
**è™•ç†æ™‚é–“**: ç´„ 2-3 åˆ†é˜  
**è¼¸å‡ºæ¨¡å¼**: çµ±ä¸€ UNIFIED_CONSTELLATION_FORMAT
**ğŸ”§ v5.0 é‡å¤§æ”¹é€²**: æ¶ˆé™¤é›™é‡å­˜å„²æ¶æ§‹ï¼Œçµ±ä¸€è³‡æ–™æ ¼å¼ï¼Œé æœŸæ¸›å°‘70%æ–‡ä»¶å¤§å°

**å¯¦éš›å¯¦ç¾ä½ç½®**: `/netstack/src/stages/tle_orbital_calculation_processor.py`
```python
class Stage1TLEProcessor:
    def __init__(self, tle_data_dir="/app/tle_data", output_dir="/app/data"):
        self.tle_data_dir = Path(tle_data_dir)    # æœ¬åœ°TLEæ•¸æ“šæº
        self.output_dir = Path(output_dir)        # çµ±ä¸€è¼¸å‡ºç›®éŒ„
```

**æ ¸å¿ƒè™•ç†æµç¨‹**:
```python
def process_tle_orbital_calculation(self):
    # 1. æƒææœ¬åœ°TLEæ–‡ä»¶
    scan_result = self.scan_tle_data() 
    
    # 2. è¼‰å…¥åŸå§‹è¡›æ˜Ÿæ•¸æ“š 
    raw_satellite_data = self.load_raw_satellite_data(scan_result)
    
    # 3. åŸ·è¡Œå®Œæ•´SGP4è»Œé“è¨ˆç®—
    tle_data = self.calculate_all_orbits(raw_satellite_data)
    
    # 4. è¿”å›è¨˜æ†¶é«”æ•¸æ“šçµ¦Stage 2
    return tle_data
```

**æŠ€è¡“ç‰¹è‰²**:
- **å®Œæ•´ SGP4 è»Œé“è¨ˆç®—** - ä½¿ç”¨å®˜æ–¹ SGP4 æ¼”ç®—æ³•ï¼Œéç°¡åŒ–ç‰ˆæœ¬
- **æ™‚é–“è§£æåº¦**: 30 ç§’é–“éš”ï¼Œè¨ˆç®— 96 åˆ†é˜è»Œé“çª—å£ï¼Œç”Ÿæˆ 192 å€‹è»Œé“é»
- **å®Œæ•´æ•¸æ“šçµæ§‹** - æ¯é¡†è¡›æ˜ŸåŒ…å«è»Œé“è¦ç´ ã€æ™‚é–“åºåˆ—ã€å¯è¦‹æ€§åˆ†æã€æ•¸æ“šè¡€çµ±è¿½è¹¤
- **å³æ™‚é©—è­‰** - ValidationSnapshotBase æ¡†æ¶è‡ªå‹•æª¢æŸ¥æ•¸æ“šå®Œæ•´æ€§å’Œè³ªé‡

**å¯¦éš›è¼¸å‡ºæ•¸æ“šçµæ§‹** (ç¶“é©—è­‰ç¢ºèª):
```json
{
  "satellites": [
    {
      "satellite_id": "STARLINK-1008", 
      "norad_id": 44713,
      "orbital_elements": {
        "epoch_year": 25, "epoch_days": 245.21338756,
        "inclination_deg": 53.055, "raan_deg": 312.7245,
        "eccentricity": 0.0001497, "mean_motion_revs_per_day": 15.06406813
      },
      "position_timeseries": [
        {
          "time_index": 0, "utc_time": "2025-09-06T06:45:55.529510+00:00",
          "eci_position_km": [2115.75, 4376.90, 4922.43],
          "geodetic": {"latitude_deg": 45.60, "longitude_deg": -22.44, "altitude_km": 551.12},
          "relative_to_observer": {"elevation_deg": -49.21, "azimuth_deg": 334.96, "is_visible": false}
        }
        // ... å…±192å€‹æ™‚é–“é»
      ],
      "visibility_analysis": {
        "total_points": 192, "visible_points": 45, "visibility_percentage": 23.44,
        "visibility_windows": [...], "orbital_phase_metrics": {...}
      },
      "tle_data": {
        "source_file": "/app/tle_data/starlink/tle/starlink_20250902.tle",
        "constellation": "starlink", "data_lineage": {...}
      }
    }
  ],
  "metadata": {
    "total_satellites": 8791, "processing_timestamp": "2025-09-06T06:49:40.346292+00:00"
  }
}
```

#### **Stage 2: åœ°ç†å¯è¦‹æ€§ç¯©é¸** âœ… v2.0 å¢å¼·é©—è­‰ç‰ˆ
**è™•ç†å°è±¡**: å¾ 8,791 é¡†ç¯©é¸è‡³ ~3,075 é¡†å€™é¸  
**ç¯©é¸ç‡**: ~35.0% ä¿ç•™ç‡ (åŸºæ–¼çœŸå¯¦åœ°ç†å¯è¦‹æ€§æ¢ä»¶)  
**è™•ç†æ™‚é–“**: ç´„ 1-2 åˆ†é˜ (çµ±ä¸€æ ¼å¼é«˜æ•ˆè™•ç†)
**ğŸ”§ v2.0 æ›´æ–°**: ä¿®æ­£é©—è­‰æ¨™æº–ï¼ŒåŸºæ–¼ç‰©ç†æ¢ä»¶çš„è‡ªç„¶ç¯©é¸ï¼Œéç¡¬æ€§æ•¸é‡é™åˆ¶

**å¯¦éš›å¯¦ç¾ä½ç½®**: `/netstack/src/stages/satellite_visibility_filter_processor.py`
```python
class SatelliteVisibilityFilterProcessor:
    def process_intelligent_filtering(self, stage1_data):
        # æ¥æ”¶Stage 1çš„è¨˜æ†¶é«”æ•¸æ“š
        # åŸ·è¡Œè‡ªç„¶åœ°ç†å¯è¦‹æ€§ç¯©é¸ - ç„¡æ•¸é‡é™åˆ¶ï¼Œç´”ç²¹åŸºæ–¼æ¢ä»¶ç¯©é¸
        # è¿”å›ç¯©é¸å¾Œçš„å€™é¸è¡›æ˜Ÿçµ¦Stage 3
```

**è‡ªç„¶ç¯©é¸ç®¡ç·š** (v2.0):
1. **æ˜Ÿåº§åˆ†é›¢ç¯©é¸** (8,791 â†’ 8,791) - åˆ†é›¢ Starlink å’Œ OneWeb
2. **åœ°ç†å¯è¦‹æ€§ç¯©é¸** (8,791 â†’ ~3,075) - åŸºæ–¼ NTPU è§€æ¸¬é»å’Œç‰©ç†æ¢ä»¶
3. **ç‰©ç†æ¢ä»¶é©—è­‰** (~3,075 â†’ ~3,075) - é©—è­‰ä»°è§’é–€æª»å’Œå¯è¦‹æ™‚é–“

**å¯¦éš›ç¯©é¸çµæœ** (v2.0 åŸºæ–¼ç‰©ç†æ¢ä»¶):
- **ç¯©é¸æ¢ä»¶**:
  - Starlink: ä»°è§’ â‰¥5Â°, å¯è¦‹æ™‚é–“ â‰¥1.0åˆ†é˜
  - OneWeb: ä»°è§’ â‰¥10Â°, å¯è¦‹æ™‚é–“ â‰¥0.5åˆ†é˜
- **å¯¦éš›çµæœ**:
  - Starlink: ~2,852 é¡† (åŸºæ–¼5Â°é–€æª»è‡ªç„¶ç¯©é¸)
  - OneWeb: ~223 é¡† (åŸºæ–¼10Â°é–€æª»è‡ªç„¶ç¯©é¸)
  - ç¸½è¨ˆ: ~3,075 é¡†è¡›æ˜Ÿ (35.0% ä¿ç•™ç‡)

**ğŸ¯ é‡è¦èªªæ˜**: æ•¸é‡ç”±ç‰©ç†æ¢ä»¶æ±ºå®šï¼Œä¸æ˜¯ç¡¬æ€§é™åˆ¶ã€‚ä¸åŒTLEæ•¸æ“šæ—¥æœŸå’Œè§€æ¸¬æ¢ä»¶æœƒç”¢ç”Ÿä¸åŒçµæœã€‚

#### **Stage 3: ä¿¡è™Ÿå“è³ªåˆ†æ**
**è™•ç†å°è±¡**: 1,113 é¡†å€™é¸è¡›æ˜Ÿçš„ä¿¡è™Ÿåˆ†æ  
**è™•ç†æ™‚é–“**: ç´„ 1-2 åˆ†é˜  
**æ ¸å¿ƒæŠ€è¡“**: 3GPP NTN æ¨™æº– A4/A5/D2 äº‹ä»¶å¯¦ç¾

**3GPP äº‹ä»¶åˆ†æ**:
- **Event A4**: é„°è¿‘è¡›æ˜Ÿä¿¡è™Ÿå„ªæ–¼é–€æª» (RSRP > -100 dBm)
- **Event A5**: æœå‹™è¡›æ˜ŸåŠ£åŒ–ä¸”é„°è¿‘è¡›æ˜Ÿè‰¯å¥½
- **Event D2**: åŸºæ–¼è·é›¢çš„æ›æ‰‹è§¸ç™¼

**RSRP è¨ˆç®—å¯¦ç¾**:
```python
def calculate_rsrp_simple(sat):
    # è‡ªç”±ç©ºé–“è·¯å¾‘æè€— (Kué »æ®µ 12 GHz)
    fspl_db = 20 * math.log10(sat.distance_km) + 20 * math.log10(12.0) + 32.45
    elevation_gain = min(sat.elevation_deg / 90.0, 1.0) * 15  # æœ€å¤§15dBå¢ç›Š
    tx_power = 43.0  # 43dBmç™¼å°„åŠŸç‡
    return tx_power - fspl_db + elevation_gain
```

#### **Stage 4: æ™‚é–“åºåˆ—é è™•ç†**
**è™•ç†å°è±¡**: 1,113 é¡†è¡›æ˜Ÿçš„æ™‚é–“åºåˆ—æœ€ä½³åŒ–  
**è¼¸å…¥**: éšæ®µä¸‰ä¿¡è™Ÿå“è³ªæ•¸æ“š (~200MB)  
**è¼¸å‡º**: å‰ç«¯æ™‚é–“åºåˆ—æ•¸æ“š (~60-75MB)

**å‰ç«¯å‹•ç•«éœ€æ±‚**:
- **æ™‚é–“è»¸æ§åˆ¶**: æ”¯æ´ 1x-60x å€é€Ÿæ’­æ”¾
- **è¡›æ˜Ÿè»Œè·¡**: å¹³æ»‘çš„è»Œé“å‹•ç•«è·¯å¾‘
- **ä¿¡è™Ÿè®ŠåŒ–**: å³æ™‚ä¿¡è™Ÿå¼·åº¦è¦–è¦ºåŒ–
- **æ›æ‰‹äº‹ä»¶**: å‹•æ…‹æ›æ‰‹æ±ºç­–å±•ç¤º

**æœ€ä½³åŒ–ç­–ç•¥**:
- **æª”æ¡ˆå¤§å°**: å£“ç¸®è‡³å‰ç«¯å¯æ¥å—ç¯„åœ
- **è¼‰å…¥é€Ÿåº¦**: æ”¯æ´å¿«é€Ÿåˆå§‹åŒ–
- **å‹•ç•«æµæš¢**: 60 FPS æ¸²æŸ“éœ€æ±‚
- **è¨˜æ†¶é«”æ•ˆç‡**: ç€è¦½å™¨è¨˜æ†¶é«”å‹å–„

#### **Stage 5: æ•¸æ“šæ•´åˆè™•ç†** âœ… å·²ä¿®å¾©
**è™•ç†å°è±¡**: è·¨ç³»çµ±æ•¸æ“šæ ¼å¼çµ±ä¸€èˆ‡åˆ†å±¤å¢å¼·  
**è™•ç†æ™‚é–“**: ç´„ 30-60 ç§’  

**æ•´åˆåŠŸèƒ½**:
- **åˆ†å±¤ä»°è§’æ¿¾æ³¢**: 5Â°/10Â°/15Â° ä¸‰å±¤ä»°è§’é–€æª»æ•¸æ“šç”Ÿæˆ
  - elevation_5deg: 399é¡†è¡›æ˜Ÿ (100%ä¿ç•™)
  - elevation_10deg: 351é¡†è¡›æ˜Ÿ (87.9%ä¿ç•™) 
  - elevation_15deg: 277é¡†è¡›æ˜Ÿ (69.4%ä¿ç•™)
- **PostgreSQLæ•´åˆ**: è¡›æ˜Ÿå…ƒæ•¸æ“šã€ä¿¡è™Ÿçµ±è¨ˆã€æ›æ‰‹äº‹ä»¶
- **æ ¼å¼æ¨™æº–åŒ–**: çµ±ä¸€ `position_timeseries` æ•¸æ“šçµæ§‹
- **æ›æ‰‹å ´æ™¯ç”Ÿæˆ**: A4/A5/D2 äº‹ä»¶æ™‚é–“è»¸

#### **Stage 6: å‹•æ…‹æ± è¦åŠƒ (æ™‚é–“åºåˆ—ä¿ç•™ç‰ˆ)**
**è™•ç†å°è±¡**: å¾ 1,113 é¡†å€™é¸ä¸­é¸å‡º 156 é¡†è¡›æ˜Ÿæ±  (120 Starlink + 36 OneWeb)  
**è™•ç†æ™‚é–“**: ç´„ 0.5 ç§’ (å¿«é€Ÿé¸æ“‡ + æ™‚é–“åºåˆ—æ•¸æ“šä¿ç•™)

**æ ¸å¿ƒåŠŸèƒ½**:
- **æ™‚é–“åºåˆ—ä¿ç•™**: ç¢ºä¿æ¯é¡†è¡›æ˜ŸåŒ…å«å®Œæ•´çš„ 192 é»è»Œè·¡æ•¸æ“š
- **æ•¸æ“šå®Œæ•´æ€§**: 30 ç§’é–“éš”çš„é€£çºŒ SGP4 è¨ˆç®—çµæœ
- **å‰ç«¯æ”¯æŒ**: è§£æ±ºè»Œè·¡è·³èºå•é¡Œï¼Œæ”¯æŒå¹³æ»‘ 3D å‹•ç•«

**é—œéµå¯¦ç¾**:
```python
# å¯¦éš›å¯¦ç¾ä½ç½®: /netstack/src/stages/enhanced_dynamic_pool_planner.py
@dataclass 
class EnhancedSatelliteCandidate:
    position_timeseries: List[Dict[str, Any]] = None  # ğŸ¯ å®Œæ•´æ™‚é–“åºåˆ—

def convert_to_enhanced_candidates(satellite_data):
    # ä¿ç•™å®Œæ•´çš„æ™‚é–“åºåˆ—æ•¸æ“š
    position_timeseries = sat_data.get('position_timeseries', [])
    # ç¢ºä¿ 192 é»Ã—30 ç§’é–“éš”è»Œè·¡æ•¸æ“šå®Œæ•´æ€§
```

## ğŸ—ƒï¸ æ•¸æ“šå­˜å„²æ¶æ§‹

### æœ¬åœ°TLEæ•¸æ“šæº
**æ•¸æ“šä¾†æº**: é ä¸‹è¼‰çš„æ­·å²TLEæ•¸æ“š  
**æ›´æ–°æ–¹å¼**: æ‰‹å‹•æ›´æ–°æœ¬åœ°TLEæ–‡ä»¶  
**æ˜Ÿåº§è¦†è“‹**:

```
ğŸ“ /app/tle_data/ (å®¹å™¨å…§è·¯å¾‘)
â”œâ”€â”€ starlink/
â”‚   â”œâ”€â”€ tle/starlink_20250805.tle    # æ­·å²TLEæ•¸æ“š (8,128é¡†)
â”‚   â””â”€â”€ json/starlink.json           # çµæ§‹åŒ–æ•¸æ“š
â””â”€â”€ oneweb/
    â”œâ”€â”€ tle/oneweb_20250805.tle      # æ­·å²TLEæ•¸æ“š (651é¡†)  
    â””â”€â”€ json/oneweb.json
```

### å…­éšæ®µè¼¸å‡ºæ•¸æ“šçµæ§‹
```
ğŸ“ /app/data/ (çµ±ä¸€æ•¸æ“šè¼¸å‡ºç›®éŒ„)
â”œâ”€â”€ tle_calculation_outputs/         # Stage 1: SGP4è»Œé“è¨ˆç®—çµæœ
â”‚   â””â”€â”€ tle_orbital_calculation_output.json  # å®Œæ•´è»Œé“æ•¸æ“š (å¯é”2.3GB)
â”œâ”€â”€ intelligent_filtering_outputs/   # Stage 2: 1,113é¡†ç¯©é¸å€™é¸
â”‚   â””â”€â”€ satellite_visibility_filtered_output.json
â”œâ”€â”€ signal_analysis_outputs/         # Stage 3: 3GPPäº‹ä»¶åˆ†æ
â”‚   â””â”€â”€ signal_event_analysis_output.json  
â”œâ”€â”€ timeseries_preprocessing_outputs/ # Stage 4: å‰ç«¯å‹•ç•«æ•¸æ“š (~60MB)
â”‚   â”œâ”€â”€ starlink_enhanced.json      # Starlinkæ™‚åºæ•¸æ“š
â”‚   â””â”€â”€ oneweb_enhanced.json         # OneWebæ™‚åºæ•¸æ“š
â”œâ”€â”€ data_integration_outputs/        # Stage 5: PostgreSQLæ•´åˆç‹€æ…‹
â”‚   â””â”€â”€ integrated_data_output.json
â””â”€â”€ enhanced_dynamic_pools_output.json  # Stage 6: æœ€çµ‚å‹•æ…‹æ± 
```

### Docker Volume æ˜ å°„
```yaml
# docker-compose.yml ä¸­çš„å¯¦éš›æ˜ å°„
volumes:
  - /home/sat/ntn-stack/data:/app/data              # ä¸»è¦è¼¸å‡ºç›®éŒ„
  - /home/sat/ntn-stack/netstack/tle_data:/app/tle_data  # TLEæ•¸æ“šæº
```

### PostgreSQL æ•¸æ“šåº«æ•´åˆ
```sql
-- RL ç ”ç©¶æ•¸æ“šåº« (172.20.0.51:5432/rl_research)
satellite_orbital_cache:    -- è»Œé“è¨ˆç®—ç·©å­˜ (~3MB/é€±)
â”œâ”€â”€ satellite_id           -- è¡›æ˜Ÿè­˜åˆ¥ç¢¼
â”œâ”€â”€ timestamp              -- æ™‚é–“æˆ³ (30ç§’é–“éš”)  
â”œâ”€â”€ latitude, longitude    -- åœ°ç†åº§æ¨™
â”œâ”€â”€ altitude, elevation    -- é«˜åº¦å’Œä»°è§’
â””â”€â”€ distance_km           -- 3Dè·é›¢

satellite_tle_data:        -- TLEåŸå§‹æ•¸æ“šå­˜å„²
â”œâ”€â”€ satellite_id          -- è¡›æ˜Ÿè­˜åˆ¥ç¢¼
â”œâ”€â”€ constellation         -- æ˜Ÿåº§åç¨±
â”œâ”€â”€ tle_line1, tle_line2  -- TLEæ•¸æ“šè¡Œ
â””â”€â”€ epoch_time           -- è»Œé“å…ƒç´ æ™‚é–“
```

## âš¡ æ€§èƒ½æŒ‡æ¨™èˆ‡å„ªåŒ–

### é æœŸæ€§èƒ½æå‡
- **API éŸ¿æ‡‰æ™‚é–“**: å¾ 500-2000ms â†’ 50-100ms
- **è¡›æ˜Ÿæ•¸æ“šé‡**: å¾ 6 é¡†æ¨¡æ“¬ â†’ 6-8 é¡†çœŸå¯¦å¯è¦‹è¡›æ˜Ÿ (ç¬¦åˆ 3GPP NTN æ¨™æº–)
- **æ›æ‰‹å€™é¸**: 3-5 é¡† (ç¬¦åˆçœŸå¯¦å ´æ™¯)
- **æ™‚é–“ç¯„åœ**: æ”¯æ´ 6 å°æ™‚å®Œæ•´æ­·å²æ•¸æ“š
- **å‹•ç•«æµæš¢åº¦**: æ”¯æ´ 1x-60x å€é€Ÿæ’­æ”¾

### è¨˜æ†¶é«”å‚³éå„ªå‹¢
- **é¿å…å¤§æ–‡ä»¶I/O**: Stageé–“ç›´æ¥è¨˜æ†¶é«”æ•¸æ“šæµï¼Œç„¡éœ€å¯«å…¥2.3GBä¸­é–“æ–‡ä»¶
- **è™•ç†é€Ÿåº¦æå‡**: å…­éšæ®µç¸½è™•ç†æ™‚é–“å¾10-15åˆ†é˜å„ªåŒ–è‡³5-8åˆ†é˜
- **å„²å­˜ç©ºé–“ç¯€çœ**: åƒ…åœ¨éœ€è¦æ™‚æ‰ç”Ÿæˆæ–‡ä»¶å‚™ä»½ï¼Œç¯€çœç£ç¢Ÿç©ºé–“

### è³‡æºä½¿ç”¨å„ªåŒ–  
- **è¨˜æ†¶é«”å³°å€¼**: ~4-6GB (è™•ç†8,779é¡†è¡›æ˜Ÿæ™‚)
- **CPU ä½¿ç”¨**: Stage 1 æœ€é«˜ (~80%)ï¼Œå…¶ä»–éšæ®µ <30%
- **ç£ç¢Ÿç©ºé–“**: å®Œæ•´è¼¸å‡ºç´„200-300MB (ä¸å«å¤§å‹å‚™ä»½æ–‡ä»¶)
- **è™•ç†æ™‚é–“**: å®Œæ•´å…­éšæ®µ 5-8åˆ†é˜

### æ€§èƒ½åŸºæº–
```
ğŸš€ æ•¸æ“šè¼‰å…¥æ™‚é–“: < 30 ç§’
âš¡ API æŸ¥è©¢éŸ¿æ‡‰: < 100ms
ğŸ¨ å‰ç«¯çµ„ä»¶è¼‰å…¥: < 2 ç§’
ğŸ¬ å‹•ç•«æµæš¢åº¦: 60 FPS
ğŸ’¾ è¨˜æ†¶é«”ä½¿ç”¨: < 200MB
ğŸ”§ CPU ä½¿ç”¨ç‡: < 50%
```

## ğŸ”§ åŸ·è¡Œå’Œç®¡ç†

### æ‰‹å‹•åŸ·è¡Œå…­éšæ®µ

#### â­ æ¨è–¦ï¼šå³æ™‚é©—è­‰æ¨¡å¼ (v4.1)
```bash
# æ–¹æ³• 1: å®¹å™¨å…§åŸ·è¡Œå³æ™‚é©—è­‰ç‰ˆæœ¬ (æ¨è–¦)
docker exec netstack-api python /app/scripts/run_six_stages_with_validation.py

# æ–¹æ³• 2: é€²å…¥å®¹å™¨åŸ·è¡Œ
docker exec -it netstack-api bash
python /app/scripts/run_six_stages_with_validation.py

# æ–¹æ³• 3: å»ºæ§‹æ™‚åŸ·è¡Œ (åœ¨Dockerfileä¸­)  
RUN python /app/scripts/run_six_stages_with_validation.py
```

#### å‚³çµ±æ¨¡å¼ï¼šå®Œæ•´è™•ç†å¾Œé©—è­‰
```bash
# å‚³çµ±æ–¹å¼ï¼šåŸ·è¡Œæ‰€æœ‰éšæ®µå¾Œæ‰é©—è­‰
docker exec netstack-api python /app/scripts/run_six_stages.py

# å¾ŒçºŒé©—è­‰ (å·²æ•´åˆåˆ°ä¸»ç¨‹å¼ä¸­ï¼Œç„¡éœ€é¡å¤–æ­¥é©Ÿ)
# é©—è­‰åŠŸèƒ½å·²å…§å»ºæ–¼ run_six_stages_with_validation.py
```

#### åŸ·è¡Œæ¨¡å¼æ¯”è¼ƒ
| ç‰¹æ€§ | å³æ™‚é©—è­‰æ¨¡å¼ | å‚³çµ±æ¨¡å¼ |
|------|-------------|----------|
| **é©—è­‰æ™‚æ©Ÿ** | æ¯éšæ®µåŸ·è¡Œå¾Œç«‹å³é©—è­‰ | æ‰€æœ‰éšæ®µå®Œæˆå¾Œé©—è­‰ |
| **å¤±æ•—è™•ç†** | ç«‹å³åœæ­¢ï¼Œç¯€çœè³‡æº | ç¹¼çºŒåŸ·è¡Œï¼Œå¯èƒ½æµªè²»è¨ˆç®— |
| **éŒ¯èª¤æª¢æ¸¬** | å¿«é€Ÿæª¢æ¸¬ (<5åˆ†é˜) | å»¶é²æª¢æ¸¬ (20-30åˆ†é˜) |
| **è³‡æºæ•ˆç‡** | é«˜æ•ˆï¼Œé¿å…ç„¡æ„ç¾©è¨ˆç®— | ä½æ•ˆï¼Œå¯èƒ½é‡è¤‡è¨ˆç®— |
| **æ¨è–¦åº¦** | âœ… **å¼·çƒˆæ¨è–¦** | âš ï¸ åƒ…ä¾›ç›¸å®¹æ€§ |

### è¼¸å‡ºé©—è­‰
```bash
# æª¢æŸ¥è¼¸å‡ºæª”æ¡ˆå®Œæ•´æ€§
docker exec netstack-api python /app/scripts/run_six_stages.py --verify-only

# æŸ¥çœ‹è™•ç†çµ±è¨ˆ
ls -lah /home/sat/ntn-stack/data/*/
```

### æ¸…ç†ç­–ç•¥
```bash
# æ¸…ç†æ‰€æœ‰è¼¸å‡º (é‡æ–°é–‹å§‹)
rm -rf /home/sat/ntn-stack/data/*/

# æ¸…ç†å¤§å‹å‚™ä»½æª”æ¡ˆä½†ä¿ç•™å°æ–‡ä»¶  
find /home/sat/ntn-stack/data/ -name "*.json" -size +100M -delete
```

## ğŸ” æ•¸æ“šå“è³ªä¿è­‰

### TLE æ•¸æ“šæ ¼å¼é©—è­‰
```
STARLINK-1008           
1 44714U 19074B   25217.02554568  .00001428  00000+0  11473-3 0  9994
2 44714  53.0544  88.2424 0001286  82.9322 277.1813 15.06399309315962
```

**é©—è­‰é …ç›®**:
- **æ ¼å¼å®Œæ•´æ€§**: TLE æ¨™æº– 69 å­—å…ƒè¡Œæ ¼å¼
- **æ ¡é©—å’Œé©—è­‰**: modulo-10 æ ¡é©—å’Œæ­£ç¢ºæ€§
- **æ•¸å€¼ç¯„åœæª¢æŸ¥**: è»Œé“åƒæ•¸åˆç†æ€§é©—è­‰
- **æ™‚é–“ä¸€è‡´æ€§**: epoch æ™‚é–“èˆ‡ç•¶å‰æ™‚é–“å·®ç•°æª¢æŸ¥

### SGP4 è¨ˆç®—ç²¾åº¦é©—è­‰
- **ä½ç½®ç²¾åº¦**: èˆ‡å®˜æ–¹ SGP4 åƒè€ƒå¯¦ç¾æ¯”è¼ƒèª¤å·® < 1km
- **é€Ÿåº¦ç²¾åº¦**: è»Œé“é€Ÿåº¦è¨ˆç®—èª¤å·® < 0.1 m/s
- **æ™‚é–“ç²¾åº¦**: è»Œé“é æ¸¬æ™‚é–“ç²¾åº¦ < 1 ç§’

## ğŸš¨ ç•°å¸¸è™•ç†èˆ‡å®¹éŒ¯

### å¸¸è¦‹å•é¡Œæ’è§£
1. **TLEæ–‡ä»¶ç¼ºå¤±**: æª¢æŸ¥ `/app/tle_data/` ç›®éŒ„çµæ§‹
2. **è¨˜æ†¶é«”ä¸è¶³**: èª¿æ•´Dockerè¨˜æ†¶é«”é™åˆ¶æˆ–ä½¿ç”¨sample_mode
3. **ç£ç¢Ÿç©ºé–“ä¸è¶³**: æ¸…ç†èˆŠè¼¸å‡ºæ–‡ä»¶æˆ–èª¿æ•´ä¿ç•™ç­–ç•¥
4. **è™•ç†ä¸­æ–·**: å¾ä¸­æ–·çš„Stageç¹¼çºŒï¼Œåˆ©ç”¨å·²æœ‰çš„ä¸­é–“çµæœ

### æ•¸æ“šå®Œæ•´æ€§é©—è­‰
```python
# æ¯å€‹Stageéƒ½åŒ…å«å®Œæ•´æ€§æª¢æŸ¥
def verify_stage_output(stage_data):
    if not stage_data or 'metadata' not in stage_data:
        raise ValueError("Stageæ•¸æ“šä¸å®Œæ•´")
    
    total_satellites = stage_data['metadata']['total_satellites'] 
    if total_satellites == 0:
        raise ValueError("æœªè™•ç†ä»»ä½•è¡›æ˜Ÿæ•¸æ“š")
```

### å®¹éŒ¯è¨­è¨ˆåŸå‰‡
1. **graceful degradation** - éƒ¨åˆ†å¤±æ•—ä¸å½±éŸ¿æ•´é«”ç³»çµ±
2. **automatic retry** - è‡ªå‹•é‡è©¦æ©Ÿåˆ¶ (æŒ‡æ•¸é€€é¿)
3. **fallback mechanism** - å¤±æ•—æ™‚ä½¿ç”¨ç·©å­˜æ•¸æ“š
4. **health monitoring** - æŒçºŒå¥åº·ç‹€æ…‹ç›£æ§

## ğŸ”® æœªä¾†æ“´å±•è¦åŠƒ

### æ¶æ§‹å„ªåŒ–æ–¹å‘
1. **åˆ†æ•£å¼è™•ç†**: æ”¯æ´å¤šå®¹å™¨ä¸¦è¡Œè™•ç†ä¸åŒæ˜Ÿåº§  
2. **å¢é‡æ›´æ–°**: æ™ºèƒ½æª¢æ¸¬TLEè®Šæ›´ï¼Œåªé‡æ–°è¨ˆç®—è®Šæ›´éƒ¨åˆ†
3. **å¿«å–å„ªåŒ–**: æ™ºèƒ½å¿«å–ä¸­é–“çµæœï¼Œé¿å…é‡è¤‡è¨ˆç®—
4. **è‡ªå‹•åŒ–æµç¨‹**: å¯é¸çš„Cronèª¿åº¦æ”¯æ´ï¼Œä½†ä¿æŒæ‰‹å‹•å„ªå…ˆ

### ç ”ç©¶åƒ¹å€¼æå‡  
1. **å¤šæ™‚é–“é»æ”¯æ´**: æ”¯æ´ä¸åŒæ­·å²æ™‚é–“é»çš„è»Œé“æ•¸æ“š
2. **ç²¾åº¦æ¯”è¼ƒ**: èˆ‡å®˜æ–¹è»Œé“æ•¸æ“šé€²è¡Œç²¾åº¦é©—è­‰
3. **çµ±è¨ˆåˆ†æ**: å¤§é‡æ­·å²æ•¸æ“šæ”¯æ´çµ±è¨ˆç ”ç©¶
4. **ç®—æ³•é©—è­‰**: çœŸå¯¦å ´æ™¯ä¸‹çš„ handover ç®—æ³•æ¸¬è©¦

## ğŸ¯ æŠ€è¡“è¦æ ¼ç¸½çµ

### æ ¸å¿ƒæŠ€è¡“åƒæ•¸
- **æ•¸æ“šä¾†æº**: æœ¬åœ°æ­·å²TLEæ–‡ä»¶ (CelesTrakåŸå§‹æ•¸æ“š)
- **è™•ç†æ¨¡å¼**: æ‰‹å‹•/æŒ‰éœ€åŸ·è¡Œï¼Œè¨˜æ†¶é«”å„ªå…ˆå‚³é  
- **æ™‚é–“è§£æåº¦**: 30 ç§’é–“éš”
- **è§€æ¸¬ä½ç½®**: å°ç£ NTPU (24.94Â°N, 121.37Â°E)
- **æ”¯æ´æ˜Ÿåº§**: Starlink (8,128é¡†) + OneWeb (651é¡†)
- **æ•¸æ“šå­˜å„²**: çµ±ä¸€æ–¼ `/app/data`ï¼ŒPostgreSQL æ•´åˆ

### æ•¸æ“šè™•ç†çµ±è¨ˆ
```
åŸå§‹æ•¸æ“š:     8,779 é¡†è¡›æ˜Ÿ TLE (æœ¬åœ°æ–‡ä»¶)
Stage 1:      å®Œæ•´ SGP4 è»Œé“è¨ˆç®— (è¨˜æ†¶é«”å‚³é)
Stage 2:      æ™ºèƒ½ç¯©é¸è‡³ 1,113 é¡†å€™é¸ (87.3% æ¸›å°‘)
Stage 3:      3GPP A4/A5/D2 äº‹ä»¶åˆ†æ
Stage 4:      å‰ç«¯å‹•ç•«æ•¸æ“šæœ€ä½³åŒ– (60-75MB)
Stage 5:      è·¨ç³»çµ±æ ¼å¼çµ±ä¸€
Stage 6:      å‹•æ…‹æ± è¦åŠƒ (æœ€çµ‚è¡›æ˜Ÿæ± )
```

---

## ğŸ¯ v4.1 å³æ™‚é©—è­‰æ¶æ§‹ç¸½çµ

### é—œéµæ”¹é€²
- **é©å‘½æ€§æ¶æ§‹å‡ç´š**ï¼šå¾ã€Œè™•ç†å¾Œé©—è­‰ã€â†’ã€Œå³æ™‚é©—è­‰ã€  
- **è³‡æºæ•ˆç‡æå‡**ï¼šé˜²æ­¢åŸºæ–¼å¤±æ•—æ•¸æ“šçš„ç„¡æ„ç¾©è¨ˆç®—
- **å¿«é€ŸéŒ¯èª¤æª¢æ¸¬**ï¼šéšæ®µå¤±æ•—ç«‹å³åœæ­¢ï¼Œç¯€çœ20-30åˆ†é˜ç„¡æ•ˆè™•ç†æ™‚é–“
- **ç²¾ç¢ºå¤±æ•—å®šä½**ï¼šæº–ç¢ºè­˜åˆ¥å…·é«”å¤±æ•—éšæ®µï¼Œä¾¿æ–¼èª¿è©¦
- **Dockerå»ºæ§‹æ•´åˆ**ï¼šæ–°çš„å»ºæ§‹è…³æœ¬æ”¯æ´å³æ™‚é©—è­‰æ¨¡å¼

### å¯¦ç¾æª”æ¡ˆ
- **ä¸»ç®¡é“**ï¼š`/netstack/scripts/run_six_stages_with_validation.py`
- **å»ºæ§‹è…³æœ¬**ï¼š`/netstack/scripts/final_build_validation.py` (çµ±ä¸€é©—è­‰)
- **é©—è­‰æ¡†æ¶**ï¼š`ValidationSnapshotBase` çµ±ä¸€é©—è­‰ç³»çµ±

**é€™å€‹æœ¬åœ°æ•¸æ“šé©…å‹•æ¶æ§‹ + å³æ™‚é©—è­‰ç³»çµ±ç¢ºä¿äº†å­¸è¡“ç ”ç©¶çš„æ•¸æ“šæº–ç¢ºæ€§ã€å¯é‡ç¾æ€§å’Œè™•ç†æ•ˆç‡ï¼Œå®Œå…¨åŸºæ–¼çœŸå¯¦çš„æ­·å²TLEæ•¸æ“šå’Œå®Œæ•´çš„SGP4è¨ˆç®—ï¼**

*æœ€å¾Œæ›´æ–°ï¼š2025-09-06 | æ•¸æ“šè™•ç†æµç¨‹ç‰ˆæœ¬ 4.1.0 (å³æ™‚é©—è­‰æ¶æ§‹ç‰ˆ)*