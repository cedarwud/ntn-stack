# 程式碼清除確認機制

## ⚠️ 重要原則
**任何程式碼/檔案的刪除操作都必須先經過用戶確認，絕不自主執行清除動作**

## 🔒 確認流程

### 1. 分析階段 (僅分析，不執行)
```bash
# ✅ 允許的分析操作
- 使用 vulture, pydeps 等工具分析代碼
- 生成依賴關係報告
- 識別潛在的冗余文件
- 計算文件使用頻率
- 檢查導入引用關係
```

### 2. 提案階段 (提供建議，等待確認)
```markdown
## 清除提案 (需用戶確認)

### 建議刪除的文件
- `src/algorithms/access/` (原因: 只有1個文件，建議合併到父目錄)
- `src/services/research/unused_experiment.py` (原因: 零引用，疑似過時實驗)

### 建議合併的文件  
- 將 `src/algorithms/handover/fine_grained_decision.py` 移動到 `src/algorithms/`

### 建議保留的文件
- `src/services/satellite/` (原因: 22個文件，組織良好，核心功能)

### 待確認的文件
- `netstack_api/services/old_service.py` (不確定是否還需要，請用戶確認)
```

### 3. 確認階段 (等待用戶回應)
```bash
用戶需要明確回應:
- ✅ "同意刪除 X 文件"
- ✅ "同意合併 Y 到 Z"  
- ❌ "保留 X 文件"
- ❓ "需要更多資訊關於 X 文件"
```

### 4. 執行階段 (僅執行已確認的操作)
```bash
# ✅ 僅執行用戶明確同意的操作
- 移動/重命名文件 (非破壞性)
- 合併文件內容
- 刪除用戶確認的文件

# ❌ 絕不執行的操作
- 未經確認的刪除
- 批量刪除操作
- 不可逆的修改
```

## 📋 確認檢查清單模板

### 刪除確認清單
```markdown
## 檔案刪除確認

### 檔案資訊
- **檔案路徑**: `src/example/unused_file.py`
- **檔案大小**: 1.2KB
- **最後修改**: 2024-03-15
- **引用次數**: 0
- **相關測試**: 無

### 刪除理由
- [ ] 零引用 (沒有其他文件導入)
- [ ] 功能重複 (與 X 文件功能相同)
- [ ] 過時實驗 (明顯的實驗性代碼)
- [ ] 空文件 (無實際功能)
- [ ] 其他: ___________

### 風險評估
- **刪除風險**: 低/中/高
- **回復難度**: 容易 (Git 歷史可恢復)
- **影響範圍**: 無已知影響

### 確認狀態
- [ ] **用戶已確認同意刪除**
- [ ] **用戶要求保留**
- [ ] **需要更多資訊**
- [ ] **待用戶回應**
```

### 合併確認清單
```markdown
## 檔案合併確認

### 來源檔案
- **路徑**: `src/algorithms/access/fast_access_decision.py`
- **大小**: 44KB
- **功能**: Fast Access 算法實現

### 目標位置
- **新路徑**: `src/algorithms/fast_access_decision.py`
- **理由**: 消除單文件目錄的過度分散

### 影響分析
- **導入路徑變更**: `from src.algorithms.access.fast_access_decision import` → `from src.algorithms.fast_access_decision import`
- **需要更新的文件**: 3 個文件的導入路徑
- **測試影響**: 需要更新測試文件路徑

### 確認狀態
- [ ] **用戶已確認同意合併**
- [ ] **用戶要求保持原結構**
- [ ] **需要更多資訊**
- [ ] **待用戶回應**
```

## 🚨 緊急停止機制

### 如果意外開始刪除操作
```bash
# 立即停止所有操作
echo "⚠️ 檢測到未確認的刪除操作，立即停止！"
echo "❌ 所有檔案修改操作已暫停"
echo "📋 請檢查確認狀態再繼續"

# 檢查 Git 狀態
git status

# 如有誤刪，立即恢復
git checkout HEAD -- <誤刪的文件>
```

## 📊 建議的確認工作流程

### Phase 1 分析: 生成清理建議
1. 執行分析工具
2. 生成潛在清理清單
3. 分類建議 (刪除/合併/重構)
4. 提交給用戶審查

### Phase 2 確認: 等待用戶回應
1. 用戶逐項確認每個建議
2. 記錄用戶的決定
3. 澄清不確定的項目
4. 確認完整的執行清單

### Phase 3 執行: 僅執行已確認項目
1. 依據用戶確認執行操作
2. 每個操作前再次確認
3. 記錄執行過程
4. 提供回滾機制

## 💡 建議的互動範例

### 分析師 (Claude) 提案:
```
🔍 分析完成！發現以下清理機會:

📁 建議合併 (低風險):
- src/algorithms/access/ → src/algorithms/ (消除單文件目錄)
- src/algorithms/handover/ → src/algorithms/

🗑️ 建議刪除 (需確認):
- netstack/old_experiment.py (0 引用，疑似過時)
- src/utils/unused_helper.py (0 引用，8個月未修改)

❓ 需要您的決定:
您是否同意以上的合併和刪除建議？還是需要我提供更多資訊？
```

### 用戶回應範例:
```
✅ 同意合併所有 algorithms 子目錄
❌ 保留 old_experiment.py，可能還會用到
✅ 同意刪除 unused_helper.py
❓ 請提供更多關於 xyz_service.py 的使用情況
```

---

**這個確認機制確保重構過程安全、可控，避免意外刪除重要代碼。每個清除操作都有完整的追蹤和用戶確認記錄。**