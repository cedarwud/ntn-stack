<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡›æ˜Ÿæ¸²æŸ“æ•´åˆæ¸¬è©¦</title>
    <style>
        body { font-family: 'Courier New', monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #0f0; }
        .test-result { margin: 10px 0; padding: 5px; }
        .pass { color: #0f0; }
        .fail { color: #f00; }
        .info { color: #ff0; }
        button { background: #0f0; color: #000; padding: 10px 20px; margin: 5px; border: none; cursor: pointer; }
        button:hover { background: #0a0; }
    </style>
</head>
<body>
    <h1>ğŸ›°ï¸ è¡›æ˜Ÿæ¸²æŸ“æ•´åˆæ¸¬è©¦é¢æ¿</h1>
    
    <div class="test-section">
        <h2>1. API é€£æ¥æ¸¬è©¦</h2>
        <button onclick="testAPI()">æ¸¬è©¦ API</button>
        <div id="api-result"></div>
    </div>

    <div class="test-section">
        <h2>2. è¡›æ˜Ÿæ•¸æ“šæ¸¬è©¦</h2>
        <button onclick="testSatelliteData()">ç²å–è¡›æ˜Ÿæ•¸æ“š</button>
        <div id="satellite-result"></div>
    </div>

    <div class="test-section">
        <h2>3. é€Ÿåº¦æ§åˆ¶æ¸¬è©¦</h2>
        <input type="range" id="speed-slider" min="1" max="60" value="1" step="1">
        <span id="speed-value">1x</span>
        <button onclick="testSpeedControl()">æ‡‰ç”¨é€Ÿåº¦</button>
        <div id="speed-result"></div>
    </div>

    <div class="test-section">
        <h2>4. çœŸå¯¦è»Œè·¡é©—è­‰</h2>
        <button onclick="verifyTrajectory()">é©—è­‰è»Œè·¡æ•¸æ“š</button>
        <div id="trajectory-result"></div>
    </div>

    <script>
        const speedSlider = document.getElementById('speed-slider');
        const speedValue = document.getElementById('speed-value');
        
        speedSlider.oninput = function() {
            speedValue.textContent = this.value + 'x';
        };

        async function testAPI() {
            const result = document.getElementById('api-result');
            result.innerHTML = '<div class="info">æ¸¬è©¦ä¸­...</div>';
            
            try {
                // Test NetStack health
                const netstackResponse = await fetch('/netstack/health');
                const netstackOk = netstackResponse.ok;
                
                // Test SimWorld API
                const simworldResponse = await fetch('/api/v1/satellites/visible_satellites?count=1&min_elevation_deg=5&observer_lat=24.9441667&observer_lon=121.3713889&global_view=false&constellation=starlink');
                const simworldOk = simworldResponse.ok;
                
                result.innerHTML = `
                    <div class="${netstackOk ? 'pass' : 'fail'}">âœ… NetStack API: ${netstackOk ? 'æ­£å¸¸' : 'éŒ¯èª¤'}</div>
                    <div class="${simworldOk ? 'pass' : 'fail'}">âœ… SimWorld API: ${simworldOk ? 'æ­£å¸¸' : 'éŒ¯èª¤'}</div>
                `;
            } catch (error) {
                result.innerHTML = `<div class="fail">âŒ API æ¸¬è©¦å¤±æ•—: ${error.message}</div>`;
            }
        }

        async function testSatelliteData() {
            const result = document.getElementById('satellite-result');
            result.innerHTML = '<div class="info">è¼‰å…¥ä¸­...</div>';
            
            try {
                const response = await fetch('/api/v1/satellites/visible_satellites?count=10&min_elevation_deg=5&observer_lat=24.9441667&observer_lon=121.3713889&global_view=false&constellation=starlink');
                const data = await response.json();
                
                if (data.satellites && data.satellites.length > 0) {
                    const sat = data.satellites[0];
                    result.innerHTML = `
                        <div class="pass">âœ… ç²å– ${data.satellites.length} é¡†è¡›æ˜Ÿ</div>
                        <div class="info">ç¬¬ä¸€é¡†è¡›æ˜Ÿ:</div>
                        <div class="info">- åç¨±: ${sat.name}</div>
                        <div class="info">- ä»°è§’: ${sat.elevation_deg?.toFixed(2)}Â°</div>
                        <div class="info">- æ–¹ä½è§’: ${sat.azimuth_deg?.toFixed(2)}Â°</div>
                        <div class="info">- è·é›¢: ${sat.distance_km?.toFixed(1)} km</div>
                    `;
                } else {
                    result.innerHTML = '<div class="fail">âŒ æ²’æœ‰è¡›æ˜Ÿæ•¸æ“š</div>';
                }
            } catch (error) {
                result.innerHTML = `<div class="fail">âŒ è¼‰å…¥å¤±æ•—: ${error.message}</div>`;
            }
        }

        function testSpeedControl() {
            const speed = speedSlider.value;
            const result = document.getElementById('speed-result');
            
            // æ¨¡æ“¬ç™¼é€é€Ÿåº¦æ›´æ–°åˆ°å‰ç«¯
            result.innerHTML = `
                <div class="pass">âœ… é€Ÿåº¦è¨­å®šç‚º ${speed}x</div>
                <div class="info">é æœŸè¡Œç‚º:</div>
                <div class="info">- è¡›æ˜Ÿç§»å‹•é€Ÿåº¦æ‡‰è©²æ˜¯ ${speed} å€</div>
                <div class="info">- 10åˆ†é˜è»Œè·¡å°‡åœ¨ ${(600/speed).toFixed(1)} ç§’å…§å®Œæˆ</div>
            `;
            
            // å¯¦éš›æ‡‰ç”¨éœ€è¦é€šé WebSocket æˆ–å…¶ä»–æ©Ÿåˆ¶é€šçŸ¥å‰ç«¯
            console.log('Speed updated to:', speed);
        }

        async function verifyTrajectory() {
            const result = document.getElementById('trajectory-result');
            result.innerHTML = '<div class="info">é©—è­‰ä¸­...</div>';
            
            try {
                const response = await fetch('/api/v1/satellites/visible_satellites?count=5&min_elevation_deg=5&observer_lat=24.9441667&observer_lon=121.3713889&global_view=false&constellation=starlink');
                const data = await response.json();
                
                if (data.satellites && data.satellites.length > 0) {
                    let trajectoryInfo = '<div class="pass">âœ… è»Œè·¡æ•¸æ“šé©—è­‰</div>';
                    
                    data.satellites.forEach((sat, index) => {
                        trajectoryInfo += `
                            <div class="info">è¡›æ˜Ÿ ${index + 1} (${sat.name}):</div>
                            <div class="info">- åŸºç¤ä»°è§’: ${sat.elevation_deg?.toFixed(2)}Â°</div>
                            <div class="info">- é æœŸè®ŠåŒ–: Â±8Â° (æ­£å¼¦æ³¢)</div>
                            <div class="info">- æ–¹ä½è§’è®ŠåŒ–: 45Â° (10åˆ†é˜å…§)</div>
                            <div class="info">- è·é›¢æŒ¯ç›ª: Â±50km</div>
                        `;
                    });
                    
                    result.innerHTML = trajectoryInfo;
                } else {
                    result.innerHTML = '<div class="fail">âŒ ç„¡æ³•ç²å–è»Œè·¡æ•¸æ“š</div>';
                }
            } catch (error) {
                result.innerHTML = `<div class="fail">âŒ é©—è­‰å¤±æ•—: ${error.message}</div>`;
            }
        }

        // è‡ªå‹•é‹è¡Œåˆå§‹æ¸¬è©¦
        window.onload = () => {
            console.log('ğŸ›°ï¸ è¡›æ˜Ÿæ¸²æŸ“æ•´åˆæ¸¬è©¦é¢æ¿å·²è¼‰å…¥');
            console.log('è«‹æ‰“é–‹ http://localhost:5173/test-satellite-integration.html æŸ¥çœ‹æ¸¬è©¦çµæœ');
        };
    </script>
</body>
</html>