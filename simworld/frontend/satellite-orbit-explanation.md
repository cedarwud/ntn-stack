# 衛星軌道渲染系統說明

## 🎯 核心挑戰

由於衛星是基於「當前可見」的智能篩選結果，這些衛星在真實世界中的軌道週期和過境時間是不同步的。我們需要在3D視覺化中合理地呈現這些衛星的運動。

## 🛰️ 解決方案

### 1. 智能相位分配系統

根據衛星的當前仰角，推斷其在軌道中的位置：

- **高仰角 (>60°)**: 衛星正在過頂 → 軌道相位 50%
- **中仰角 (30-60°)**: 衛星正在上升或下降 → 軌道相位 30% 或 70%
- **低仰角 (<30°)**: 衛星剛升起或即將落下 → 軌道相位 10% 或 90%

### 2. 真實軌道物理模型

每顆衛星的軌道遵循真實的LEO衛星物理特性：

```javascript
// 軌道特性
- 可見窗口：10分鐘（600秒）
- 仰角變化：-5° → 最高仰角 → -5°
- 方位角變化：90度橫跨天空
- 距離變化：根據仰角動態調整
```

### 3. 軌道週期

- **真實時間 (1x)**: 10分鐘完整軌道
- **10倍速**: 1分鐘看完整軌跡  
- **30倍速**: 20秒看完整軌跡
- **60倍速**: 10秒看完整軌跡

## 📊 實際效果

### 當前可見的10顆衛星示例：

| 衛星名稱 | 當前仰角 | 推斷相位 | 軌道狀態 |
|----------|----------|----------|----------|
| STARLINK-6358 | 72.26° | 50% | 正在過頂 |
| STARLINK-5097 | 64.24° | 50% | 接近過頂 |
| STARLINK-3721 | 60.47° | 50% | 接近過頂 |
| STARLINK-5555 | 45.12° | 30% 或 70% | 上升或下降中 |
| STARLINK-4321 | 28.55° | 10% 或 90% | 剛升起或即將落下 |

## 🎨 視覺呈現

1. **自然分布**: 衛星不會同時出現在同一位置
2. **連續運動**: 每顆衛星沿完整弧線軌道移動
3. **真實感**: 基於實際仰角數據的軌道位置
4. **循環動畫**: 衛星完成軌道後重新開始

## 🔧 技術實現細節

### 初始相位計算
```javascript
let initialPhase = 0 // 軌道相位 (0-1)
if (baseElevation > 60) {
    initialPhase = 0.5  // 高仰角：過頂階段
} else if (baseElevation > 30) {
    initialPhase = i % 2 === 0 ? 0.3 : 0.7  // 中仰角：交替分配
} else {
    initialPhase = i % 2 === 0 ? 0.1 : 0.9  // 低仰角：交替分配
}
```

### 起始時間偏移
```javascript
const startTimeOffset = -initialPhase * visibleDuration
// 讓衛星從正確的軌道位置開始動畫
```

## 💡 優勢

1. **真實性**: 基於真實衛星數據的仰角和位置
2. **視覺效果**: 自然的衛星分布和運動
3. **性能**: 優化的軌跡計算和插值
4. **靈活性**: 支援不同速度倍數的動畫控制

## 🚀 未來改進方向

1. **TLE軌道預測**: 使用SGP4算法計算真實軌道
2. **時間同步**: 基於真實時間戳的衛星位置
3. **換手預測**: 根據軌道預測未來的換手時機
4. **多觀測點**: 支援不同地理位置的觀測視角

---

這個系統在智能篩選的限制下，提供了最接近真實的衛星運動視覺化效果。