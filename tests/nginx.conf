server {
    listen 80;
    server_name localhost;
    
    root /usr/share/nginx/html;
    index index.html index.htm report.html;
    
    # 測試報告主頁
    location / {
        try_files $uri $uri/ /report.html;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
        add_header Expires "0";
    }
    
    # HTML 報告
    location ~* \.html$ {
        add_header Content-Type "text/html; charset=utf-8";
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }
    
    # JSON 報告
    location ~* \.json$ {
        add_header Content-Type "application/json; charset=utf-8";
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }
    
    # XML 報告 (JUnit)
    location ~* \.xml$ {
        add_header Content-Type "application/xml; charset=utf-8";
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }
    
    # 靜態資源
    location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1h;
        add_header Cache-Control "public, immutable";
    }
    
    # API 端點（如果需要）
    location /api/reports {
        alias /usr/share/nginx/html;
        autoindex on;
        autoindex_format json;
    }
    
    # 健康檢查
    location /health {
        access_log off;
        return 200 '{"status":"healthy","service":"test-reporter"}';
        add_header Content-Type application/json;
    }
    
    # 錯誤頁面
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;
    
    location = /404.html {
        internal;
        return 404 '{"error":"報告不存在","message":"請確認測試已執行完成"}';
        add_header Content-Type application/json;
    }
    
    location = /50x.html {
        internal;
        return 500 '{"error":"服務器錯誤","message":"請聯繫管理員"}';
        add_header Content-Type application/json;
    }
} 