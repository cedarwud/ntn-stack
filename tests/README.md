# NTN Stack æ¸¬è©¦å¥—ä»¶

## ğŸ“ ç›®éŒ„çµæ§‹

```
tests/
â”œâ”€â”€ unit/                    # å–®å…ƒæ¸¬è©¦
â”‚   â”œâ”€â”€ netstack/           # NetStack å–®å…ƒæ¸¬è©¦
â”‚   â”œâ”€â”€ simworld/           # SimWorld å–®å…ƒæ¸¬è©¦
â”‚   â””â”€â”€ deployment/         # éƒ¨ç½²æ¨¡çµ„å–®å…ƒæ¸¬è©¦
â”œâ”€â”€ integration/            # æ•´åˆæ¸¬è©¦
â”‚   â”œâ”€â”€ api/               # API æ•´åˆæ¸¬è©¦
â”‚   â””â”€â”€ services/          # æœå‹™æ•´åˆæ¸¬è©¦
â”œâ”€â”€ e2e/                   # ç«¯åˆ°ç«¯æ¸¬è©¦
â”œâ”€â”€ api/                   # API å°ˆé …æ¸¬è©¦
â”œâ”€â”€ performance/           # æ€§èƒ½æ¸¬è©¦
â”œâ”€â”€ reports/               # æ¸¬è©¦å ±å‘Š (è‡ªå‹•ç”Ÿæˆ)
â”‚   â”œâ”€â”€ test_results/      # æ¸¬è©¦çµæœ
â”‚   â””â”€â”€ coverage/          # è¦†è“‹ç‡å ±å‘Š
â”œâ”€â”€ tools/                 # æ¸¬è©¦å·¥å…·
â”œâ”€â”€ configs/               # æ¸¬è©¦é…ç½®
â”œâ”€â”€ pytest.ini            # pytest é…ç½®
â”œâ”€â”€ requirements.txt       # æ¸¬è©¦ä¾è³´
â”œâ”€â”€ run_tests.py          # æ¸¬è©¦åŸ·è¡Œè…³æœ¬
â”œâ”€â”€ Makefile              # æ§‹å»ºé…ç½®
â””â”€â”€ README.md             # æœ¬æª”æ¡ˆ
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### å®‰è£æ¸¬è©¦ä¾è³´

```bash
cd tests
pip install -r requirements.txt
```

### åŸ·è¡Œæ¸¬è©¦

#### ä½¿ç”¨æ¸¬è©¦åŸ·è¡Œè…³æœ¬ï¼ˆæ¨è–¦ï¼‰

```bash
# åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
python run_tests.py

# åŸ·è¡Œç‰¹å®šé¡å‹æ¸¬è©¦
python run_tests.py --type unit         # å–®å…ƒæ¸¬è©¦
python run_tests.py --type integration  # æ•´åˆæ¸¬è©¦
python run_tests.py --type e2e          # ç«¯åˆ°ç«¯æ¸¬è©¦
python run_tests.py --type api          # API æ¸¬è©¦
python run_tests.py --type performance  # æ€§èƒ½æ¸¬è©¦

# åŸ·è¡Œç‰¹å®šæ¨¡çµ„çš„å–®å…ƒæ¸¬è©¦
python run_tests.py --type unit --module simworld

# ç”Ÿæˆå ±å‘Š
python run_tests.py --coverage --html --summary
```

#### ç›´æ¥ä½¿ç”¨ pytest

```bash
# åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
pytest

# åŸ·è¡Œç‰¹å®šé¡å‹æ¸¬è©¦
pytest unit/                # å–®å…ƒæ¸¬è©¦
pytest integration/         # æ•´åˆæ¸¬è©¦
pytest e2e/                 # ç«¯åˆ°ç«¯æ¸¬è©¦
pytest api/                 # API æ¸¬è©¦
pytest performance/         # æ€§èƒ½æ¸¬è©¦

# ç”Ÿæˆå ±å‘Š
pytest --html=reports/test_results/report.html --cov=unit
```

#### ä½¿ç”¨ Makefileï¼ˆæ¨è–¦ï¼‰

```bash
# åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
make test

# åŸ·è¡Œç‰¹å®šé¡å‹æ¸¬è©¦
make test-unit           # å–®å…ƒæ¸¬è©¦
make test-integration    # æ•´åˆæ¸¬è©¦
make test-e2e           # ç«¯åˆ°ç«¯æ¸¬è©¦
make test-api           # API æ¸¬è©¦
make test-performance   # æ€§èƒ½æ¸¬è©¦

# åŸ·è¡Œç‰¹å®šæ¨¡çµ„æ¸¬è©¦
make test-netstack      # NetStack æ¨¡çµ„
make test-simworld      # SimWorld æ¨¡çµ„
make test-deployment    # éƒ¨ç½²æ¨¡çµ„

# ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
make coverage

# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨æŒ‡ä»¤
make help
```

## ğŸ“Š æ¸¬è©¦å ±å‘Š

### è‡ªå‹•ç”Ÿæˆçš„å ±å‘Š

-   **HTML å ±å‘Š**: `reports/test_results/*.html`
-   **JUnit XML**: `reports/test_results/junit.xml`
-   **è¦†è“‹ç‡å ±å‘Š**: `reports/coverage/`
-   **æ¸¬è©¦æ‘˜è¦**: `reports/test_summary.json`

### æŸ¥çœ‹æ¸¬è©¦æ‘˜è¦

```bash
python tools/test_summary.py
# æˆ–
make report
```

## ğŸ§ª æ¸¬è©¦é¡å‹

| é¡å‹           | ç›®éŒ„           | ç”¨é€”                 | ç‰¹é»                       |
| -------------- | -------------- | -------------------- | -------------------------- |
| **å–®å…ƒæ¸¬è©¦**   | `unit/`        | æ¸¬è©¦å€‹åˆ¥æ¨¡çµ„å’Œå‡½æ•¸   | å¿«é€ŸåŸ·è¡Œï¼Œä¸ä¾è³´å¤–éƒ¨æœå‹™   |
| **æ•´åˆæ¸¬è©¦**   | `integration/` | æ¸¬è©¦æ¨¡çµ„é–“çš„æ•´åˆ     | å¯èƒ½éœ€è¦å¤–éƒ¨æœå‹™é‹è¡Œ       |
| **ç«¯åˆ°ç«¯æ¸¬è©¦** | `e2e/`         | æ¸¬è©¦å®Œæ•´çš„ä½¿ç”¨è€…æµç¨‹ | éœ€è¦å®Œæ•´çš„ç³»çµ±ç’°å¢ƒ         |
| **API æ¸¬è©¦**   | `api/`         | å°ˆé–€æ¸¬è©¦ API ç«¯é»    | å°ˆæ³¨æ–¼ API ä»‹é¢é©—è­‰        |
| **æ€§èƒ½æ¸¬è©¦**   | `performance/` | æ¸¬è©¦ç³»çµ±æ€§èƒ½å’Œè² è¼‰   | åŸ·è¡Œæ™‚é–“è¼ƒé•·ï¼Œéœ€è¦ç‰¹æ®Šç’°å¢ƒ |

## ğŸ”§ é…ç½®

### æ¸¬è©¦æ¨™è¨˜ (Markers)

ä½¿ç”¨ `@pytest.mark.*` æ¨™è¨˜æ¸¬è©¦ï¼š

-   `@pytest.mark.smoke`: ç…™éœ§æ¸¬è©¦
-   `@pytest.mark.unit`: å–®å…ƒæ¸¬è©¦
-   `@pytest.mark.integration`: æ•´åˆæ¸¬è©¦
-   `@pytest.mark.e2e`: ç«¯åˆ°ç«¯æ¸¬è©¦
-   `@pytest.mark.api`: API æ¸¬è©¦
-   `@pytest.mark.performance`: æ€§èƒ½æ¸¬è©¦
-   `@pytest.mark.slow`: åŸ·è¡Œæ™‚é–“è¼ƒé•·çš„æ¸¬è©¦
-   `@pytest.mark.network`: éœ€è¦ç¶²è·¯é€£æ¥çš„æ¸¬è©¦

### åŸ·è¡Œç‰¹å®šæ¨™è¨˜çš„æ¸¬è©¦

```bash
pytest -m "smoke"              # åªåŸ·è¡Œç…™éœ§æ¸¬è©¦
pytest -m "unit and not slow"  # åŸ·è¡Œå¿«é€Ÿçš„å–®å…ƒæ¸¬è©¦
pytest -m "not network"        # è·³ééœ€è¦ç¶²è·¯çš„æ¸¬è©¦
```

## ğŸ“ˆ æ¸¬è©¦çµ±è¨ˆ

æœ€æ–°æ¸¬è©¦åŸ·è¡Œçµæœï¼š

-   **ç¸½æ¸¬è©¦æ•¸**: 12
-   **é€šéç‡**: 100%
-   **åŸ·è¡Œæ™‚é–“**: < 0.1 ç§’
-   **è¦†è“‹ç‡**: 12% (æŒçºŒæ”¹å–„ä¸­)

## ğŸ› ï¸ é–‹ç™¼æŒ‡å—

### æ–°å¢æ¸¬è©¦

1. **å–®å…ƒæ¸¬è©¦**: åœ¨ `unit/æ¨¡çµ„å/` ç›®éŒ„ä¸‹å‰µå»º `test_*.py` æª”æ¡ˆ
2. **æ•´åˆæ¸¬è©¦**: åœ¨ `integration/` ç›®éŒ„ä¸‹å‰µå»ºæ¸¬è©¦æª”æ¡ˆ
3. **API æ¸¬è©¦**: åœ¨ `api/` ç›®éŒ„ä¸‹å‰µå»ºæ¸¬è©¦æª”æ¡ˆ
4. **ç«¯åˆ°ç«¯æ¸¬è©¦**: åœ¨ `e2e/` ç›®éŒ„ä¸‹å‰µå»ºæ¸¬è©¦æª”æ¡ˆ
5. **æ€§èƒ½æ¸¬è©¦**: åœ¨ `performance/` ç›®éŒ„ä¸‹å‰µå»ºæ¸¬è©¦æª”æ¡ˆ

### æ¸¬è©¦å‘½åè¦ç¯„

-   æª”æ¡ˆå: `test_*.py` æˆ– `*_test.py` æˆ– `*_tests.py`
-   å‡½æ•¸å: `test_*`
-   é¡åˆ¥å: `Test*`

### æœ€ä½³å¯¦è¸

1. **ç¨ç«‹æ€§**: æ¯å€‹æ¸¬è©¦æ‡‰è©²ç¨ç«‹åŸ·è¡Œ
2. **æ¸…æ™°æ€§**: æ¸¬è©¦åç¨±æ‡‰è©²æ¸…æ¥šæè¿°æ¸¬è©¦å…§å®¹
3. **å¿«é€Ÿæ€§**: å–®å…ƒæ¸¬è©¦æ‡‰è©²å¿«é€ŸåŸ·è¡Œ
4. **å¯é æ€§**: æ¸¬è©¦çµæœæ‡‰è©²ä¸€è‡´ä¸”å¯é‡ç¾
5. **ç°¡æ½”æ€§**: ä¿æŒæ¸¬è©¦ç›®éŒ„çµæ§‹ç°¡å–®æ‰å¹³

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **æ¨¡çµ„å°å…¥éŒ¯èª¤**: æª¢æŸ¥ Python è·¯å¾‘è¨­å®š
2. **æœå‹™é€£æ¥å¤±æ•—**: ç¢ºèªç›¸é—œæœå‹™å·²å•Ÿå‹•
3. **æ¬Šé™å•é¡Œ**: æª¢æŸ¥æª”æ¡ˆå’Œç›®éŒ„æ¬Šé™

### é™¤éŒ¯æŠ€å·§

```bash
pytest -v -s          # è©³ç´°è¼¸å‡º
pytest --lf           # åªåŸ·è¡Œå¤±æ•—çš„æ¸¬è©¦
pytest -x             # åœåœ¨ç¬¬ä¸€å€‹å¤±æ•—
pytest --pdb          # é™¤éŒ¯æ¨¡å¼
make test-debug       # ä½¿ç”¨ Makefile é€²è¡Œé™¤éŒ¯
```

### ç²å–å”åŠ©

å¦‚æœ‰å•é¡Œï¼Œè«‹ï¼š

1. æª¢æŸ¥æ¸¬è©¦æ—¥èªŒ: `reports/test_results/pytest.log`
2. æŸ¥çœ‹æ¸¬è©¦æ‘˜è¦: `python tools/test_summary.py` æˆ– `make report`
3. è¯ç¹«é–‹ç™¼åœ˜éšŠ

---

**æœ€å¾Œæ›´æ–°**: 2025-05-31  
**ç‰ˆæœ¬**: 3.0.0 (æ¥µç°¡æ‰å¹³åŒ–ç‰ˆ)
