# NTN Stack 端到端測試場景規範
# 版本: v1.0.0
# 更新日期: 2024-12-01

metadata:
  version: "1.0.0"
  last_updated: "2024-12-01"
  description: "NTN Stack 系統端到端測試場景統一規範"
  maintainer: "NTN Stack Test Team"

# 測試場景命名規範
naming_convention:
  format: "{scenario_type}_{test_level}_{condition}_{objective}"
  description: "場景類型_測試級別_測試條件_測試目標"
  examples:
    - "uav_satellite_basic_connectivity"
    - "interference_advanced_jamming_resilience"
    - "mesh_failover_critical_recovery"

# 場景類型定義
scenario_types:
  uav_satellite:
    description: "UAV 與衛星連接測試"
    prefix: "uav_satellite"
    focus_areas:
      - connectivity
      - latency
      - reliability
      - handover
    
  interference:
    description: "干擾檢測與規避測試"
    prefix: "interference"
    focus_areas:
      - detection
      - mitigation
      - resilience
      - recovery
    
  mesh_failover:
    description: "Mesh 網絡備援測試"
    prefix: "mesh_failover"
    focus_areas:
      - switching
      - recovery
      - continuity
      - redundancy
    
  performance:
    description: "性能壓力測試"
    prefix: "performance"
    focus_areas:
      - throughput
      - latency
      - scalability
      - resource_usage
    
  multi_uav:
    description: "多 UAV 協同測試"
    prefix: "multi_uav"
    focus_areas:
      - coordination
      - scalability
      - resource_sharing
      - interference
    
  longrun:
    description: "長時間穩定性測試"
    prefix: "longrun"
    focus_areas:
      - stability
      - memory_leaks
      - performance_degradation
      - error_accumulation
    
  boundary:
    description: "邊界條件測試"
    prefix: "boundary"
    focus_areas:
      - edge_cases
      - error_handling
      - recovery
      - limits

# 測試級別定義
test_levels:
  basic:
    description: "基礎功能測試"
    duration_range: "1-5 minutes"
    complexity: "low"
    prerequisites: ["system_ready"]
    
  intermediate:
    description: "中等複雜度測試"
    duration_range: "5-30 minutes"
    complexity: "medium"
    prerequisites: ["basic_tests_passed", "network_stable"]
    
  advanced:
    description: "高級綜合測試"
    duration_range: "30-120 minutes"
    complexity: "high"
    prerequisites: ["intermediate_tests_passed", "full_system_available"]
    
  critical:
    description: "關鍵路徑測試"
    duration_range: "1-60 minutes"
    complexity: "variable"
    prerequisites: ["system_validated"]

# 測試條件定義
test_conditions:
  normal:
    description: "正常網絡條件"
    network_delay: "10-50ms"
    packet_loss: "0-0.1%"
    bandwidth: "100Mbps+"
    
  degraded:
    description: "退化網絡條件"
    network_delay: "100-300ms"
    packet_loss: "1-5%"
    bandwidth: "10-50Mbps"
    
  hostile:
    description: "惡劣環境條件"
    network_delay: "300-1000ms"
    packet_loss: "5-15%"
    bandwidth: "1-10Mbps"
    interference: "active"
    
  jamming:
    description: "干擾攻擊條件"
    interference_type: ["jamming", "spoofing"]
    interference_strength: ["low", "medium", "high"]
    
  mobile:
    description: "移動環境條件"
    uav_movement: "active"
    handover_required: true
    signal_variation: "high"

# 具體測試場景定義
test_scenarios:
  # UAV 衛星連接測試場景
  uav_satellite_basic_connectivity:
    type: "uav_satellite"
    level: "basic"
    condition: "normal"
    objective: "connectivity"
    description: "驗證 UAV 與衛星的基本連接功能"
    duration: "3 minutes"
    kpi_targets:
      connection_success_rate: ">= 95%"
      e2e_latency: "<= 50ms"
      data_integrity: "100%"
    test_steps:
      - initialize_uav_terminal
      - establish_satellite_connection
      - measure_connection_quality
      - perform_data_transfer
      - verify_data_integrity
    pass_criteria:
      - connection_established: true
      - latency_within_target: true
      - no_data_corruption: true
      
  uav_satellite_intermediate_handover:
    type: "uav_satellite"
    level: "intermediate"
    condition: "mobile"
    objective: "handover"
    description: "測試 UAV 在移動中的衛星切換"
    duration: "15 minutes"
    kpi_targets:
      handover_success_rate: ">= 90%"
      handover_interruption: "<= 2s"
      data_continuity: ">= 98%"
    test_steps:
      - setup_mobile_scenario
      - initiate_uav_movement
      - trigger_satellite_handover
      - measure_interruption_time
      - verify_data_continuity
    pass_criteria:
      - handover_completed: true
      - interruption_within_limit: true
      - data_loss_minimal: true

  # 干擾檢測與規避測試場景
  interference_basic_detection:
    type: "interference"
    level: "basic"
    condition: "jamming"
    objective: "detection"
    description: "測試系統對基本干擾的檢測能力"
    duration: "5 minutes"
    kpi_targets:
      detection_time: "<= 1s"
      false_positive_rate: "<= 5%"
      detection_accuracy: ">= 95%"
    test_steps:
      - establish_baseline_connection
      - inject_interference_signal
      - monitor_detection_response
      - measure_detection_time
      - verify_detection_accuracy
    pass_criteria:
      - interference_detected: true
      - detection_time_acceptable: true
      - no_false_alarms: true
      
  interference_advanced_mitigation:
    type: "interference"
    level: "advanced"
    condition: "jamming"
    objective: "mitigation"
    description: "測試高級干擾緩解機制"
    duration: "20 minutes"
    kpi_targets:
      mitigation_success_rate: ">= 85%"
      frequency_hop_time: "<= 100ms"
      communication_continuity: ">= 80%"
    test_steps:
      - setup_advanced_jamming
      - enable_mitigation_mechanisms
      - monitor_frequency_hopping
      - measure_communication_quality
      - verify_mitigation_effectiveness
    pass_criteria:
      - mitigation_activated: true
      - communication_maintained: true
      - quality_acceptable: true

  # Mesh 網絡備援測試場景
  mesh_failover_basic_switching:
    type: "mesh_failover"
    level: "basic"
    condition: "normal"
    objective: "switching"
    description: "測試基本的 Mesh 網絡切換功能"
    duration: "5 minutes"
    kpi_targets:
      switch_time: "<= 2s"
      data_loss: "<= 1%"
      recovery_success_rate: ">= 95%"
    test_steps:
      - establish_satellite_connection
      - simulate_satellite_failure
      - trigger_mesh_failover
      - measure_switching_time
      - verify_data_continuity
    pass_criteria:
      - failover_triggered: true
      - switch_time_acceptable: true
      - data_loss_minimal: true
      
  mesh_failover_critical_recovery:
    type: "mesh_failover"
    level: "critical"
    condition: "degraded"
    objective: "recovery"
    description: "關鍵情況下的網絡恢復測試"
    duration: "10 minutes"
    kpi_targets:
      recovery_time: "<= 5s"
      service_availability: ">= 99%"
      data_integrity: "100%"
    test_steps:
      - setup_degraded_conditions
      - simulate_multiple_failures
      - test_recovery_mechanisms
      - measure_recovery_time
      - verify_service_restoration
    pass_criteria:
      - recovery_successful: true
      - timing_acceptable: true
      - integrity_maintained: true

  # 性能測試場景
  performance_basic_throughput:
    type: "performance"
    level: "basic"
    condition: "normal"
    objective: "throughput"
    description: "基本吞吐量性能測試"
    duration: "10 minutes"
    kpi_targets:
      max_throughput: ">= 100Mbps"
      avg_throughput: ">= 80Mbps"
      throughput_stability: ">= 95%"
    test_steps:
      - setup_performance_environment
      - initiate_throughput_test
      - monitor_performance_metrics
      - analyze_throughput_patterns
      - verify_stability
    pass_criteria:
      - throughput_target_met: true
      - performance_stable: true
      - no_degradation: true
      
  performance_advanced_stress:
    type: "performance"
    level: "advanced"
    condition: "hostile"
    objective: "scalability"
    description: "高壓力下的系統擴展性測試"
    duration: "60 minutes"
    kpi_targets:
      concurrent_uavs: ">= 50"
      resource_utilization: "<= 80%"
      response_time: "<= 100ms"
    test_steps:
      - setup_stress_environment
      - gradually_increase_load
      - monitor_system_resources
      - measure_response_times
      - verify_scalability_limits
    pass_criteria:
      - load_target_achieved: true
      - resources_within_limits: true
      - response_acceptable: true

  # 多 UAV 協同測試場景
  multi_uav_basic_coordination:
    type: "multi_uav"
    level: "basic"
    condition: "normal"
    objective: "coordination"
    description: "基本多 UAV 協同功能測試"
    duration: "15 minutes"
    kpi_targets:
      coordination_success_rate: ">= 90%"
      inter_uav_latency: "<= 20ms"
      resource_sharing_efficiency: ">= 85%"
    test_steps:
      - deploy_multiple_uavs
      - establish_coordination_network
      - test_inter_uav_communication
      - verify_resource_sharing
      - measure_coordination_metrics
    pass_criteria:
      - coordination_established: true
      - communication_reliable: true
      - sharing_efficient: true
      
  multi_uav_advanced_scalability:
    type: "multi_uav"
    level: "advanced"
    condition: "mobile"
    objective: "scalability"
    description: "大規模 UAV 集群可擴展性測試"
    duration: "45 minutes"
    kpi_targets:
      max_uav_count: ">= 100"
      coordination_overhead: "<= 10%"
      system_stability: ">= 95%"
    test_steps:
      - setup_scalability_test
      - incrementally_add_uavs
      - monitor_coordination_overhead
      - test_system_limits
      - verify_graceful_degradation
    pass_criteria:
      - scalability_target_met: true
      - overhead_acceptable: true
      - stability_maintained: true

  # 長時間穩定性測試場景
  longrun_basic_stability:
    type: "longrun"
    level: "basic"
    condition: "normal"
    objective: "stability"
    description: "24小時連續運行穩定性測試"
    duration: "24 hours"
    kpi_targets:
      uptime: ">= 99.9%"
      memory_growth: "<= 10%"
      performance_degradation: "<= 5%"
    test_steps:
      - initialize_long_run_test
      - monitor_system_continuously
      - track_resource_usage
      - detect_performance_trends
      - verify_stability_metrics
    pass_criteria:
      - no_system_crashes: true
      - memory_stable: true
      - performance_consistent: true
      
  longrun_advanced_endurance:
    type: "longrun"
    level: "advanced"
    condition: "degraded"
    objective: "endurance"
    description: "惡劣條件下的長期耐久性測試"
    duration: "72 hours"
    kpi_targets:
      service_availability: ">= 99%"
      error_recovery_rate: ">= 95%"
      resource_leak_rate: "0%"
    test_steps:
      - setup_endurance_conditions
      - run_extended_operations
      - inject_periodic_stress
      - monitor_recovery_patterns
      - analyze_long_term_trends
    pass_criteria:
      - endurance_target_met: true
      - recovery_effective: true
      - no_resource_leaks: true

  # 邊界條件測試場景
  boundary_basic_limits:
    type: "boundary"
    level: "basic"
    condition: "hostile"
    objective: "limits"
    description: "系統邊界條件和限制測試"
    duration: "30 minutes"
    kpi_targets:
      error_detection_rate: ">= 99%"
      graceful_degradation: "100%"
      recovery_success_rate: ">= 90%"
    test_steps:
      - identify_system_boundaries
      - test_parameter_limits
      - verify_error_handling
      - test_recovery_mechanisms
      - document_limitations
    pass_criteria:
      - boundaries_well_defined: true
      - errors_handled_gracefully: true
      - recovery_mechanisms_work: true
      
  boundary_advanced_edge_cases:
    type: "boundary"
    level: "advanced"
    condition: "hostile"
    objective: "edge_cases"
    description: "極端邊界情況處理測試"
    duration: "60 minutes"
    kpi_targets:
      edge_case_coverage: ">= 95%"
      system_survival_rate: ">= 85%"
      data_integrity: "100%"
    test_steps:
      - design_edge_case_scenarios
      - execute_extreme_conditions
      - monitor_system_behavior
      - verify_data_protection
      - test_emergency_procedures
    pass_criteria:
      - edge_cases_handled: true
      - system_survives: true
      - data_protected: true

# 測試套件定義
test_suites:
  critical_path:
    description: "關鍵路徑測試套件"
    scenarios:
      - uav_satellite_basic_connectivity
      - interference_basic_detection
      - mesh_failover_basic_switching
      - performance_basic_throughput
    estimated_duration: "23 minutes"
    priority: "high"
    
  comprehensive:
    description: "全面功能測試套件"
    scenarios:
      - uav_satellite_basic_connectivity
      - uav_satellite_intermediate_handover
      - interference_basic_detection
      - interference_advanced_mitigation
      - mesh_failover_basic_switching
      - mesh_failover_critical_recovery
      - performance_basic_throughput
      - multi_uav_basic_coordination
    estimated_duration: "133 minutes"
    priority: "medium"
    
  stress_test:
    description: "壓力測試套件"
    scenarios:
      - performance_advanced_stress
      - multi_uav_advanced_scalability
      - longrun_basic_stability
      - boundary_advanced_edge_cases
    estimated_duration: "25+ hours"
    priority: "low"
    
  regression:
    description: "回歸測試套件"
    scenarios:
      - uav_satellite_basic_connectivity
      - interference_basic_detection
      - mesh_failover_basic_switching
      - performance_basic_throughput
      - boundary_basic_limits
    estimated_duration: "68 minutes"
    priority: "high"

# 配置驗證規則
validation_rules:
  scenario_naming:
    pattern: "^[a-z]+_[a-z]+_[a-z]+_[a-z]+$"
    max_length: 50
    required_parts: ["type", "level", "condition", "objective"]
    
  duration_format:
    pattern: "^\\d+\\s+(minutes?|hours?)$"
    valid_units: ["minute", "minutes", "hour", "hours"]
    
  kpi_format:
    operators: [">=", "<=", ">", "<", "="]
    value_types: ["percentage", "time", "count", "rate"]
    
  test_steps:
    min_steps: 3
    max_steps: 10
    required_fields: ["action", "validation"]

# 擴展配置
extension_points:
  custom_scenarios:
    location: "tests/e2e/custom_scenarios/"
    naming_convention: "custom_{scenario_name}.yaml"
    validation_required: true
    
  scenario_plugins:
    location: "tests/e2e/plugins/"
    interface: "ScenarioPlugin"
    registration_required: true
    
  external_integrations:
    supported_formats: ["junit", "testng", "cucumber"]
    import_location: "tests/e2e/imports/"
    mapping_required: true 