# NTN Stack çµ±ä¸€æ¸¬è©¦å¥—ä»¶ Makefile
# é›†ä¸­ç®¡ç†æ‰€æœ‰æ¸¬è©¦åˆ†é¡å’ŒåŸ·è¡Œæµç¨‹

.PHONY: help test-all test-quick test-smoke test-core test-regression
.PHONY: test-unit-all test-integration-all test-e2e-all test-frontend-all test-shell-all
.PHONY: test-unit-netstack test-unit-simworld test-unit-deployment test-unit-monitoring
.PHONY: test-integration-api test-integration-services test-integration-cross-service
.PHONY: test-e2e-basic test-e2e-failover test-e2e-performance test-e2e-comprehensive
.PHONY: test-perf-latency test-perf-throughput test-perf-load test-perf-stress
.PHONY: test-frontend-components test-frontend-ui test-frontend-e2e
.PHONY: test-shell-netstack test-shell-connectivity test-shell-deployment
.PHONY: test-env-setup test-env-start test-env-stop test-env-reset test-env-check
.PHONY: test-report test-report-detailed test-report-coverage test-report-archive
.PHONY: test-clean test-clean-reports test-clean-logs test-clean-all
.PHONY: install-deps check-env smoke-test coverage

# é¡è‰²å®šç¾©
RED=\033[0;31m
GREEN=\033[0;32m
YELLOW=\033[1;33m
BLUE=\033[0;34m
PURPLE=\033[0;35m
CYAN=\033[0;36m
NC=\033[0m # No Color

# é»˜èªç›®æ¨™
help:
	@echo "$(CYAN)ğŸ§ª NTN Stack çµ±ä¸€æ¸¬è©¦å¥—ä»¶$(NC)"
	@echo "=================================="
	@echo ""
	@echo "$(GREEN)ğŸ“‹ å¿«é€Ÿæ¸¬è©¦æŒ‡ä»¤:$(NC)"
	@echo "  $(YELLOW)test-smoke$(NC)      - ç…™éœ§æ¸¬è©¦ (30s) - åŸºæœ¬æœå‹™å¯ç”¨æ€§"
	@echo "  $(YELLOW)test-quick$(NC)      - å¿«é€Ÿæ¸¬è©¦ (2min) - æ ¸å¿ƒåŠŸèƒ½é©—è­‰"
	@echo "  $(YELLOW)test-core$(NC)       - æ ¸å¿ƒæ¸¬è©¦ (5min) - ä¸»è¦åŠŸèƒ½å®Œæ•´æ€§"
	@echo "  $(YELLOW)test-regression$(NC) - å›æ­¸æ¸¬è©¦ (10min) - åŠŸèƒ½ç„¡é€€åŒ–é©—è­‰"
	@echo "  $(YELLOW)test-all$(NC)        - å®Œæ•´æ¸¬è©¦ (20min) - å…¨åŠŸèƒ½è¦†è“‹"
	@echo ""
	@echo "$(GREEN)ğŸ”§ åˆ†é¡æ¸¬è©¦æŒ‡ä»¤:$(NC)"
	@echo "  $(BLUE)å–®å…ƒæ¸¬è©¦:$(NC)"
	@echo "    test-unit-netstack     - NetStack API å–®å…ƒæ¸¬è©¦"
	@echo "    test-unit-simworld     - SimWorld å¾Œç«¯å–®å…ƒæ¸¬è©¦"
	@echo "    test-unit-deployment   - éƒ¨ç½²æ¨¡çµ„å–®å…ƒæ¸¬è©¦"
	@echo "    test-unit-monitoring   - ç›£æ§æ¨¡çµ„å–®å…ƒæ¸¬è©¦"
	@echo ""
	@echo "  $(BLUE)æ•´åˆæ¸¬è©¦:$(NC)"
	@echo "    test-integration-api        - API æ•´åˆæ¸¬è©¦"
	@echo "    test-integration-services   - æœå‹™é–“æ•´åˆæ¸¬è©¦"
	@echo "    test-integration-cross-service - è·¨æœå‹™æ•´åˆæ¸¬è©¦"
	@echo ""
	@echo "  $(BLUE)ç«¯åˆ°ç«¯æ¸¬è©¦:$(NC)"
	@echo "    test-e2e-basic         - åŸºæœ¬åŠŸèƒ½ç«¯åˆ°ç«¯æ¸¬è©¦"
	@echo "    test-e2e-failover      - å‚™æ´æ©Ÿåˆ¶ç«¯åˆ°ç«¯æ¸¬è©¦"
	@echo "    test-e2e-performance   - æ€§èƒ½è¦æ±‚ç«¯åˆ°ç«¯æ¸¬è©¦"
	@echo "    test-e2e-comprehensive - ç¶œåˆå ´æ™¯ç«¯åˆ°ç«¯æ¸¬è©¦"
	@echo ""
	@echo "  $(BLUE)æ€§èƒ½æ¸¬è©¦:$(NC)"
	@echo "    test-perf-latency      - å»¶é²æ¸¬è©¦"
	@echo "    test-perf-throughput   - ååé‡æ¸¬è©¦"
	@echo "    test-perf-load         - è² è¼‰æ¸¬è©¦"
	@echo "    test-perf-stress       - å£“åŠ›æ¸¬è©¦"
	@echo ""
	@echo "  $(BLUE)å‰ç«¯æ¸¬è©¦:$(NC)"
	@echo "    test-frontend-components - çµ„ä»¶æ¸¬è©¦"
	@echo "    test-frontend-ui       - UI æ¸¬è©¦"
	@echo "    test-frontend-e2e      - å‰ç«¯ç«¯åˆ°ç«¯æ¸¬è©¦"
	@echo ""
	@echo "  $(BLUE)Shell è…³æœ¬æ¸¬è©¦:$(NC)"
	@echo "    test-shell-netstack    - NetStack åŠŸèƒ½è…³æœ¬æ¸¬è©¦"
	@echo "    test-shell-connectivity - é€£æ¥æ€§è…³æœ¬æ¸¬è©¦"
	@echo "    test-shell-deployment  - éƒ¨ç½²è…³æœ¬æ¸¬è©¦"
	@echo ""
	@echo "$(GREEN)ğŸ› ï¸ ç’°å¢ƒç®¡ç†:$(NC)"
	@echo "  test-env-setup         - è¨­ç½®æ¸¬è©¦ç’°å¢ƒ"
	@echo "  test-env-start         - å•Ÿå‹•æ¸¬è©¦ç’°å¢ƒ"
	@echo "  test-env-stop          - åœæ­¢æ¸¬è©¦ç’°å¢ƒ"
	@echo "  test-env-reset         - é‡è¨­æ¸¬è©¦ç’°å¢ƒ"
	@echo "  test-env-check         - æª¢æŸ¥ç’°å¢ƒç‹€æ…‹"
	@echo ""
	@echo "$(GREEN)ğŸ“Š å ±å‘Šç®¡ç†:$(NC)"
	@echo "  test-report            - ç”Ÿæˆæ¸¬è©¦å ±å‘Šæ‘˜è¦"
	@echo "  test-report-detailed   - ç”Ÿæˆè©³ç´°æ¸¬è©¦å ±å‘Š"
	@echo "  test-report-coverage   - ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š"
	@echo "  test-report-archive    - æ­¸æª”æ¸¬è©¦å ±å‘Š"
	@echo ""
	@echo "$(GREEN)ğŸ§¹ æ¸…ç†æŒ‡ä»¤:$(NC)"
	@echo "  test-clean             - æ¸…ç†æ¸¬è©¦ç·©å­˜"
	@echo "  test-clean-reports     - æ¸…ç†æ¸¬è©¦å ±å‘Š"
	@echo "  test-clean-logs        - æ¸…ç†æ¸¬è©¦æ—¥èªŒ"
	@echo "  test-clean-all         - æ¸…ç†æ‰€æœ‰æ¸¬è©¦ç”¢ç‰©"

# ============================================================================
# å¿«é€Ÿæ¸¬è©¦æŒ‡ä»¤
# ============================================================================

# ç…™éœ§æ¸¬è©¦ - åŸºæœ¬æœå‹™å¯ç”¨æ€§æª¢æŸ¥
test-smoke:
	@echo "$(YELLOW)ğŸ’¨ åŸ·è¡Œç…™éœ§æ¸¬è©¦...$(NC)"
	@python3 tools/test_runner.py --suite smoke --timeout 30
	@echo "$(GREEN)âœ… ç…™éœ§æ¸¬è©¦å®Œæˆ$(NC)"

# å¿«é€Ÿæ¸¬è©¦ - æ ¸å¿ƒåŠŸèƒ½é©—è­‰
test-quick:
	@echo "$(YELLOW)âš¡ åŸ·è¡Œå¿«é€Ÿæ¸¬è©¦...$(NC)"
	@python3 tools/test_runner.py --suite quick --timeout 120
	@echo "$(GREEN)âœ… å¿«é€Ÿæ¸¬è©¦å®Œæˆ$(NC)"

# æ ¸å¿ƒæ¸¬è©¦ - ä¸»è¦åŠŸèƒ½å®Œæ•´æ€§
test-core:
	@echo "$(YELLOW)ğŸ¯ åŸ·è¡Œæ ¸å¿ƒæ¸¬è©¦...$(NC)"
	@python3 tools/test_runner.py --suite core --timeout 300
	@echo "$(GREEN)âœ… æ ¸å¿ƒæ¸¬è©¦å®Œæˆ$(NC)"

# å›æ­¸æ¸¬è©¦ - åŠŸèƒ½ç„¡é€€åŒ–é©—è­‰
test-regression:
	@echo "$(YELLOW)ğŸ”„ åŸ·è¡Œå›æ­¸æ¸¬è©¦...$(NC)"
	@python3 tools/test_runner.py --suite regression --timeout 600
	@echo "$(GREEN)âœ… å›æ­¸æ¸¬è©¦å®Œæˆ$(NC)"

# å®Œæ•´æ¸¬è©¦ - å…¨åŠŸèƒ½è¦†è“‹
test-all:
	@echo "$(YELLOW)ğŸš€ åŸ·è¡Œå®Œæ•´æ¸¬è©¦å¥—ä»¶...$(NC)"
	@echo "$(BLUE)æ¸¬è©¦ç¯„åœ: å–®å…ƒæ¸¬è©¦ + æ•´åˆæ¸¬è©¦ + ç«¯åˆ°ç«¯æ¸¬è©¦ + æ€§èƒ½æ¸¬è©¦$(NC)"
	@$(MAKE) test-unit-all
	@$(MAKE) test-integration-all
	@$(MAKE) test-e2e-all
	@$(MAKE) test-frontend-all
	@$(MAKE) test-shell-all
	@echo "$(GREEN)âœ… å®Œæ•´æ¸¬è©¦å¥—ä»¶åŸ·è¡Œå®Œæˆ$(NC)"

# ============================================================================
# å–®å…ƒæ¸¬è©¦
# ============================================================================

test-unit-all:
	@echo "$(BLUE)ğŸ”§ åŸ·è¡Œæ‰€æœ‰å–®å…ƒæ¸¬è©¦...$(NC)"
	@$(MAKE) test-unit-netstack
	@$(MAKE) test-unit-simworld
	@$(MAKE) test-unit-deployment
	@$(MAKE) test-unit-monitoring

test-unit-netstack:
	@echo "$(CYAN)ğŸ“¡ NetStack API å–®å…ƒæ¸¬è©¦$(NC)"
	@cd unit/netstack && python3 -m pytest -v --tb=short

test-unit-simworld:
	@echo "$(CYAN)ğŸŒ SimWorld å¾Œç«¯å–®å…ƒæ¸¬è©¦$(NC)"
	@cd unit/simworld && python3 -m pytest -v --tb=short

test-unit-deployment:
	@echo "$(CYAN)ğŸš€ éƒ¨ç½²æ¨¡çµ„å–®å…ƒæ¸¬è©¦$(NC)"
	@cd unit/deployment && python3 -m pytest -v --tb=short

test-unit-monitoring:
	@echo "$(CYAN)ğŸ“Š ç›£æ§æ¨¡çµ„å–®å…ƒæ¸¬è©¦$(NC)"
	@cd unit/monitoring && python3 -m pytest -v --tb=short

# ============================================================================
# æ•´åˆæ¸¬è©¦
# ============================================================================

test-integration-all:
	@echo "$(BLUE)ğŸ”— åŸ·è¡Œæ‰€æœ‰æ•´åˆæ¸¬è©¦...$(NC)"
	@$(MAKE) test-integration-api
	@$(MAKE) test-integration-services
	@$(MAKE) test-integration-cross-service

test-integration-api:
	@echo "$(CYAN)ğŸŒ API æ•´åˆæ¸¬è©¦$(NC)"
	@cd integration/api && python3 -m pytest -v --tb=short

test-integration-services:
	@echo "$(CYAN)âš™ï¸ æœå‹™é–“æ•´åˆæ¸¬è©¦$(NC)"
	@cd integration/services && python3 -m pytest -v --tb=short

test-integration-cross-service:
	@echo "$(CYAN)ğŸ”„ è·¨æœå‹™æ•´åˆæ¸¬è©¦$(NC)"
	@cd integration/cross_service && python3 -m pytest -v --tb=short

# ============================================================================
# ç«¯åˆ°ç«¯æ¸¬è©¦
# ============================================================================

test-e2e-all:
	@echo "$(BLUE)ğŸ­ åŸ·è¡Œæ‰€æœ‰ç«¯åˆ°ç«¯æ¸¬è©¦...$(NC)"
	@$(MAKE) test-e2e-basic
	@$(MAKE) test-e2e-failover
	@$(MAKE) test-e2e-performance
	@$(MAKE) test-e2e-comprehensive

test-e2e-basic:
	@echo "$(CYAN)ğŸ¯ åŸºæœ¬åŠŸèƒ½ç«¯åˆ°ç«¯æ¸¬è©¦$(NC)"
	@cd e2e/scenarios && python3 simple_functionality_test.py

test-e2e-failover:
	@echo "$(CYAN)ğŸ”„ å‚™æ´æ©Ÿåˆ¶ç«¯åˆ°ç«¯æ¸¬è©¦$(NC)"
	@cd e2e/scenarios && python3 final_network_verification.py

test-e2e-performance:
	@echo "$(CYAN)âš¡ æ€§èƒ½è¦æ±‚ç«¯åˆ°ç«¯æ¸¬è©¦$(NC)"
	@cd e2e/scenarios && python3 complete_e2e_optimization_test.py

test-e2e-comprehensive:
	@echo "$(CYAN)ğŸª ç¶œåˆå ´æ™¯ç«¯åˆ°ç«¯æ¸¬è©¦$(NC)"
	@cd e2e/scenarios && python3 final_comprehensive_test.py

# ============================================================================
# æ€§èƒ½æ¸¬è©¦
# ============================================================================

test-perf-latency:
	@echo "$(PURPLE)â±ï¸ å»¶é²æ¸¬è©¦$(NC)"
	@cd shell/netstack && bash ntn_latency_test.sh

test-perf-throughput:
	@echo "$(PURPLE)ğŸ“ˆ ååé‡æ¸¬è©¦$(NC)"
	@cd shell/netstack && bash performance_test.sh

test-perf-load:
	@echo "$(PURPLE)ğŸ“Š è² è¼‰æ¸¬è©¦$(NC)"
	@cd e2e/performance && python3 load_test.py

test-perf-stress:
	@echo "$(PURPLE)ğŸ’ª å£“åŠ›æ¸¬è©¦$(NC)"
	@cd e2e/performance && python3 stress_test.py

# ============================================================================
# å‰ç«¯æ¸¬è©¦
# ============================================================================

test-frontend-all:
	@echo "$(BLUE)ğŸ¨ åŸ·è¡Œæ‰€æœ‰å‰ç«¯æ¸¬è©¦...$(NC)"
	@$(MAKE) test-frontend-components
	@$(MAKE) test-frontend-ui
	@$(MAKE) test-frontend-e2e

test-frontend-components:
	@echo "$(CYAN)ğŸ§© çµ„ä»¶æ¸¬è©¦$(NC)"
	@cd frontend/components && python3 -m pytest -v --tb=short

test-frontend-ui:
	@echo "$(CYAN)ğŸ¨ UI æ¸¬è©¦$(NC)"
	@cd frontend/ui && npm test

test-frontend-e2e:
	@echo "$(CYAN)ğŸ­ å‰ç«¯ç«¯åˆ°ç«¯æ¸¬è©¦$(NC)"
	@cd frontend/integration && npm run test:e2e

# ============================================================================
# Shell è…³æœ¬æ¸¬è©¦
# ============================================================================

test-shell-all:
	@echo "$(BLUE)ğŸš åŸ·è¡Œæ‰€æœ‰ Shell è…³æœ¬æ¸¬è©¦...$(NC)"
	@$(MAKE) test-shell-netstack
	@$(MAKE) test-shell-connectivity
	@$(MAKE) test-shell-deployment

test-shell-netstack:
	@echo "$(CYAN)ğŸ“¡ NetStack åŠŸèƒ½è…³æœ¬æ¸¬è©¦$(NC)"
	@cd shell/netstack && bash e2e_netstack.sh
	@cd shell/netstack && bash quick_ntn_validation.sh

test-shell-connectivity:
	@echo "$(CYAN)ğŸ”— é€£æ¥æ€§è…³æœ¬æ¸¬è©¦$(NC)"
	@cd shell/netstack && bash test_connectivity.sh

test-shell-deployment:
	@echo "$(CYAN)ğŸš€ éƒ¨ç½²è…³æœ¬æ¸¬è©¦$(NC)"
	@cd shell/deployment && bash deployment_test.sh

# ============================================================================
# ç’°å¢ƒç®¡ç†
# ============================================================================

test-env-setup:
	@echo "$(GREEN)ğŸ“¦ è¨­ç½®æ¸¬è©¦ç’°å¢ƒ...$(NC)"
	@python3 tools/environment_setup.py --setup
	@pip install -r requirements-test.txt

test-env-start:
	@echo "$(GREEN)ğŸš€ å•Ÿå‹•æ¸¬è©¦ç’°å¢ƒ...$(NC)"
	@cd .. && make up
	@sleep 10
	@$(MAKE) check-env

test-env-stop:
	@echo "$(GREEN)ğŸ›‘ åœæ­¢æ¸¬è©¦ç’°å¢ƒ...$(NC)"
	@cd .. && make down

test-env-reset:
	@echo "$(GREEN)ğŸ”„ é‡è¨­æ¸¬è©¦ç’°å¢ƒ...$(NC)"
	@$(MAKE) test-env-stop
	@$(MAKE) test-clean-all
	@$(MAKE) test-env-start

test-env-check:
	@echo "$(GREEN)ğŸ” æª¢æŸ¥æ¸¬è©¦ç’°å¢ƒ...$(NC)"
	@python3 tools/environment_setup.py --check

# ============================================================================
# å ±å‘Šç®¡ç†
# ============================================================================

test-report:
	@echo "$(CYAN)ğŸ“Š ç”Ÿæˆæ¸¬è©¦å ±å‘Šæ‘˜è¦...$(NC)"
	@python3 tools/report_generator.py --summary

test-report-detailed:
	@echo "$(CYAN)ğŸ“‹ ç”Ÿæˆè©³ç´°æ¸¬è©¦å ±å‘Š...$(NC)"
	@python3 tools/report_generator.py --detailed

test-report-coverage:
	@echo "$(CYAN)ğŸ“ˆ ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š...$(NC)"
	@python3 tools/report_generator.py --coverage

test-report-archive:
	@echo "$(CYAN)ğŸ“¦ æ­¸æª”æ¸¬è©¦å ±å‘Š...$(NC)"
	@python3 tools/report_generator.py --archive

# ============================================================================
# æ¸…ç†æŒ‡ä»¤
# ============================================================================

test-clean:
	@echo "$(YELLOW)ğŸ§¹ æ¸…ç†æ¸¬è©¦ç·©å­˜...$(NC)"
	@find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	@find . -type f -name "*.pyc" -delete 2>/dev/null || true
	@find . -type d -name ".pytest_cache" -exec rm -rf {} + 2>/dev/null || true

test-clean-reports:
	@echo "$(YELLOW)ğŸ“„ æ¸…ç†æ¸¬è©¦å ±å‘Š...$(NC)"
	@rm -rf reports/
	@rm -f *.html *.xml *.json

test-clean-logs:
	@echo "$(YELLOW)ğŸ“ æ¸…ç†æ¸¬è©¦æ—¥èªŒ...$(NC)"
	@rm -f *.log
	@rm -rf logs/

test-clean-all:
	@echo "$(YELLOW)ğŸ—‘ï¸ æ¸…ç†æ‰€æœ‰æ¸¬è©¦ç”¢ç‰©...$(NC)"
	@$(MAKE) test-clean
	@$(MAKE) test-clean-reports
	@$(MAKE) test-clean-logs

# ============================================================================
# è¼”åŠ©åŠŸèƒ½
# ============================================================================

install-deps:
	@echo "$(GREEN)ğŸ“¦ å®‰è£æ¸¬è©¦ä¾è³´...$(NC)"
	@pip install pytest pytest-asyncio pytest-cov httpx requests

check-env:
	@echo "$(BLUE)ğŸ” æª¢æŸ¥æ¸¬è©¦ç’°å¢ƒ...$(NC)"
	@curl -s http://localhost:8080/health > /dev/null && echo "$(GREEN)âœ… NetStack API æœå‹™æ­£å¸¸$(NC)" || echo "$(RED)âŒ NetStack API æœå‹™æœªå•Ÿå‹•$(NC)"
	@curl -s http://localhost:3000 > /dev/null && echo "$(GREEN)âœ… SimWorld å‰ç«¯æœå‹™æ­£å¸¸$(NC)" || echo "$(RED)âŒ SimWorld å‰ç«¯æœå‹™æœªå•Ÿå‹•$(NC)"
	@curl -s http://localhost:8000/health > /dev/null && echo "$(GREEN)âœ… SimWorld å¾Œç«¯æœå‹™æ­£å¸¸$(NC)" || echo "$(RED)âŒ SimWorld å¾Œç«¯æœå‹™æœªå•Ÿå‹•$(NC)"

smoke-test:
	@echo "$(YELLOW)ğŸ’¨ åŸ·è¡Œå¿«é€Ÿç…™éœ§æ¸¬è©¦...$(NC)"
	@curl -s http://localhost:8080/health | python3 -m json.tool
	@curl -s http://localhost:8080/api/v1/mesh/nodes | python3 -m json.tool | head -20

coverage:
	@echo "$(CYAN)ğŸ“Š æ¸¬è©¦è¦†è“‹ç¯„åœ$(NC)"
	@echo "==============="
	@echo ""
	@echo "$(GREEN)âœ… NetStack æ ¸å¿ƒåŠŸèƒ½ (97% è¦†è“‹)$(NC)"
	@echo "  ğŸ“¡ ç¶²è·¯æ ¸å¿ƒ API - çµ±ä¸€ API è·¯ç”±ã€å¥åº·æª¢æŸ¥ã€æœå‹™ç™¼ç¾"
	@echo "  ğŸš UAV ç®¡ç† - UAV è¨»å†Šã€è»Œè·¡ç®¡ç†ã€UE æ•´åˆ"
	@echo "  ğŸ›¡ï¸ å¹²æ“¾æ§åˆ¶ - äº‹ä»¶é©…å‹•æ¶æ§‹ã€AI æ±ºç­–å¼•æ“"
	@echo "  ğŸŒ Mesh æ©‹æ¥ - Tier-1 Mesh ç¶²è·¯èˆ‡ 5G æ ¸å¿ƒç¶²æ©‹æ¥"
	@echo "  ğŸ”„ UAV-Mesh å‚™æ´ - å¤±è¯æª¢æ¸¬ã€è‡ªå‹•åˆ‡æ›ï¼ˆ2ç§’å…§é‡å»ºï¼‰"
	@echo "  ğŸ›°ï¸ è¡›æ˜Ÿé€šä¿¡ - NTN é…ç½®ã€gNodeB æ•´åˆã€å»¶é²æœ€ä½³åŒ–"
	@echo "  âš¡ æ€§èƒ½æœ€ä½³åŒ– - è² è¼‰æ¸¬è©¦ã€åˆ‡ç‰‡åˆ‡æ›ã€UERANSIM æ•´åˆ"
	@echo ""
	@echo "$(GREEN)âœ… SimWorld æ¨¡æ“¬æ ¸å¿ƒ (95% è¦†è“‹)$(NC)"
	@echo "  ğŸ“» Sionna ç„¡ç·šé€šé“ - é€šé“æ¨¡å‹ã€å ´æ™¯æ¨¡æ“¬ã€å“è³ªè©•ä¼°"
	@echo "  ğŸ—ï¸ CQRS æ¶æ§‹ - è¡›æ˜Ÿä½ç½®è®€å¯«åˆ†é›¢ã€å‘½ä»¤æŸ¥è©¢åˆ†é›¢"
	@echo "  ğŸ­ å ´æ™¯ç®¡ç† - å¤šå ´æ™¯æ”¯æ´ï¼ˆNYCUã€Lotusã€NTPUã€Nanliaoï¼‰"
	@echo "  ğŸ¥ å¥åº·åº¦æª¢æŸ¥ - å ´æ™¯è‡ªå‹•å›é€€ã€æª”æ¡ˆå®Œæ•´æ€§é©—è­‰"
	@echo "  ğŸ¨ å‰ç«¯çµ„ä»¶ - Charts Dropdownã€éŒ¯èª¤è™•ç†ã€éŸ¿æ‡‰å¼è¨­è¨ˆ"
	@echo ""
	@echo "$(GREEN)âœ… ç³»çµ±æ•´åˆ (93% è¦†è“‹)$(NC)"
	@echo "  ğŸ”— è·¨æœå‹™é€šä¿¡ - ç•°æ­¥å¾®æœå‹™ã€äº‹ä»¶é©…å‹•æ•´åˆ"
	@echo "  ğŸ“Š UAV-è¡›æ˜Ÿé€£æ¥å“è³ª - å³æ™‚è©•ä¼°ã€æ™ºèƒ½è·¯ç”±ã€æ•…éšœé æ¸¬"
	@echo "  ğŸ—ºï¸ ç¶²è·¯æ‹“æ’²ç®¡ç† - å‹•æ…‹ç™¼ç¾ã€æœ€ä½³åŒ–è·¯ç”±ã€QoS ä¿è­‰"
	@echo "  ğŸš€ éƒ¨ç½²è‡ªå‹•åŒ– - å¤šç’°å¢ƒé…ç½®ã€ä¸€éµéƒ¨ç½²ã€å›æ»¾æ©Ÿåˆ¶"
	@echo ""
	@echo "$(GREEN)âœ… éƒ¨ç½²èˆ‡é‹ç¶­ (90% è¦†è“‹)$(NC)"
	@echo "  âš™ï¸ é…ç½®ç®¡ç† - ç’°å¢ƒéš”é›¢ã€æ¨¡æ¿ç”Ÿæˆã€é©—è­‰æ©Ÿåˆ¶"
	@echo "  ğŸ“ˆ ç›£æ§ç³»çµ± - æŒ‡æ¨™æ”¶é›†ã€å‘Šè­¦æ©Ÿåˆ¶ã€å¯è§€æ¸¬æ€§"
	@echo "  ğŸ³ Docker åŒ–éƒ¨ç½² - å®¹å™¨ç·¨æ’ã€ç¶²è·¯éš”é›¢ã€è³‡æºç®¡ç†"
	@echo "  ğŸ’¾ å‚™ä»½æ¢å¾© - è³‡æ–™å‚™ä»½ã€ç½é›£æ¢å¾©ã€é«˜å¯ç”¨æ€§"

# ç‰¹å®šåŠŸèƒ½æ¸¬è©¦å¿«æ·æ–¹å¼
test-uav-ue:
	@echo "$(PURPLE)ğŸš UAV UE åŠŸèƒ½æ¸¬è©¦$(NC)"
	@cd integration/services && python3 test_uav_ue_integration.py

test-mesh-bridge:
	@echo "$(PURPLE)ğŸŒ Mesh æ©‹æ¥åŠŸèƒ½æ¸¬è©¦$(NC)"
	@cd integration/services && python3 test_mesh_bridge_integration.py

test-interference:
	@echo "$(PURPLE)ğŸ›¡ï¸ å¹²æ“¾æ§åˆ¶åŠŸèƒ½æ¸¬è©¦$(NC)"
	@cd integration/services && python3 test_interference_control.py

test-cqrs:
	@echo "$(PURPLE)ğŸ—ï¸ CQRS æ¶æ§‹åŠŸèƒ½æ¸¬è©¦$(NC)"
	@cd unit/simworld && python3 test_cqrs_architecture.py

# å‰µå»ºæ¸¬è©¦ä¾è³´æ–‡ä»¶
create-requirements:
	@echo "$(GREEN)ğŸ“ å‰µå»ºæ¸¬è©¦ä¾è³´æ–‡ä»¶...$(NC)"
	@echo "# NTN Stack æ¸¬è©¦ä¾è³´" > requirements-test.txt
	@echo "pytest>=7.0.0" >> requirements-test.txt
	@echo "pytest-asyncio>=0.21.0" >> requirements-test.txt
	@echo "pytest-cov>=4.0.0" >> requirements-test.txt
	@echo "httpx>=0.24.0" >> requirements-test.txt
	@echo "requests>=2.28.0" >> requirements-test.txt
	@echo "aiohttp>=3.8.0" >> requirements-test.txt
	@echo "selenium>=4.0.0" >> requirements-test.txt
	@echo "beautifulsoup4>=4.11.0" >> requirements-test.txt
	@echo "pyyaml>=6.0" >> requirements-test.txt
	@echo "jinja2>=3.1.0" >> requirements-test.txt
	@echo "$(GREEN)âœ… requirements-test.txt å·²å‰µå»º$(NC)"

# ============================================================================
# å¾æ ¹ç›®éŒ„ Makefile æ•´åˆçš„æ¸¬è©¦æŒ‡ä»¤
# ============================================================================

# ===== ç’°å¢ƒæª¢æŸ¥å’ŒæŒä¹…æ€§æ¸¬è©¦ =====

test-env-check-advanced: ## ğŸ” æª¢æŸ¥æ¸¬è©¦ç’°å¢ƒï¼ˆæœ¬åœ°å’Œå®¹å™¨ä¸­ï¼‰
	@echo "$(CYAN)ğŸ” æª¢æŸ¥æ¸¬è©¦ç’°å¢ƒ...$(NC)"
	@echo "$(YELLOW)1. æœ¬åœ°ç’°å¢ƒæª¢æŸ¥...$(NC)"
	@python3 ../tests/test_environment_check.py 2>/dev/null || echo "$(RED)âŒ æœ¬åœ°ç’°å¢ƒæª¢æŸ¥æª”æ¡ˆä¸å­˜åœ¨$(NC)"
	@echo "$(YELLOW)2. å®¹å™¨ç’°å¢ƒæª¢æŸ¥...$(NC)"
	@docker exec netstack-api python /app/tests/test_environment_check.py 2>/dev/null || echo "$(RED)âŒ å®¹å™¨ç’°å¢ƒæª¢æŸ¥å¤±æ•—$(NC)"
	@echo "$(GREEN)âœ… æ¸¬è©¦ç’°å¢ƒæª¢æŸ¥å®Œæˆ$(NC)"

test-env-persistence-advanced: ## ğŸ”§ æ¸¬è©¦ç’°å¢ƒæŒä¹…æ€§ï¼ˆæ¨¡æ“¬ make clean && make upï¼‰
	@echo "$(CYAN)ğŸ”§ æ¸¬è©¦ç’°å¢ƒæŒä¹…æ€§...$(NC)"
	@echo "$(YELLOW)æª¢æŸ¥ä¾è³´æ˜¯å¦æ­£ç¢ºå®‰è£åœ¨ Docker é¡åƒä¸­...$(NC)"
	@docker exec netstack-api python -c "import pytest; print('âœ… pytest åœ¨å®¹å™¨ä¸­å¯ç”¨')" 2>/dev/null || echo "$(RED)âŒ pytest ä¸åœ¨å®¹å™¨ä¸­$(NC)"
	@docker exec netstack-api python -c "import pytest_asyncio; print('âœ… pytest-asyncio åœ¨å®¹å™¨ä¸­å¯ç”¨')" 2>/dev/null || echo "$(RED)âŒ pytest-asyncio ä¸åœ¨å®¹å™¨ä¸­$(NC)"
	@docker exec netstack-api python -c "import httpx; print('âœ… httpx åœ¨å®¹å™¨ä¸­å¯ç”¨')" 2>/dev/null || echo "$(RED)âŒ httpx ä¸åœ¨å®¹å™¨ä¸­$(NC)"
	@docker exec netstack-api python -c "import asyncio; print('âœ… asyncio åœ¨å®¹å™¨ä¸­å¯ç”¨')" 2>/dev/null || echo "$(RED)âŒ asyncio ä¸åœ¨å®¹å™¨ä¸­$(NC)"
	@echo "$(YELLOW)æª¢æŸ¥çµ±ä¸€ API æ¨¡çµ„...$(NC)"
	@docker exec netstack-api python -c "from netstack_api.routers.unified_api_router import unified_router; print('âœ… çµ±ä¸€ API è·¯ç”±å™¨å¯ç”¨')" 2>/dev/null || echo "$(RED)âŒ çµ±ä¸€ API è·¯ç”±å™¨ä¸å¯ç”¨$(NC)"
	@docker exec netstack-api python -c "from netstack_api.models.unified_models import SystemStatusResponse; print('âœ… çµ±ä¸€æ¨¡å‹å¯ç”¨')" 2>/dev/null || echo "$(RED)âŒ çµ±ä¸€æ¨¡å‹ä¸å¯ç”¨$(NC)"
	@echo "$(GREEN)âœ… ç’°å¢ƒæŒä¹…æ€§æª¢æŸ¥å®Œæˆ$(NC)"

# ===== çµ±ä¸€ API æ¸¬è©¦ =====

test-unified-api-local: ## ğŸŒ æœ¬åœ°çµ±ä¸€ API æ¸¬è©¦
	@echo "$(CYAN)ğŸŒ åŸ·è¡Œæœ¬åœ°çµ±ä¸€ API æ¸¬è©¦...$(NC)"
	@echo "$(YELLOW)ç¢ºä¿æ¸¬è©¦ä¾è³´å·²å®‰è£...$(NC)"
	@pip install -q pytest pytest-asyncio httpx structlog 2>/dev/null || pip3 install -q pytest pytest-asyncio httpx structlog 2>/dev/null
	@python3 -m pytest ../tests/test_unified_api.py -v --tb=short 2>/dev/null || echo "$(RED)âŒ çµ±ä¸€ API æ¸¬è©¦æª”æ¡ˆä¸å­˜åœ¨$(NC)"
	@echo "$(GREEN)âœ… æœ¬åœ°çµ±ä¸€ API æ¸¬è©¦å®Œæˆ$(NC)"

test-unified-api-docker: ## ğŸ³ Docker å®¹å™¨ä¸­çµ±ä¸€ API æ¸¬è©¦
	@echo "$(CYAN)ğŸ³ åŸ·è¡Œ Docker å®¹å™¨ä¸­çµ±ä¸€ API æ¸¬è©¦...$(NC)"
	@docker exec netstack-api python -m pytest /app/tests/test_unified_api.py -v --tb=short 2>/dev/null || echo "$(RED)âŒ å®¹å™¨ä¸­æ¸¬è©¦å¤±æ•—$(NC)"
	@echo "$(GREEN)âœ… Docker çµ±ä¸€ API æ¸¬è©¦å®Œæˆ$(NC)"

test-unified-api-complete: ## ğŸ¯ å®Œæ•´çµ±ä¸€ API æ¸¬è©¦ï¼ˆæœ¬åœ°+å®¹å™¨ï¼‰
	@echo "$(CYAN)ğŸ¯ åŸ·è¡Œå®Œæ•´çµ±ä¸€ API æ¸¬è©¦...$(NC)"
	@$(MAKE) test-env-check-advanced
	@$(MAKE) test-unified-api-local
	@$(MAKE) test-unified-api-docker
	@echo "$(GREEN)âœ… å®Œæ•´çµ±ä¸€ API æ¸¬è©¦å®Œæˆ$(NC)"

# ===== NetStack æ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦ï¼ˆShell è…³æœ¬ï¼‰ =====

test-ntn-validation: ## ğŸš€ åŸ·è¡Œ NTN åŠŸèƒ½å¿«é€Ÿé©—è­‰
	@echo "$(CYAN)ğŸš€ åŸ·è¡Œ NTN åŠŸèƒ½å¿«é€Ÿé©—è­‰...$(NC)"
	@cd shell/netstack && bash ./quick_ntn_validation.sh
	@echo "$(GREEN)âœ… NTN åŠŸèƒ½é©—è­‰å®Œæˆ$(NC)"

test-config-validation: ## âš™ï¸ åŸ·è¡Œ NTN é…ç½®é©—è­‰æ¸¬è©¦
	@echo "$(CYAN)âš™ï¸ åŸ·è¡Œ NTN é…ç½®é©—è­‰æ¸¬è©¦...$(NC)"
	@cd shell/netstack && bash ./ntn_config_validation_test.sh
	@echo "$(GREEN)âœ… NTN é…ç½®é©—è­‰å®Œæˆ$(NC)"

test-satellite-gnb: ## ğŸ›°ï¸ åŸ·è¡Œè¡›æ˜Ÿ-gNodeB æ•´åˆæ¸¬è©¦
	@echo "$(CYAN)ğŸ›°ï¸ åŸ·è¡Œè¡›æ˜Ÿ-gNodeB æ•´åˆæ¸¬è©¦...$(NC)"
	@cd shell/netstack && bash ./satellite_gnb_integration_test.sh
	@echo "$(GREEN)âœ… è¡›æ˜Ÿ-gNodeB æ•´åˆæ¸¬è©¦å®Œæˆ$(NC)"

test-ueransim: ## ğŸ“¡ åŸ·è¡Œ UERANSIM é…ç½®æ¸¬è©¦
	@echo "$(CYAN)ğŸ“¡ åŸ·è¡Œ UERANSIM é…ç½®æ¸¬è©¦...$(NC)"
	@cd shell/netstack && bash ./ueransim_config_test.sh
	@echo "$(GREEN)âœ… UERANSIM é…ç½®æ¸¬è©¦å®Œæˆ$(NC)"

test-latency: ## ğŸ• åŸ·è¡Œ NTN å»¶é²æ¸¬è©¦
	@echo "$(CYAN)ğŸ• åŸ·è¡Œ NTN å»¶é²æ¸¬è©¦...$(NC)"
	@cd shell/netstack && bash ./ntn_latency_test.sh
	@echo "$(GREEN)âœ… NTN å»¶é²æ¸¬è©¦å®Œæˆ$(NC)"

test-e2e-netstack: ## ğŸ”„ åŸ·è¡Œ NetStack ç«¯åˆ°ç«¯æ¸¬è©¦
	@echo "$(CYAN)ğŸ”„ åŸ·è¡Œ NetStack ç«¯åˆ°ç«¯æ¸¬è©¦...$(NC)"
	@cd shell/netstack && bash ./e2e_netstack.sh
	@echo "$(GREEN)âœ… NetStack ç«¯åˆ°ç«¯æ¸¬è©¦å®Œæˆ$(NC)"

test-slice-switching: ## ğŸ”€ åŸ·è¡Œåˆ‡ç‰‡åˆ‡æ›æ¸¬è©¦
	@echo "$(CYAN)ğŸ”€ åŸ·è¡Œåˆ‡ç‰‡åˆ‡æ›æ¸¬è©¦...$(NC)"
	@cd shell/netstack && bash ./slice_switching_test.sh
	@echo "$(GREEN)âœ… åˆ‡ç‰‡åˆ‡æ›æ¸¬è©¦å®Œæˆ$(NC)"

test-performance-advanced: ## âš¡ åŸ·è¡Œæ€§èƒ½æ¸¬è©¦
	@echo "$(CYAN)âš¡ åŸ·è¡Œæ€§èƒ½æ¸¬è©¦...$(NC)"
	@cd shell/netstack && bash ./performance_test.sh
	@echo "$(GREEN)âœ… æ€§èƒ½æ¸¬è©¦å®Œæˆ$(NC)"

test-connectivity-advanced: ## ğŸ”— åŸ·è¡Œé€£æ¥æ€§æ¸¬è©¦
	@echo "$(CYAN)ğŸ”— åŸ·è¡Œé€£æ¥æ€§æ¸¬è©¦...$(NC)"
	@cd shell/netstack && bash ./test_connectivity.sh
	@echo "$(GREEN)âœ… é€£æ¥æ€§æ¸¬è©¦å®Œæˆ$(NC)"

# ===== Sionna æ•´åˆæ¸¬è©¦ =====

test-sionna-integration: ## ğŸ“¡ åŸ·è¡Œ Sionna ç„¡ç·šé€šé“æ¨¡å‹æ•´åˆæ¸¬è©¦
	@echo "$(CYAN)ğŸ“¡ åŸ·è¡Œ Sionna ç„¡ç·šé€šé“æ¨¡å‹æ•´åˆæ¸¬è©¦...$(NC)"
	@cd .. && python3 test_sionna_integration.py 2>/dev/null || echo "$(RED)âŒ Sionna æ•´åˆæ¸¬è©¦æª”æ¡ˆä¸å­˜åœ¨$(NC)"
	@echo "$(GREEN)âœ… Sionna æ•´åˆæ¸¬è©¦å®Œæˆ$(NC)"

test-sionna-core: ## ğŸ¯ åŸ·è¡Œ Sionna æ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦
	@echo "$(CYAN)ğŸ¯ åŸ·è¡Œ Sionna æ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦...$(NC)"
	@cd .. && python3 test_sionna_core.py 2>/dev/null || echo "$(RED)âŒ Sionna æ ¸å¿ƒæ¸¬è©¦æª”æ¡ˆä¸å­˜åœ¨$(NC)"
	@echo "$(GREEN)âœ… Sionna æ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦å®Œæˆ$(NC)"

# ===== é«˜ç´šæ¸¬è©¦çµ„åˆ =====

test-netstack-only: ## ğŸ“¡ åƒ…åŸ·è¡Œ NetStack æ¸¬è©¦
	@echo "$(CYAN)ğŸ“¡ åŸ·è¡Œ NetStack æ¸¬è©¦...$(NC)"
	@python3 tools/test_runner.py --suite netstack
	@echo "$(GREEN)âœ… NetStack æ¸¬è©¦å®Œæˆ$(NC)"

test-simworld-only: ## ğŸŒ åƒ…åŸ·è¡Œ SimWorld æ¸¬è©¦
	@echo "$(CYAN)ğŸŒ åŸ·è¡Œ SimWorld æ¸¬è©¦...$(NC)"
	@cd ../simworld && $(MAKE) test-all 2>/dev/null || echo "$(RED)âŒ SimWorld æ¸¬è©¦å¤±æ•—$(NC)"
	@echo "$(GREEN)âœ… SimWorld æ¸¬è©¦å®Œæˆ$(NC)"

test-advanced-all: ## ğŸš€ åŸ·è¡Œé€²éšåŠŸèƒ½æ¸¬è©¦
	@echo "$(CYAN)ğŸš€ åŸ·è¡Œé€²éšåŠŸèƒ½æ¸¬è©¦...$(NC)"
	@$(MAKE) test-integration-all
	@$(MAKE) test-satellite-gnb
	@$(MAKE) test-ueransim
	@$(MAKE) test-performance-advanced
	@$(MAKE) test-uav-ue
	@echo "$(GREEN)âœ… é€²éšåŠŸèƒ½æ¸¬è©¦å®Œæˆ$(NC)"

test-legacy-shell: ## ğŸ”„ åŸ·è¡Œå‚³çµ± Shell æ¸¬è©¦ï¼ˆå‘å¾Œå…¼å®¹ï¼‰
	@echo "$(CYAN)ğŸ”„ åŸ·è¡Œå‚³çµ± Shell æ¸¬è©¦...$(NC)"
	@$(MAKE) test-config-validation
	@$(MAKE) test-latency
	@$(MAKE) test-e2e-netstack
	@$(MAKE) test-slice-switching
	@echo "$(GREEN)âœ… å‚³çµ±æ¸¬è©¦å®Œæˆ$(NC)"

# ===== UAV UE æ•´åˆæ¸¬è©¦ =====

test-uav-ue-integration: ## ğŸš åŸ·è¡Œ UAV UE æ•´åˆæ¸¬è©¦
	@echo "$(CYAN)ğŸš åŸ·è¡Œ UAV UE æ•´åˆæ¸¬è©¦...$(NC)"
	@echo "$(YELLOW)ç¢ºèªæ¸¬è©¦ä¾è³´å·²å®‰è£...$(NC)"
	@pip install -q pytest httpx asyncio 2>/dev/null || pip3 install -q pytest httpx asyncio 2>/dev/null
	@cd .. && python3 tests/test_uav_ue_integration.py 2>/dev/null || echo "$(RED)âŒ UAV UE æ•´åˆæ¸¬è©¦æª”æ¡ˆä¸å­˜åœ¨$(NC)"
	@echo "$(GREEN)âœ… UAV UE æ•´åˆæ¸¬è©¦å®Œæˆ$(NC)"

test-uav-ue-quick: ## âš¡ åŸ·è¡Œ UAV UE å¿«é€Ÿæ¸¬è©¦
	@echo "$(CYAN)âš¡ åŸ·è¡Œ UAV UE å¿«é€Ÿæ¸¬è©¦...$(NC)"
	@echo "$(YELLOW)æ¸¬è©¦ NetStack UAV UE API ç«¯é»...$(NC)"
	@curl -s http://localhost:8080/api/v1/uav > /dev/null && echo "$(GREEN)âœ… UAV åˆ—è¡¨ç«¯é»æ­£å¸¸$(NC)" || echo "$(RED)âŒ UAV åˆ—è¡¨ç«¯é»ç•°å¸¸$(NC)"
	@curl -s http://localhost:8080/api/v1/uav/trajectory > /dev/null && echo "$(GREEN)âœ… è»Œè·¡åˆ—è¡¨ç«¯é»æ­£å¸¸$(NC)" || echo "$(RED)âŒ è»Œè·¡åˆ—è¡¨ç«¯é»ç•°å¸¸$(NC)"
	@echo "$(YELLOW)æ¸¬è©¦ SimWorld UAV ä½ç½®ç«¯é»...$(NC)"
	@curl -s http://localhost:8888/api/v1/uav/positions > /dev/null && echo "$(GREEN)âœ… SimWorld UAV ä½ç½®ç«¯é»æ­£å¸¸$(NC)" || echo "$(RED)âŒ SimWorld UAV ä½ç½®ç«¯é»ç•°å¸¸$(NC)"
	@echo "$(GREEN)âœ… UAV UE å¿«é€Ÿæ¸¬è©¦å®Œæˆ$(NC)"

test-uav-ue-demo: ## ğŸš€ åŸ·è¡Œ UAV UE æ¼”ç¤º
	@echo "$(CYAN)ğŸš€ åŸ·è¡Œ UAV UE æ¼”ç¤º...$(NC)"
	@curl -X POST http://localhost:8080/api/v1/uav/demo/quick-test -H "Content-Type: application/json" 2>/dev/null | jq . || echo "$(RED)âŒ æ¼”ç¤ºå¤±æ•—ï¼Œè«‹æª¢æŸ¥æœå‹™ç‹€æ…‹$(NC)"
	@echo "$(GREEN)âœ… UAV UE æ¼”ç¤ºå®Œæˆ$(NC)"

test-uav-ue-validation: ## ğŸ¯ åŸ·è¡Œ UAV UE å®Œæ•´æ€§é©—è­‰
	@echo "$(CYAN)ğŸ¯ åŸ·è¡Œ UAV UE å®Œæ•´æ€§é©—è­‰...$(NC)"
	@echo "$(YELLOW)æª¢æŸ¥æ‰€æœ‰ TODO.md è¦æ±‚æ˜¯å¦å®Œæˆ...$(NC)"
	@cd .. && python3 tests/validate_uav_ue_implementation.py 2>/dev/null || echo "$(RED)âŒ UAV UE é©—è­‰æª”æ¡ˆä¸å­˜åœ¨$(NC)"
	@echo "$(GREEN)âœ… UAV UE å®Œæ•´æ€§é©—è­‰å®Œæˆ$(NC)"

test-uav-ue-comprehensive: ## ğŸš€ åŸ·è¡Œ UAV UE ç¶œåˆæ¸¬è©¦ï¼ˆåŒ…å«æ‰€æœ‰å­æ¸¬è©¦ï¼‰
	@echo "$(CYAN)ğŸš€ åŸ·è¡Œ UAV UE ç¶œåˆæ¸¬è©¦å¥—ä»¶...$(NC)"
	@$(MAKE) test-uav-ue-quick
	@$(MAKE) test-uav-ue-demo
	@$(MAKE) test-uav-ue-integration
	@$(MAKE) test-uav-ue-validation
	@echo "$(GREEN)ğŸ‰ UAV UE ç¶œåˆæ¸¬è©¦å®Œæˆ$(NC)"

# ===== UAV-è¡›æ˜Ÿé€£æ¥è³ªé‡è©•ä¼°æ¸¬è©¦ =====

test-uav-satellite-connection-quality: ## ğŸ›°ï¸ æ¸¬è©¦ UAV-è¡›æ˜Ÿé€£æ¥è³ªé‡è©•ä¼°ç³»çµ±
	@echo "$(CYAN)ğŸ” é–‹å§‹æ¸¬è©¦ UAV-è¡›æ˜Ÿé€£æ¥è³ªé‡è©•ä¼°ç³»çµ±...$(NC)"
	@cd .. && python3 tests/test_uav_satellite_connection_quality.py 2>/dev/null || echo "$(RED)âŒ UAV-è¡›æ˜Ÿé€£æ¥æ¸¬è©¦æª”æ¡ˆä¸å­˜åœ¨$(NC)"
	@echo "$(GREEN)âœ… UAV-è¡›æ˜Ÿé€£æ¥è³ªé‡è©•ä¼°æ¸¬è©¦å®Œæˆ$(NC)"

test-uav-satellite-connection-quality-quick: ## âš¡ å¿«é€Ÿæ¸¬è©¦ UAV-è¡›æ˜Ÿé€£æ¥è³ªé‡è©•ä¼°ç³»çµ±ï¼ˆåƒ…æ ¸å¿ƒåŠŸèƒ½ï¼‰
	@echo "$(CYAN)âš¡ å¿«é€Ÿæ¸¬è©¦ UAV-è¡›æ˜Ÿé€£æ¥è³ªé‡è©•ä¼°ç³»çµ±...$(NC)"
	@cd .. && timeout 60 python3 tests/test_uav_satellite_connection_quality.py 2>/dev/null || echo "$(YELLOW)ğŸ• 60ç§’å¿«é€Ÿæ¸¬è©¦å®Œæˆ$(NC)"

test-uav-satellite-all: ## ğŸŒŒ æ¸¬è©¦æ‰€æœ‰ UAV-è¡›æ˜Ÿç›¸é—œåŠŸèƒ½
	@echo "$(CYAN)ğŸš€ æ¸¬è©¦æ‰€æœ‰ UAV-è¡›æ˜ŸåŠŸèƒ½...$(NC)"
	@$(MAKE) test-uav-ue-validation
	@$(MAKE) test-uav-satellite-connection-quality
	@echo "$(GREEN)âœ… æ‰€æœ‰ UAV-è¡›æ˜ŸåŠŸèƒ½æ¸¬è©¦å®Œæˆ$(NC)"

test-connection-quality: ## ğŸ”¬ é–‹å§‹ UAV-è¡›æ˜Ÿé€£æ¥è³ªé‡è©•ä¼°ç³»çµ±æ¸¬è©¦
	@echo "$(CYAN)ğŸ”¬ é–‹å§‹ UAV-è¡›æ˜Ÿé€£æ¥è³ªé‡è©•ä¼°ç³»çµ±æ¸¬è©¦...$(NC)"
	@cd .. && python -m pytest tests/test_uav_satellite_connection_quality.py -v --tb=short 2>/dev/null || echo "$(RED)âŒ é€£æ¥è³ªé‡æ¸¬è©¦å¤±æ•—$(NC)"

test-connection-quality-detailed: ## ğŸ“Š é–‹å§‹è©³ç´°çš„é€£æ¥è³ªé‡è©•ä¼°æ¸¬è©¦
	@echo "$(CYAN)ğŸ”¬ é–‹å§‹è©³ç´°çš„é€£æ¥è³ªé‡è©•ä¼°æ¸¬è©¦...$(NC)"
	@cd .. && python tests/test_uav_satellite_connection_quality.py 2>/dev/null || echo "$(RED)âŒ è©³ç´°é€£æ¥è³ªé‡æ¸¬è©¦å¤±æ•—$(NC)"

test-connection-quality-quick: ## âš¡ å¿«é€Ÿé€£æ¥è³ªé‡è©•ä¼°æ¸¬è©¦
	@echo "$(CYAN)âš¡ å¿«é€Ÿé€£æ¥è³ªé‡è©•ä¼°æ¸¬è©¦...$(NC)"
	@cd .. && timeout 30 python tests/test_uav_satellite_connection_quality.py 2>/dev/null || echo "$(YELLOW)æ¸¬è©¦å®Œæˆï¼ˆå¯èƒ½å› ç‚ºæœå‹™æœªå•Ÿå‹•è€Œå¤±æ•—ï¼‰$(NC)"

# ===== å‰ç«¯çµ„ä»¶æ¸¬è©¦ =====

test-frontend-charts-dropdown: ## ğŸ¨ æ¸¬è©¦å‰ç«¯åœ–è¡¨ Dropdown åŠŸèƒ½
	@echo "$(CYAN)ğŸ¨ æ¸¬è©¦å‰ç«¯åœ–è¡¨ Dropdown åŠŸèƒ½...$(NC)"
	@cd .. && python3 tests/test_frontend_charts_dropdown.py 2>/dev/null || echo "$(RED)âŒ å‰ç«¯åœ–è¡¨æ¸¬è©¦æª”æ¡ˆä¸å­˜åœ¨$(NC)"
	@echo "$(GREEN)âœ… å‰ç«¯åœ–è¡¨ Dropdown æ¸¬è©¦å®Œæˆ$(NC)"

test-frontend-error-handling: ## ğŸ›¡ï¸ æ¸¬è©¦å‰ç«¯éŒ¯èª¤è™•ç†åŠŸèƒ½
	@echo "$(CYAN)ğŸ›¡ï¸ æ¸¬è©¦å‰ç«¯éŒ¯èª¤è™•ç†åŠŸèƒ½...$(NC)"
	@cd .. && python3 tests/test_frontend_error_handling.py 2>/dev/null || echo "$(RED)âŒ å‰ç«¯éŒ¯èª¤è™•ç†æ¸¬è©¦æª”æ¡ˆä¸å­˜åœ¨$(NC)"
	@echo "$(GREEN)âœ… å‰ç«¯éŒ¯èª¤è™•ç†æ¸¬è©¦å®Œæˆ$(NC)"

test-frontend-validation-complete: ## ğŸŒ åŸ·è¡Œå‰ç«¯çµ„ä»¶é©—è­‰
	@echo "$(CYAN)ğŸŒ åŸ·è¡Œå‰ç«¯çµ„ä»¶é©—è­‰...$(NC)"
	@$(MAKE) test-frontend-charts-dropdown
	@$(MAKE) test-frontend-error-handling
	@echo "$(GREEN)âœ… å‰ç«¯çµ„ä»¶é©—è­‰å®Œæˆ$(NC)"

test-frontend-dev-server: ## ğŸš€ å•Ÿå‹•å‰ç«¯é–‹ç™¼ä¼ºæœå™¨
	@echo "$(CYAN)ğŸš€ å•Ÿå‹•å‰ç«¯é–‹ç™¼ä¼ºæœå™¨...$(NC)"
	@cd ../simworld/frontend && npm run dev 2>/dev/null || echo "$(RED)âŒ å‰ç«¯é–‹ç™¼ä¼ºæœå™¨å•Ÿå‹•å¤±æ•—$(NC)"
	@echo "$(GREEN)âœ… å‰ç«¯é–‹ç™¼ä¼ºæœå™¨å•Ÿå‹•å®Œæˆ$(NC)"

test-frontend-build: ## ğŸ”¨ æ¸¬è©¦å‰ç«¯å»ºç½®
	@echo "$(CYAN)ğŸ”¨ æ¸¬è©¦å‰ç«¯å»ºç½®...$(NC)"
	@cd ../simworld/frontend && npm run build 2>/dev/null || echo "$(RED)âŒ å‰ç«¯å»ºç½®å¤±æ•—$(NC)"
	@echo "$(GREEN)âœ… å‰ç«¯å»ºç½®æ¸¬è©¦å®Œæˆ$(NC)"

# ===== äº‹ä»¶é©…å‹•æ¶æ§‹æ¸¬è©¦ =====

test-event-driven: ## ğŸ”„ æ¸¬è©¦äº‹ä»¶é©…å‹•æ¶æ§‹
	@echo "$(CYAN)ğŸ”„ æ¸¬è©¦ NetStack äº‹ä»¶é©…å‹•æ¶æ§‹...$(NC)"
	@echo "$(YELLOW)1. æ¸¬è©¦äº‹ä»¶ç¸½ç·šæœå‹™...$(NC)"
	@curl -s -X POST http://localhost:8080/api/v1/interference/quick-demo 2>/dev/null | jq . || echo "$(RED)âŒ äº‹ä»¶é©…å‹•å¹²æ“¾æ§åˆ¶æ¼”ç¤ºå¤±æ•—$(NC)"
	@echo "$(YELLOW)2. æª¢æŸ¥äº‹ä»¶ç¸½ç·šæŒ‡æ¨™...$(NC)"
	@curl -s http://localhost:8080/metrics 2>/dev/null | grep -i event || echo "$(RED)âŒ äº‹ä»¶ç¸½ç·šæŒ‡æ¨™ä¸å¯ç”¨$(NC)"
	@echo "$(GREEN)âœ… äº‹ä»¶é©…å‹•æ¶æ§‹æ¸¬è©¦å®Œæˆ$(NC)"

test-cqrs-advanced: ## ğŸ“Š æ¸¬è©¦ CQRS è¡›æ˜Ÿæœå‹™
	@echo "$(CYAN)ğŸ“Š æ¸¬è©¦ SimWorld CQRS è¡›æ˜Ÿæœå‹™...$(NC)"
	@echo "$(YELLOW)1. æ¸¬è©¦ CQRS è¡›æ˜Ÿä½ç½®æŸ¥è©¢...$(NC)"
	@curl -s -X POST http://localhost:8888/api/v1/satellite/25544/position-cqrs 2>/dev/null | jq . || echo "$(RED)âŒ CQRS ä½ç½®æŸ¥è©¢å¤±æ•—$(NC)"
	@echo "$(YELLOW)2. æ¸¬è©¦æ‰¹é‡ä½ç½®æŸ¥è©¢...$(NC)"
	@curl -s -X POST http://localhost:8888/api/v1/satellite/batch-positions-cqrs -H "Content-Type: application/json" -d '[25544, 40069]' 2>/dev/null | jq . || echo "$(RED)âŒ CQRS æ‰¹é‡æŸ¥è©¢å¤±æ•—$(NC)"
	@echo "$(YELLOW)3. æª¢æŸ¥ CQRS æœå‹™çµ±è¨ˆ...$(NC)"
	@curl -s http://localhost:8888/api/v1/cqrs/satellite-service/stats 2>/dev/null | jq . || echo "$(RED)âŒ CQRS çµ±è¨ˆä¸å¯ç”¨$(NC)"
	@echo "$(GREEN)âœ… CQRS æ¸¬è©¦å®Œæˆ$(NC)"

test-microservice-communication: ## ğŸŒ æ¸¬è©¦å¾®æœå‹™é–“é€šä¿¡
	@echo "$(CYAN)ğŸŒ æ¸¬è©¦ç•°æ­¥å¾®æœå‹™æ¶æ§‹...$(NC)"
	@echo "$(YELLOW)1. æ¸¬è©¦çµ±ä¸€ API æœå‹™ç™¼ç¾...$(NC)"
	@curl -s http://localhost:8080/unified/system/discovery 2>/dev/null | jq . || echo "$(RED)âŒ æœå‹™ç™¼ç¾å¤±æ•—$(NC)"
	@echo "$(YELLOW)2. æ¸¬è©¦è·¨æœå‹™äº‹ä»¶æ¼”ç¤º...$(NC)"
	@curl -s -X POST http://localhost:8080/unified/event-driven/interference-satellite-demo 2>/dev/null | jq . || echo "$(RED)âŒ è·¨æœå‹™äº‹ä»¶æ¼”ç¤ºå¤±æ•—$(NC)"
	@echo "$(YELLOW)3. æ¸¬è©¦æ¶æ§‹å°æ¯”...$(NC)"
	@curl -s http://localhost:8080/unified/architecture/comparison 2>/dev/null | jq . || echo "$(RED)âŒ æ¶æ§‹å°æ¯”ä¸å¯ç”¨$(NC)"
	@echo "$(GREEN)âœ… å¾®æœå‹™é€šä¿¡æ¸¬è©¦å®Œæˆ$(NC)"

test-new-architecture: ## ğŸš€ å®Œæ•´æ¸¬è©¦æ–°æ¶æ§‹ï¼ˆäº‹ä»¶é©…å‹• + CQRS + ç•°æ­¥å¾®æœå‹™ï¼‰
	@echo "$(CYAN)ğŸš€ åŸ·è¡Œå®Œæ•´æ–°æ¶æ§‹æ¸¬è©¦å¥—ä»¶...$(NC)"
	@$(MAKE) test-event-driven
	@$(MAKE) test-cqrs-advanced
	@$(MAKE) test-microservice-communication
	@echo "$(GREEN)ğŸ‰ æ–°æ¶æ§‹å®Œæ•´æ¸¬è©¦å®Œæˆ$(NC)"

test-architecture-performance: ## âš¡ æ–°æ¶æ§‹æ€§èƒ½æ¸¬è©¦
	@echo "$(CYAN)âš¡ æ–°æ¶æ§‹æ€§èƒ½æ¸¬è©¦...$(NC)"
	@echo "$(YELLOW)1. äº‹ä»¶ç¸½ç·šååé‡æ¸¬è©¦...$(NC)"
	@for i in {1..10}; do \
		curl -s -X POST http://localhost:8080/api/v1/interference/quick-demo > /dev/null 2>&1 & \
	done; \
	wait; \
	echo "$(GREEN)âœ… ä¸¦ç™¼äº‹ä»¶è™•ç†æ¸¬è©¦å®Œæˆ$(NC)"
	@echo "$(YELLOW)2. CQRS è®€å¯«åˆ†é›¢æ€§èƒ½æ¸¬è©¦...$(NC)"
	@for i in {1..5}; do \
		curl -s -X POST http://localhost:8888/api/v1/satellite/25544/position-cqrs > /dev/null 2>&1 & \
		curl -s -X POST http://localhost:8888/api/v1/satellite/25544/force-update-cqrs > /dev/null 2>&1 & \
	done; \
	wait; \
	@echo "$(GREEN)âœ… CQRS æ€§èƒ½æ¸¬è©¦å®Œæˆ$(NC)"

# ===== æ¶æ§‹é©—è­‰å’Œè¨ºæ–· =====

verify-architecture: ## ğŸ” é©—è­‰ä¸‰å€‹é‡æ§‹ç›®æ¨™é”æˆæƒ…æ³
	@echo "$(CYAN)ğŸ” é©—è­‰ä¸‰å€‹é‡æ§‹ç›®æ¨™é”æˆæƒ…æ³...$(NC)"
	@echo ""
	@echo "$(YELLOW)âœ… ç›®æ¨™ 1: NetStack äº‹ä»¶é©…å‹•æ¶æ§‹ï¼ˆå¹²æ“¾æª¢æ¸¬ç•°æ­¥åŒ–ï¼‰$(NC)"
	@echo "   - äº‹ä»¶ç¸½ç·šæœå‹™: $$(curl -s http://localhost:8080/health 2>/dev/null | jq -r '.components.event_bus // "âŒ æœªå•Ÿå‹•"')"
	@echo "   - å¹²æ“¾æ§åˆ¶äº‹ä»¶åŒ–: $$(curl -s http://localhost:8080/api/v1/interference/status 2>/dev/null | jq -r '.service_type // "âŒ éäº‹ä»¶é©…å‹•"')"
	@echo ""
	@echo "$(YELLOW)âœ… ç›®æ¨™ 2: SimWorld CQRS æ¨¡å¼ï¼ˆè¡›æ˜Ÿä½ç½®è®€å¯«åˆ†é›¢ï¼‰$(NC)"
	@echo "   - CQRS æœå‹™ç‹€æ…‹: $$(curl -s http://localhost:8888/api/v1/cqrs/satellite-service/stats 2>/dev/null | jq -r '.running // "âŒ æœªé‹è¡Œ"')"
	@echo "   - è®€å¯«åˆ†é›¢æŒ‡æ¨™: $$(curl -s http://localhost:8888/api/v1/cqrs/satellite-service/stats 2>/dev/null | jq -r '.command_stats.position_updates // 0')/$$(curl -s http://localhost:8888/api/v1/cqrs/satellite-service/stats 2>/dev/null | jq -r '.query_stats.position_queries // 0') (å¯«/è®€)"
	@echo ""
	@echo "$(YELLOW)âœ… ç›®æ¨™ 3: å…¨é¢ç•°æ­¥å¾®æœå‹™æ¶æ§‹$(NC)"
	@echo "   - çµ±ä¸€ API ç‹€æ…‹: $$(curl -s http://localhost:8080/unified/system/status 2>/dev/null | jq -r '.architecture_type // "âŒ éç•°æ­¥æ¶æ§‹"')"
	@echo "   - è·¨æœå‹™é€šä¿¡: $$(curl -s http://localhost:8080/unified/system/discovery 2>/dev/null | jq -r '.services | length')å€‹æœå‹™ç™¼ç¾"
	@echo ""
	@echo "$(GREEN)ğŸ¯ æ¶æ§‹é©—è­‰å®Œæˆ$(NC)"

verify-architecture-detailed: ## ğŸ”¬ è©³ç´°æ¶æ§‹é©—è­‰ï¼ˆä½¿ç”¨é©—è­‰è…³æœ¬ï¼‰
	@echo "$(CYAN)ğŸ”¬ åŸ·è¡Œè©³ç´°æ¶æ§‹é©—è­‰...$(NC)"
	@cd .. && python3 tests/tools/verify_architecture_status.py 2>/dev/null || echo "$(RED)âŒ æ¶æ§‹é©—è­‰è…³æœ¬ä¸å­˜åœ¨$(NC)"
	@echo "$(GREEN)âœ… è©³ç´°æ¶æ§‹é©—è­‰å®Œæˆ$(NC)"

architecture-health-check: ## ğŸ¥ æ–°æ¶æ§‹å¥åº·æª¢æŸ¥
	@echo "$(CYAN)ğŸ¥ æ–°æ¶æ§‹å¥åº·æª¢æŸ¥...$(NC)"
	@echo "$(YELLOW)æª¢æŸ¥äº‹ä»¶ç¸½ç·šå¥åº·ç‹€æ…‹...$(NC)"
	@curl -s http://localhost:8080/health 2>/dev/null | jq '.components.event_bus' || echo "$(RED)âŒ äº‹ä»¶ç¸½ç·šç•°å¸¸$(NC)"
	@echo "$(YELLOW)æª¢æŸ¥ CQRS æœå‹™å¥åº·ç‹€æ…‹...$(NC)"
	@curl -s http://localhost:8888/ping 2>/dev/null || echo "$(RED)âŒ CQRS æœå‹™ç•°å¸¸$(NC)"
	@echo "$(YELLOW)æª¢æŸ¥å¾®æœå‹™é€šä¿¡å¥åº·ç‹€æ…‹...$(NC)"
	@curl -s http://localhost:8080/unified/system/status 2>/dev/null | jq '.health_status' || echo "$(RED)âŒ å¾®æœå‹™é€šä¿¡ç•°å¸¸$(NC)"
	@echo "$(GREEN)âœ… æ¶æ§‹å¥åº·æª¢æŸ¥å®Œæˆ$(NC)"

monitor-architecture: ## ğŸ“ˆ ç›£æ§æ–°æ¶æ§‹ç‹€æ…‹
	@echo "$(CYAN)ğŸ“ˆ ç›£æ§æ–°æ¶æ§‹ç‹€æ…‹...$(NC)"
	@echo "$(YELLOW)äº‹ä»¶ç¸½ç·šæŒ‡æ¨™:$(NC)"
	@curl -s http://localhost:8080/metrics 2>/dev/null | grep -E "(event|interference)" || echo "$(RED)âŒ äº‹ä»¶æŒ‡æ¨™ä¸å¯ç”¨$(NC)"
	@echo ""
	@echo "$(YELLOW)CQRS æœå‹™ç‹€æ…‹:$(NC)"
	@curl -s http://localhost:8888/api/v1/cqrs/satellite-service/stats 2>/dev/null | jq '.command_stats, .query_stats, .cache_stats' || echo "$(RED)âŒ CQRS ç‹€æ…‹ä¸å¯ç”¨$(NC)"
	@echo ""
	@echo "$(YELLOW)ç³»çµ±ç¸½è¦½:$(NC)"
	@curl -s http://localhost:8080/unified/system/status 2>/dev/null | jq '.netstack_status, .simworld_status' || echo "$(RED)âŒ ç³»çµ±ç‹€æ…‹ä¸å¯ç”¨$(NC)"

demo-new-architecture: ## ğŸ¯ æ–°æ¶æ§‹åŠŸèƒ½æ¼”ç¤º
	@echo "$(CYAN)ğŸ¯ æ–°æ¶æ§‹åŠŸèƒ½æ¼”ç¤º...$(NC)"
	@echo "$(YELLOW)1. å¹²æ“¾æª¢æ¸¬äº‹ä»¶é©…å‹•æ¼”ç¤º...$(NC)"
	@curl -s -X POST http://localhost:8080/api/v1/interference/quick-demo 2>/dev/null | jq '.scenario_id, .events_triggered, .ai_decision' || echo "$(RED)âŒ å¹²æ“¾æ¼”ç¤ºå¤±æ•—$(NC)"
	@echo ""
	@echo "$(YELLOW)2. CQRS è¡›æ˜Ÿä½ç½®æ¼”ç¤º...$(NC)"
	@curl -s -X POST http://localhost:8888/api/v1/satellite/25544/position-cqrs 2>/dev/null | jq '.satellite_name, .timestamp, .cqrs_metrics' || echo "$(RED)âŒ CQRS æ¼”ç¤ºå¤±æ•—$(NC)"
	@echo ""
	@echo "$(YELLOW)3. è·¨æœå‹™äº‹ä»¶é€šä¿¡æ¼”ç¤º...$(NC)"
	@curl -s -X POST http://localhost:8080/unified/event-driven/interference-satellite-demo 2>/dev/null | jq '.cross_service_events, .integration_metrics' || echo "$(RED)âŒ è·¨æœå‹™æ¼”ç¤ºå¤±æ•—$(NC)"
	@echo "$(GREEN)ğŸ‰ æ–°æ¶æ§‹æ¼”ç¤ºå®Œæˆ$(NC)"

# ===== é«˜ç´šæ¸…ç†å’Œå ±å‘Šç”Ÿæˆ =====

test-clean-advanced: ## ğŸ§¹ æ¸…ç†æ¸¬è©¦çµæœå’Œè‡¨æ™‚æ–‡ä»¶
	@echo "$(CYAN)ğŸ§¹ æ¸…ç†æ¸¬è©¦çµæœå’Œè‡¨æ™‚æ–‡ä»¶...$(NC)"
	@rm -rf ../tests/reports/* ../test-reports/ ../netstack/tests/test-reports/ ../netstack/tests/*.log 2>/dev/null || true
	@rm -rf ../simworld/backend/tests/reports/ ../simworld/backend/tests/*.log 2>/dev/null || true
	@rm -rf ../**/__pycache__/ ../**/.pytest_cache/ ../.coverage* 2>/dev/null || true
	@$(MAKE) test-clean
	@echo "$(GREEN)âœ… æ¸¬è©¦æ¸…ç†å®Œæˆ$(NC)"

test-report-advanced: ## ğŸ“Š ç”Ÿæˆæ¸¬è©¦å ±å‘Šæ‘˜è¦
	@echo "$(CYAN)ğŸ“Š ç”Ÿæˆæ¸¬è©¦å ±å‘Šæ‘˜è¦...$(NC)"
	@cd .. && python3 -c "import json, glob, os; reports = sorted(glob.glob('tests/reports/test_report_*.json'), reverse=True); print(f'ğŸ“‹ æœ€æ–°æ¸¬è©¦å ±å‘Š: {os.path.basename(reports[0])}' if reports else 'âŒ æœªæ‰¾åˆ°æ¸¬è©¦å ±å‘Š')" 2>/dev/null || echo "âŒ å ±å‘Šè§£æå¤±æ•—"

test-coverage-advanced: ## ğŸ“ˆ ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
	@echo "$(CYAN)ğŸ“ˆ ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š...$(NC)"
	@echo "NetStack è¦†è“‹ç‡:"
	@cd ../netstack && python3 -m pytest --cov=netstack_api --cov-report=html:../tests/reports/coverage/netstack_coverage.html --cov-report=term 2>/dev/null || echo "$(RED)âŒ NetStack è¦†è“‹ç‡ç”Ÿæˆå¤±æ•—$(NC)"
	@echo "SimWorld è¦†è“‹ç‡:"
	@cd ../simworld/backend && python3 -m pytest --cov=app --cov-report=html:../../tests/reports/coverage/simworld_coverage.html --cov-report=term 2>/dev/null || echo "$(RED)âŒ SimWorld è¦†è“‹ç‡ç”Ÿæˆå¤±æ•—$(NC)"
	@echo "$(GREEN)âœ… è¦†è“‹ç‡å ±å‘Šå·²ç”Ÿæˆ$(NC)"

test-env-setup-advanced: ## ğŸŒ è¨­ç½®æ¸¬è©¦ç’°å¢ƒ
	@echo "$(CYAN)ğŸŒ è¨­ç½®æ¸¬è©¦ç’°å¢ƒ...$(NC)"
	@cd .. && pip install -r requirements.txt 2>/dev/null || echo "$(RED)âŒ æ ¹ç›®éŒ„ä¾è³´å®‰è£å¤±æ•—$(NC)"
	@cd ../netstack && pip install -r requirements-dev.txt 2>/dev/null || echo "$(RED)âŒ NetStack ä¾è³´å®‰è£å¤±æ•—$(NC)"
	@cd ../simworld && pip install -r backend/requirements.txt 2>/dev/null || echo "$(RED)âŒ SimWorld ä¾è³´å®‰è£å¤±æ•—$(NC)"
	@$(MAKE) test-env-setup
	@echo "$(GREEN)âœ… æ¸¬è©¦ç’°å¢ƒè¨­ç½®å®Œæˆ$(NC)" 